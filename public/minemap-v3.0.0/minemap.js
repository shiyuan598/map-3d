/**
 * 最后修改时间：2020-8-25 23:26:26
 * 软件版本：minemap 3d 3.1.6版 
 */
(function (global, factory) {
	typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
	typeof define === 'function' && define.amd ? define(factory) :
	(global.minemap = factory());
}(this, (function () { 'use strict';

var shared, worker, minemap;function define(_, chunk) {if (!shared) {shared = chunk;} else if (!worker) {worker = chunk;} else {var workerBundleString = 'var sharedChunk = {}; (' + shared + ')(sharedChunk); (' + worker + ')(sharedChunk);';var sharedChunk = {};shared(sharedChunk);minemap = chunk(sharedChunk);minemap.workerUrl = window.URL.createObjectURL(new Blob([workerBundleString], { type: 'text/javascript' }));}}


define(["exports"],function(t){"use strict";function e(t,e){return t(e={exports:{}},e.exports),e.exports}var r=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now.bind(Date),i=self.requestAnimationFrame||self.mozRequestAnimationFrame||self.webkitRequestAnimationFrame||self.msRequestAnimationFrame,n=self.cancelAnimationFrame||self.mozCancelAnimationFrame||self.webkitCancelAnimationFrame||self.msCancelAnimationFrame,a={now:r,frame:function(t){var e=i(t);return{cancel:function(){return n(e)}}},getImageData:function(t){var e=self.document.createElement("canvas"),r=e.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return e.width=t.width,e.height=t.height,r.drawImage(t,0,0,t.width,t.height),r.getImageData(0,0,t.width,t.height)},resolveURL:function(t){var e=self.document.createElement("a");return e.href=t,e.href},hardwareConcurrency:self.navigator.hardwareConcurrency||4,get devicePixelRatio(){return self.devicePixelRatio},supportsWebp:!1};if(self.document){var o=self.document.createElement("img");o.onload=function(){a.supportsWebp=!0;},o.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=";}var s=u;function u(t,e,r,i){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=r,this.p2y=i;}u.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},u.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},u.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},u.prototype.solveCurveX=function(t,e){var r,i,n,a,o;for(void 0===e&&(e=1e-6),n=t,o=0;o<8;o++){if(a=this.sampleCurveX(n)-t,Math.abs(a)<e)return n;var s=this.sampleCurveDerivativeX(n);if(Math.abs(s)<1e-6)break;n-=a/s;}if(i=1,(n=t)<(r=0))return r;if(n>i)return i;for(;r<i;){if(a=this.sampleCurveX(n),Math.abs(a-t)<e)return n;t>a?r=n:i=n,n=.5*(i-r)+r;}return n},u.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var p=function(t,e,r){this.column=t,this.row=e,this.zoom=r;};p.prototype.clone=function(){return new p(this.column,this.row,this.zoom)},p.prototype.zoomTo=function(t){return this.clone()._zoomTo(t)},p.prototype.sub=function(t){return this.clone()._sub(t)},p.prototype._zoomTo=function(t){var e=Math.pow(2,t-this.zoom);return this.column*=e,this.row*=e,this.zoom=t,this},p.prototype._sub=function(t){return t=t.zoomTo(this.zoom),this.column-=t.column,this.row-=t.row,this};var l=h;function h(t,e,r){this.x=t,this.y=e,this.z=r||0;}function c(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!c(t[r],e[r]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var i in t)if(!c(t[i],e[i]))return!1;return!0}return t===e}function y(t,e,r,i){var n=new s(t,e,r,i);return function(t){return n.solve(t)}}h.prototype={clone:function(){return new h(this.x,this.y,this.z)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=e*this.x-r*this.y,n=r*this.x+e*this.y;return this.x=i,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),n=e.x+r*(this.x-e.x)-i*(this.y-e.y),a=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=n,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},h.convert=function(t){return t instanceof h?t:Array.isArray(t)?new h(t[0],t[1],t[2]):t};var f=y(.25,.1,.25,1),d=y(0,.7,1,.3);function m(t,e,r){return Math.min(r,Math.max(e,t))}function g(t,e,r){var i=r-e,n=((t-e)%i+i)%i+e;return n===e?r:n}function v(t,e,r){if(!t.length)return r(null,[]);var i=t.length,n=new Array(t.length),a=null;t.forEach(function(t,o){e(t,function(t,e){t&&(a=t),n[o]=e,0==--i&&r(a,n);});});}function x(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var i=0,n=e;i<n.length;i+=1){var a=n[i];for(var o in a)t[o]=a[o];}return t}var b=1;function _(){return b++}function w(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e));});}function A(t,e){return-1!==t.indexOf(e,t.length-e.length)}function k(t,e,r){var i={};for(var n in t)i[n]=e.call(r||this,t[n],n,t);return i}function S(t,e,r){var i={};for(var n in t)e.call(r||this,t[n],n,t)&&(i[n]=t[n]);return i}function z(t){return Array.isArray(t)?t.map(z):"object"==typeof t&&t?k(t,z):t}var B={};function T(t){B[t]||("undefined"!=typeof console&&console.warn(t),B[t]=!0);}function M(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function E(t){for(var e=0,r=0,i=t.length,n=i-1,a=void 0,o=void 0;r<i;n=r++)a=t[r],e+=((o=t[n]).x-a.x)*(a.y+o.y);return e}function V(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(t,r,i,n){var a=i||n;return e[r]=!a||a.toLowerCase(),""}),e["max-age"]){var r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r;}return e}var I=1e-6,C="undefined"!=typeof Float32Array?Float32Array:Array;Math.PI;function R(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=r[0],u=r[1],p=r[2],l=r[3];return t[0]=i*s+a*u,t[1]=n*s+o*u,t[2]=i*p+a*l,t[3]=n*p+o*l,t}var L=R;function P(){var t=new C(9);return C!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function F(){var t=new C(16);return C!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function O(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function D(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],p=e[6],l=e[7],h=e[8],c=e[9],y=e[10],f=e[11],d=e[12],m=e[13],g=e[14],v=e[15],x=r[0],b=r[1],_=r[2],w=r[3];return t[0]=x*i+b*s+_*h+w*d,t[1]=x*n+b*u+_*c+w*m,t[2]=x*a+b*p+_*y+w*g,t[3]=x*o+b*l+_*f+w*v,x=r[4],b=r[5],_=r[6],w=r[7],t[4]=x*i+b*s+_*h+w*d,t[5]=x*n+b*u+_*c+w*m,t[6]=x*a+b*p+_*y+w*g,t[7]=x*o+b*l+_*f+w*v,x=r[8],b=r[9],_=r[10],w=r[11],t[8]=x*i+b*s+_*h+w*d,t[9]=x*n+b*u+_*c+w*m,t[10]=x*a+b*p+_*y+w*g,t[11]=x*o+b*l+_*f+w*v,x=r[12],b=r[13],_=r[14],w=r[15],t[12]=x*i+b*s+_*h+w*d,t[13]=x*n+b*u+_*c+w*m,t[14]=x*a+b*p+_*y+w*g,t[15]=x*o+b*l+_*f+w*v,t}function q(t,e,r){var i,n,a,o,s,u,p,l,h,c,y,f,d=r[0],m=r[1],g=r[2];return e===t?(t[12]=e[0]*d+e[4]*m+e[8]*g+e[12],t[13]=e[1]*d+e[5]*m+e[9]*g+e[13],t[14]=e[2]*d+e[6]*m+e[10]*g+e[14],t[15]=e[3]*d+e[7]*m+e[11]*g+e[15]):(i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],u=e[5],p=e[6],l=e[7],h=e[8],c=e[9],y=e[10],f=e[11],t[0]=i,t[1]=n,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=p,t[7]=l,t[8]=h,t[9]=c,t[10]=y,t[11]=f,t[12]=i*d+s*m+h*g+e[12],t[13]=n*d+u*m+c*g+e[13],t[14]=a*d+p*m+y*g+e[14],t[15]=o*d+l*m+f*g+e[15]),t}function U(t,e,r){var i=r[0],n=r[1],a=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function N(t,e,r){var i=Math.sin(r),n=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],p=e[8],l=e[9],h=e[10],c=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*n+p*i,t[5]=o*n+l*i,t[6]=s*n+h*i,t[7]=u*n+c*i,t[8]=p*n-a*i,t[9]=l*n-o*i,t[10]=h*n-s*i,t[11]=c*n-u*i,t}function j(t,e,r){var i=Math.sin(r),n=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],p=e[8],l=e[9],h=e[10],c=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n-p*i,t[1]=o*n-l*i,t[2]=s*n-h*i,t[3]=u*n-c*i,t[8]=a*i+p*n,t[9]=o*i+l*n,t[10]=s*i+h*n,t[11]=u*i+c*n,t}function G(t,e,r){var i=Math.sin(r),n=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],p=e[4],l=e[5],h=e[6],c=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*n+p*i,t[1]=o*n+l*i,t[2]=s*n+h*i,t[3]=u*n+c*i,t[4]=p*n-a*i,t[5]=l*n-o*i,t[6]=h*n-s*i,t[7]=c*n-u*i,t}function X(t,e,r,i,n,a,o){var s=1/(e-r),u=1/(i-n),p=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*p,t[11]=0,t[12]=(e+r)*s,t[13]=(n+i)*u,t[14]=(o+a)*p,t[15]=1,t}var Y=D;function H(){var t=new C(3);return C!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Z(t){var e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function $(t,e,r){var i=new C(3);return i[0]=t,i[1]=e,i[2]=r,i}function J(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function K(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function W(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Q(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function tt(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}function et(t,e){var r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function rt(t,e){var r=e[0],i=e[1],n=e[2],a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t}function it(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function nt(t,e,r){var i=e[0],n=e[1],a=e[2],o=r[0],s=r[1],u=r[2];return t[0]=n*u-a*s,t[1]=a*o-i*u,t[2]=i*s-n*o,t}function at(t,e,r){var i=e[0],n=e[1],a=e[2],o=r[3]*i+r[7]*n+r[11]*a+r[15];return o=o||1,t[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/o,t[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/o,t[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/o,t}var ot,st=W,ut=tt,pt=Z,lt=(ot=H(),function(t,e,r,i,n,a){var o,s;for(e||(e=3),r||(r=0),s=i?Math.min(i*e+r,t.length):t.length,o=r;o<s;o+=e)ot[0]=t[o],ot[1]=t[o+1],ot[2]=t[o+2],n(ot,ot,a),t[o]=ot[0],t[o+1]=ot[1],t[o+2]=ot[2];return t});function ht(){var t=new C(4);return C!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function ct(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=r*r+i*i+n*n+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=n*o,t[3]=a*o),t}function yt(t,e,r,i){var n=e[0],a=e[1],o=e[2],s=e[3];return t[0]=n+i*(r[0]-n),t[1]=a+i*(r[1]-a),t[2]=o+i*(r[2]-o),t[3]=s+i*(r[3]-s),t}function ft(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*o,t[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*o,t[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*o,t[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*o,t}var dt=function(){var t=ht();return function(e,r,i,n,a,o){var s,u;for(r||(r=4),i||(i=0),u=n?Math.min(n*r+i,e.length):e.length,s=i;s<u;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}();function mt(){var t=new C(4);return C!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function gt(t,e,r){r*=.5;var i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function vt(t,e,r,i){var n,a,o,s,u,p=e[0],l=e[1],h=e[2],c=e[3],y=r[0],f=r[1],d=r[2],m=r[3];return(a=p*y+l*f+h*d+c*m)<0&&(a=-a,y=-y,f=-f,d=-d,m=-m),1-a>I?(n=Math.acos(a),o=Math.sin(n),s=Math.sin((1-i)*n)/o,u=Math.sin(i*n)/o):(s=1-i,u=i),t[0]=s*p+u*y,t[1]=s*l+u*f,t[2]=s*h+u*d,t[3]=s*c+u*m,t}function xt(t,e){var r,i=e[0]+e[4]+e[8];if(i>0)r=Math.sqrt(i+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);var a=(n+1)%3,o=(n+2)%3;r=Math.sqrt(e[3*n+n]-e[3*a+a]-e[3*o+o]+1),t[n]=.5*r,r=.5/r,t[3]=(e[3*a+o]-e[3*o+a])*r,t[a]=(e[3*a+n]+e[3*n+a])*r,t[o]=(e[3*o+n]+e[3*n+o])*r;}return t}var bt,_t,wt,At,kt,St,zt=yt,Bt=ct,Tt=(bt=H(),_t=$(1,0,0),wt=$(0,1,0),function(t,e,r){var i=it(e,r);return i<-.999999?(nt(bt,_t,e),pt(bt)<1e-6&&nt(bt,wt,e),rt(bt,bt),gt(t,bt,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(nt(bt,e,r),t[0]=bt[0],t[1]=bt[1],t[2]=bt[2],t[3]=1+i,Bt(t,t))}),Mt=(At=mt(),kt=mt(),function(t,e,r,i,n,a){return vt(At,e,n,a),vt(kt,r,i,a),vt(t,At,kt,2*a*(1-a)),t}),Et=(St=P(),function(t,e,r,i){return St[0]=r[0],St[3]=r[1],St[6]=r[2],St[1]=i[0],St[4]=i[1],St[7]=i[2],St[2]=-e[0],St[5]=-e[1],St[8]=-e[2],Bt(t,xt(t,St))});function Vt(){var t=new C(2);return C!=Float32Array&&(t[0]=0,t[1]=0),t}var It=function(){var t=Vt();return function(e,r,i,n,a,o){var s,u;for(r||(r=2),i||(i=0),u=n?Math.min(n*r+i,e.length):e.length,s=i;s<u;s+=r)t[0]=e[s],t[1]=e[s+1],a(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}}(),Ct=new Float64Array(16);Ct[0]=1,Ct[5]=1,Ct[10]=1,Ct[15]=1,X(Ct,-1,1,-1,1,0,1),q(Ct,Ct,[-1,-1,0]),U(Ct,Ct,[2/8192,2/8192,1]);var Rt=6378.137,Lt=3.141592653589793,Pt={DEFAULT_SPHERE_TRIANGLES:[],SCROLL_ZOOM_SPHERE_CONTROL:4,TILE_GRIDSAMPLES_SPLIT:{SMALL:4,MIDDLE:6,LARGE:9,LARGE_S:20,SMALL_Z_SAMPLES:16,MIDDLE_Z_SAMPLES:8,LARGE_Z_SAMPLES:2,LARGE_S_Z_SAMPLES:1,THE_MIN_SAMPLES:1},TRANSFORM:{PROJECTION_CHANGE_SMALL_ZOOM:5,PROJECTION_CHANGE_MIDDLE_ZOOM:10,PROJECTION_CHANGE_LARGE_ZOOM:15,MAX_LAT:85.05113,MIN_LAT:-85.05113,SPHERE_MAX_PITCH:85,PLAIN_MAX_PITCH:60,SPHERE_DRAG_PAN_MAX_PITCH:45,DEG_TO_RAD:Lt/180,RAD_TO_DEG:180/Lt,R:Rt,REAL_R:6378137,R_SCALE:.001,R_ZOOM:1e3,CIR:2*Lt*Rt,COVERING_TILE_ZOOM:6,EPSILON2:.01,EPSILON3:.001,EPSILON4:1e-4,EPSILON5:1e-5,EPSILON6:1e-6,EPSILON7:1e-7,EPSILON8:1e-8,EPSILON9:1e-9,EPSILON10:1e-10,EPSILON11:1e-11,EPSILON12:1e-12,UNIT_Z:[0,0,1],UNIT_Z_REVERSE:[0,0,-1],VIEW_MAX_BOUNDING:{west:-180,south:-85.05113,east:180,north:85.05113},TWO_PI:2*Lt,PI_OVER_TWO:Lt/2,FP_ZOOM:17,TERRAIN_FIND_ZOOM_MIN:10,TERRAIN_SIMPLIFY_ZOOM_MAX:15,ERR_TERRAIN_ALT:-Rt,OFFSCREEN_WIDTH:2048,OFFSCREEN_HEIGHT:2048,SHADOW_VIEWPORT_SIZE:[8192,8192],RAY_PICK_MIN_ZOOM:4},SOURCE:{MAX_BOUNDS:[[-180,90],[180,90],[180,-90],[-180,-90]],ERROR_IMG_INDEX:-999,CLOCK_SKEW_RETRY_TIMEOUT:3e4,TRANSPARENT_PNG_URL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",GLOBAL_SOURCE_ID:"sphere-image-globe",SKYBOX_SOURCE_ID:"sphere-image-skybox",PANORAMA_SOURCE_ID:"panorama-special-source",ATMOSPHERE_SOURCE_ID:"sphere-atmosphere",COSMOS_SOURCE_ID:"sphere-cosmos",MAX_GLTF_TILE_COUNT:128,MAX_GLTF_TILE_TO_FIND_PARENT:64,MAX_IMAGE_CONCURRENCY:32},MODEL_TYPE:{OSGB:"osgb",E3DCM:"e3dcm",TDMODEL:"3dmodel"},LAYER:{PANORAMA_LAYER_ID:"panorama-special-layer",RADIATION_REGIONS:5},FB_MATRIX:Ct,TILE:{EXTENT:8192,DEPTH_MAX_RANGE:1,OFFSCREEN_SIZE:1024,OFFSCREEN_SIZE_WITH_PIXEL_RATIO:1024*(self.devicePixelRatio>1?1.3:1)},FPMODE:{MAP:"MAP",DRAG_ROTATE:"DRAG_ROTATE",NULL:"NULL"},FRAMEBUFFER:{DEPTH_IMAGE_SCALE:1},EFFECTS:{FOG_START_DISTANCE:4,FOG_CALC_LENGTH:20,SHADOW_OFFSET:2.5e-7},CAMERA:{SUNLIGHT_CAMERA_ID:"SUNLIGHT_CAMERA_ID",SKYBOX_CAMERA_ID:"SKYBOX_CAMERA_ID",ATMOSPHERE_BLEND_CAMERA_ID:"ATMOSPHERE_BLEND_CAMERA_ID",DRAW_MODE:{NORMAL:"NORMAL",OFFSCREEN:"OFFSCREEN",OFFSCREEN_VIEWSHED:"OFFSCREEN_VIEWSHED",ONSCREEN_SHADOW:"SHADOW",ONSCREEN_VIEWSHED:"VIEWSHED",ONSCREEN_ALL:"ONSCREEN_ALL"}}};function Ft(t,e){if(e&&-1!=e.indexOf("?")){var r=e.split("?")[1],i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),n=r.match(i);if(null!=n)return unescape(n[2])}return null}function Ot(t){var e=t.responseURL||t.__responseURL,r=t.response,i=r?r.byteLength:0,n=Ft("token",e)||"",a=Ft("appKey",e)||"",o=a.length>0?a:n;if(o.length>0&&i>8){var s=new Uint8Array(r);if("minedata"===function(t,e,r){for(var i="",n=e;n<r;){var a=t[n],o=null,s=a>239?4:a>223?3:a>191?2:1;if(n+s>r)break;var u=void 0,p=void 0,l=void 0;1===s?a<128&&(o=a):2===s?128==(192&(u=t[n+1]))&&(o=(31&a)<<6|63&u)<=127&&(o=null):3===s?(u=t[n+1],p=t[n+2],128==(192&u)&&128==(192&p)&&((o=(15&a)<<12|(63&u)<<6|63&p)<=2047||o>=55296&&o<=57343)&&(o=null)):4===s&&(u=t[n+1],p=t[n+2],l=t[n+3],128==(192&u)&&128==(192&p)&&128==(192&l)&&((o=(15&a)<<18|(63&u)<<12|(63&p)<<6|63&l)<=65535||o>=1114112)&&(o=null)),null===o?(o=65533,s=1):o>65535&&(o-=65536,i+=String.fromCharCode(o>>>10&1023|55296),o=56320|1023&o),i+=String.fromCharCode(o),n+=s;}return i}(s,i-8,i).toLowerCase())return function(t,e){var r=t.length-8;if(r<=e)for(var i=0;i<r/2;i++){var n=t[i];t[i]=t[r-i-1],t[r-i-1]=n;}else for(var a=parseInt(r/e),o=parseInt(e/2),s=0;s<a;s++)for(var u=s*e,p=(s+1)*e-1,l=u,h=0;l<u+o;l++,h++){var c=l,y=p-h,f=t[c];t[c]=t[y],t[y]=f;}}(s,function(t){for(var e=0,r=t.length,i=0;i<r;i++)e+=t.charCodeAt(i);return parseInt(e/r)}(o)),r.slice(0,i-8)}return r}var Dt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Dt);var qt=function(t){function e(e,r,i){t.call(this,e),this.status=r,this.url=i,this.name=this.constructor.name,this.message=e;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error);function Ut(t){var e=new self.XMLHttpRequest;for(var r in e.open("GET",t.url,!0),t.headers)e.setRequestHeader(r,t.headers[r]);return e.withCredentials="include"===t.credentials,e}var Nt=function(t,e){var r=Ut("string"==typeof t?{url:t}:t);return r.setRequestHeader("Accept","application/json"),r.onerror=function(){e(new Error(r.statusText));},r.onload=function(){if(r.status>=200&&r.status<300&&r.response){var i;try{i=JSON.parse(r.response);}catch(t){return e(t)}e(null,i);}else e(new qt(r.statusText,r.status,t.url));},r.send(),{cancel:function(){return r.abort()}}},jt=function(t,e){var r=Ut(t);return r.__responseURL=t.url,r.responseType="arraybuffer",r.onerror=function(){e(new Error(r.statusText));},r.onload=function(){var i=r.response;if(0===i.byteLength&&200===r.status&&e(null,{data:i,cacheControl:r.getResponseHeader("Cache-Control"),expires:r.getResponseHeader("Expires")}),r.status>=200&&r.status<300&&r.response){var n=Ot(r);e(null,{data:n,cacheControl:r.getResponseHeader("Cache-Control"),expires:r.getResponseHeader("Expires")});}else e(new qt(r.statusText,r.status,t.url));},r.send(),{cancel:function(){return r.abort()}}};var Gt=function(t,e){return jt(t,function(t,r){if(t)e(t);else if(r){var i=new self.Image,n=self.URL||self.webkitURL;i.onload=function(){e(null,i),n.revokeObjectURL(i.src);};var a=new self.Blob([new Uint8Array(r.data)],{type:"image/png"});i.cacheControl=r.cacheControl,i.expires=r.expires,i.src=r.data.byteLength?n.createObjectURL(a):Pt.SOURCE.TRANSPARENT_PNG_URL;}})};function Xt(t,e,r){r[t]&&-1!==r[t].indexOf(e)||(r[t]=r[t]||[],r[t].push(e));}function Yt(t,e,r){if(r&&r[t]){var i=r[t].indexOf(e);-1!==i&&r[t].splice(i,1);}}var Ht=function(t,e){void 0===e&&(e={}),x(this,e),this.type=t;},Zt=function(t){function e(e,r){void 0===r&&(r={}),t.call(this,"error",x({error:e},r));}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Ht),$t=function(){};$t.prototype.on=function(t,e){return this._listeners=this._listeners||{},Xt(t,e,this._listeners),this},$t.prototype.off=function(t,e){return Yt(t,e,this._listeners),Yt(t,e,this._oneTimeListeners),this},$t.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},Xt(t,e,this._oneTimeListeners),this},$t.prototype.fire=function(t){"string"==typeof t&&(t=new Ht(t,arguments[1]||{}));var e=t.type;if(this.listens(e)){t.target=this;for(var r=0,i=this._listeners&&this._listeners[e]?this._listeners[e].slice():[];r<i.length;r+=1){i[r].call(this,t);}for(var n=0,a=this._oneTimeListeners&&this._oneTimeListeners[e]?this._oneTimeListeners[e].slice():[];n<a.length;n+=1){var o=a[n];Yt(e,o,this._oneTimeListeners),o.call(this,t);}var s=this._eventedParent;s&&(x(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),s.fire(t));}else t instanceof Zt&&console.error(t.error);return this},$t.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},$t.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var Jt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_geojson","source_video","source_image","source_sphere_image","source_3d_model","source_3d_tile","source_panorama"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},tileUsage:{type:"enum",values:{all:{},plain:{},sphere:{}},default:"plain"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},terrainTiles:{type:"array",value:"string"},renderWithTerrain:{type:"boolean"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.0511,180,85.0511]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},tileUsage:{type:"enum",values:{all:{},plain:{},sphere:{}},default:"plain"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},lineMetrics:{type:"boolean",default:!1},tileUsage:{type:"enum",values:{all:{},plain:{},sphere:{}},default:"plain"}},source_sphere_image:{type:{required:!0,type:"enum",values:{"sphere-image":{}}},url:{required:!0,type:"string"},renderInner:{required:!0,type:"boolean"},radius:{required:!0,type:"number"},extractRadius:{required:!1,type:"number"},gridSamples:{required:!1,type:"number"},debug:{type:"boolean"},renderAtmosphere:{type:"boolean"}},source_3d_model:{type:{required:!0,type:"enum",values:{"3d-model":{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},bounds:{type:"array",length:4,value:{type:"array",length:2,value:"number"}},location:{required:!0,type:"array",value:{type:"number"}},scale:{required:!0,type:"array",value:{type:"number"}},pickable:{type:"boolean"},filter:{type:"array",value:"*"},aabbFilter:{type:"array",value:"*"},rotation:{required:!0,type:"array",value:{type:"number"}},"up-axis":{type:"enum",values:{"Y-UP":{},"Z-UP":{}}},translation:{required:!0,type:"array",value:{type:"number"}},modelFolder:{required:!0,type:"string"}},source_3d_tile:{type:{required:!0,type:"enum",values:{"3d-tile":{}}},modelFolder:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},bounds:{type:"array",length:4,value:{type:"array",length:2,value:"number"}},location:{required:!0,type:"array",value:{type:"number"}},translation:{required:!0,type:"array",value:{type:"number"}},collectResourceTiming:{required:!0,type:"boolean"},"up-axis":{type:"enum",values:{"Y-UP":{},"Z-UP":{}}},pickable:{type:"boolean"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}},grid:{type:"number",default:1}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}},grid:{type:"number",default:1},wms:{required:!1,type:"boolean"}},source_panorama:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},extrusion:{},raster:{},hillshade:{},tracking:{},"sphere-raster":{},"sphere-fill":{},"sphere-line":{},"sphere-symbol":{},"sphere-circle":{},"sphere-heatmap":{},"sphere-extrusion":{},"sphere-tracking":{},"sphere-sprite":{},sprite:{},symtracking:{},histogram:{},"3d-model":{},"3d-tile":{},"3d-point-cloud":{},background:{},"sphere-background":{},panorama:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"},"depth-test":{type:"boolean"},location:{type:"array",value:{type:"number"}},rotation:{type:"array",value:{type:"number"}},translation:{type:"array",value:{type:"number"}},scale:{type:"array",value:{type:"number"}},clipGround:{type:"boolean"},isSpecialLight:{type:"boolean"},highLightColorsIndex:{type:"number"},highLightColors:{type:"color"},"viewshed-render":{type:"boolean"},cvtBGR2RGB:{type:"boolean"},"radiation-regions":{type:"array",value:{type:"any"},required:!1},"shadow-center":{type:"boolean"},specialLights:{type:"array",value:{type:"*"}}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sphere-background","layout_tracking","layout_sphere-fill","layout_sphere-line","layout_sphere-symbol","layout_sphere-circle","layout_sphere-heatmap","layout_sphere-raster","layout_sphere-extrusion","layout_sphere-tracking","layout_sphere-sprite","layout_sprite","layout_3d-model","layout_3d-tile","layout_3d-point-cloud","layout_panorama"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_extrusion:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"border-visibility":{type:"enum",default:"none",values:{visible:{},none:{}},"property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"string",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"string",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_tracking:{"tracking-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"tracking-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"tracking-miter-limit":{type:"number",default:2,requires:[{"tracking-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"tracking-round-limit":{type:"number",default:1.05,requires:[{"tracking-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"tracking-display-mode":{type:"enum",function:"piecewise-constant",values:["loop","reverse","loop-reserve","reverse-reserve"],default:"loop","property-type":"data-constant"}},layout_sprite:{"sprite-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sprite-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"sprite-miter-limit":{type:"number",default:2,requires:[{"sprite-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sprite-round-limit":{type:"number",default:1.05,requires:[{"sprite-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symtracking:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"string",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"string",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"symtracking-time-segment":{type:"number",function:"piecewise-constant",default:20,minimum:1,"property-type":"data-constant"},"symtracking-fps":{type:"number",function:"piecewise-constant",default:1,minimum:1,"property-type":"data-constant"},"compatible-mode":{type:"boolean",function:"piecewise-constant",default:!0,"property-type":"data-constant"}},layout_histogram:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"histogram-color-render":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"histogram-max-height-render":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"}},layout_panorama:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},like:{},"!like":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},arrin:{},"!arrin":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Zoom"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Heatmap"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sphere-background","paint_tracking","paint_sphere-fill","paint_sphere-line","paint_sphere-symbol","paint_sphere-circle","paint_sphere-raster","paint_sphere-extrusion","paint_sphere-tracking","paint_sphere-sprite","paint_sprite","paint_3d-model","paint_3d-point-cloud","paint_panorama"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"fill-water":{type:"enum",values:{water:{},none:{}},default:"none",transition:!1,"property-type":"data-constant"},"render-3d":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"}},paint_extrusion:{"extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"extrusion-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"render-road":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-opacity":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:0,maximum:1,transition:!0,"property-type":"data-driven"},"line-border-color":{type:"color",default:"#ffffff",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},transition:!0,requires:[{"!":"line-pattern"}],"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"render-3d":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"render-3d":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"render-road-mark":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"symbol-height-offset":{type:"number",function:"piecewise-constant",default:0,minimum:0,maximum:1e4,"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_tracking:{"tracking-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"tracking-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"tracking-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["tracking-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"tracking-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-type":{type:"enum",function:"piecewise-constant",values:["real-time","history"],default:"real-time","property-type":"constant"},"tracking-seg-count":{type:"number",function:"interpolated",default:700,minimum:0,maximum:1e4,transition:!0,"property-type":"constant"},"tracking-seg-group":{type:"number",function:"interpolated",default:20,minimum:1,maximum:600,transition:!0,"property-type":"constant"},"tracking-speed":{type:"number",function:"interpolated",default:1,minimum:1,maximum:500,transition:!0,"property-type":"constant"},"tracking-delay":{type:"number",default:20,minimum:0,maximum:120,transition:!0,"property-type":"constant"},"tracking-speed-factor":{type:"number",default:1,minimum:0,function:"interpolated",transition:!0,units:"pixels","property-type":"constant"}},paint_sprite:{"sprite-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"sprite-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sprite-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["sprite-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sprite-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-speed-factor":{type:"number",default:1,minimum:0,function:"interpolated",transition:!0,units:"pixels","property-type":"data-constant"},"render-3d":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"sprite-interpolate":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"sprite-status":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:1,maximum:5,transition:!0,"property-type":"data-driven"},"sprite-instatus":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:1,maximum:5,transition:!0,"property-type":"data-driven"},"sprite-height-offset":{type:"number",function:"piecewise-constant",default:0,minimum:0,maximum:100,"property-type":"data-constant"}},paint_symtracking:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symtracking-delay":{type:"number",function:"piecewise-constant",default:10,minimum:0,maximum:120,transition:!0,"property-type":"data-constant"},"render-3d":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"symtracking-height-offset":{type:"number",function:"piecewise-constant",default:0,minimum:0,maximum:100,"property-type":"data-constant"},"render-road-mark":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"}},paint_histogram:{"histogram-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"histogram-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"histogram-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"histogram-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"histogram-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["histogram-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"histogram-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"histogram-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"histogram-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["histogram-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"histogram-dynamic":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"histogram-heightArr1":{type:"color",default:[0,0,0,0],transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},units:"x-color","property-type":"data-driven"},"histogram-heightArr2":{type:"color",default:[0,0,0,0],transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},units:"x-color","property-type":"data-driven"},"histogram-heightArr3":{type:"color",default:[0,0,0,0],transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},units:"x-color","property-type":"data-driven"},"histogram-time":{type:"number",function:"piecewise-constant",default:1e3,minimum:0,units:"millisecond",transition:!0,"property-type":"data-constant"},"histogram-count":{type:"number",function:"piecewise-constant",default:12,minimum:1,maximum:12,units:"millisecond",transition:!0,"property-type":"data-constant"},"histogram-colors":{type:"array",value:"string",length:5,default:["#ffc1e0","#bbffff","#00e3e3","#005757","#ea0000"],function:"interpolated",transition:!0,"property-type":"data-constant"},"histogram-max-height":{type:"number",function:"piecewise-constant",default:200,minimum:0,units:"meters",transition:!0,"property-type":"data-constant"},"histogram-fluorescent":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"}},paint_panorama:{"panorama-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"layout_sphere-background":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-sprite":{"sprite-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sprite-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"sprite-miter-limit":{type:"number",default:2,requires:[{"sprite-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sprite-round-limit":{type:"number",default:1.05,requires:[{"sprite-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-raster":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-fill":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-line":{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"border-visibility":{type:"enum",default:"none",values:{visible:{},none:{}},"property-type":"constant"}},"layout_sphere-symbol":{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"string",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"string",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-circle":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-heatmap":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_sphere-tracking":{"tracking-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"tracking-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"tracking-miter-limit":{type:"number",default:2,requires:[{"tracking-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"tracking-round-limit":{type:"number",default:1.05,requires:[{"tracking-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"tracking-display-mode":{type:"enum",function:"piecewise-constant",values:["loop","reverse","loop-reserve","reverse-reserve"],default:"loop","property-type":"data-constant"}},"layout_3d-model":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_3d-tile":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_3d-point-cloud":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},"paint_sphere-background":{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},"paint_sphere-raster":{"sphere-raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sphere-raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sphere-raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sphere-raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sphere-raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sphere-raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sphere-raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sphere-raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},"paint_sphere-fill":{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"}},"paint_sphere-line":{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-width":{type:"number",default:0,minimum:0,function:"interpolated",transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-opacity":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:0,maximum:1,transition:!0,"property-type":"data-driven"},"line-border-color":{type:"color",default:"#ffffff",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},transition:!0,requires:[{"!":"line-pattern"}],"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},"paint_sphere-symbol":{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_sphere-circle":{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_sphere-heatmap":{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},"paint_sphere-extrusion":{"extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"extrusion-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"extrusion-top-pattern":{type:"string",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"render-road":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"}},"paint_sphere-tracking":{"tracking-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"tracking-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"tracking-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["tracking-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"tracking-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"tracking-type":{type:"enum",function:"piecewise-constant",values:["real-time","history"],default:"real-time","property-type":"constant"},"tracking-seg-count":{type:"number",function:"interpolated",default:700,minimum:0,maximum:1e4,transition:!0,"property-type":"constant"},"tracking-seg-group":{type:"number",function:"interpolated",default:20,minimum:1,maximum:600,transition:!0,"property-type":"constant"},"tracking-speed":{type:"number",function:"interpolated",default:1,minimum:1,maximum:500,transition:!0,"property-type":"constant"},"tracking-delay":{type:"number",default:20,minimum:0,maximum:120,transition:!0,"property-type":"constant"},"tracking-speed-factor":{type:"number",default:1,minimum:0,function:"interpolated",transition:!0,units:"pixels","property-type":"constant"}},"paint_sphere-sprite":{"sprite-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"sprite-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"sprite-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["sprite-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sprite-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"sprite-speed-factor":{type:"number",default:1,minimum:0,function:"interpolated",transition:!0,units:"pixels","property-type":"data-constant"},"sprite-interpolate":{type:"boolean",function:"piecewise-constant",default:!1,"property-type":"data-constant"},"sprite-status":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:1,maximum:5,transition:!0,"property-type":"data-driven"},"sprite-instatus":{type:"number",function:"interpolated",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},default:1,minimum:1,maximum:5,transition:!0,"property-type":"data-driven"},"sprite-height-offset":{type:"number",function:"piecewise-constant",default:0,minimum:0,maximum:100,"property-type":"data-constant"}},"paint_3d-model":{"3d-model-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},"paint_3d-tile":{"3d-tile-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},"paint_3d-point-cloud":{"3d-point-cloud-mode":{type:"enum",values:{color:{},intensity:{},height:{},classification:{}},default:"color","property-type":"constant"},"3d-point-cloud-size":{type:"number",default:1,minimum:0,maximum:100,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"3d-point-cloud-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}}},Kt=function(t,e,r,i){this.message=(t?t+": ":"")+r,i&&(this.identifier=i),null!==e&&void 0!==e&&e.__line__&&(this.line=e.__line__);};function Wt(t){var e=t.key,r=t.value;return r?[new Kt(e,r,"constants have been deprecated as of v8")]:[]}function Qt(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var i=0,n=e;i<n.length;i+=1){var a=n[i];for(var o in a)t[o]=a[o];}return t}function te(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function ee(t){return Array.isArray(t)?t.map(ee):te(t)}var re=function(t){function e(e,r){t.call(this,r),this.message=r,this.key=e;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),ie=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var r=0,i=e;r<i.length;r+=1){var n=i[r],a=n[0],o=n[1];this.bindings[a]=o;}};ie.prototype.concat=function(t){return new ie(this,t)},ie.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},ie.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var ne={kind:"null"},ae={kind:"number"},oe={kind:"string"},se={kind:"boolean"},ue={kind:"color"},pe={kind:"object"},le={kind:"value"},he={kind:"collator"};function ce(t,e){return{kind:"array",itemType:t,N:e}}function ye(t){if("array"===t.kind){var e=ye(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var fe=[ne,ae,oe,se,ue,pe,ce(le)];function de(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&!de(t.itemType,e.itemType)&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var r=0,i=fe;r<i.length;r+=1){if(!de(i[r],e))return null}}return"Expected "+ye(t)+" but found "+ye(e)+" instead."}var me=e(function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function i(t){return(t=Math.round(t))<0?0:t>255?255:t}function n(t){return t<0?0:t>1?1:t}function a(t){return"%"===t[t.length-1]?i(parseFloat(t)/100*255):i(parseInt(t))}function o(t){return"%"===t[t.length-1]?n(parseFloat(t)/100):n(parseFloat(t))}function s(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{e.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in r)return r[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=n.indexOf("("),p=n.indexOf(")");if(-1!==u&&p+1===n.length){var l=n.substr(0,u),h=n.substr(u+1,p-(u+1)).split(","),c=1;switch(l){case"rgba":if(4!==h.length)return null;c=o(h.pop());case"rgb":return 3!==h.length?null:[a(h[0]),a(h[1]),a(h[2]),c];case"hsla":if(4!==h.length)return null;c=o(h.pop());case"hsl":if(3!==h.length)return null;var y=(parseFloat(h[0])%360+360)%360/360,f=o(h[1]),d=o(h[2]),m=d<=.5?d*(f+1):d+f-d*f,g=2*d-m;return[i(255*s(g,m,y+1/3)),i(255*s(g,m,y)),i(255*s(g,m,y-1/3)),c];default:return null}}return null};}catch(t){}}),ge=me.parseCSSColor,ve=function(t,e,r,i){void 0===i&&(i=1),this.r=t,this.g=e,this.b=r,this.a=i;};ve.parse=function(t){if(t){if(t instanceof ve)return t;if("string"==typeof t){var e=ge(t);if(e)return new ve(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},ve.prototype.toString=function(){var t=this.toArray(),e=t[0],r=t[1],i=t[2],n=t[3];return"rgba("+Math.round(e)+","+Math.round(r)+","+Math.round(i)+","+n+")"},ve.prototype.toArray=function(){var t=this.r,e=this.g,r=this.b,i=this.a;return 0===i?[0,0,0,0]:[255*t/i,255*e/i,255*r/i,i]},ve.black=new ve(0,0,0,1),ve.white=new ve(1,1,1,1),ve.transparent=new ve(0,0,0,0);var xe=function(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"});};xe.prototype.compare=function(t,e){return this.collator.compare(t,e)},xe.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var be=function(t,e,r){this.type=he,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e;};function _e(t,e,r,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:"Invalid rgba value ["+[t,e,r,i].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof i?[t,e,r,i]:[t,e,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function we(t){if(null===t)return ne;if("string"==typeof t)return oe;if("boolean"==typeof t)return se;if("number"==typeof t)return ae;if(t instanceof ve)return ue;if(t instanceof xe)return he;if(Array.isArray(t)){for(var e,r=t.length,i=0,n=t;i<n.length;i+=1){var a=we(n[i]);if(e){if(e===a)continue;e=le;break}e=a;}return ce(e||le,r)}return pe}be.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var r=t[1];if("object"!=typeof r||Array.isArray(r))return e.error("Collator options argument must be an object.");var i=e.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,se);if(!i)return null;var n=e.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,se);if(!n)return null;var a=null;return r.locale&&!(a=e.parse(r.locale,1,oe))?null:new be(i,n,a)},be.prototype.evaluate=function(t){return new xe(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},be.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale);},be.prototype.possibleOutputs=function(){return[void 0]},be.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Ae=function(t,e){this.type=t,this.value=e;};Ae.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!function t(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof ve)return!0;if(e instanceof xe)return!0;if(Array.isArray(e)){for(var r=0,i=e;r<i.length;r+=1)if(!t(i[r]))return!1;return!0}if("object"==typeof e){for(var n in e)if(!t(e[n]))return!1;return!0}return!1}(t[1]))return e.error("invalid value");var r=t[1],i=we(r),n=e.expectedType;return"array"!==i.kind||0!==i.N||!n||"array"!==n.kind||"number"==typeof n.N&&0!==n.N||(i=n),new Ae(i,r)},Ae.prototype.evaluate=function(){return this.value},Ae.prototype.eachChild=function(){},Ae.prototype.possibleOutputs=function(){return[this.value]},Ae.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ve?["rgba"].concat(this.value.toArray()):this.value};var ke=function(t){this.name="ExpressionEvaluationError",this.message=t;};ke.prototype.toJSON=function(){return this.message};var Se={string:oe,number:ae,boolean:se,object:pe},ze=function(t,e){this.type=t,this.args=e;};ze.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");for(var r=t[0],i=Se[r],n=[],a=1;a<t.length;a++){var o=e.parse(t[a],a,le);if(!o)return null;n.push(o);}return new ze(i,n)},ze.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!de(this.type,we(r)))return r;if(e===this.args.length-1)throw new ke("Expected value to be of type "+ye(this.type)+", but found "+ye(we(r))+" instead.")}return null},ze.prototype.eachChild=function(t){this.args.forEach(t);},ze.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}))},ze.prototype.serialize=function(){return[this.type.kind].concat(this.args.map(function(t){return t.serialize()}))};var Be={string:oe,number:ae,boolean:se},Te=function(t,e){this.type=t,this.input=e;};Te.parse=function(t,e){if(t.length<2||t.length>4)return e.error("Expected 1, 2, or 3 arguments, but found "+(t.length-1)+" instead.");var r,i;if(t.length>2){var n=t[1];if("string"!=typeof n||!(n in Be))return e.error('The item type argument of "array" must be one of string, number, boolean',1);r=Be[n];}else r=le;if(t.length>3){if("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2]))return e.error('The length argument to "array" must be a positive integer literal',2);i=t[2];}var a=ce(r,i),o=e.parse(t[t.length-1],t.length-1,le);return o?new Te(a,o):null},Te.prototype.evaluate=function(t){var e=this.input.evaluate(t);if(de(this.type,we(e)))throw new ke("Expected value to be of type "+ye(this.type)+", but found "+ye(we(e))+" instead.");return e},Te.prototype.eachChild=function(t){t(this.input);},Te.prototype.possibleOutputs=function(){return this.input.possibleOutputs()},Te.prototype.serialize=function(){var t=["array"],e=this.type.itemType;if("string"===e.kind||"number"===e.kind||"boolean"===e.kind){t.push(e.kind);var r=this.type.N;"number"==typeof r&&t.push(r);}return t.push(this.input.serialize()),t};var Me={"to-number":ae,"to-color":ue},Ee=function(t,e){this.type=t,this.args=e;};Ee.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");for(var r=t[0],i=Me[r],n=[],a=1;a<t.length;a++){var o=e.parse(t[a],a,le);if(!o)return null;n.push(o);}return new Ee(i,n)},Ee.prototype.evaluate=function(t){if("color"===this.type.kind){for(var e,r,i=0,n=this.args;i<n.length;i+=1){if(r=null,"string"==typeof(e=n[i].evaluate(t))){var a=t.parseColor(e);if(a)return a}else if(Array.isArray(e)&&!(r=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":_e(e[0],e[1],e[2],e[3])))return new ve(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ke(r||"Could not parse color from value '"+("string"==typeof e?e:JSON.stringify(e))+"'")}for(var o=null,s=0,u=this.args;s<u.length;s+=1){if(null!==(o=u[s].evaluate(t))){var p=Number(o);if(!isNaN(p))return p}}throw new ke("Could not convert "+JSON.stringify(o)+" to number.")},Ee.prototype.eachChild=function(t){this.args.forEach(t);},Ee.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}))},Ee.prototype.serialize=function(){var t=["to-"+this.type.kind];return this.eachChild(function(e){t.push(e.serialize());}),t};var Ve=["Unknown","Point","LineString","Polygon"],Ie=function(){this._parseColorCache={};};Ie.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Ie.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?Ve[this.feature.type]:this.feature.type:null},Ie.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Ie.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ve.parse(t)),e};var Ce=function(t,e,r,i){this.name=t,this.type=e,this._evaluate=r,this.args=i;};function Re(t){if(t instanceof Ce){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}var e=!0;return t.eachChild(function(t){e&&!Re(t)&&(e=!1);}),e}function Le(t){if(t instanceof Ce&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild(function(t){e&&!Le(t)&&(e=!1);}),e}function Pe(t,e){if(t instanceof Ce&&e.indexOf(t.name)>=0)return!1;var r=!0;return t.eachChild(function(t){r&&!Pe(t,e)&&(r=!1);}),r}Ce.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Ce.prototype.eachChild=function(t){this.args.forEach(t);},Ce.prototype.possibleOutputs=function(){return[void 0]},Ce.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Ce.parse=function(t,e){var r=t[0],i=Ce.definitions[r];if(!i)return e.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0);for(var n=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,o=a.filter(function(e){var r=e[0];return!Array.isArray(r)||r.length===t.length-1}),s=[],u=1;u<t.length;u++){var p=t[u],l=void 0;if(1===o.length){var h=o[0][0];l=Array.isArray(h)?h[u-1]:h.type;}var c=e.parse(p,1+s.length,l);if(!c)return null;s.push(c);}for(var y=null,f=0,d=o;f<d.length;f+=1){var m=d[f],g=m[0],v=m[1];if(y=new Oe(e.registry,e.path,null,e.scope),Array.isArray(g)&&g.length!==s.length)y.error("Expected "+g.length+" arguments, but found "+s.length+" instead.");else{for(var x=0;x<s.length;x++){var b=Array.isArray(g)?g[x]:g.type,_=s[x];y.concat(x+1).checkSubtype(b,_.type);}if(0===y.errors.length)return new Ce(r,n,v,s)}}if(1===o.length)e.errors.push.apply(e.errors,y.errors);else{var w=(o.length?o:a).map(function(t){var e,r=t[0];return e=r,Array.isArray(e)?"("+e.map(ye).join(", ")+")":"("+ye(e.type)+"...)"}).join(" | "),A=s.map(function(t){return ye(t.type)}).join(", ");e.error("Expected arguments of type "+w+", but found ("+A+") instead.");}return null},Ce.register=function(t,e){for(var r in Ce.definitions=e,e)t[r]=Ce;};var Fe=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e;};Fe.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var r=t[1];return e.scope.has(r)?new Fe(r,e.scope.get(r)):e.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},Fe.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Fe.prototype.eachChild=function(){},Fe.prototype.possibleOutputs=function(){return[void 0]},Fe.prototype.serialize=function(){return["var",this.name]};var Oe=function(t,e,r,i,n){void 0===e&&(e=[]),void 0===i&&(i=new ie),void 0===n&&(n=[]),this.registry=t,this.path=e,this.key=e.map(function(t){return"["+t+"]"}).join(""),this.scope=i,this.errors=n,this.expectedType=r;};function De(t,e){for(var r,i,n=0,a=t.length-1,o=0;n<=a;){if(r=t[o=Math.floor((n+a)/2)],i=t[o+1],e===r||e>r&&e<i)return o;if(r<e)n=o+1;else{if(!(r>e))throw new ke("Input is not a number.");a=o-1;}}return Math.max(o-1,0)}Oe.prototype.parse=function(t,e,r,i,n){return void 0===n&&(n={}),e?this.concat(e,r,i)._parse(t,n):this._parse(t,n)},Oe.prototype._parse=function(t,e){if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var r=t[0];if("string"!=typeof r)return this.error("Expression name must be a string, but found "+typeof r+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[r];if(i){var n=i.parse(t,this);if(!n)return null;if(this.expectedType){var a=this.expectedType,o=n.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind||"value"!==o.kind)if("array"===a.kind&&"value"===o.kind)e.omitTypeAnnotations||(n=new Te(a,n));else if("color"!==a.kind||"value"!==o.kind&&"string"!==o.kind){if(this.checkSubtype(this.expectedType,n.type))return null}else e.omitTypeAnnotations||(n=new Ee(a,[n]));else e.omitTypeAnnotations||(n=new ze(a,[n]));}if(!(n instanceof Ae)&&function t(e){if(e instanceof Fe)return t(e.boundExpression);if(e instanceof Ce&&"error"===e.name)return!1;if(e instanceof be)return!1;var r=e instanceof Ee||e instanceof ze||e instanceof Te;var i=!0;e.eachChild(function(e){i=r?i&&t(e):i&&e instanceof Ae;});if(!i)return!1;return Re(e)&&Pe(e,["zoom","heatmap-density","line-progress","is-supported-script"])}(n)){var s=new Ie;try{n=new Ae(n.type,n.evaluate(s));}catch(t){return this.error(t.message),null}}return n}return this.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0)}return void 0===t?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error("Expected an array, but found "+typeof t+" instead.")},Oe.prototype.concat=function(t,e,r){var i="number"==typeof t?this.path.concat(t):this.path,n=r?this.scope.concat(r):this.scope;return new Oe(this.registry,i,e||null,n,this.errors)},Oe.prototype.error=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var i=""+this.key+e.map(function(t){return"["+t+"]"}).join("");this.errors.push(new re(i,t));},Oe.prototype.checkSubtype=function(t,e){var r=de(t,e);return r&&this.error(r),r};var qe=function(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var i=0,n=r;i<n.length;i+=1){var a=n[i],o=a[0],s=a[1];this.labels.push(o),this.outputs.push(s);}};function Ue(t,e,r){return t*(1-r)+e*r}qe.parse=function(t,e){var r=t[1],i=t.slice(2);if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(r=e.parse(r,1,ae)))return null;var n=[],a=null;e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType),i.unshift(-1/0);for(var o=0;o<i.length;o+=2){var s=i[o],u=i[o+1],p=o+1,l=o+2;if("number"!=typeof s)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(n.length&&n[n.length-1][0]>=s)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',p);var h=e.parse(u,l,a);if(!h)return null;a=a||h.type,n.push([s,h]);}return new qe(a,r,n)},qe.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var i=this.input.evaluate(t);if(i<=e[0])return r[0].evaluate(t);var n=e.length;return i>=e[n-1]?r[n-1].evaluate(t):r[De(e,i)].evaluate(t)},qe.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1){t(r[e]);}},qe.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}))},qe.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var Ne=Object.freeze({number:Ue,color:function(t,e,r){return new ve(Ue(t.r,e.r,r),Ue(t.g,e.g,r),Ue(t.b,e.b,r),Ue(t.a,e.a,r))},array:function(t,e,r){return t.map(function(t,i){return Ue(t,e[i],r)})}}),je=function(t,e,r,i){this.type=t,this.interpolation=e,this.input=r,this.labels=[],this.outputs=[];for(var n=0,a=i;n<a.length;n+=1){var o=a[n],s=o[0],u=o[1];this.labels.push(s),this.outputs.push(u);}};function Ge(t,e,r,i){var n=i-r,a=t-r;return 0===n?0:1===e?a/n:(Math.pow(e,a)-1)/(Math.pow(e,n)-1)}je.interpolationFactor=function(t,e,r,i){var n=0;if("exponential"===t.name)n=Ge(e,t.base,r,i);else if("linear"===t.name)n=Ge(e,1,r,i);else if("cubic-bezier"===t.name){var a=t.controlPoints;n=new s(a[0],a[1],a[2],a[3]).solve(Ge(e,1,r,i));}return n},je.parse=function(t,e){var r=t[1],i=t[2],n=t.slice(3);if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){var a=r[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:a};}else{if("cubic-bezier"!==r[0])return e.error("Unknown interpolation type "+String(r[0]),1,0);var o=r.slice(1);if(4!==o.length||o.some(function(t){return"number"!=typeof t||t<0||t>1}))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:o};}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,ae)))return null;var s=[],u=null;e.expectedType&&"value"!==e.expectedType.kind&&(u=e.expectedType);for(var p=0;p<n.length;p+=2){var l=n[p],h=n[p+1],c=p+3,y=p+4;if("number"!=typeof l)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',c);if(s.length&&s[s.length-1][0]>=l)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',c);var f=e.parse(h,y,u);if(!f)return null;u=u||f.type,s.push([l,f]);}return"number"===u.kind||"color"===u.kind||"array"===u.kind&&"number"===u.itemType.kind&&"number"==typeof u.N?new je(u,r,i,s):e.error("Type "+ye(u)+" is not interpolatable.")},je.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var i=this.input.evaluate(t);if(i<=e[0])return r[0].evaluate(t);var n=e.length;if(i>=e[n-1])return r[n-1].evaluate(t);var a=De(e,i),o=e[a],s=e[a+1],u=je.interpolationFactor(this.interpolation,i,o,s),p=r[a].evaluate(t),l=r[a+1].evaluate(t);return Ne[this.type.kind.toLowerCase()](p,l,u)},je.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1){t(r[e]);}},je.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}))},je.prototype.serialize=function(){var t;if("linear"===this.interpolation.name)t=["linear"];else if("exponential"===this.interpolation.name)t=1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base];else{t=["cubic-bezier"].concat(this.interpolation.controlPoints);}for(var e=["interpolate",t,this.input.serialize()],r=0;r<this.labels.length;r++)e.push(this.labels[r],this.outputs[r].serialize());return e};var Xe=function(t,e){this.type=t,this.args=e;};Xe.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var r=null,i=e.expectedType;i&&"value"!==i.kind&&(r=i);for(var n=[],a=0,o=t.slice(1);a<o.length;a+=1){var s=o[a],u=e.parse(s,1+n.length,r,void 0,{omitTypeAnnotations:!0});if(!u)return null;r=r||u.type,n.push(u);}var p=i&&n.some(function(t){return de(i,t.type)});return new Xe(p?le:r,n)},Xe.prototype.evaluate=function(t){for(var e=null,r=0,i=this.args;r<i.length;r+=1){if(null!==(e=i[r].evaluate(t)))break}return e},Xe.prototype.eachChild=function(t){this.args.forEach(t);},Xe.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}))},Xe.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(e){t.push(e.serialize());}),t};var Ye=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e;};Ye.prototype.evaluate=function(t){return this.result.evaluate(t)},Ye.prototype.eachChild=function(t){for(var e=0,r=this.bindings;e<r.length;e+=1){t(r[e][1]);}t(this.result);},Ye.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],i=1;i<t.length-1;i+=2){var n=t[i];if("string"!=typeof n)return e.error("Expected string, but found "+typeof n+" instead.",i);if(/[^a-zA-Z0-9_]/.test(n))return e.error("Variable names must contain only alphanumeric characters or '_'.",i);var a=e.parse(t[i+1],i+1);if(!a)return null;r.push([n,a]);}var o=e.parse(t[t.length-1],t.length-1,void 0,r);return o?new Ye(r,o):null},Ye.prototype.possibleOutputs=function(){return this.result.possibleOutputs()},Ye.prototype.serialize=function(){for(var t=["let"],e=0,r=this.bindings;e<r.length;e+=1){var i=r[e],n=i[0],a=i[1];t.push(n,a.serialize());}return t.push(this.result.serialize()),t};var He=function(t,e,r){this.type=t,this.index=e,this.input=r;};He.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,ae),i=e.parse(t[2],2,ce(e.expectedType||le));if(!r||!i)return null;var n=i.type;return new He(n.itemType,r,i)},He.prototype.evaluate=function(t){var e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new ke("Array index out of bounds: "+e+" < 0.");if(e>=r.length)throw new ke("Array index out of bounds: "+e+" > "+(r.length-1)+".");if(e!==Math.floor(e))throw new ke("Array index must be an integer, but found "+e+" instead.");return r[e]},He.prototype.eachChild=function(t){t(this.index),t(this.input);},He.prototype.possibleOutputs=function(){return[void 0]},He.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Ze=function(t,e,r,i,n,a){this.inputType=t,this.type=e,this.input=r,this.cases=i,this.outputs=n,this.otherwise=a;};Ze.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var r,i;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var n={},a=[],o=2;o<t.length-1;o+=2){var s=t[o],u=t[o+1];Array.isArray(s)||(s=[s]);var p=e.concat(o);if(0===s.length)return p.error("Expected at least one branch label.");for(var l=0,h=s;l<h.length;l+=1){var c=h[l];if("number"!=typeof c&&"string"!=typeof c)return p.error("Branch labels must be numbers or strings.");if("number"==typeof c&&Math.abs(c)>Number.MAX_SAFE_INTEGER)return p.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof c&&Math.floor(c)!==c)return p.error("Numeric branch labels must be integer values.");if(r){if(p.checkSubtype(r,we(c)))return null}else r=we(c);if(void 0!==n[String(c)])return p.error("Branch labels must be unique.");n[String(c)]=a.length;}var y=e.parse(u,o,i);if(!y)return null;i=i||y.type,a.push(y);}var f=e.parse(t[1],1,le);if(!f)return null;var d=e.parse(t[t.length-1],t.length-1,i);return d?"value"!==f.type.kind&&e.concat(1).checkSubtype(r,f.type)?null:new Ze(r,i,f,n,a,d):null},Ze.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(we(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},Ze.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise);},Ze.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()})).concat(this.otherwise.possibleOutputs())},Ze.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],r=[],i={},n=0,a=Object.keys(this.cases).sort();n<a.length;n+=1){var o=a[n],s=i[t.cases[o]];void 0===s?(i[t.cases[o]]=r.length,r.push([t.cases[o],[o]])):r[s][1].push(o);}for(var u=function(e){return"number"===t.inputType.kind?Number(e):e},p=0,l=r;p<l.length;p+=1){var h=l[p],c=h[0],y=h[1];if(1===y.length)e.push(u(y[0]));else{var f=y.map(u);e.push(f);}e.push(t.outputs[c].serialize());}return e.push(this.otherwise.serialize()),e};var $e=function(t,e,r){this.type=t,this.branches=e,this.otherwise=r;};function Je(t){return"string"===t.kind||"number"===t.kind||"boolean"===t.kind||"null"===t.kind}function Ke(t,e){return function(){function r(t,e,r){this.type=se,this.lhs=t,this.rhs=e,this.collator=r;}return r.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var i=e.parse(t[1],1,le);if(!i)return null;var n=e.parse(t[2],2,le);if(!n)return null;if(!Je(i.type)&&!Je(n.type))return e.error("Expected at least one argument to be a string, number, boolean, or null, but found ("+ye(i.type)+", "+ye(n.type)+") instead.");if(i.type.kind!==n.type.kind&&"value"!==i.type.kind&&"value"!==n.type.kind)return e.error("Cannot compare "+ye(i.type)+" and "+ye(n.type)+".");var a=null;if(4===t.length){if("string"!==i.type.kind&&"string"!==n.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(a=e.parse(t[3],3,he)))return null}return new r(i,n,a)},r.prototype.evaluate=function(t){var r=this.collator?0===this.collator.evaluate(t).compare(this.lhs.evaluate(t),this.rhs.evaluate(t)):this.lhs.evaluate(t)===this.rhs.evaluate(t);return e?!r:r},r.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator);},r.prototype.possibleOutputs=function(){return[!0,!1]},r.prototype.serialize=function(){var e=[t];return this.eachChild(function(t){e.push(t.serialize());}),e},r}()}$e.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var i=[],n=1;n<t.length-1;n+=2){var a=e.parse(t[n],n,se);if(!a)return null;var o=e.parse(t[n+1],n+1,r);if(!o)return null;i.push([a,o]),r=r||o.type;}var s=e.parse(t[t.length-1],t.length-1,r);return s?new $e(r,i,s):null},$e.prototype.evaluate=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var i=r[e],n=i[0],a=i[1];if(n.evaluate(t))return a.evaluate(t)}return this.otherwise.evaluate(t)},$e.prototype.eachChild=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var i=r[e],n=i[0],a=i[1];t(n),t(a);}t(this.otherwise);},$e.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.branches.map(function(t){t[0];return t[1].possibleOutputs()})).concat(this.otherwise.possibleOutputs())},$e.prototype.serialize=function(){var t=["case"];return this.eachChild(function(e){t.push(e.serialize());}),t};var We=Ke("==",!1),Qe=Ke("!=",!0),tr=function(t){this.type=ae,this.input=t;};tr.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error("Expected argument of type string or array, but found "+ye(r.type)+" instead."):new tr(r):null},tr.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ke("Expected value to be of type string or array, but found "+ye(we(e))+" instead.")},tr.prototype.eachChild=function(t){t(this.input);},tr.prototype.possibleOutputs=function(){return[void 0]},tr.prototype.serialize=function(){var t=["length"];return this.eachChild(function(e){t.push(e.serialize());}),t};var er={"==":We,"!=":Qe,array:Te,at:He,boolean:ze,case:$e,coalesce:Xe,collator:be,interpolate:je,length:tr,let:Ye,literal:Ae,match:Ze,number:ze,object:ze,step:qe,string:ze,"to-color":Ee,"to-number":Ee,var:Fe};function rr(t,e){var r=e[0],i=e[1],n=e[2],a=e[3];r=r.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);var o=a?a.evaluate(t):1,s=_e(r,i,n,o);if(s)throw new ke(s);return new ve(r/255*o,i/255*o,n/255*o,o)}function ir(t,e){return t in e}function nr(t,e){var r=e[t];return void 0===r?null:r}function ar(t,e){var r=e[0],i=e[1];return r.evaluate(t)<i.evaluate(t)}function or(t,e){var r=e[0],i=e[1];return r.evaluate(t)>i.evaluate(t)}function sr(t,e){var r=e[0],i=e[1];return r.evaluate(t)<=i.evaluate(t)}function ur(t,e){var r=e[0],i=e[1];return r.evaluate(t)>=i.evaluate(t)}function pr(t){return{type:t}}function lr(t){return{result:"success",value:t}}function hr(t){return{result:"error",value:t}}function cr(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function yr(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function fr(t){return!!t.expression&&t.expression.interpolated}Ce.register(er,{error:[{kind:"error"},[oe],function(t,e){var r=e[0];throw new ke(r.evaluate(t))}],typeof:[oe,[le],function(t,e){return ye(we(e[0].evaluate(t)))}],"to-string":[oe,[le],function(t,e){var r=e[0],i=typeof(r=r.evaluate(t));return null===r?"":"string"===i||"number"===i||"boolean"===i?String(r):r instanceof ve?r.toString():JSON.stringify(r)}],"to-boolean":[se,[le],function(t,e){var r=e[0];return Boolean(r.evaluate(t))}],"to-rgba":[ce(ae,4),[ue],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[ue,[ae,ae,ae],rr],rgba:[ue,[ae,ae,ae,ae],rr],has:{type:se,overloads:[[[oe],function(t,e){return ir(e[0].evaluate(t),t.properties())}],[[oe,pe],function(t,e){var r=e[0],i=e[1];return ir(r.evaluate(t),i.evaluate(t))}]]},get:{type:le,overloads:[[[oe],function(t,e){return nr(e[0].evaluate(t),t.properties())}],[[oe,pe],function(t,e){var r=e[0],i=e[1];return nr(r.evaluate(t),i.evaluate(t))}]]},"feature-state":[le,[oe],function(t,e){return nr(e[0].evaluate(t),t.featureState||{})}],properties:[pe,[],function(t){return t.properties()}],"geometry-type":[oe,[],function(t){return t.geometryType()}],id:[le,[],function(t){return t.id()}],zoom:[ae,[],function(t){return t.globals.zoom}],"heatmap-density":[ae,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[ae,[],function(t){return t.globals.lineProgress||0}],"+":[ae,pr(ae),function(t,e){for(var r=0,i=0,n=e;i<n.length;i+=1){r+=n[i].evaluate(t);}return r}],"*":[ae,pr(ae),function(t,e){for(var r=1,i=0,n=e;i<n.length;i+=1){r*=n[i].evaluate(t);}return r}],"-":{type:ae,overloads:[[[ae,ae],function(t,e){var r=e[0],i=e[1];return r.evaluate(t)-i.evaluate(t)}],[[ae],function(t,e){return-e[0].evaluate(t)}]]},"/":[ae,[ae,ae],function(t,e){var r=e[0],i=e[1];return r.evaluate(t)/i.evaluate(t)}],"%":[ae,[ae,ae],function(t,e){var r=e[0],i=e[1];return r.evaluate(t)%i.evaluate(t)}],ln2:[ae,[],function(){return Math.LN2}],pi:[ae,[],function(){return Math.PI}],e:[ae,[],function(){return Math.E}],"^":[ae,[ae,ae],function(t,e){var r=e[0],i=e[1];return Math.pow(r.evaluate(t),i.evaluate(t))}],sqrt:[ae,[ae],function(t,e){var r=e[0];return Math.sqrt(r.evaluate(t))}],log10:[ae,[ae],function(t,e){var r=e[0];return Math.log10(r.evaluate(t))}],ln:[ae,[ae],function(t,e){var r=e[0];return Math.log(r.evaluate(t))}],log2:[ae,[ae],function(t,e){var r=e[0];return Math.log2(r.evaluate(t))}],sin:[ae,[ae],function(t,e){var r=e[0];return Math.sin(r.evaluate(t))}],cos:[ae,[ae],function(t,e){var r=e[0];return Math.cos(r.evaluate(t))}],tan:[ae,[ae],function(t,e){var r=e[0];return Math.tan(r.evaluate(t))}],asin:[ae,[ae],function(t,e){var r=e[0];return Math.asin(r.evaluate(t))}],acos:[ae,[ae],function(t,e){var r=e[0];return Math.acos(r.evaluate(t))}],atan:[ae,[ae],function(t,e){var r=e[0];return Math.atan(r.evaluate(t))}],min:[ae,pr(ae),function(t,e){return Math.min.apply(Math,e.map(function(e){return e.evaluate(t)}))}],max:[ae,pr(ae),function(t,e){return Math.max.apply(Math,e.map(function(e){return e.evaluate(t)}))}],abs:[ae,[ae],function(t,e){var r=e[0];return Math.abs(r.evaluate(t))}],round:[ae,[ae],function(t,e){var r=e[0].evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[ae,[ae],function(t,e){var r=e[0];return Math.floor(r.evaluate(t))}],ceil:[ae,[ae],function(t,e){var r=e[0];return Math.ceil(r.evaluate(t))}],"filter-==":[se,[oe,le],function(t,e){var r=e[0],i=e[1];return t.properties()[r.value]===i.value}],"filter-id-==":[se,[le],function(t,e){var r=e[0];return t.id()===r.value}],"filter-type-==":[se,[oe],function(t,e){var r=e[0];return t.geometryType()===r.value}],"filter-<":[se,[oe,le],function(t,e){var r=e[0],i=e[1],n=t.properties()[r.value],a=i.value;return typeof n==typeof a&&n<a}],"filter-id-<":[se,[le],function(t,e){var r=e[0],i=t.id(),n=r.value;return typeof i==typeof n&&i<n}],"filter->":[se,[oe,le],function(t,e){var r=e[0],i=e[1],n=t.properties()[r.value],a=i.value;return typeof n==typeof a&&n>a}],"filter-id->":[se,[le],function(t,e){var r=e[0],i=t.id(),n=r.value;return typeof i==typeof n&&i>n}],"filter-<=":[se,[oe,le],function(t,e){var r=e[0],i=e[1],n=t.properties()[r.value],a=i.value;return typeof n==typeof a&&n<=a}],"filter-id-<=":[se,[le],function(t,e){var r=e[0],i=t.id(),n=r.value;return typeof i==typeof n&&i<=n}],"filter->=":[se,[oe,le],function(t,e){var r=e[0],i=e[1],n=t.properties()[r.value],a=i.value;return typeof n==typeof a&&n>=a}],"filter-id->=":[se,[le],function(t,e){var r=e[0],i=t.id(),n=r.value;return typeof i==typeof n&&i>=n}],"filter-has":[se,[le],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[se,[],function(t){return null!==t.id()}],"filter-type-in":[se,[ce(oe)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-type-arrin":[se,[ce(oe)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-arrin":[se,[oe,ce(le)],function(t,e){var r=e[0],i=e[1];return function(t,e,r,i){for(;r<=i;){if(!t)return!1;var n=null;if("string"==typeof t?n=t.split(","):"number"==typeof t&&(n=[t]),n&&n.indexOf(e[r])>-1)return!0;r+=1;}return!1}(t.properties()[r.value],i.value,0,i.value.length-1)}],"filter-type-like":[se,[ce(oe)],function(t,e){var r=e[0];return t.geometryType().indexOf(r.value)>=0}],"filter-like":[se,[oe,ce(le)],function(t,e){var r=e[0],i=e[1];return function(t,e){return-1!==t.indexOf(e)}(t.properties()[r.value],i.value)}],"filter-id-in":[se,[ce(le)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[se,[oe,ce(le)],function(t,e){var r=e[0];return e[1].value.indexOf(t.properties()[r.value])>=0}],"filter-in-large":[se,[oe,ce(le)],function(t,e){var r=e[0],i=e[1];return function(t,e,r,i){for(;r<=i;){var n=r+i>>1;if(e[n]===t)return!0;e[n]>t?i=n-1:r=n+1;}return!1}(t.properties()[r.value],i.value,0,i.value.length-1)}],">":{type:se,overloads:[[[ae,ae],or],[[oe,oe],or],[[oe,oe,he],function(t,e){var r=e[0],i=e[1];return e[2].evaluate(t).compare(r.evaluate(t),i.evaluate(t))>0}]]},"<":{type:se,overloads:[[[ae,ae],ar],[[oe,oe],ar],[[oe,oe,he],function(t,e){var r=e[0],i=e[1];return e[2].evaluate(t).compare(r.evaluate(t),i.evaluate(t))<0}]]},">=":{type:se,overloads:[[[ae,ae],ur],[[oe,oe],ur],[[oe,oe,he],function(t,e){var r=e[0],i=e[1];return e[2].evaluate(t).compare(r.evaluate(t),i.evaluate(t))>=0}]]},"<=":{type:se,overloads:[[[ae,ae],sr],[[oe,oe],sr],[[oe,oe,he],function(t,e){var r=e[0],i=e[1];return e[2].evaluate(t).compare(r.evaluate(t),i.evaluate(t))<=0}]]},all:{type:se,overloads:[[[se,se],function(t,e){var r=e[0],i=e[1];return r.evaluate(t)&&i.evaluate(t)}],[pr(se),function(t,e){for(var r=0,i=e;r<i.length;r+=1){if(!i[r].evaluate(t))return!1}return!0}]]},any:{type:se,overloads:[[[se,se],function(t,e){var r=e[0],i=e[1];return r.evaluate(t)||i.evaluate(t)}],[pr(se),function(t,e){for(var r=0,i=e;r<i.length;r+=1){if(i[r].evaluate(t))return!0}return!1}]]},"!":[se,[se],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[se,[oe],function(t,e){var r=e[0],i=t.globals&&t.globals.isSupportedScript;return!i||i(r.evaluate(t))}],upcase:[oe,[oe],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[oe,[oe],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[oe,pr(oe),function(t,e){return e.map(function(e){return e.evaluate(t)}).join("")}],"resolved-locale":[oe,[he],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var dr=.95047,mr=1,gr=1.08883,vr=4/29,xr=6/29,br=3*xr*xr,_r=xr*xr*xr,wr=Math.PI/180,Ar=180/Math.PI;function kr(t){return t>_r?Math.pow(t,1/3):t/br+vr}function Sr(t){return t>xr?t*t*t:br*(t-vr)}function zr(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Br(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Tr(t){var e=Br(t.r),r=Br(t.g),i=Br(t.b),n=kr((.4124564*e+.3575761*r+.1804375*i)/dr),a=kr((.2126729*e+.7151522*r+.072175*i)/mr);return{l:116*a-16,a:500*(n-a),b:200*(a-kr((.0193339*e+.119192*r+.9503041*i)/gr)),alpha:t.a}}function Mr(t){var e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=mr*Sr(e),r=dr*Sr(r),i=gr*Sr(i),new ve(zr(3.2404542*r-1.5371385*e-.4985314*i),zr(-.969266*r+1.8760108*e+.041556*i),zr(.0556434*r-.2040259*e+1.0572252*i),t.alpha)}var Er={forward:Tr,reverse:Mr,interpolate:function(t,e,r){return{l:Ue(t.l,e.l,r),a:Ue(t.a,e.a,r),b:Ue(t.b,e.b,r),alpha:Ue(t.alpha,e.alpha,r)}}},Vr={forward:function(t){var e=Tr(t),r=e.l,i=e.a,n=e.b,a=Math.atan2(n,i)*Ar;return{h:a<0?a+360:a,c:Math.sqrt(i*i+n*n),l:r,alpha:t.a}},reverse:function(t){var e=t.h*wr,r=t.c;return Mr({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:function(t,e,r){var i=e-t;return t+r*(i>180||i<-180?i-360*Math.round(i/360):i)}(t.h,e.h,r),c:Ue(t.c,e.c,r),l:Ue(t.l,e.l,r),alpha:Ue(t.alpha,e.alpha,r)}}},Ir=Object.freeze({lab:Er,hcl:Vr});function Cr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Rr(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Lr(t){return t}function Pr(t,e,r){return void 0!==t?t:void 0!==e?e:void 0!==r?r:void 0}function Fr(t,e,r,i,n){return Pr(typeof r===n?i[r]:void 0,t.default,e.default)}function Or(t,e,r){if("number"!==Cr(r))return Pr(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];var n=Ur(t.stops,r);return t.stops[n][1]}function Dr(t,e,r){var i=void 0!==t.base?t.base:1;if("number"!==Cr(r))return Pr(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];var a=Ur(t.stops,r),o=function(t,e,r,i){var n=i-r,a=t-r;return 0===n?0:1===e?a/n:(Math.pow(e,a)-1)/(Math.pow(e,n)-1)}(r,i,t.stops[a][0],t.stops[a+1][0]),s=t.stops[a][1],u=t.stops[a+1][1],p=Ne[e.type]||Lr;if(t.colorSpace&&"rgb"!==t.colorSpace){var l=Ir[t.colorSpace];p=function(t,e){return l.reverse(l.interpolate(l.forward(t),l.forward(e),o))};}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=s.evaluate.apply(void 0,t),i=u.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==i)return p(r,i,o)}}:p(s,u,o)}function qr(t,e,r){return"color"===e.type?"x-color"!==e.units&&(r=ve.parse(r)):Cr(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),Pr(r,t.default,e.default)}function Ur(t,e){for(var r,i,n=0,a=t.length-1,o=0;n<=a;){if(r=t[o=Math.floor((n+a)/2)][0],i=t[o+1][0],e===r||e>r&&e<i)return o;r<e?n=o+1:r>e&&(a=o-1);}return Math.max(o-1,0)}var Nr=function(t,e){var r;this.expression=t,this._warningHistory={},this._defaultValue="color"===(r=e).type&&Rr(r.default)?new ve(0,0,0,0):"color"===r.type?ve.parse(r.default)||null:void 0===r.default?null:r.default,"enum"===e.type&&(this._enumValues=e.values);};function jr(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in er}function Gr(t,e){var r=new Oe(er,[],function(t){var e={color:ue,string:oe,number:ae,enum:oe,boolean:se};if("array"===t.type)return ce(e[t.value]||le,t.length);return e[t.type]||null}(e)),i=r.parse(t);return i?lr(new Nr(i,e)):hr(r.errors)}Nr.prototype.evaluateWithoutErrorHandling=function(t,e,r){return this._evaluator||(this._evaluator=new Ie),this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this.expression.evaluate(this._evaluator)},Nr.prototype.evaluate=function(t,e,r){this._evaluator||(this._evaluator=new Ie),this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r;try{var i=this.expression.evaluate(this._evaluator);if(null===i||void 0===i)return this._defaultValue;if(this._enumValues&&!(i in this._enumValues))throw new ke("Expected value to be one of "+Object.keys(this._enumValues).map(function(t){return JSON.stringify(t)}).join(", ")+", but found "+JSON.stringify(i)+" instead.");return i}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Xr=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Le(e.expression);};Xr.prototype.evaluateWithoutErrorHandling=function(t,e,r){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r)},Xr.prototype.evaluate=function(t,e,r){return this._styleExpression.evaluate(t,e,r)};var Yr=function(t,e,r){this.kind=t,this.zoomStops=r.labels,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Le(e.expression),r instanceof je&&(this._interpolationType=r.interpolation);};function Hr(t,e){if("error"===(t=Gr(t,e)).result)return t;var r=t.value.expression,i=Re(r);if(!i&&!cr(e))return hr([new re("","data expressions not supported")]);var n=Pe(r,["zoom"]);if(!n&&!yr(e))return hr([new re("","zoom expressions not supported")]);var a=function t(e){var r=null;if(e instanceof Ye)r=t(e.result);else if(e instanceof Xe)for(var i=0,n=e.args;i<n.length;i+=1){var a=n[i];if(r=t(a))break}else(e instanceof qe||e instanceof je)&&e.input instanceof Ce&&"zoom"===e.input.name&&(r=e);if(r instanceof re)return r;e.eachChild(function(e){var i=t(e);i instanceof re?r=i:!r&&i?r=new re("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&i&&r!==i&&(r=new re("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'));});return r}(r);return a||n?a instanceof re?hr([a]):a instanceof je&&!fr(e)?hr([new re("",'"interpolate" expressions cannot be used with this property')]):lr(a?new Yr(i?"camera":"composite",t.value,a):new Xr(i?"constant":"source",t.value)):hr([new re("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Yr.prototype.evaluateWithoutErrorHandling=function(t,e,r){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r)},Yr.prototype.evaluate=function(t,e,r){return this._styleExpression.evaluate(t,e,r)},Yr.prototype.interpolationFactor=function(t,e,r){return this._interpolationType?je.interpolationFactor(this._interpolationType,t,e,r):0};var Zr=function(t,e){this._parameters=t,this._specification=e,Qt(this,function t(e,r){var i,n,a,o="color"===r.type,s=e.stops&&"object"==typeof e.stops[0][0],u=s||void 0!==e.property,p=s||!u,l=e.type||(fr(r)?"exponential":"interval");if(o&&((e=Qt({},e)).stops&&(e.stops=e.stops.map(function(t){return[t[0],ve.parse(t[1])]})),e.default?e.default=ve.parse(e.default):e.default=ve.parse(r.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Ir[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===l)i=Dr;else if("interval"===l)i=Or;else if("categorical"===l){i=Fr,n=Object.create(null);for(var h=0,c=e.stops;h<c.length;h+=1){var y=c[h];n[y[0]]=y[1];}a=typeof e.stops[0][0];}else{if("identity"!==l)throw new Error('Unknown function type "'+l+'"');i=qr;}if(s){for(var f={},d=[],m=0;m<e.stops.length;m++){var g=e.stops[m],v=g[0].zoom;void 0===f[v]&&(f[v]={zoom:v,type:e.type,property:e.property,default:e.default,stops:[]},d.push(v)),f[v].stops.push([g[0].value,g[1]]);}for(var x=[],b=0,_=d;b<_.length;b+=1){var w=_[b];x.push([f[w].zoom,t(f[w],r)]);}return{kind:"composite",interpolationFactor:je.interpolationFactor.bind(void 0,{name:"linear"}),zoomStops:x.map(function(t){return t[0]}),evaluate:function(t,i){var n=t.zoom;return Dr({stops:x,base:e.base},r,n).evaluate(n,i)}}}return p?{kind:"camera",interpolationFactor:"exponential"===l?je.interpolationFactor.bind(void 0,{name:"exponential",base:void 0!==e.base?e.base:1}):function(){return 0},zoomStops:e.stops.map(function(t){return t[0]}),evaluate:function(t){var o=t.zoom;return i(e,r,o,n,a)}}:{kind:"source",evaluate:function(t,o){var s=o&&o.properties?o.properties[e.property]:void 0;return void 0===s?Pr(e.default,r.default):i(e,r,s,n,a)}}}(this._parameters,this._specification));};function $r(t,e){if(Rr(t))return new Zr(t,e);if(jr(t)){var r=Hr(t,e);if("error"===r.result)throw new Error(r.value.map(function(t){return t.key+": "+t.message}).join(", "));return r.value}var i=t;return"string"==typeof t&&"color"===e.type&&(i=ve.parse(t)),{kind:"constant",evaluate:function(){return i}}}function Jr(t){var e=t.key,r=t.value,i=t.valueSpec||{},n=t.objectElementValidators||{},a=t.style,o=t.styleSpec,s=[],u=Cr(r);if("object"!==u)return[new Kt(e,r,"object expected, "+u+" found")];for(var p in r){var l=p.split(".")[0],h=i[l]||i["*"],c=void 0;if(n[l])c=n[l];else if(i[l])c=wi;else if(n["*"])c=n["*"];else{if(!i["*"]){s.push(new Kt(e,r[p],'unknown property "'+p+'"'));continue}c=wi;}s=s.concat(c({key:(e?e+".":e)+p,value:r[p],valueSpec:h,style:a,styleSpec:o,object:r,objectKey:p},r));}for(var y in i)n[y]||i[y].required&&void 0===i[y].default&&void 0===r[y]&&s.push(new Kt(e,r,'missing required property "'+y+'"'));return s}function Kr(t){var e=t.value,r=t.valueSpec,i=t.style,n=t.styleSpec,a=t.key,o=t.arrayElementValidator||wi;if("array"!==Cr(e))return[new Kt(a,e,"array expected, "+Cr(e)+" found")];if(r.length&&e.length!==r.length)return[new Kt(a,e,"array length "+r.length+" expected, length "+e.length+" found")];if(r["min-length"]&&e.length<r["min-length"])return[new Kt(a,e,"array length at least "+r["min-length"]+" expected, length "+e.length+" found")];var s={type:r.value};n.$version<7&&(s.function=r.function),"object"===Cr(r.value)&&(s=r.value);for(var u=[],p=0;p<e.length;p++)u=u.concat(o({array:e,arrayIndex:p,value:e[p],valueSpec:s,style:i,styleSpec:n,key:a+"["+p+"]"}));return u}function Wr(t){var e=t.key,r=t.value,i=t.valueSpec,n=Cr(r);return"number"!==n?[new Kt(e,r,"number expected, "+n+" found")]:"minimum"in i&&r<i.minimum?[new Kt(e,r,r+" is less than the minimum value "+i.minimum)]:"maximum"in i&&r>i.maximum?[new Kt(e,r,r+" is greater than the maximum value "+i.maximum)]:[]}function Qr(t){var e,r,i,n=t.valueSpec,a=te(t.value.type),o={},s="categorical"!==a&&void 0===t.value.property,u=!s,p="array"===Cr(t.value.stops)&&"array"===Cr(t.value.stops[0])&&"object"===Cr(t.value.stops[0][0]),l=Jr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===a)return[new Kt(t.key,t.value,'identity function may not have a "stops" property')];var e=[],r=t.value;e=e.concat(Kr({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Cr(r)&&0===r.length&&e.push(new Kt(t.key,r,"array must have at least one stop"));return e},default:function(t){return wi({key:t.key,value:t.value,valueSpec:n,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===a&&s&&l.push(new Kt(t.key,t.value,'missing required property "property"')),"identity"===a||t.value.stops||l.push(new Kt(t.key,t.value,'missing required property "stops"')),"exponential"===a&&t.valueSpec.expression&&!fr(t.valueSpec)&&l.push(new Kt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!cr(t.valueSpec)?l.push(new Kt(t.key,t.value,"property functions not supported")):s&&!yr(t.valueSpec)&&l.push(new Kt(t.key,t.value,"zoom functions not supported"))),"categorical"!==a&&!p||void 0!==t.value.property||l.push(new Kt(t.key,t.value,'"property" property is required')),l;function h(t){var e=[],a=t.value,s=t.key;if("array"!==Cr(a))return[new Kt(s,a,"array expected, "+Cr(a)+" found")];if(2!==a.length)return[new Kt(s,a,"array length 2 expected, length "+a.length+" found")];if(p){if("object"!==Cr(a[0]))return[new Kt(s,a,"object expected, "+Cr(a[0])+" found")];if(void 0===a[0].zoom)return[new Kt(s,a,"object stop key must have zoom")];if(void 0===a[0].value)return[new Kt(s,a,"object stop key must have value")];if(i&&i>te(a[0].zoom))return[new Kt(s,a[0].zoom,"stop zoom values must appear in ascending order")];te(a[0].zoom)!==i&&(i=te(a[0].zoom),r=void 0,o={}),e=e.concat(Jr({key:s+"[0]",value:a[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Wr,value:c}}));}else e=e.concat(c({key:s+"[0]",value:a[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},a));return e.concat(wi({key:s+"[1]",value:a[1],valueSpec:n,style:t.style,styleSpec:t.styleSpec}))}function c(t,i){var s=Cr(t.value),u=te(t.value),p=null!==t.value?t.value:i;if(e){if(s!==e)return[new Kt(t.key,p,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Kt(t.key,p,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==a){var l="number expected, "+s+" found";return cr(n)&&void 0===a&&(l+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Kt(t.key,p,l)]}return"categorical"!==a||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==a&&"number"===s&&void 0!==r&&u<r?[new Kt(t.key,p,"stop domain values must appear in ascending order")]:(r=u,"categorical"===a&&u in o?[new Kt(t.key,p,"stop domain values must be unique")]:(o[u]=!0,[])):[new Kt(t.key,p,"integer expected, found "+u)]}}function ti(t){var e=("property"===t.expressionContext?Hr:Gr)(ee(t.value),t.valueSpec);return"error"===e.result?e.value.map(function(e){return new Kt(""+t.key+e.key,t.value,e.message)}):"property"===t.expressionContext&&"text-font"===t.propertyKey&&-1!==e.value._styleExpression.expression.possibleOutputs().indexOf(void 0)?[new Kt(t.key,t.value,'Invalid data expression for "text-font". Output values must be contained as literals within the expression.')]:"property"!==t.expressionContext||"layout"!==t.propertyType||Le(e.value._styleExpression.expression)?[]:[new Kt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')]}function ei(t){var e=t.key,r=t.value,i=t.valueSpec,n=[];return Array.isArray(i.values)?-1===i.values.indexOf(te(r))&&n.push(new Kt(e,r,"expected one of ["+i.values.join(", ")+"], "+JSON.stringify(r)+" found")):-1===Object.keys(i.values).indexOf(te(r))&&n.push(new Kt(e,r,"expected one of ["+Object.keys(i.values).join(", ")+"], "+JSON.stringify(r)+" found")),n}function ri(t){if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":case"!in":case"!has":case"none":case"!arrin":case"arrin":case"like":case"!like":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,r=t.slice(1);e<r.length;e+=1){var i=r[e];if(!ri(i)&&"boolean"!=typeof i)return!1}return!0;default:return!0}}Zr.deserialize=function(t){return new Zr(t._parameters,t._specification)},Zr.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var ii={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ni(t){if(!t)return function(){return!0};ri(t)||(t=oi(t));var e=Gr(t,ii);if("error"===e.result)throw new Error(e.value.map(function(t){return t.key+": "+t.message}).join(", "));return function(t,r){return e.value.evaluate(t,r)}}function ai(t,e){return t<e?-1:t>e?1:0}function oi(t){if(!t)return!0;var e,r=t[0];return t.length<=1?"any"!==r:"=="===r?si(t[1],t[2],"=="):"!="===r?ci(si(t[1],t[2],"==")):"<"===r||">"===r||"<="===r||">="===r?si(t[1],t[2],r):"any"===r?(e=t.slice(1),["any"].concat(e.map(oi))):"all"===r?["all"].concat(t.slice(1).map(oi)):"none"===r?["all"].concat(t.slice(1).map(oi).map(ci)):"in"===r?ui(t[1],t.slice(2)):"!in"===r?ci(ui(t[1],t.slice(2))):"has"===r?hi(t[1]):"!has"===r?ci(hi(t[1])):"arrin"===r?pi(t[1],t.slice(2)):"!arrin"===r?ci(pi(t[1],t.slice(2))):"like"===r?li(t[1],t.slice(2)):"!like"!==r||ci(li(t[1],t.slice(2)))}function si(t,e,r){switch(t){case"$type":return["filter-type-"+r,e];case"$id":return["filter-id-"+r,e];default:return["filter-"+r,t,e]}}function ui(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(function(t){return typeof t!=typeof e[0]})?["filter-in-large",t,["literal",e.sort(ai)]]:["filter-in-small",t,["literal",e]]}}function pi(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-arrin",["literal",e]];default:return["filter-arrin",t,["literal",e]]}}function li(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-like",["literal",e]];default:return["filter-like",t,["literal",e]]}}function hi(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function ci(t){return["!",t]}function yi(t){return ri(ee(t.value))?ti(Qt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var r=e.value;var i=e.key;if("array"!==Cr(r))return[new Kt(i,r,"array expected, "+Cr(r)+" found")];var n=e.styleSpec;var a;var o=[];if(r.length<1)return[new Kt(i,r,"filter array must have at least 1 element")];o=o.concat(ei({key:i+"[0]",value:r[0],valueSpec:n.filter_operator,style:e.style,styleSpec:e.styleSpec}));switch(te(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===te(r[1])&&o.push(new Kt(i,r,'"$type" cannot be use with operator "'+r[0]+'"'));case"==":case"!=":3!==r.length&&o.push(new Kt(i,r,'filter array for operator "'+r[0]+'" must have 3 elements'));case"in":case"!in":case"arrin":case"!arrin":case"like":case"!like":r.length>=2&&"string"!==(a=Cr(r[1]))&&o.push(new Kt(i+"[1]",r[1],"string expected, "+a+" found"));for(var s=2;s<r.length;s++)a=Cr(r[s]),"$type"===te(r[1])?o=o.concat(ei({key:i+"["+s+"]",value:r[s],valueSpec:n.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==a&&"number"!==a&&"boolean"!==a&&o.push(new Kt(i+"["+s+"]",r[s],"string, number, or boolean expected, "+a+" found"));break;case"any":case"all":case"none":for(var u=1;u<r.length;u++)o=o.concat(t({key:i+"["+u+"]",value:r[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":a=Cr(r[1]),2!==r.length?o.push(new Kt(i,r,'filter array for "'+r[0]+'" operator must have 2 elements')):"string"!==a&&o.push(new Kt(i+"[1]",r[1],"string expected, "+a+" found"));}return o}(t)}function fi(t,e){var r=t.key,i=t.style,n=t.styleSpec,a=t.value,o=t.objectKey,s=n[e+"_"+t.layerType];if(!s)return[];var u=o.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return wi({key:r,value:a,valueSpec:n.transition,style:i,styleSpec:n});var p,l=t.valueSpec||s[o];if(!l)return[new Kt(r,a,'unknown property "'+o+'"')];if("string"===Cr(a)&&cr(l)&&!l.tokens&&(p=/^{([^}]+)}$/.exec(a)))return[new Kt(r,a,'"'+o+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(p[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===o&&i&&!i.glyphs&&h.push(new Kt(r,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&Rr(ee(a))&&"identity"===te(a.type)&&h.push(new Kt(r,a,'"text-font" does not support identity functions'))),h.concat(wi({key:t.key,value:a,valueSpec:l,style:i,styleSpec:n,expressionContext:"property",propertyType:e,propertyKey:o}))}function di(t){return fi(t,"paint")}function mi(t){return fi(t,"layout")}function gi(t){var e=[],r=t.value,i=t.key,n=t.style,a=t.styleSpec;r.type||r.ref||e.push(new Kt(i,r,'either "type" or "ref" is required'));var o,s=te(r.type),u=te(r.ref);if(r.id)for(var p=te(r.id),l=0;l<t.arrayIndex;l++){var h=n.layers[l];te(h.id)===p&&e.push(new Kt(i,r.id,'duplicate layer id "'+r.id+'", previously used at line '+h.id.__line__));}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(t){t in r&&e.push(new Kt(i,r[t],'"'+t+'" is prohibited for ref layers'));}),n.layers.forEach(function(t){te(t.id)===u&&(o=t);}),o?o.ref?e.push(new Kt(i,r.ref,"ref cannot reference another ref layer")):s=te(o.type):e.push(new Kt(i,r.ref,'ref layer "'+u+'" not found'));else if("background"!==s&&"sphere-background"!==s)if(r.source){var c=n.sources&&n.sources[r.source],y=c&&te(c.type);c?"vector"===y&&"raster"===s?e.push(new Kt(i,r.source,'layer "'+r.id+'" requires a raster source')):"raster"===y&&"raster"!==s&&"sphere-raster"!==s?e.push(new Kt(i,r.source,'layer "'+r.id+'" requires a vector source')):"vector"!==y||r["source-layer"]?"raster-dem"===y&&"hillshade"!==s?e.push(new Kt(i,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!r.paint||!r.paint["line-gradient"]||"geojson"===y&&c.lineMetrics||e.push(new Kt(i,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new Kt(i,r,'layer "'+r.id+'" must specify a "source-layer"')):e.push(new Kt(i,r.source,'source "'+r.source+'" not found'));}else e.push(new Kt(i,r,'missing required property "source"'));return e=e.concat(Jr({key:i,value:r,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return wi({key:i+".type",value:r.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"})},filter:yi,layout:function(t){return Jr({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return mi(Qt({layerType:s},t))}}})},paint:function(t){return Jr({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return di(Qt({layerType:s},t))}}})}}}))}function vi(t){var e=t.value,r=t.key,i=t.styleSpec,n=t.style;if(!e.type)return[new Kt(r,e,'"type" is required')];var a=te(e.type),o=[];switch(a){case"vector":case"raster":case"raster-dem":if(o=o.concat(Jr({key:r,value:e,valueSpec:i["source_"+a.replace("-","_")],style:t.style,styleSpec:i})),"url"in e)for(var s in e)["type","url","tileSize"].indexOf(s)<0&&o.push(new Kt(r+"."+s,e[s],'a source with a "url" property may not include a "'+s+'" property'));return o;case"geojson":return Jr({key:r,value:e,valueSpec:i.source_geojson,style:n,styleSpec:i});case"video":return Jr({key:r,value:e,valueSpec:i.source_video,style:n,styleSpec:i});case"image":return Jr({key:r,value:e,valueSpec:i.source_image,style:n,styleSpec:i});case"canvas":return o.push(new Kt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")),o;default:return ei({key:r+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:n,styleSpec:i})}}function xi(t){var e=t.value,r=t.styleSpec,i=r.light,n=t.style,a=[],o=Cr(e);if(void 0===e)return a;if("object"!==o)return a=a.concat([new Kt("light",e,"object expected, "+o+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);a=u&&i[u[1]]&&i[u[1]].transition?a.concat(wi({key:s,value:e[s],valueSpec:r.transition,style:n,styleSpec:r})):i[s]?a.concat(wi({key:s,value:e[s],valueSpec:i[s],style:n,styleSpec:r})):a.concat([new Kt(s,e[s],'unknown property "'+s+'"')]);}return a}function bi(t){var e=t.value,r=t.key,i=Cr(e);return"string"!==i?[new Kt(r,e,"string expected, "+i+" found")]:[]}var _i={"*":function(){return[]},any:function(){return[]},array:Kr,boolean:function(t){var e=t.value,r=t.key,i=Cr(e);return"boolean"!==i?[new Kt(r,e,"boolean expected, "+i+" found")]:[]},number:Wr,color:function(t){var e=t.key,r=t.value,i=Cr(r);return"string"!==i?[new Kt(e,r,"color expected, "+i+" found")]:null===ge(r)?[new Kt(e,r,'color expected, "'+r+'" found')]:[]},constants:Wt,enum:ei,filter:yi,function:Qr,layer:gi,object:Jr,source:vi,light:xi,string:bi};function wi(t){var e=t.value,r=t.valueSpec,i=t.styleSpec;return r.expression&&Rr(te(e))?Qr(t):r.expression&&jr(ee(e))?ti(t):r.type&&_i[r.type]?_i[r.type](t):Jr(Qt({},t,{valueSpec:r.type?i[r.type]:r}))}function Ai(t){var e=t.value,r=t.key,i=bi(t);return i.length?i:(-1===e.indexOf("{fontstack}")&&i.push(new Kt(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&i.push(new Kt(r,e,'"glyphs" url must include a "{range}" token')),i)}function ki(t,e){e=e||Jt;var r=[];return r=r.concat(wi({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Ai,"*":function(){return[]}}})),t.constants&&(r=r.concat(Wt({key:"constants",value:t.constants,style:t,styleSpec:e}))),Si(r)}function Si(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function zi(t){return function(){return Si(t.apply(this,arguments))}}ki.source=zi(vi),ki.light=zi(xi),ki.layer=zi(gi),ki.filter=zi(yi),ki.paintProperty=zi(di),ki.layoutProperty=zi(mi);var Bi=ki,Ti=ki.light,Mi=ki.paintProperty,Ei=ki.layoutProperty;function Vi(t,e){var r=!1;if(e&&e.length)for(var i=0,n=e;i<n.length;i+=1){var a=n[i];t.fire(new Zt(new Error(a.message))),r=!0;}return r}var Ii=Ri,Ci=3;function Ri(t,e,r){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var n=new Int32Array(this.arrayBuffer);t=n[0],e=n[1],r=n[2],this.d=e+2*r;for(var a=0;a<this.d*this.d;a++){var o=n[Ci+a],s=n[Ci+a+1];i.push(o===s?null:n.subarray(o,s));}var u=n[Ci+i.length],p=n[Ci+i.length+1];this.keys=n.subarray(u,p),this.bboxes=n.subarray(p),this.insert=this._insertReadonly;}else{this.d=e+2*r;for(var l=0;l<this.d*this.d;l++)i.push([]);this.keys=[],this.bboxes=[];}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var h=r/e*t;this.min=-h,this.max=t+h;}Ri.prototype.insert=function(t,e,r,i,n){this._forEachCell(e,r,i,n,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(i),this.bboxes.push(n);},Ri.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ri.prototype._insertCell=function(t,e,r,i,n,a){this.cells[n].push(a);},Ri.prototype.query=function(t,e,r,i,n){var a=this.min,o=this.max;if(t<=a&&e<=a&&o<=r&&o<=i&&!n)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,r,i,this._queryCell,s,{},n),s},Ri.prototype._queryCell=function(t,e,r,i,n,a,o,s){var u=this.cells[n];if(null!==u)for(var p=this.keys,l=this.bboxes,h=0;h<u.length;h++){var c=u[h];if(void 0===o[c]){var y=4*c;(s?s(l[y+0],l[y+1],l[y+2],l[y+3]):t<=l[y+2]&&e<=l[y+3]&&r>=l[y+0]&&i>=l[y+1])?(o[c]=!0,a.push(p[c])):o[c]=!1;}}},Ri.prototype._forEachCell=function(t,e,r,i,n,a,o,s){for(var u=this._convertToCellCoord(t),p=this._convertToCellCoord(e),l=this._convertToCellCoord(r),h=this._convertToCellCoord(i),c=u;c<=l;c++)for(var y=p;y<=h;y++){var f=this.d*y+c;if((!s||s(this._convertFromCellCoord(c),this._convertFromCellCoord(y),this._convertFromCellCoord(c+1),this._convertFromCellCoord(y+1)))&&n.call(this,t,e,r,i,f,a,o,s))return}},Ri.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Ri.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Ri.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Ci+this.cells.length+1+1,r=0,i=0;i<this.cells.length;i++)r+=this.cells[i].length;var n=new Int32Array(e+r+this.keys.length+this.bboxes.length);n[0]=this.extent,n[1]=this.n,n[2]=this.padding;for(var a=e,o=0;o<t.length;o++){var s=t[o];n[Ci+o]=a,n.set(s,a),a+=s.length;}return n[Ci+t.length]=a,n.set(this.keys,a),a+=this.keys.length,n[Ci+t.length+1]=a,n.set(this.bboxes,a),a+=this.bboxes.length,n.buffer};var Li=self.ImageData,Pi={};function Fi(t,e,r){void 0===r&&(r={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Pi[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]};}for(var Oi in Fi("Object",Object),Ii.serialize=function(t,e){var r=t.toArrayBuffer();return e&&e.push(r),r},Ii.deserialize=function(t){return new Ii(t)},Fi("Grid",Ii),Fi("Color",ve),Fi("Error",Error),Fi("StylePropertyFunction",Zr),Fi("StyleExpression",Nr,{omit:["_evaluator"]}),Fi("ZoomDependentExpression",Yr),Fi("ZoomConstantExpression",Xr),Fi("CompoundExpression",Ce,{omit:["_evaluate"]}),er)er[Oi]._classRegistryKey||Fi("Expression_"+Oi,er[Oi]);function Di(t,e){if(null===t||void 0===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(t instanceof ArrayBuffer)return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var r=t;return e&&e.push(r.buffer),r}if(t instanceof Li)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var i=[],n=0,a=t;n<a.length;n+=1){var o=a[n];i.push(Di(o,e));}return i}if("object"==typeof t){var s=t.constructor,u=s._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");var p={};if(s.serialize)p._serialized=s.serialize(t,e);else{for(var l in t)if(t.hasOwnProperty(l)&&!(Pi[u].omit.indexOf(l)>=0)){var h=t[l];p[l]=Pi[u].shallow.indexOf(l)>=0?h:Di(h,e);}t instanceof Error&&(p.message=t.message);}return{name:u,properties:p}}throw new Error("can't serialize object of type "+typeof t)}function qi(t){if(null===t||void 0===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof ArrayBuffer||ArrayBuffer.isView(t)||t instanceof Li)return t;if(Array.isArray(t))return t.map(function(t){return qi(t)});if("object"==typeof t){var e=t,r=e.name,i=e.properties;if(!r)throw new Error("can't deserialize object of anonymous class");var n=Pi[r].klass;if(!n)throw new Error("can't deserialize unregistered class "+r);if(n.deserialize)return n.deserialize(i._serialized);for(var a=Object.create(n.prototype),o=0,s=Object.keys(i);o<s.length;o+=1){var u=s[o];a[u]=Pi[r].shallow.indexOf(u)>=0?i[u]:qi(i[u]);}return a}throw new Error("can't deserialize object of type "+typeof t)}var Ui=function(){this.first=!0;};Ui.prototype.update=function(t,e){var r=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=r,!0))};var Ni={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function ji(t){for(var e=0,r=t;e<r.length;e+=1){if(Xi(r[e].charCodeAt(0)))return!0}return!1}function Gi(t){return!Ni.Arabic(t)&&(!Ni["Arabic Supplement"](t)&&(!Ni["Arabic Extended-A"](t)&&(!Ni["Arabic Presentation Forms-A"](t)&&!Ni["Arabic Presentation Forms-B"](t))))}function Xi(t){return 746===t||747===t||!(t<4352)&&(!!Ni["Bopomofo Extended"](t)||(!!Ni.Bopomofo(t)||(!(!Ni["CJK Compatibility Forms"](t)||t>=65097&&t<=65103)||(!!Ni["CJK Compatibility Ideographs"](t)||(!!Ni["CJK Compatibility"](t)||(!!Ni["CJK Radicals Supplement"](t)||(!!Ni["CJK Strokes"](t)||(!(!Ni["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||(!!Ni["CJK Unified Ideographs Extension A"](t)||(!!Ni["CJK Unified Ideographs"](t)||(!!Ni["Enclosed CJK Letters and Months"](t)||(!!Ni["Hangul Compatibility Jamo"](t)||(!!Ni["Hangul Jamo Extended-A"](t)||(!!Ni["Hangul Jamo Extended-B"](t)||(!!Ni["Hangul Jamo"](t)||(!!Ni["Hangul Syllables"](t)||(!!Ni.Hiragana(t)||(!!Ni["Ideographic Description Characters"](t)||(!!Ni.Kanbun(t)||(!!Ni["Kangxi Radicals"](t)||(!!Ni["Katakana Phonetic Extensions"](t)||(!(!Ni.Katakana(t)||12540===t)||(!(!Ni["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||(!(!Ni["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(!!Ni["Unified Canadian Aboriginal Syllabics"](t)||(!!Ni["Unified Canadian Aboriginal Syllabics Extended"](t)||(!!Ni["Vertical Forms"](t)||(!!Ni["Yijing Hexagram Symbols"](t)||(!!Ni["Yi Syllables"](t)||!!Ni["Yi Radicals"](t))))))))))))))))))))))))))))))}function Yi(t){return!(Xi(t)||function(t){return!!(Ni["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Ni["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Ni["Letterlike Symbols"](t)||Ni["Number Forms"](t)||Ni["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Ni["Control Pictures"](t)&&9251!==t||Ni["Optical Character Recognition"](t)||Ni["Enclosed Alphanumerics"](t)||Ni["Geometric Shapes"](t)||Ni["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Ni["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Ni["CJK Symbols and Punctuation"](t)||Ni.Katakana(t)||Ni["Private Use Area"](t)||Ni["CJK Compatibility Forms"](t)||Ni["Small Form Variants"](t)||Ni["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Hi(t,e){return!(!e&&(t>=1424&&t<=2303||Ni["Arabic Presentation Forms-A"](t)||Ni["Arabic Presentation Forms-B"](t)))&&!(t>=2304&&t<=3583||t>=3840&&t<=4255||Ni.Khmer(t))}var Zi,$i=!1,Ji=null,Ki=!1,Wi=new $t,Qi={applyArabicShaping:null,processBidirectionalText:null,isLoaded:function(){return Ki||null!=Qi.applyArabicShaping}},tn=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ui,this.transition={});};tn.prototype.isSupportedScript=function(t){return function(t,e){for(var r=0,i=t;r<i.length;r+=1)if(!Hi(i[r].charCodeAt(0),e))return!1;return!0}(t,Qi.isLoaded())},tn.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},tn.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),r=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*e}};var en=function(t,e){this.property=t,this.value=e,this.expression=$r(void 0===e?t.specification.default:e,t.specification);};en.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},en.prototype.possiblyEvaluate=function(t){return this.property.possiblyEvaluate(this,t)};var rn=function(t){this.property=t,this.value=new en(t,void 0);};rn.prototype.transitioned=function(t,e){return new an(this.property,this.value,e,x({},t.transition,this.transition),t.now)},rn.prototype.untransitioned=function(){return new an(this.property,this.value,null,{},0)};var nn=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues);};nn.prototype.getValue=function(t){return z(this._values[t].value.value)},nn.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new rn(this._values[t].property)),this._values[t].value=new en(this._values[t].property,null===e?void 0:z(e));},nn.prototype.getTransition=function(t){return z(this._values[t].transition)},nn.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new rn(this._values[t].property)),this._values[t].transition=z(e)||void 0;},nn.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var i=r[e],n=this.getValue(i);void 0!==n&&(t[i]=n);var a=this.getTransition(i);void 0!==a&&(t[i+"-transition"]=a);}return t},nn.prototype.transitioned=function(t,e){for(var r=new on(this._properties),i=0,n=Object.keys(this._values);i<n.length;i+=1){var a=n[i];r._values[a]=this._values[a].transitioned(t,e._values[a]);}return r},nn.prototype.untransitioned=function(){for(var t=new on(this._properties),e=0,r=Object.keys(this._values);e<r.length;e+=1){var i=r[e];t._values[i]=this._values[i].untransitioned();}return t};var an=function(t,e,r,i,n){this.property=t,this.value=e,this.begin=n+i.delay||0,this.end=this.begin+i.duration||0,t.specification.transition&&(i.delay||i.duration)&&(this.prior=r);};an.prototype.possiblyEvaluate=function(t){var e=t.now||0,r=this.value.possiblyEvaluate(t),i=this.prior;if(i){if(e>this.end)return this.prior=null,r;if(this.value.isDataDriven())return this.prior=null,r;if(e<this.begin)return i.possiblyEvaluate(t);var n=(e-this.begin)/(this.end-this.begin);return this.property.interpolate(i.possiblyEvaluate(t),r,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}(n))}return r};var on=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues);};on.prototype.possiblyEvaluate=function(t){for(var e=new pn(this._properties),r=0,i=Object.keys(this._values);r<i.length;r+=1){var n=i[r];e._values[n]=this._values[n].possiblyEvaluate(t);}return e},on.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1){var r=e[t];if(this._values[r].prior)return!0}return!1};var sn=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues);};sn.prototype.getValue=function(t){return z(this._values[t].value)},sn.prototype.setValue=function(t,e){this._values[t]=new en(this._values[t].property,null===e?void 0:z(e));},sn.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var i=r[e],n=this.getValue(i);void 0!==n&&(t[i]=n);}return t},sn.prototype.possiblyEvaluate=function(t){for(var e=new pn(this._properties),r=0,i=Object.keys(this._values);r<i.length;r+=1){var n=i[r];e._values[n]=this._values[n].possiblyEvaluate(t);}return e};var un=function(t,e,r){this.property=t,this.value=e,this.globals=r;};un.prototype.isConstant=function(){return"constant"===this.value.kind},un.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},un.prototype.evaluate=function(t,e){return this.property.evaluate(this.value,this.globals,t,e)};var pn=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues);};pn.prototype.get=function(t){return this._values[t]};var ln=function(t){this.specification=t;};ln.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},ln.prototype.interpolate=function(t,e,r){var i=Ne[this.specification.type];return i?i(t,e,r):t};var hn=function(t){this.specification=t;};hn.prototype.possiblyEvaluate=function(t,e){return"constant"===t.expression.kind||"camera"===t.expression.kind?new un(this,{kind:"constant",value:t.expression.evaluate(e)},e):new un(this,t.expression,e)},hn.prototype.interpolate=function(t,e,r){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new un(this,{kind:"constant",value:void 0},t.globals);var i=Ne[this.specification.type];return i?new un(this,{kind:"constant",value:i(t.value.value,e.value.value,r)},t.globals):t},hn.prototype.evaluate=function(t,e,r,i){return"constant"===t.kind?t.value:t.evaluate(e,r,i)};var cn=function(t){this.specification=t;};cn.prototype.possiblyEvaluate=function(t,e){if(void 0!==t.value){if("constant"===t.expression.kind){var r=t.expression.evaluate(e);return this._calculate(r,r,r,e)}return this._calculate(t.expression.evaluate(new tn(Math.floor(e.zoom-1),e)),t.expression.evaluate(new tn(Math.floor(e.zoom),e)),t.expression.evaluate(new tn(Math.floor(e.zoom+1),e)),e)}},cn.prototype._calculate=function(t,e,r,i){var n=i.zoom,a=n-Math.floor(n),o=i.crossFadingFactor();return n>i.zoomHistory.lastIntegerZoom?{from:t,to:e,fromScale:2,toScale:1,t:a+(1-a)*o}:{from:r,to:e,fromScale:.5,toScale:1,t:1-(1-o)*a}},cn.prototype.interpolate=function(t){return t};var yn=function(t){this.specification=t;};yn.prototype.possiblyEvaluate=function(t,e){return!!t.expression.evaluate(e)},yn.prototype.interpolate=function(){return!1};var fn=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},t){var r=t[e],i=this.defaultPropertyValues[e]=new en(r,void 0),n=this.defaultTransitionablePropertyValues[e]=new rn(r);this.defaultTransitioningPropertyValues[e]=n.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=i.possiblyEvaluate({});}};Fi("DataDrivenProperty",hn),Fi("DataConstantProperty",ln),Fi("CrossFadedProperty",cn),Fi("ColorRampProperty",yn);var dn=function(t){function e(e,r){if(t.call(this),this.id=e.id,this._featureFilter=function(){return!0},"custom"!==e.type){if(e=e,this.metadata=e.metadata,this.type=e.type,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this.visibility="visible",this.depthTest=e["depth-test"]||!1,this.shadowCenter=e["shadow-center"]||!1,"background"!==e.type&&"sphere-background"!==e.type&&"panorama"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new sn(r.layout)),r.paint){for(var i in this._transitionablePaint=new nn(r.paint),e.paint)this.setPaintProperty(i,e.paint[i],{validate:!1});for(var n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned();}e.clipGround&&(this.clipGround=!0),this.useLayerPosition=!1;}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,r){if(null!==e&&void 0!==e){var i="layers."+this.id+".layout."+t;if(this._validate(Ei,i,t,e,r))return}"visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility="none"===e?e:"visible";},e.prototype.getPaintProperty=function(t){return A(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,r){if(null!==e&&void 0!==e){var i="layers."+this.id+".paint."+t;if(this._validate(Mi,i,t,e,r))return!1}if(A(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var n=this._transitionablePaint._values[t].value.isDataDriven();this._transitionablePaint.setValue(t,e);var a=this._transitionablePaint._values[t].value.isDataDriven();return this._handleSpecialPaintPropertyUpdate(t),a||n},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||(!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility)},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint);},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t)),this.paint=this._transitioningPaint.possiblyEvaluate(t);},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,_original_style:this._original_style,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return"none"===this.visibility&&(t.layout=t.layout||{},t.layout.visibility="none"),S(t,function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)})},e.prototype._validate=function(t,e,r,i,n){return(!n||!1!==n.validate)&&Vi(this,t.call(Bi,{key:e,layerType:this.type,objectKey:r,value:i,styleSpec:Jt,style:{glyphs:!0,sprite:!0}}))},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof un&&cr(e.property.specification)&&(("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent))return!0}return!1},e.prototype.clearPick=function(){},e}($t),mn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},gn=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8;},vn=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0);};function xn(t,e){void 0===e&&(e=1);var r=0,i=0;return{members:t.map(function(t){var n,a=(n=t.type,mn[n].BYTES_PER_ELEMENT),o=r=bn(r,Math.max(e,a)),s=t.components||1;return i=Math.max(i,a),r+=a*s,{name:t.name,type:t.type,components:s,offset:o}}),size:bn(r,Math.max(i,e)),alignment:e}}function bn(t,e){return Math.ceil(t/e)*e}vn.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},vn.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},vn.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews());},vn.prototype.clear=function(){this.length=0;},vn.prototype.resize=function(t){this.reserve(t),this.length=t;},vn.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e);}},vn.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var _n=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e){var r=this.length;this.resize(r+1);var i=2*r;return this.int16[i+0]=t,this.int16[i+1]=e,r},e.prototype.emplace=function(t,e,r){var i=2*t;return this.int16[i+0]=e,this.int16[i+1]=r,t},e}(vn);_n.prototype.bytesPerElement=4,Fi("StructArrayLayout2i4",_n);var wn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i){var n=this.length;this.resize(n+1);var a=4*n;return this.int16[a+0]=t,this.int16[a+1]=e,this.int16[a+2]=r,this.int16[a+3]=i,n},e.prototype.emplace=function(t,e,r,i,n){var a=4*t;return this.int16[a+0]=e,this.int16[a+1]=r,this.int16[a+2]=i,this.int16[a+3]=n,t},e}(vn);wn.prototype.bytesPerElement=8,Fi("StructArrayLayout4i8",wn);var An=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n){var a=this.length;this.resize(a+1);var o=5*a;return this.float32[o+0]=t,this.float32[o+1]=e,this.float32[o+2]=r,this.float32[o+3]=i,this.float32[o+4]=n,a},e.prototype.emplace=function(t,e,r,i,n,a){var o=5*t;return this.float32[o+0]=e,this.float32[o+1]=r,this.float32[o+2]=i,this.float32[o+3]=n,this.float32[o+4]=a,t},e}(vn);An.prototype.bytesPerElement=20,Fi("StructArrayLayout5f20",An);var kn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s){var u=this.length;this.resize(u+1);var p=8*u;return this.float32[p+0]=t,this.float32[p+1]=e,this.float32[p+2]=r,this.float32[p+3]=i,this.float32[p+4]=n,this.float32[p+5]=a,this.float32[p+6]=o,this.float32[p+7]=s,u},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u){var p=8*t;return this.float32[p+0]=e,this.float32[p+1]=r,this.float32[p+2]=i,this.float32[p+3]=n,this.float32[p+4]=a,this.float32[p+5]=o,this.float32[p+6]=s,this.float32[p+7]=u,t},e}(vn);kn.prototype.bytesPerElement=32,Fi("StructArrayLayout8f32",kn);var Sn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r){var i=this.length;this.resize(i+1);var n=4*i;return this.int16[n+0]=t,this.int16[n+1]=e,this.int16[n+2]=r,i},e.prototype.emplace=function(t,e,r,i){var n=4*t;return this.int16[n+0]=e,this.int16[n+1]=r,this.int16[n+2]=i,t},e}(vn);Sn.prototype.bytesPerElement=8,Fi("StructArrayLayout3i8",Sn);var zn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a,o){var s=this.length;this.resize(s+1);var u=8*s;return this.int16[u+0]=t,this.int16[u+1]=e,this.int16[u+2]=r,this.int16[u+4]=i,this.int16[u+5]=n,this.int16[u+6]=a,this.int16[u+7]=o,s},e.prototype.emplace=function(t,e,r,i,n,a,o,s){var u=8*t;return this.int16[u+0]=e,this.int16[u+1]=r,this.int16[u+2]=i,this.int16[u+4]=n,this.int16[u+5]=a,this.int16[u+6]=o,this.int16[u+7]=s,t},e}(vn);zn.prototype.bytesPerElement=16,Fi("StructArrayLayout3i4i16",zn);var Bn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s,u,p){var l=this.length;this.resize(l+1);var h=8*l,c=16*l;return this.int16[h+0]=t,this.int16[h+1]=e,this.int16[h+2]=r,this.int16[h+3]=i,this.uint8[c+8]=n,this.uint8[c+9]=a,this.uint8[c+10]=o,this.uint8[c+11]=s,this.uint16[h+6]=u,this.uint16[h+7]=p,l},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u,p,l){var h=8*t,c=16*t;return this.int16[h+0]=e,this.int16[h+1]=r,this.int16[h+2]=i,this.int16[h+3]=n,this.uint8[c+8]=a,this.uint8[c+9]=o,this.uint8[c+10]=s,this.uint8[c+11]=u,this.uint16[h+6]=p,this.uint16[h+7]=l,t},e}(vn);Bn.prototype.bytesPerElement=16,Fi("StructArrayLayout4i4ub2ui16",Bn);var Tn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s,u){var p=this.length;this.resize(p+1);var l=8*p,h=16*p;return this.int16[l+0]=t,this.int16[l+1]=e,this.int16[l+2]=r,this.int16[l+3]=i,this.uint8[h+8]=n,this.uint8[h+9]=a,this.uint8[h+10]=o,this.uint8[h+11]=s,this.uint16[l+6]=u,p},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u,p){var l=8*t,h=16*t;return this.int16[l+0]=e,this.int16[l+1]=r,this.int16[l+2]=i,this.int16[l+3]=n,this.uint8[h+8]=a,this.uint8[h+9]=o,this.uint8[h+10]=s,this.uint8[h+11]=u,this.uint16[l+6]=p,t},e}(vn);Tn.prototype.bytesPerElement=16,Fi("StructArrayLayout4i4ub1ui16",Tn);var Mn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s,u,p,l,h,c){var y=this.length;this.resize(y+1);var f=10*y,d=20*y;return this.int16[f+0]=t,this.int16[f+1]=e,this.int16[f+2]=r,this.int16[f+3]=i,this.uint8[d+8]=n,this.uint8[d+9]=a,this.uint8[d+10]=o,this.uint8[d+11]=s,this.uint8[d+12]=u,this.uint8[d+13]=p,this.uint8[d+14]=l,this.uint16[f+8]=h,this.uint16[f+9]=c,y},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u,p,l,h,c,y){var f=10*t,d=20*t;return this.int16[f+0]=e,this.int16[f+1]=r,this.int16[f+2]=i,this.int16[f+3]=n,this.uint8[d+8]=a,this.uint8[d+9]=o,this.uint8[d+10]=s,this.uint8[d+11]=u,this.uint8[d+12]=p,this.uint8[d+13]=l,this.uint8[d+14]=h,this.uint16[f+8]=c,this.uint16[f+9]=y,t},e}(vn);Mn.prototype.bytesPerElement=20,Fi("StructArrayLayout4i4ub3ub2ui20",Mn);var En=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a){var o=this.length;this.resize(o+1);var s=6*o;return this.int16[s+0]=t,this.int16[s+1]=e,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=n,this.int16[s+5]=a,o},e.prototype.emplace=function(t,e,r,i,n,a,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=i,this.int16[s+3]=n,this.int16[s+4]=a,this.int16[s+5]=o,t},e}(vn);En.prototype.bytesPerElement=12,Fi("StructArrayLayout2i4i12",En);var Vn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n){var a=this.length;this.resize(a+1);var o=4*a,s=16*a;return this.float32[o+0]=t,this.float32[o+1]=e,this.float32[o+2]=r,this.int8[s+12]=i,this.int8[s+13]=n,a},e.prototype.emplace=function(t,e,r,i,n,a){var o=4*t,s=16*t;return this.float32[o+0]=e,this.float32[o+1]=r,this.float32[o+2]=i,this.int8[s+12]=n,this.int8[s+13]=a,t},e}(vn);Vn.prototype.bytesPerElement=16,Fi("StructArrayLayout3f2b16",Vn);var In=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s,u){var p=this.length;this.resize(p+1);var l=9*p;return this.float32[l+0]=t,this.float32[l+1]=e,this.float32[l+2]=r,this.float32[l+3]=i,this.float32[l+4]=n,this.float32[l+5]=a,this.float32[l+6]=o,this.float32[l+7]=s,this.float32[l+8]=u,p},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u,p){var l=9*t;return this.float32[l+0]=e,this.float32[l+1]=r,this.float32[l+2]=i,this.float32[l+3]=n,this.float32[l+4]=a,this.float32[l+5]=o,this.float32[l+6]=s,this.float32[l+7]=u,this.float32[l+8]=p,t},e}(vn);In.prototype.bytesPerElement=36,Fi("StructArrayLayout3f3f3f36",In);var Cn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s,u,p,l,h){var c=this.length;this.resize(c+1);var y=6*c,f=24*c;return this.float32[y+0]=t,this.float32[y+1]=e,this.float32[y+2]=r,this.int8[f+12]=i,this.int8[f+13]=n,this.uint8[f+16]=a,this.uint8[f+17]=o,this.uint8[f+18]=s,this.uint8[f+19]=u,this.uint8[f+20]=p,this.uint8[f+21]=l,this.uint8[f+22]=h,c},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u,p,l,h,c){var y=6*t,f=24*t;return this.float32[y+0]=e,this.float32[y+1]=r,this.float32[y+2]=i,this.int8[f+12]=n,this.int8[f+13]=a,this.uint8[f+16]=o,this.uint8[f+17]=s,this.uint8[f+18]=u,this.uint8[f+19]=p,this.uint8[f+20]=l,this.uint8[f+21]=h,this.uint8[f+22]=c,t},e}(vn);Cn.prototype.bytesPerElement=24,Fi("StructArrayLayout3f2b4ub3ub24",Cn);var Rn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s,u){var p=this.length;this.resize(p+1);var l=5*p,h=20*p;return this.float32[l+0]=t,this.float32[l+1]=e,this.float32[l+2]=r,this.int8[h+12]=i,this.int8[h+13]=n,this.uint8[h+16]=a,this.uint8[h+17]=o,this.uint8[h+18]=s,this.uint8[h+19]=u,p},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u,p){var l=5*t,h=20*t;return this.float32[l+0]=e,this.float32[l+1]=r,this.float32[l+2]=i,this.int8[h+12]=n,this.int8[h+13]=a,this.uint8[h+16]=o,this.uint8[h+17]=s,this.uint8[h+18]=u,this.uint8[h+19]=p,t},e}(vn);Rn.prototype.bytesPerElement=20,Fi("StructArrayLayout3f2b4ub20",Rn);var Ln=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r){var i=this.length;this.resize(i+1);var n=3*i;return this.float32[n+0]=t,this.float32[n+1]=e,this.float32[n+2]=r,i},e.prototype.emplace=function(t,e,r,i){var n=3*t;return this.float32[n+0]=e,this.float32[n+1]=r,this.float32[n+2]=i,t},e}(vn);Ln.prototype.bytesPerElement=12,Fi("StructArrayLayout3f12",Ln);var Pn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int8=new Int8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s,u,p){var l=this.length;this.resize(l+1);var h=6*l,c=24*l,y=12*l;return this.float32[h+0]=t,this.float32[h+1]=e,this.float32[h+2]=r,this.int8[c+12]=i,this.int8[c+13]=n,this.uint8[c+16]=a,this.uint8[c+17]=o,this.uint8[c+18]=s,this.uint8[c+19]=u,this.uint16[y+10]=p,l},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u,p,l){var h=6*t,c=24*t,y=12*t;return this.float32[h+0]=e,this.float32[h+1]=r,this.float32[h+2]=i,this.int8[c+12]=n,this.int8[c+13]=a,this.uint8[c+16]=o,this.uint8[c+17]=s,this.uint8[c+18]=u,this.uint8[c+19]=p,this.uint16[y+10]=l,t},e}(vn);Pn.prototype.bytesPerElement=24,Fi("StructArrayLayout3f2b4ub1ui24",Pn);var Fn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n){var a=this.length;this.resize(a+1);var o=4*a,s=8*a;return this.float32[o+0]=t,this.float32[o+1]=e,this.float32[o+2]=r,this.int16[s+6]=i,this.int16[s+7]=n,a},e.prototype.emplace=function(t,e,r,i,n,a){var o=4*t,s=8*t;return this.float32[o+0]=e,this.float32[o+1]=r,this.float32[o+2]=i,this.int16[s+6]=n,this.int16[s+7]=a,t},e}(vn);Fn.prototype.bytesPerElement=16,Fi("StructArrayLayout3f2i16",Fn);var On=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s,u){var p=this.length;this.resize(p+1);var l=9*p;return this.int16[l+0]=t,this.int16[l+1]=e,this.int16[l+2]=r,this.int16[l+3]=i,this.uint16[l+4]=n,this.uint16[l+5]=a,this.uint16[l+6]=o,this.uint16[l+7]=s,this.uint16[l+8]=u,p},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u,p){var l=9*t;return this.int16[l+0]=e,this.int16[l+1]=r,this.int16[l+2]=i,this.int16[l+3]=n,this.uint16[l+4]=a,this.uint16[l+5]=o,this.uint16[l+6]=s,this.uint16[l+7]=u,this.uint16[l+8]=p,t},e}(vn);On.prototype.bytesPerElement=18,Fi("StructArrayLayout4i5ui18",On);var Dn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t){var e=this.length;this.resize(e+1);var r=1*e;return this.uint32[r+0]=t,e},e.prototype.emplace=function(t,e){var r=1*t;return this.uint32[r+0]=e,t},e}(vn);Dn.prototype.bytesPerElement=4,Fi("StructArrayLayout1ul4",Dn);var qn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s,u,p,l){var h=this.length;this.resize(h+1);var c=12*h,y=6*h;return this.int16[c+0]=t,this.int16[c+1]=e,this.int16[c+2]=r,this.int16[c+3]=i,this.int16[c+4]=n,this.int16[c+5]=a,this.uint32[y+3]=o,this.uint16[c+8]=s,this.uint16[c+9]=u,this.int16[c+10]=p,this.int16[c+11]=l,h},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u,p,l,h){var c=12*t,y=6*t;return this.int16[c+0]=e,this.int16[c+1]=r,this.int16[c+2]=i,this.int16[c+3]=n,this.int16[c+4]=a,this.int16[c+5]=o,this.uint32[y+3]=s,this.uint16[c+8]=u,this.uint16[c+9]=p,this.int16[c+10]=l,this.int16[c+11]=h,t},e}(vn);qn.prototype.bytesPerElement=24,Fi("StructArrayLayout6i1ul2ui2i24",qn);var Un=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a){var o=this.length;this.resize(o+1);var s=6*o;return this.int16[s+0]=t,this.int16[s+1]=e,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=n,this.int16[s+5]=a,o},e.prototype.emplace=function(t,e,r,i,n,a,o){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=i,this.int16[s+3]=n,this.int16[s+4]=a,this.int16[s+5]=o,t},e}(vn);Un.prototype.bytesPerElement=12,Fi("StructArrayLayout2i2i2i12",Un);var Nn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e){var r=this.length;this.resize(r+1);var i=4*r;return this.uint8[i+0]=t,this.uint8[i+1]=e,r},e.prototype.emplace=function(t,e,r){var i=4*t;return this.uint8[i+0]=e,this.uint8[i+1]=r,t},e}(vn);Nn.prototype.bytesPerElement=4,Fi("StructArrayLayout2ub4",Nn);var jn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s,u,p,l,h,c,y){var f=this.length;this.resize(f+1);var d=20*f,m=10*f,g=40*f;return this.int16[d+0]=t,this.int16[d+1]=e,this.uint16[d+2]=r,this.uint16[d+3]=i,this.uint32[m+2]=n,this.uint32[m+3]=a,this.uint32[m+4]=o,this.uint16[d+10]=s,this.uint16[d+11]=u,this.uint16[d+12]=p,this.float32[m+7]=l,this.float32[m+8]=h,this.uint8[g+36]=c,this.uint8[g+37]=y,f},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u,p,l,h,c,y,f){var d=20*t,m=10*t,g=40*t;return this.int16[d+0]=e,this.int16[d+1]=r,this.uint16[d+2]=i,this.uint16[d+3]=n,this.uint32[m+2]=a,this.uint32[m+3]=o,this.uint32[m+4]=s,this.uint16[d+10]=u,this.uint16[d+11]=p,this.uint16[d+12]=l,this.float32[m+7]=h,this.float32[m+8]=c,this.uint8[g+36]=y,this.uint8[g+37]=f,t},e}(vn);jn.prototype.bytesPerElement=40,Fi("StructArrayLayout2i2ui3ul3ui2f2ub40",jn);var Gn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t){var e=this.length;this.resize(e+1);var r=1*e;return this.float32[r+0]=t,e},e.prototype.emplace=function(t,e){var r=1*t;return this.float32[r+0]=e,t},e}(vn);Gn.prototype.bytesPerElement=4,Fi("StructArrayLayout1f4",Gn);var Xn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r){var i=this.length;this.resize(i+1);var n=3*i;return this.int16[n+0]=t,this.int16[n+1]=e,this.int16[n+2]=r,i},e.prototype.emplace=function(t,e,r,i){var n=3*t;return this.int16[n+0]=e,this.int16[n+1]=r,this.int16[n+2]=i,t},e}(vn);Xn.prototype.bytesPerElement=6,Fi("StructArrayLayout3i6",Xn);var Yn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s,u,p){var l=this.length;this.resize(l+1);var h=10*l;return this.int16[h+0]=t,this.int16[h+1]=e,this.int16[h+2]=r,this.int16[h+3]=i,this.uint16[h+4]=n,this.uint16[h+5]=a,this.uint16[h+6]=o,this.uint16[h+7]=s,this.uint16[h+8]=u,this.uint16[h+9]=p,l},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u,p,l){var h=10*t;return this.int16[h+0]=e,this.int16[h+1]=r,this.int16[h+2]=i,this.int16[h+3]=n,this.uint16[h+4]=a,this.uint16[h+5]=o,this.uint16[h+6]=s,this.uint16[h+7]=u,this.uint16[h+8]=p,this.uint16[h+9]=l,t},e}(vn);Yn.prototype.bytesPerElement=20,Fi("StructArrayLayout4i6ui20",Yn);var Hn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a,o,s,u){var p=this.length;this.resize(p+1);var l=6*p,h=12*p;return this.float32[l+0]=t,this.float32[l+1]=e,this.float32[l+2]=r,this.int16[h+6]=i,this.int16[h+7]=n,this.uint16[h+8]=a,this.uint16[h+9]=o,this.uint16[h+10]=s,this.uint16[h+11]=u,p},e.prototype.emplace=function(t,e,r,i,n,a,o,s,u,p){var l=6*t,h=12*t;return this.float32[l+0]=e,this.float32[l+1]=r,this.float32[l+2]=i,this.int16[h+6]=n,this.int16[h+7]=a,this.uint16[h+8]=o,this.uint16[h+9]=s,this.uint16[h+10]=u,this.uint16[h+11]=p,t},e}(vn);Hn.prototype.bytesPerElement=24,Fi("StructArrayLayout3f2i4ui24",Hn);var Zn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i,n,a,o){var s=this.length;this.resize(s+1);var u=5*s,p=10*s;return this.float32[u+0]=t,this.float32[u+1]=e,this.float32[u+2]=r,this.int16[p+6]=i,this.int16[p+7]=n,this.int16[p+8]=a,this.int16[p+9]=o,s},e.prototype.emplace=function(t,e,r,i,n,a,o,s){var u=5*t,p=10*t;return this.float32[u+0]=e,this.float32[u+1]=r,this.float32[u+2]=i,this.int16[p+6]=n,this.int16[p+7]=a,this.int16[p+8]=o,this.int16[p+9]=s,t},e}(vn);Zn.prototype.bytesPerElement=20,Fi("StructArrayLayout3f2i2i20",Zn);var $n=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r){var i=this.length;this.resize(i+1);var n=2*i,a=4*i;return this.uint32[n+0]=t,this.uint16[a+2]=e,this.uint16[a+3]=r,i},e.prototype.emplace=function(t,e,r,i){var n=2*t,a=4*t;return this.uint32[n+0]=e,this.uint16[a+2]=r,this.uint16[a+3]=i,t},e}(vn);$n.prototype.bytesPerElement=8,Fi("StructArrayLayout1ul2ui8",$n);var Jn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r){var i=this.length;this.resize(i+1);var n=3*i;return this.uint16[n+0]=t,this.uint16[n+1]=e,this.uint16[n+2]=r,i},e.prototype.emplace=function(t,e,r,i){var n=3*t;return this.uint16[n+0]=e,this.uint16[n+1]=r,this.uint16[n+2]=i,t},e}(vn);Jn.prototype.bytesPerElement=6,Fi("StructArrayLayout3ui6",Jn);var Kn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e){var r=this.length;this.resize(r+1);var i=2*r;return this.uint16[i+0]=t,this.uint16[i+1]=e,r},e.prototype.emplace=function(t,e,r){var i=2*t;return this.uint16[i+0]=e,this.uint16[i+1]=r,t},e}(vn);Kn.prototype.bytesPerElement=4,Fi("StructArrayLayout2ui4",Kn);var Wn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e){var r=this.length;this.resize(r+1);var i=2*r;return this.float32[i+0]=t,this.float32[i+1]=e,r},e.prototype.emplace=function(t,e,r){var i=2*t;return this.float32[i+0]=e,this.float32[i+1]=r,t},e}(vn);Wn.prototype.bytesPerElement=8,Fi("StructArrayLayout2f8",Wn);var Qn=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer);},e.prototype.emplaceBack=function(t,e,r,i){var n=this.length;this.resize(n+1);var a=4*n;return this.float32[a+0]=t,this.float32[a+1]=e,this.float32[a+2]=r,this.float32[a+3]=i,n},e.prototype.emplace=function(t,e,r,i,n){var a=4*t;return this.float32[a+0]=e,this.float32[a+1]=r,this.float32[a+2]=i,this.float32[a+3]=n,t},e}(vn);Qn.prototype.bytesPerElement=16,Fi("StructArrayLayout4f16",Qn);var ta=function(t){function e(){t.apply(this,arguments);}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},radius:{configurable:!0},signedDistanceFromAnchor:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointX.set=function(t){this._structArray.int16[this._pos2+0]=t;},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.anchorPointY.set=function(t){this._structArray.int16[this._pos2+1]=t;},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.x1.set=function(t){this._structArray.int16[this._pos2+2]=t;},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.y1.set=function(t){this._structArray.int16[this._pos2+3]=t;},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.x2.set=function(t){this._structArray.int16[this._pos2+4]=t;},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.y2.set=function(t){this._structArray.int16[this._pos2+5]=t;},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.featureIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t;},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t;},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t;},r.radius.get=function(){return this._structArray.int16[this._pos2+10]},r.radius.set=function(t){this._structArray.int16[this._pos2+10]=t;},r.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},r.signedDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+11]=t;},r.anchorPoint.get=function(){return new l(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,r),e}(gn);ta.prototype.size=24;var ea=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new ta(this,t)},e}(qn);Fi("CollisionBoxArray",ea);var ra=function(t){function e(){t.apply(this,arguments);}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},hidden:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t;},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t;},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.glyphStartIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t;},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.numGlyphs.set=function(t){this._structArray.uint16[this._pos2+3]=t;},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.vertexStartIndex.set=function(t){this._structArray.uint32[this._pos4+2]=t;},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineStartIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t;},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.lineLength.set=function(t){this._structArray.uint32[this._pos4+4]=t;},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.segment.set=function(t){this._structArray.uint16[this._pos2+10]=t;},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.lowerSize.set=function(t){this._structArray.uint16[this._pos2+11]=t;},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.upperSize.set=function(t){this._structArray.uint16[this._pos2+12]=t;},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetX.set=function(t){this._structArray.float32[this._pos4+7]=t;},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.lineOffsetY.set=function(t){this._structArray.float32[this._pos4+8]=t;},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.writingMode.set=function(t){this._structArray.uint8[this._pos1+36]=t;},r.hidden.get=function(){return this._structArray.uint8[this._pos1+37]},r.hidden.set=function(t){this._structArray.uint8[this._pos1+37]=t;},Object.defineProperties(e.prototype,r),e}(gn);ra.prototype.size=40;var ia=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new ra(this,t)},e}(jn);Fi("PlacedSymbolArray",ia);var na=function(t){function e(){t.apply(this,arguments);}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={offsetX:{configurable:!0}};return r.offsetX.get=function(){return this._structArray.float32[this._pos4+0]},r.offsetX.set=function(t){this._structArray.float32[this._pos4+0]=t;},Object.defineProperties(e.prototype,r),e}(gn);na.prototype.size=4;var aa=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e.prototype.get=function(t){return new na(this,t)},e}(Gn);Fi("GlyphOffsetArray",aa);var oa=function(t){function e(){t.apply(this,arguments);}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={x:{configurable:!0},y:{configurable:!0},tileUnitDistanceFromAnchor:{configurable:!0}};return r.x.get=function(){return this._structArray.int16[this._pos2+0]},r.x.set=function(t){this._structArray.int16[this._pos2+0]=t;},r.y.get=function(){return this._structArray.int16[this._pos2+1]},r.y.set=function(t){this._structArray.int16[this._pos2+1]=t;},r.tileUnitDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+2]},r.tileUnitDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+2]=t;},Object.defineProperties(e.prototype,r),e}(gn);oa.prototype.size=6;var sa=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e.prototype.get=function(t){return new oa(this,t)},e}(Xn);Fi("SymbolLineVertexArray",sa);var ua=function(t){function e(){t.apply(this,arguments);}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.featureIndex.set=function(t){this._structArray.uint32[this._pos4+0]=t;},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t;},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},r.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+3]=t;},Object.defineProperties(e.prototype,r),e}(gn);ua.prototype.size=8;var pa=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(t){return new ua(this,t)},e}($n);Fi("FeatureIndexArray",pa);var la=xn([{name:"a_pos",components:2,type:"Int16"}],4).members,ha=function(t){void 0===t&&(t=[]),this.segments=t;};ha.prototype.prepareSegment=function(t,e,r){var i=this.segments[this.segments.length-1];return t>ha.MAX_VERTEX_ARRAY_LENGTH&&T("Max vertices per segment is "+ha.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!i||i.vertexLength+t>ha.MAX_VERTEX_ARRAY_LENGTH)&&(i={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},this.segments.push(i)),i},ha.prototype.get=function(){return this.segments},ha.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var r=e[t];for(var i in r.vaos)r.vaos[i].destroy();}},ha.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Fi("SegmentVector",ha);var ca=function(t,e){return 256*(t=m(Math.floor(t),0,255))+(e=m(Math.floor(e),0,255))};function ya(t,e){return e?[ca(t[0],t[1]),ca(t[2],t[3])]:[ca(255*t.r,255*t.g),ca(255*t.b,255*t.a)]}var fa=function(t,e,r){this.value=t,this.name=e,this.type=r,this.statistics={max:-1/0};};fa.prototype.defines=function(){return["#define HAS_UNIFORM_u_"+this.name]},fa.prototype.populatePaintArray=function(){},fa.prototype.updatePaintArray=function(){},fa.prototype.upload=function(){},fa.prototype.destroy=function(){},fa.prototype.setUniforms=function(t,e,r,i){var n=i.constantOr(this.value),a=t.gl;"color"===this.type?a.uniform4f(e.uniforms["u_"+this.name],n.r,n.g,n.b,n.a):a.uniform1f(e.uniforms["u_"+this.name],n);};var da=function(t,e,r){this.expression=t,this.name=e,this.type=r,this.statistics={max:-1/0};var i="color"===r?Wn:Gn;this.paintVertexAttributes=[{name:"a_"+e,type:"Float32",components:"color"===r?2:1,offset:0}],this.paintVertexArray=new i;};da.prototype.defines=function(){return[]},da.prototype.populatePaintArray=function(t,e){var r=this.paintVertexArray,i=r.length;r.reserve(t);var n=this.expression.evaluate(new tn(0),e,{});if("color"===this.type)for(var a=ya(n,"color"!==this.name&&"fill_color"!==this.name),o=i;o<t;o++)r.emplaceBack(a[0],a[1]);else{for(var s=i;s<t;s++)r.emplaceBack(n);this.statistics.max=Math.max(this.statistics.max,n);}},da.prototype.updatePaintArray=function(t,e,r,i){var n=this.paintVertexArray,a=this.expression.evaluate({zoom:0},r,i);if("color"===this.type)for(var o=ya(a,"color"!==this.name&&"fill_color"!==this.name),s=t;s<e;s++)n.emplace(s,o[0],o[1]);else{for(var u=t;u<e;u++)n.emplace(u,a);this.statistics.max=Math.max(this.statistics.max,a);}},da.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent));},da.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy();},da.prototype.setUniforms=function(t,e){t.gl.uniform1f(e.uniforms["a_"+this.name+"_t"],0);};var ma=function(t,e,r,i,n){this.expression=t,this.name=e,this.type=r,this.useIntegerZoom=i,this.zoom=n,this.statistics={max:-1/0};var a="color"===r?Qn:Wn;this.paintVertexAttributes=[{name:"a_"+e,type:"Float32",components:"color"===r?4:2,offset:0}],this.paintVertexArray=new a;};ma.prototype.defines=function(){return[]},ma.prototype.populatePaintArray=function(t,e){var r=this.paintVertexArray,i=r.length;r.reserve(t);var n=this.expression.evaluate(new tn(this.zoom),e,{}),a=this.expression.evaluate(new tn(this.zoom+1),e,{});if("color"===this.type)for(var o=ya(n),s=ya(a),u=i;u<t;u++)r.emplaceBack(o[0],o[1],s[0],s[1]);else{for(var p=i;p<t;p++)r.emplaceBack(n,a);this.statistics.max=Math.max(this.statistics.max,n,a);}},ma.prototype.updatePaintArray=function(t,e,r,i){var n=this.paintVertexArray,a=this.expression.evaluate({zoom:this.zoom},r,i),o=this.expression.evaluate({zoom:this.zoom+1},r,i);if("color"===this.type)for(var s=ya(a),u=ya(o),p=t;p<e;p++)n.emplace(p,s[0],s[1],u[0],u[1]);else{for(var l=t;l<e;l++)n.emplace(l,a,o);this.statistics.max=Math.max(this.statistics.max,a,o);}},ma.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent));},ma.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy();},ma.prototype.interpolationFactor=function(t){return this.useIntegerZoom?this.expression.interpolationFactor(Math.floor(t),this.zoom,this.zoom+1):this.expression.interpolationFactor(t,this.zoom,this.zoom+1)},ma.prototype.setUniforms=function(t,e,r){t.gl.uniform1f(e.uniforms["a_"+this.name+"_t"],this.interpolationFactor(r.zoom));};var ga=function(){this.binders={},this.cacheKey="",this._buffers=[],this._idMap={},this._bufferOffset=0;};ga.createDynamic=function(t,e,r){var i=new ga,n=[];for(var a in t.paint._values)if(r(a)){var o=t.paint.get(a);if(o instanceof un&&cr(o.property.specification)){var s=xa(a,t.type),u=o.property.specification.type,p=o.property.useIntegerZoom;"constant"===o.value.kind?(i.binders[a]=new fa(o.value,s,u),n.push("/u_"+s)):"source"===o.value.kind?(i.binders[a]=new da(o.value,s,u),n.push("/a_"+s)):(i.binders[a]=new ma(o.value,s,u,p,e),n.push("/z_"+s));}}return i.cacheKey=n.sort().join(""),i},ga.prototype.populatePaintArrays=function(t,e,r){for(var i in this.binders)this.binders[i].populatePaintArray(t,e);if(e.id){var n=String(e.id);this._idMap[n]=this._idMap[n]||[],this._idMap[n].push({index:r,start:this._bufferOffset,end:t});}this._bufferOffset=t;},ga.prototype.updatePaintArrays=function(t,e,r){var i=!1;for(var n in t){var a=this._idMap[n];if(a)for(var o=t[n],s=0,u=a;s<u.length;s+=1){var p=u[s],l=e.feature(p.index);for(var h in this.binders){var c=this.binders[h];if(!(c instanceof fa)&&!0===c.expression.isStateDependent){var y=r.paint.get(h);c.expression=y.value,c.updatePaintArray(p.start,p.end,l,o),i=!0;}}}}return i},ga.prototype.defines=function(){var t=[];for(var e in this.binders)t.push.apply(t,this.binders[e].defines());return t},ga.prototype.setUniforms=function(t,e,r,i){for(var n in this.binders){this.binders[n].setUniforms(t,e,i,r.get(n));}},ga.prototype.getPaintVertexBuffers=function(){return this._buffers},ga.prototype.upload=function(t){for(var e in this.binders)this.binders[e].upload(t);var r=[];for(var i in this.binders){var n=this.binders[i];(n instanceof da||n instanceof ma)&&n.paintVertexBuffer&&r.push(n.paintVertexBuffer);}this._buffers=r;},ga.prototype.destroy=function(){for(var t in this.binders)this.binders[t].destroy();};var va=function(t,e,r,i){void 0===i&&(i=function(){return!0}),this.programConfigurations={};for(var n=0,a=e;n<a.length;n+=1){var o=a[n];this.programConfigurations[o.id]=ga.createDynamic(o,r,i),this.programConfigurations[o.id].layoutAttributes=t;}this.needsUpload=!1;};function xa(t,e){return{"text-opacity":"opacity","icon-opacity":"opacity","text-color":"fill_color","icon-color":"fill_color","text-halo-color":"halo_color","icon-halo-color":"halo_color","text-halo-blur":"halo_blur","icon-halo-blur":"halo_blur","text-halo-width":"halo_width","icon-halo-width":"halo_width","line-gap-width":"gapwidth","line-border-width":"borderwidth","line-border-opacity":"borderopacity","line-border-color":"bordercolor"}[t]||t.replace(e.replace("sphere-3d-","")+"-","").replace(e.replace("sphere-","")+"-","").replace(/-/g,"_")}va.prototype.populatePaintArrays=function(t,e,r){for(var i in this.programConfigurations)this.programConfigurations[i].populatePaintArrays(t,e,r);this.needsUpload=!0;},va.prototype.updatePaintArrays=function(t,e,r){for(var i=0,n=r;i<n.length;i+=1){var a=n[i];this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,e,a)||this.needsUpload;}},va.prototype.get=function(t){return this.programConfigurations[t]},va.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1;}},va.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy();},Fi("ConstantBinder",fa),Fi("SourceExpressionBinder",da),Fi("CompositeExpressionBinder",ma),Fi("ProgramConfiguration",ga,{omit:["_buffers"]}),Fi("ProgramConfigurationSet",va);var ba=8192;var _a,wa=(_a=16,{min:-1*Math.pow(2,_a-1),max:Math.pow(2,_a-1)-1});function Aa(t){for(var e=ba/t.extent,r=t.loadGeometry(),i=0;i<r.length;i++)for(var n=r[i],a=0;a<n.length;a++){var o=n[a];o.x=Math.round(o.x*e),o.y=Math.round(o.y*e),(o.x<wa.min||o.x>wa.max||o.y<wa.min||o.y>wa.max)&&T("Geometry exceeds allowed extent, reduce your vector tile buffer size");}return r}function ka(t,e,r,i,n){t.emplaceBack(2*e+(i+1)/2,2*r+(n+1)/2);}var Sa=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new _n,this.indexArray=new Jn,this.segments=new ha,this.programConfigurations=new va(la,t.layers,t.zoom);};function za(t,e){for(var r=0;r<t.length;r++)if(Pa(e,t[r]))return!0;for(var i=0;i<e.length;i++)if(Pa(t,e[i]))return!0;return!!Va(t,e)}function Ba(t,e,r){return!!Pa(t,e)||!!Ca(e,t,r)}function Ta(t,e){if(1===t.length)return La(e,t[0]);for(var r=0;r<e.length;r++)for(var i=e[r],n=0;n<i.length;n++)if(Pa(t,i[n]))return!0;for(var a=0;a<t.length;a++)if(La(e,t[a]))return!0;for(var o=0;o<e.length;o++)if(Va(t,e[o]))return!0;return!1}function Ma(t,e,r){for(var i=0;i<e.length;i++){var n=e[i];if(t.length>=3)for(var a=0;a<n.length;a++)if(Pa(t,n[a]))return!0;if(Ea(t,n,r))return!0}return!1}function Ea(t,e,r){if(t.length>1){if(Va(t,e))return!0;for(var i=0;i<e.length;i++)if(Ca(e[i],t,r))return!0}for(var n=0;n<t.length;n++)if(Ca(t[n],e,r))return!0;return!1}function Va(t,e){if(0===t.length||0===e.length)return!1;for(var r=0;r<t.length-1;r++)for(var i=t[r],n=t[r+1],a=0;a<e.length-1;a++){if(Ia(i,n,e[a],e[a+1]))return!0}return!1}function Ia(t,e,r,i){return M(t,r,i)!==M(e,r,i)&&M(t,e,r)!==M(t,e,i)}function Ca(t,e,r){var i=r*r;if(1===e.length)return t.distSqr(e[0])<i;for(var n=1;n<e.length;n++){if(Ra(t,e[n-1],e[n])<i)return!0}return!1}function Ra(t,e,r){var i=e.distSqr(r);if(0===i)return t.distSqr(e);var n=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/i;return n<0?t.distSqr(e):n>1?t.distSqr(r):t.distSqr(r.sub(e)._mult(n)._add(e))}function La(t,e){for(var r,i,n,a=!1,o=0;o<t.length;o++)for(var s=0,u=(r=t[o]).length-1;s<r.length;u=s++)i=r[s],n=r[u],i.y>e.y!=n.y>e.y&&e.x<(n.x-i.x)*(e.y-i.y)/(n.y-i.y)+i.x&&(a=!a);return a}function Pa(t,e){for(var r=!1,i=0,n=t.length-1;i<t.length;n=i++){var a=t[i],o=t[n];a.y>e.y!=o.y>e.y&&e.x<(o.x-a.x)*(e.y-a.y)/(o.y-a.y)+a.x&&(r=!r);}return r}function Fa(t,e,r){var i=r[0],n=r[2];if(t.x<i.x&&e.x<i.x||t.x>n.x&&e.x>n.x||t.y<i.y&&e.y<i.y||t.y>n.y&&e.y>n.y)return!1;var a=M(t,e,r[0]);return a!==M(t,e,r[1])||a!==M(t,e,r[2])||a!==M(t,e,r[3])}function Oa(t,e,r){var i=e.paint.get(t).value;return"constant"===i.kind?i.value:r.programConfigurations.get(e.id).binders[t].statistics.max}function Da(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function qa(t,e,r,i,n){if(!e[0]&&!e[1])return t;var a=l.convert(e);"viewport"===r&&a._rotate(-i);for(var o=[],s=0;s<t.length;s++){var u=t[s];o.push(u.sub(a._mult(n)));}return o}Sa.prototype.populate=function(t,e){for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new tn(this.zoom),a)){var u=Aa(a);this.addFeature(a,u,o),e.featureIndex.insert(a,u,o,s,this.index);}}this.x=e.x,this.y=e.y,this.z=e.z;},Sa.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},Sa.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Sa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Sa.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,la),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},Sa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},Sa.prototype.addFeature=function(t,e,r){for(var i=0,n=e;i<n.length;i+=1)for(var a=0,o=n[i];a<o.length;a+=1){var s=o[a],u=s.x,p=s.y;if(!(u<.2*-ba||u>=1.2*ba||p<.2*-ba||p>=1.2*ba)){var l=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=l.vertexLength;ka(this.layoutVertexArray,u,p,-1,-1),ka(this.layoutVertexArray,u,p,1,-1),ka(this.layoutVertexArray,u,p,1,1),ka(this.layoutVertexArray,u,p,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),l.vertexLength+=4,l.primitiveLength+=2;}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r);},Fi("CircleBucket",Sa,{omit:["layers"]});var Ua={paint:new fn({"circle-radius":new hn(Jt.paint_circle["circle-radius"]),"circle-color":new hn(Jt.paint_circle["circle-color"]),"circle-blur":new hn(Jt.paint_circle["circle-blur"]),"circle-opacity":new hn(Jt.paint_circle["circle-opacity"]),"circle-translate":new ln(Jt.paint_circle["circle-translate"]),"circle-translate-anchor":new ln(Jt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ln(Jt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ln(Jt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new hn(Jt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new hn(Jt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new hn(Jt.paint_circle["circle-stroke-opacity"])})},Na=function(t){function e(e){t.call(this,e,Ua);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Sa(t)},e.prototype.queryRadius=function(t){var e=t;return Oa("circle-radius",this,e)+Oa("circle-stroke-width",this,e)+Da(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,a,o,s){for(var u=qa(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,o),p=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),l="map"===this.paint.get("circle-pitch-alignment"),h=l?u:function(t,e){return t.map(function(t){return ja(t,e)})}(u,s),c=l?p*o:p,y=0,f=i;y<f.length;y+=1)for(var d=0,m=f[y];d<m.length;d+=1){var g=m[d],v=l?g:ja(g,s),x=c,b=ft([],[g.x,g.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?x*=b[3]/a.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(x*=a.cameraToCenterDistance/b[3]),Ba(h,v,x))return!0}return!1},e}(dn);function ja(t,e){var r=ft([],[t.x,t.y,0,1],e);return new l(r[0]/r[3],r[1]/r[3])}function Ga(t,e,r,i,n){t.emplaceBack(2*e+(i+1)/2,2*r+(n+1)/2);}var Xa=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new _n,this.indexArray=new Jn,this.segments=new ha,this.programConfigurations=new va(la,t.layers,t.zoom);};function Ya(t,e,r,i){var n=e.width,a=e.height;if(i){if(i.length!==n*a*r)throw new RangeError("mismatched image size")}else i=new Uint8Array(n*a*r);return t.width=n,t.height=a,t.data=i,t}function Ha(t,e,r){var i=e.width,n=e.height;if(i!==t.width||n!==t.height){var a=Ya({},{width:i,height:n},r);Za(t,a,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,n)},r),t.width=i,t.height=n,t.data=a.data;}}function Za(t,e,r,i,n,a){if(0===n.width||0===n.height)return e;if(n.width>t.width||n.height>t.height||r.x>t.width-n.width||r.y>t.height-n.height)throw new RangeError("out of range source coordinates for image copy");if(n.width>e.width||n.height>e.height||i.x>e.width-n.width||i.y>e.height-n.height)throw new RangeError("out of range destination coordinates for image copy");for(var o=t.data,s=e.data,u=0;u<n.height;u++)for(var p=((r.y+u)*t.width+r.x)*a,l=((i.y+u)*e.width+i.x)*a,h=0;h<n.width*a;h++)s[l+h]=o[p+h];return e}Xa.prototype.populate=function(t,e){for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new tn(this.zoom),a)){var u=Aa(a);this.addFeature(a,u,o),e.featureIndex.insert(a,u,o,s,this.index);}}this.x=e.x,this.y=e.y,this.z=e.z;},Xa.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},Xa.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Xa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Xa.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,la),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},Xa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},Xa.prototype.addFeature=function(t,e,r){for(var i=0,n=e;i<n.length;i+=1)for(var a=0,o=n[i];a<o.length;a+=1){var s=o[a],u=s.x,p=s.y;if(!(u<0||u>=ba||p<0||p>=ba)){var l=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=l.vertexLength;Ga(this.layoutVertexArray,u,p,-1,-1),Ga(this.layoutVertexArray,u,p,1,-1),Ga(this.layoutVertexArray,u,p,1,1),Ga(this.layoutVertexArray,u,p,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),l.vertexLength+=4,l.primitiveLength+=2;}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r);},Fi("HeatmapBucket",Xa,{omit:["layers"]});var $a=function(t,e){Ya(this,t,1,e);};$a.prototype.resize=function(t){Ha(this,t,1);},$a.prototype.clone=function(){return new $a({width:this.width,height:this.height},new Uint8Array(this.data))},$a.copy=function(t,e,r,i,n){Za(t,e,r,i,n,1);};var Ja=function(t,e){Ya(this,t,4,e);};Ja.prototype.resize=function(t){Ha(this,t,4);},Ja.prototype.clone=function(){return new Ja({width:this.width,height:this.height},new Uint8Array(this.data))},Ja.copy=function(t,e,r,i,n){Za(t,e,r,i,n,4);},Fi("AlphaImage",$a),Fi("RGBAImage",Ja);var Ka={paint:new fn({"heatmap-radius":new hn(Jt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new hn(Jt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ln(Jt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new yn(Jt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ln(Jt.paint_heatmap["heatmap-opacity"])})};function Wa(t,e){for(var r=new Uint8Array(1024),i={},n=0,a=0;n<256;n++,a+=4){i[e]=n/255;var o=t.evaluate(i);r[a+0]=Math.floor(255*o.r/o.a),r[a+1]=Math.floor(255*o.g/o.a),r[a+2]=Math.floor(255*o.b/o.a),r[a+3]=Math.floor(255*o.a);}return new Ja({width:256,height:1},r)}var Qa=function(t){function e(e){t.call(this,e,Ka),this._updateColorRamp();}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Xa(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp();},e.prototype._updateColorRamp=function(){var t=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=Wa(t,"heatmapDensity"),this.colorRampTexture=null;},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null);},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(dn),to={paint:new fn({"hillshade-illumination-direction":new ln(Jt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ln(Jt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ln(Jt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ln(Jt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ln(Jt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ln(Jt.paint_hillshade["hillshade-accent-color"])})},eo=function(t){function e(e){t.call(this,e,to);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(dn),ro=xn([{name:"a_pos",components:3,type:"Int16"}],4).members,io=ao,no=ao;function ao(t,e,r){r=r||2;var i,n,a,o,s,u,p,l=e&&e.length,h=l?e[0]*r:t.length,c=oo(t,0,h,r,!0),y=[];if(!c||c.next===c.prev)return y;if(l&&(c=function(t,e,r,i){var n,a,o,s,u,p=[];for(n=0,a=e.length;n<a;n++)o=e[n]*i,s=n<a-1?e[n+1]*i:t.length,(u=oo(t,o,s,i,!1))===u.next&&(u.steiner=!0),p.push(vo(u));for(p.sort(yo),n=0;n<p.length;n++)fo(p[n],r),r=so(r,r.next);return r}(t,e,c,r)),t.length>80*r){i=a=t[0],n=o=t[1];for(var f=r;f<h;f+=r)s=t[f],u=t[f+1],s<i&&(i=s),u<n&&(n=u),s>a&&(a=s),u>o&&(o=u);p=0!==(p=Math.max(a-i,o-n))?1/p:0;}return uo(c,y,r,i,n,p),y}function oo(t,e,r,i,n){var a,o;if(n===Vo(t,e,r,i)>0)for(a=e;a<r;a+=i)o=To(a,t[a],t[a+1],o);else for(a=r-i;a>=e;a-=i)o=To(a,t[a],t[a+1],o);return o&&wo(o,o.next)&&(Mo(o),o=o.next),o}function so(t,e){if(!t)return t;e||(e=t);var r,i=t;do{if(r=!1,i.steiner||!wo(i,i.next)&&0!==_o(i.prev,i,i.next))i=i.next;else{if(Mo(i),(i=e=i.prev)===i.next)break;r=!0;}}while(r||i!==e);return e}function uo(t,e,r,i,n,a,o){if(t){!o&&a&&function(t,e,r,i){var n=t;do{null===n.z&&(n.z=go(n.x,n.y,e,r,i)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var e,r,i,n,a,o,s,u,p=1;do{for(r=t,t=null,a=null,o=0;r;){for(o++,i=r,s=0,e=0;e<p&&(s++,i=i.nextZ);e++);for(u=p;s>0||u>0&&i;)0!==s&&(0===u||!i||r.z<=i.z)?(n=r,r=r.nextZ,s--):(n=i,i=i.nextZ,u--),a?a.nextZ=n:t=n,n.prevZ=a,a=n;r=i;}a.nextZ=null,p*=2;}while(o>1)}(n);}(t,i,n,a);for(var s,u,p=t;t.prev!==t.next;)if(s=t.prev,u=t.next,a?lo(t,i,n,a):po(t))e.push(s.i/r),e.push(t.i/r),e.push(u.i/r),Mo(t),t=u.next,p=u.next;else if((t=u)===p){o?1===o?uo(t=ho(so(t),e,r),e,r,i,n,a,2):2===o&&co(t,e,r,i,n,a):uo(so(t),e,r,i,n,a,1);break}}}function po(t){var e=t.prev,r=t,i=t.next;if(_o(e,r,i)>=0)return!1;for(var n=t.next.next;n!==t.prev;){if(xo(e.x,e.y,r.x,r.y,i.x,i.y,n.x,n.y)&&_o(n.prev,n,n.next)>=0)return!1;n=n.next;}return!0}function lo(t,e,r,i){var n=t.prev,a=t,o=t.next;if(_o(n,a,o)>=0)return!1;for(var s=n.x<a.x?n.x<o.x?n.x:o.x:a.x<o.x?a.x:o.x,u=n.y<a.y?n.y<o.y?n.y:o.y:a.y<o.y?a.y:o.y,p=n.x>a.x?n.x>o.x?n.x:o.x:a.x>o.x?a.x:o.x,l=n.y>a.y?n.y>o.y?n.y:o.y:a.y>o.y?a.y:o.y,h=go(s,u,e,r,i),c=go(p,l,e,r,i),y=t.prevZ,f=t.nextZ;y&&y.z>=h&&f&&f.z<=c;){if(y!==t.prev&&y!==t.next&&xo(n.x,n.y,a.x,a.y,o.x,o.y,y.x,y.y)&&_o(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,f!==t.prev&&f!==t.next&&xo(n.x,n.y,a.x,a.y,o.x,o.y,f.x,f.y)&&_o(f.prev,f,f.next)>=0)return!1;f=f.nextZ;}for(;y&&y.z>=h;){if(y!==t.prev&&y!==t.next&&xo(n.x,n.y,a.x,a.y,o.x,o.y,y.x,y.y)&&_o(y.prev,y,y.next)>=0)return!1;y=y.prevZ;}for(;f&&f.z<=c;){if(f!==t.prev&&f!==t.next&&xo(n.x,n.y,a.x,a.y,o.x,o.y,f.x,f.y)&&_o(f.prev,f,f.next)>=0)return!1;f=f.nextZ;}return!0}function ho(t,e,r){var i=t;do{var n=i.prev,a=i.next.next;!wo(n,a)&&Ao(n,i,i.next,a)&&zo(n,a)&&zo(a,n)&&(e.push(n.i/r),e.push(i.i/r),e.push(a.i/r),Mo(i),Mo(i.next),i=t=a),i=i.next;}while(i!==t);return so(i)}function co(t,e,r,i,n,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&bo(o,s)){var u=Bo(o,s);return o=so(o,o.next),u=so(u,u.next),uo(o,e,r,i,n,a),void uo(u,e,r,i,n,a)}s=s.next;}o=o.next;}while(o!==t)}function yo(t,e){return t.x-e.x}function fo(t,e){if(e=function(t,e){var r,i=e,n=t.x,a=t.y,o=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=n&&s>o){if(o=s,s===n){if(a===i.y)return i;if(a===i.next.y)return i.next}r=i.x<i.next.x?i:i.next;}}i=i.next;}while(i!==e);if(!r)return null;if(n===o)return r;var u,p=r,l=r.x,h=r.y,c=1/0;i=r;do{n>=i.x&&i.x>=l&&n!==i.x&&xo(a<h?n:o,a,l,h,a<h?o:n,a,i.x,i.y)&&(u=Math.abs(a-i.y)/(n-i.x),zo(i,t)&&(u<c||u===c&&(i.x>r.x||i.x===r.x&&mo(r,i)))&&(r=i,c=u)),i=i.next;}while(i!==p);return r}(t,e)){var r=Bo(e,t);so(r,r.next);}}function mo(t,e){return _o(t.prev,t,e.prev)<0&&_o(e.next,t,t.next)<0}function go(t,e,r,i,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function vo(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;}while(e!==t);return r}function xo(t,e,r,i,n,a,o,s){return(n-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(i-s)-(r-o)*(e-s)>=0&&(r-o)*(a-s)-(n-o)*(i-s)>=0}function bo(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&Ao(r,r.next,t,e))return!0;r=r.next;}while(r!==t);return!1}(t,e)&&(zo(t,e)&&zo(e,t)&&function(t,e){var r=t,i=!1,n=(t.x+e.x)/2,a=(t.y+e.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&n<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next;}while(r!==t);return i}(t,e)&&(_o(t.prev,t,e.prev)||_o(t,e.prev,e))||wo(t,e)&&_o(t.prev,t,t.next)>0&&_o(e.prev,e,e.next)>0)}function _o(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function wo(t,e){return t.x===e.x&&t.y===e.y}function Ao(t,e,r,i){var n=So(_o(t,e,r)),a=So(_o(t,e,i)),o=So(_o(r,i,t)),s=So(_o(r,i,e));return n!==a&&o!==s||(!(0!==n||!ko(t,r,e))||(!(0!==a||!ko(t,i,e))||(!(0!==o||!ko(r,t,i))||!(0!==s||!ko(r,e,i)))))}function ko(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function So(t){return t>0?1:t<0?-1:0}function zo(t,e){return _o(t.prev,t,t.next)<0?_o(t,e,t.next)>=0&&_o(t,t.prev,e)>=0:_o(t,e,t.prev)<0||_o(t,t.next,e)<0}function Bo(t,e){var r=new Eo(t.i,t.x,t.y),i=new Eo(e.i,e.x,e.y),n=t.next,a=e.prev;return t.next=e,e.prev=t,r.next=n,n.prev=r,i.next=r,r.prev=i,a.next=i,i.prev=a,i}function To(t,e,r,i){var n=new Eo(t,e,r);return i?(n.next=i.next,n.prev=i,i.next.prev=n,i.next=n):(n.prev=n,n.next=n),n}function Mo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ);}function Eo(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1;}function Vo(t,e,r,i){for(var n=0,a=e,o=r-i;a<r;a+=i)n+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return n}ao.deviation=function(t,e,r,i){var n=e&&e.length,a=n?e[0]*r:t.length,o=Math.abs(Vo(t,0,a,r));if(n)for(var s=0,u=e.length;s<u;s++){var p=e[s]*r,l=s<u-1?e[s+1]*r:t.length;o-=Math.abs(Vo(t,p,l,r));}var h=0;for(s=0;s<i.length;s+=3){var c=i[s]*r,y=i[s+1]*r,f=i[s+2]*r;h+=Math.abs((t[c]-t[f])*(t[y+1]-t[c+1])-(t[c]-t[y])*(t[f+1]-t[c+1]));}return 0===o&&0===h?0:Math.abs((h-o)/o)},ao.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},i=0,n=0;n<t.length;n++){for(var a=0;a<t[n].length;a++)for(var o=0;o<e;o++)r.vertices.push(t[n][a][o]);n>0&&(i+=t[n-1].length,r.holes.push(i));}return r},io.default=no;var Io=e(function(t,e){t.exports=function(){function t(t,e,r){var i=t[e];t[e]=t[r],t[r]=i;}function e(t,e){return t<e?-1:t>e?1:0}return function(r,i,n,a,o){!function e(r,i,n,a,o){for(;a>n;){if(a-n>600){var s=a-n+1,u=i-n+1,p=Math.log(s),l=.5*Math.exp(2*p/3),h=.5*Math.sqrt(p*l*(s-l)/s)*(u-s/2<0?-1:1),c=Math.max(n,Math.floor(i-u*l/s+h)),y=Math.min(a,Math.floor(i+(s-u)*l/s+h));e(r,i,c,y,o);}var f=r[i],d=n,m=a;for(t(r,n,i),o(r[a],f)>0&&t(r,n,a);d<m;){for(t(r,d,m),d++,m--;o(r[d],f)<0;)d++;for(;o(r[m],f)>0;)m--;}0===o(r[n],f)?t(r,n,m):t(r,++m,a),m<=i&&(n=m+1),i<=m&&(a=m-1);}}(r,i,n||0,a||r.length-1,o||e);}}();});function Co(t,e){var r=t.length;if(r<=1)return[t];for(var i,n,a=[],o=0;o<r;o++){var s=E(t[o]);0!==s&&(t[o].area=Math.abs(s),void 0===n&&(n=s<0),n===s<0?(i&&a.push(i),i=[t[o]]):i.push(t[o]));}if(i&&a.push(i),e>1)for(var u=0;u<a.length;u++)a[u].length<=e||(Io(a[u],e,1,a[u].length-1,Ro),a[u]=a[u].slice(0,e));return a}function Ro(t,e){return e.area-t.area}var Lo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Sn,this.indexArray=new Jn,this.indexArray2=new Kn,this.programConfigurations=new va(ro,t.layers,t.zoom),this.segments=new ha,this.segments2=new ha;};Lo.prototype.populate=function(t,e){for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new tn(this.zoom),a)){var u=Aa(a);this.addFeature(a,u,o),e.featureIndex.insert(a,u,o,s,this.index);}}},Lo.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},Lo.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Lo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Lo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ro),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0;},Lo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy());},Lo.prototype.addFeature=function(t,e,r){for(var i=0,n=Co(e,500);i<n.length;i+=1){for(var a=n[i],o=0,s=0,u=a;s<u.length;s+=1){o+=u[s].length;}for(var p=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray),l=p.vertexLength,h=[],c=[],y=0,f=a;y<f.length;y+=1){var d=f[y];if(0!==d.length){d!==a[0]&&c.push(h.length/2);var m=this.segments2.prepareSegment(d.length,this.layoutVertexArray,this.indexArray2),g=m.vertexLength,v=d[0].x>32767||d[0].x;v=d[0].x<-32768?-32768:d[0].x;var x=d[0].y>32767||d[0].y;x=d[0].y<-32768?-32768:d[0].y;var b=null!==t.properties&&void 0!==t.properties&&t.properties.hasOwnProperty("levels")?10*Number(t.properties.levels):d[0].z;this.layoutVertexArray.emplaceBack(v,x,0!==b?b-500:0),this.indexArray2.emplaceBack(g+d.length-1,g),h.push(d[0].x),h.push(d[0].y);for(var _=1;_<d.length;_++){var w=d[_].x>32767||d[_].x;w=d[_].x<-32768?-32768:d[_].x;var A=d[_].y>32767||d[_].y;A=d[_].y<-32768?-32768:d[_].y;var k=null!==t.properties&&void 0!==t.properties&&t.properties.hasOwnProperty("levels")?10*Number(t.properties.levels):d[_].z;this.layoutVertexArray.emplaceBack(w,A,0!==k?k-500:0),this.indexArray2.emplaceBack(g+_-1,g+_),h.push(d[_].x),h.push(d[_].y);}m.vertexLength+=d.length,m.primitiveLength+=d.length;}}for(var S=io(h,c),z=0;z<S.length;z+=3)this.indexArray.emplaceBack(l+S[z],l+S[z+1],l+S[z+2]);p.vertexLength+=o,p.primitiveLength+=S.length/3;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r);},Fi("FillBucket",Lo,{omit:["layers"]});var Po={paint:new fn({"fill-antialias":new ln(Jt.paint_fill["fill-antialias"]),"fill-opacity":new hn(Jt.paint_fill["fill-opacity"]),"fill-color":new hn(Jt.paint_fill["fill-color"]),"fill-outline-color":new hn(Jt.paint_fill["fill-outline-color"]),"fill-translate":new ln(Jt.paint_fill["fill-translate"]),"fill-translate-anchor":new ln(Jt.paint_fill["fill-translate-anchor"]),"fill-pattern":new cn(Jt.paint_fill["fill-pattern"]),"fill-water":new ln(Jt.paint_fill["fill-water"]),"render-3d":new ln(Jt.paint_fill["render-3d"])})},Fo=function(t){function e(e){t.call(this,e,Po);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(t){this.paint=this._transitioningPaint.possiblyEvaluate(t);var e=this.paint._values["fill-outline-color"];"constant"===e.value.kind&&void 0===e.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"]);},e.prototype.createBucket=function(t){return new Lo(t)},e.prototype.queryRadius=function(){return Da(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,a,o){return Ta(qa(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,o),i)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("fill-opacity")&&"none"!==this.visibility},e}(dn),Oo=xn([{name:"a_pos",components:3,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Do=Math.pow(2,13);function qo(t,e,r,i,n,a,o,s,u){t.emplaceBack(e,r,u-500,2*Math.floor(i*Do)+o,n*Do*2,a*Do*2,Math.round(s));}var Uo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new zn,this.indexArray=new Jn,this.programConfigurations=new va(Oo,t.layers,t.zoom),this.segments=new ha;};function No(t,e){return t.x===e.x&&(t.x<0||t.x>ba)||t.y===e.y&&(t.y<0||t.y>ba)}function jo(t){return t.every(function(t){return t.x<0})||t.every(function(t){return t.x>ba})||t.every(function(t){return t.y<0})||t.every(function(t){return t.y>ba})}Uo.prototype.populate=function(t,e){for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new tn(this.zoom),a)){var u=Aa(a);this.addFeature(a,u,o),e.featureIndex.insert(a,u,o,s,this.index,!0);}}},Uo.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},Uo.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Uo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Uo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Oo),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},Uo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},Uo.prototype.addFeature=function(t,e,r){for(var i=0,n=Co(e,500);i<n.length;i+=1){for(var a=n[i],o=0,s=0,u=a;s<u.length;s+=1){o+=u[s].length;}for(var p=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),l=0,h=a;l<h.length;l+=1){var c=h[l];if(0!==c.length&&!jo(c))for(var y=0,f=0;f<c.length;f++){var d=c[f];if(f>=1){var m=c[f-1];if(!No(d,m)){p.vertexLength+4>ha.MAX_VERTEX_ARRAY_LENGTH&&(p=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var g=d.sub(m)._perp()._unit(),v=m.dist(d);y+v>32768&&(y=0),qo(this.layoutVertexArray,d.x,d.y,g.x,g.y,0,0,y,d.z),qo(this.layoutVertexArray,d.x,d.y,g.x,g.y,0,1,y,d.z),y+=v,qo(this.layoutVertexArray,m.x,m.y,g.x,g.y,0,0,y,d.z),qo(this.layoutVertexArray,m.x,m.y,g.x,g.y,0,1,y,d.z);var x=p.vertexLength;this.indexArray.emplaceBack(x,x+1,x+2),this.indexArray.emplaceBack(x+1,x+2,x+3),p.vertexLength+=4,p.primitiveLength+=2;}}}}p.vertexLength+o>ha.MAX_VERTEX_ARRAY_LENGTH&&(p=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray));for(var b=[],_=[],w=p.vertexLength,A=0,k=a;A<k.length;A+=1){var S=k[A];if(0!==S.length){S!==a[0]&&_.push(b.length/2);for(var z=0;z<S.length;z++){var B=S[z];qo(this.layoutVertexArray,B.x,B.y,0,0,1,1,0,B.z),b.push(B.x),b.push(B.y);}}}for(var T=io(b,_),M=0;M<T.length;M+=3)this.indexArray.emplaceBack(w+T[M],w+T[M+1],w+T[M+2]);p.primitiveLength+=T.length/3,p.vertexLength+=o;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r);},Fi("FillExtrusionBucket",Uo,{omit:["layers"]});var Go={paint:new fn({"extrusion-opacity":new ln(Jt.paint_extrusion["extrusion-opacity"]),"extrusion-color":new hn(Jt.paint_extrusion["extrusion-color"]),"extrusion-translate":new ln(Jt.paint_extrusion["extrusion-translate"]),"extrusion-translate-anchor":new ln(Jt.paint_extrusion["extrusion-translate-anchor"]),"extrusion-pattern":new cn(Jt.paint_extrusion["extrusion-pattern"]),"extrusion-height":new hn(Jt.paint_extrusion["extrusion-height"]),"extrusion-base":new hn(Jt.paint_extrusion["extrusion-base"]),"render-road":new ln(Jt.paint_extrusion["render-road"])})},Xo=function(t){function e(e){t.call(this,e,Go);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Uo(t)},e.prototype.queryRadius=function(){return Da(this.paint.get("extrusion-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,a,o,s){var u=qa(t,this.paint.get("extrusion-translate"),this.paint.get("extrusion-translate-anchor"),a.angle,o),p=this.paint.get("extrusion-height").evaluate(e,r),h=this.paint.get("extrusion-base").evaluate(e,r),c=function(t,e,r,i){for(var n=[],a=0,o=t;a<o.length;a+=1){var s=o[a],u=[s.x,s.y,i,1];ft(u,u,e),n.push(new l(u[0]/u[3],u[1]/u[3]));}return n}(u,s,0,0),y=function(t,e,r,i){for(var n=[],a=[],o=i[8]*e,s=i[9]*e,u=i[10]*e,p=i[11]*e,h=i[8]*r,c=i[9]*r,y=i[10]*r,f=i[11]*r,d=0,m=t;d<m.length;d+=1){for(var g=m[d],v=[],x=[],b=0,_=g;b<_.length;b+=1){var w=_[b],A=w.x,k=w.y,S=i[0]*A+i[4]*k+i[12],z=i[1]*A+i[5]*k+i[13],B=i[2]*A+i[6]*k+i[14],T=i[3]*A+i[7]*k+i[15],M=S+o,E=z+s,V=B+u,I=T+p,C=S+h,R=z+c,L=B+y,P=T+f,F=new l(M/I,E/I);F.z=V/I,v.push(F);var O=new l(C/P,R/P);O.z=L/P,x.push(O);}n.push(v),a.push(x);}return[n,a]}(i,h,p,s);return function(t,e,r){var i=1/0;Ta(r,e)&&(i=Ho(r,e[0]));for(var n=0;n<e.length;n++)for(var a=e[n],o=t[n],s=0;s<a.length-1;s++){var u=a[s],p=a[s+1],l=o[s],h=o[s+1],c=[u,p,h,l,u];za(r,c)&&(i=Math.min(i,Ho(r,c)));}return i!==1/0&&i}(y[0],y[1],c)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("extrusion-opacity")&&"none"!==this.visibility},e.prototype.resize=function(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null);},e}(dn);function Yo(t,e){return t.x*e.x+t.y*e.y}function Ho(t,e){if(1===t.length){var r=e[0],i=e[1],n=e[3],a=t[0],o=i.sub(r),s=n.sub(r),u=a.sub(r),p=Yo(o,o),l=Yo(o,s),h=Yo(s,s),c=Yo(u,o),y=Yo(u,s),f=p*h-l*l,d=(h*c-l*y)/f,m=(p*y-l*c)/f,g=1-d-m;return r.z*g+i.z*d+n.z*m}for(var v=1/0,x=0,b=e;x<b.length;x+=1){var _=b[x];v=Math.min(v,_.z);}return v}var Zo=xn([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_ext",components:2,type:"Uint16"}],4).members,$o=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]));};$o.prototype.setNorthEast=function(t){return this._ne=t instanceof Jo?new Jo(t.lng,t.lat):Jo.convert(t),this},$o.prototype.setSouthWest=function(t){return this._sw=t instanceof Jo?new Jo(t.lng,t.lat):Jo.convert(t),this},$o.prototype.extend=function(t){var e,r,i=this._sw,n=this._ne;if(t instanceof Jo)e=t,r=t;else{if(!(t instanceof $o))return Array.isArray(t)?t.every(Array.isArray)?this.extend($o.convert(t)):this.extend(Jo.convert(t)):this;if(e=t._sw,r=t._ne,!e||!r)return this}return i||n?(i.lng=Math.min(e.lng,i.lng),i.lat=Math.min(e.lat,i.lat),n.lng=Math.max(r.lng,n.lng),n.lat=Math.max(r.lat,n.lat)):(this._sw=new Jo(e.lng,e.lat),this._ne=new Jo(r.lng,r.lat)),this},$o.prototype.getCenter=function(){return new Jo((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},$o.prototype.getSouthWest=function(){return this._sw},$o.prototype.getNorthEast=function(){return this._ne},$o.prototype.getNorthWest=function(){return new Jo(this.getWest(),this.getNorth())},$o.prototype.getSouthEast=function(){return new Jo(this.getEast(),this.getSouth())},$o.prototype.getWest=function(){return this._sw.lng},$o.prototype.getSouth=function(){return this._sw.lat},$o.prototype.getEast=function(){return this._ne.lng},$o.prototype.getNorth=function(){return this._ne.lat},$o.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},$o.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},$o.prototype.isEmpty=function(){return!(this._sw&&this._ne)},$o.convert=function(t){return!t||t instanceof $o?t:new $o(t)};var Jo=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Jo.prototype.wrap=function(){return new Jo(g(this.lng,-180,180),this.lat)},Jo.prototype.toArray=function(){return[this.lng,this.lat]},Jo.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Jo.prototype.toBounds=function(t){var e=360*t/40075017,r=e/Math.cos(Math.PI/180*this.lat);return new $o(new Jo(this.lng-r,this.lat-e),new Jo(this.lng+r,this.lat+e))},Jo.convert=function(t){if(t instanceof Jo)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Jo(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Jo(Number(t.lng),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Ko={LATLON:"LATLON",MERCATOR:"MERCATOR"},Wo={R:Pt.TRANSFORM.R,CIR:Pt.TRANSFORM.CIR,project:function(t){return new l(this.lngX(t.lng,this.CIR),this.latY(t.lat,this.CIR))},unproject:function(t){return new Jo(this.xLng(t.x,this.CIR),this.yLat(t.y,this.CIR))},projectWithWorldSize:function(t,e){return new l(this.lngX(t.lng,e),this.latY(t.lat,e))},unprojectWithWorldSize:function(t,e){return new Jo(this.xLng(t.x,e),this.yLat(t.y,e))},lngX:function(t,e){return(180+t)*e/360},latY:function(t,e){return(90-t)/180*e*.5},xLng:function(t,e){return 360*t/e-180},yLat:function(t,e){return 90-t/(.5*e)*180},tileNumberToLngLat:function(t,e,r){return new Jo(this.xLng(t[0]*e,r),this.yLat(t[1]*e,r))},lngLatToTileNumber:function(t,e,r){return[this.lngX(t.lng,r)/e,this.latY(t.lat,r)/e]}},Qo={R:Pt.TRANSFORM.R,CIR:Pt.TRANSFORM.CIR,project:function(t){return new l(this.lngX(t.lng,this.CIR),this.latY(t.lat,this.CIR))},unproject:function(t){return new Jo(this.xLng(t.x,this.CIR),this.yLat(t.y,this.CIR))},projectWithWorldSize:function(t,e){return new l(this.lngX(t.lng,e),this.latY(t.lat,e))},unprojectWithWorldSize:function(t,e){return new Jo(this.xLng(t.x,e),this.yLat(t.y,e))},lngX:function(t,e){return(180+t)*e/360},latY:function(t,e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))*e/360},xLng:function(t,e){return 360*t/e-180},yLat:function(t,e){var r=180-360*t/e;return 360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90},tileNumberToLngLat:function(t,e,r){return new Jo(this.xLng(t[0]*e,r),this.yLat(t[1]*e,r))},lngLatToTileNumber:function(t,e,r){return[this.lngX(t.lng,r)/e,this.latY(t.lat,r)/e]}};function ts(t){return t===Ko.LATLON?Wo:Qo}function es(t,e,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=n,this._version=arguments[5],this._projection=t.projection||"MERCATOR",this.projObj=ts(this._projection),t.readFields(rs,this,e);}function rs(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){var r=t.readVarint()+t.pos;for(;t.pos<r;){var i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n;}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos);}function is(t){for(var e,r,i=0,n=0,a=t.length,o=a-1;n<a;o=n++)e=t[n],i+=((r=t[o]).x-e.x)*(e.y+r.y);return i}function ns(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(as,this,e),this.length=this._features.length;}function as(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){var e=null,r=t.readVarint()+t.pos;for(;t.pos<r;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null;}return e}(r));}function os(t,e,r){if(3===t){var i=new ns(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i);}}es.types=["Unknown","Point","LineString","Polygon"],es.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,i=1,n=0,a=0,o=0,s=0,u=[];t.pos<r;){if(n<=0){var p=t.readVarint();i=7&p,n=p>>3;}if(n--,1===i||2===i)a+=t.readSVarint(),o+=t.readSVarint(),this._version>100&&(s+=t.readSVarint()),1===i&&(e&&u.push(e),e=[]),e.push(new l(a,o,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone());}}return e&&u.push(e),u},es.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,n=0,a=0,o=1/0,s=-1/0,u=1/0,p=-1/0;t.pos<e;){if(i<=0){var l=t.readVarint();r=7&l,i=l>>3;}if(i--,1===r||2===r)n+=t.readSVarint(),a+=t.readSVarint(),n<o&&(o=n),n>s&&(s=n),a<u&&(u=a),a>p&&(p=a);else if(7!==r)throw new Error("unknown command "+r)}return[o,u,s,p]},es.prototype.toGeoJSON=function(t,e,r){var i,n,a=this.extent*Math.pow(2,r),o=this.extent*t,s=this.extent*e,u=this.loadGeometry(),p=es.types[this.type],l=this;function h(t){for(var e=0;e<t.length;e++){var r=t[e];t[e]=[l.projObj.xLng(r.x+o,a),l.projObj.yLat(r.y+s,a)];}}switch(this.type){case 1:var c=[];for(i=0;i<u.length;i++)c[i]=u[i][0];h(u=c);break;case 2:for(i=0;i<u.length;i++)h(u[i]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var r,i,n=[],a=0;a<e;a++){var o=is(t[a]);0!==o&&(void 0===i&&(i=o<0),i===o<0?(r&&n.push(r),r=[t[a]]):r.push(t[a]));}r&&n.push(r);return n}(u),i=0;i<u.length;i++)for(n=0;n<u[i].length;n++)h(u[i][n]);}1===u.length?u=u[0]:p="Multi"+p;var y={type:"Feature",geometry:{type:p,coordinates:u},properties:this.properties};return"id"in this&&(y.id=this.id),y},ns.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new es(this._pbf,e,this.extent,this._keys,this._values,this.version)};var ss={VectorTile:function(t,e,r){t.projection=r,this.layers=t.readFields(os,{},e);},VectorTileFeature:es,VectorTileLayer:ns},us=ss.VectorTileFeature.types,ps=63,ls=0,hs=0,cs=Math.cos(Math.PI/180*37.5),ys=.5,fs=Math.pow(2,14)/ys;function ds(t,e,r,i,n,a,o){t.emplaceBack(e.x,e.y,i?1:0,n?1:-1,Math.round(ps*r.x)+128,Math.round(ps*r.y)+128,1+(0===a?0:a<0?-1:1)|(o*ys&63)<<2,o*ys>>6,Number(ls)>0?50*Number(ls):e.z-500<0?5:e.z-500+5,hs);}var ms=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Bn,this.indexArray=new Jn,this.programConfigurations=new va(Zo,t.layers,t.zoom),this.segments=new ha;};function gs(t,e){return(t/e.tileTotal*(e.end-e.start)+e.start)*(fs-1)}ms.prototype.populate=function(t,e){for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new tn(this.zoom),a)){var u=Aa(a);this.addFeature(a,u,o),e.featureIndex.insert(a,u,o,s,this.index);}}},ms.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},ms.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ms.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ms.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zo),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},ms.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},ms.prototype.addFeature=function(t,e,r){var i=this.layers[0].layout,n=i.get("line-join").evaluate(t,{}),a=i.get("line-cap"),o=i.get("line-miter-limit"),s=i.get("line-round-limit");ls=null!==t.properties&&t.properties.hasOwnProperty("ELEV")?t.properties.ELEV:0;for(var u=0,p=e;u<p.length;u+=1){var l=p[u];this.addLine(l,t,n,a,o,s,r);}},ms.prototype.addLine=function(t,e,r,i,n,a,o){var s=null;e.properties&&e.properties.hasOwnProperty("minemap_clip_start")&&e.properties.hasOwnProperty("minemap_clip_end")&&(s={start:e.properties.minemap_clip_start,end:e.properties.minemap_clip_end,tileTotal:void 0});for(var u="Polygon"===us[e.type],p=t.length;p>=2&&t[p-1].equals(t[p-2]);)p--;for(var l=0;l<p-1&&t[l].equals(t[l+1]);)l++;if(!(p<(u?3:2))){s&&(s.tileTotal=function(t,e,r){for(var i,n,a=0,o=e;o<r-1;o++)i=t[o],n=t[o+1],a+=i.dist(n);return a}(t,l,p)),"bevel"===r&&(n=1.05);var h=ba/(512*this.overscaling)*15,c=t[l],y=this.segments.prepareSegment(10*p,this.layoutVertexArray,this.indexArray);this.distance=0;var f,d,m,g=i,v=u?"butt":i,x=!0,b=void 0,_=void 0,w=void 0,A=void 0;this.e1=this.e2=this.e3=-1,u&&(f=t[p-2],A=c.sub(f)._unit()._perp());for(var k=l;k<p;k++)if(hs=k/p*1e3,!(_=u&&k===p-1?t[l+1]:t[k+1])||!t[k].equals(_)){A&&(w=A),f&&(b=f),f=t[k],A=_?_.sub(f)._unit()._perp():w;var S=(w=w||A).add(A);0===S.x&&0===S.y||S._unit();var z=S.x*A.x+S.y*A.y,B=0!==z?1/z:1/0,T=z<cs&&b&&_;if(T&&k>l){var M=f.dist(b);if(M>2*h){var E=f.sub(f.sub(b)._mult(h/M)._round());this.distance+=E.dist(b),this.addCurrentVertex(E,this.distance,w.mult(1),0,0,!1,y,s),b=E;}}var V=b&&_,I=V?r:_?g:v;if(V&&"round"===I&&(B<a?I="miter":B<=2&&(I="fakeround")),"miter"===I&&B>n&&(I="bevel"),"bevel"===I&&(B>2&&(I="flipbevel"),B<n&&(I="miter")),b&&(this.distance+=f.dist(b)),"miter"===I)S._mult(B),this.addCurrentVertex(f,this.distance,S,0,0,!1,y,s);else if("flipbevel"===I){if(B>100)S=A.clone().mult(-1);else{var C=w.x*A.y-w.y*A.x>0?-1:1,R=B*w.add(A).mag()/w.sub(A).mag();S._perp()._mult(R*C);}this.addCurrentVertex(f,this.distance,S,0,0,!1,y,s),this.addCurrentVertex(f,this.distance,S.mult(-1),0,0,!1,y,s);}else if("bevel"===I||"fakeround"===I){var L=w.x*A.y-w.y*A.x>0,P=-Math.sqrt(B*B-1);if(L?(m=0,d=P):(d=0,m=P),x||this.addCurrentVertex(f,this.distance,w,d,m,!1,y,s),"fakeround"===I){for(var F=Math.floor(8*(.5-(z-.5))),O=void 0,D=0;D<F;D++)O=A.mult((D+1)/(F+1))._add(w)._unit(),this.addPieSliceVertex(f,this.distance,O,L,y,s);this.addPieSliceVertex(f,this.distance,S,L,y,s);for(var q=F-1;q>=0;q--)O=w.mult((q+1)/(F+1))._add(A)._unit(),this.addPieSliceVertex(f,this.distance,O,L,y,s);}_&&this.addCurrentVertex(f,this.distance,A,-d,-m,!1,y,s);}else"butt"===I?(x||this.addCurrentVertex(f,this.distance,w,0,0,!1,y,s),_&&this.addCurrentVertex(f,this.distance,A,0,0,!1,y,s)):"square"===I?(x||(this.addCurrentVertex(f,this.distance,w,1,1,!1,y,s),this.e1=this.e2=-1),_&&this.addCurrentVertex(f,this.distance,A,-1,-1,!1,y,s)):"round"===I&&(x||(this.addCurrentVertex(f,this.distance,w,0,0,!1,y,s),this.addCurrentVertex(f,this.distance,w,1,1,!0,y,s),this.e1=this.e2=-1),_&&(this.addCurrentVertex(f,this.distance,A,-1,-1,!0,y,s),this.addCurrentVertex(f,this.distance,A,0,0,!1,y,s)));if(T&&k<p-1){var U=f.dist(_);if(U>2*h){var N=f.add(_.sub(f)._mult(h/U)._round());this.distance+=N.dist(f),this.addCurrentVertex(N,this.distance,A.mult(1),0,0,!1,y,s),f=N;}}x=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o);}},ms.prototype.addCurrentVertex=function(t,e,r,i,n,a,o,s){var u,p=this.layoutVertexArray,l=this.indexArray;s&&(e=gs(e,s)),u=r.clone(),i&&u._sub(r.perp()._mult(i)),ds(p,t,u,a,!1,i,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=r.mult(-1),n&&u._sub(r.perp()._mult(n)),ds(p,t,u,a,!0,-n,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>fs/2&&!s&&(this.distance=0,this.addCurrentVertex(t,this.distance,r,i,n,a,o));},ms.prototype.addPieSliceVertex=function(t,e,r,i,n,a){r=r.mult(i?-1:1);var o=this.layoutVertexArray,s=this.indexArray;a&&(e=gs(e,a)),ds(o,t,r,!1,i,0,e),this.e3=n.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),n.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3;},Fi("LineBucket",ms,{omit:["layers"]});var vs=new fn({"line-cap":new ln(Jt.layout_line["line-cap"]),"line-join":new hn(Jt.layout_line["line-join"]),"line-miter-limit":new ln(Jt.layout_line["line-miter-limit"]),"line-round-limit":new ln(Jt.layout_line["line-round-limit"]),"border-visibility":new ln(Jt.layout_line["border-visibility"])}),xs={paint:new fn({"line-opacity":new hn(Jt.paint_line["line-opacity"]),"line-color":new hn(Jt.paint_line["line-color"]),"line-translate":new ln(Jt.paint_line["line-translate"]),"line-translate-anchor":new ln(Jt.paint_line["line-translate-anchor"]),"line-width":new hn(Jt.paint_line["line-width"]),"line-border-width":new hn(Jt.paint_line["line-border-width"]),"line-border-opacity":new hn(Jt.paint_line["line-border-opacity"]),"line-border-color":new hn(Jt.paint_line["line-border-color"]),"line-gap-width":new hn(Jt.paint_line["line-gap-width"]),"line-offset":new hn(Jt.paint_line["line-offset"]),"line-blur":new hn(Jt.paint_line["line-blur"]),"line-dasharray":new cn(Jt.paint_line["line-dasharray"]),"line-pattern":new cn(Jt.paint_line["line-pattern"]),"line-gradient":new yn(Jt.paint_line["line-gradient"]),"render-3d":new ln(Jt.paint_line["render-3d"])}),layout:vs},bs=new(function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new tn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,i,n){return r=x({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,i,n)},e}(hn))(xs.paint.properties["line-width"].specification);bs.useIntegerZoom=!0;var _s=function(t){function e(e){t.call(this,e,xs);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&this._updateGradient();},e.prototype._updateGradient=function(){var t=this._transitionablePaint._values["line-gradient"].value.expression;this.gradient=Wa(t,"lineProgress"),this.gradientTexture=null;},e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["line-floorwidth"]=bs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e);},e.prototype.createBucket=function(t){return new ms(t)},e.prototype.queryRadius=function(t){var e=t,r=ws(Oa("line-width",this,e),Oa("line-gap-width",this,e)),i=Oa("line-offset",this,e);return r/2+Math.abs(i)+Da(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,a,o){var s=qa(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,o),u=o/2*ws(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),p=this.paint.get("line-offset").evaluate(e,r);return p&&(i=function(t,e){for(var r=[],i=new l(0,0),n=0;n<t.length;n++){for(var a=t[n],o=[],s=0;s<a.length;s++){var u=a[s-1],p=a[s],h=a[s+1],c=0===s?i:p.sub(u)._unit()._perp(),y=s===a.length-1?i:h.sub(p)._unit()._perp(),f=c._add(y)._unit(),d=f.x*y.x+f.y*y.y;f._mult(1/d),o.push(f._mult(e)._add(p));}r.push(o);}return r}(i,p*o)),Ma(s,i,u)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("line-opacity")&&"none"!==this.visibility},e}(dn);function ws(t,e){return e>0?e+2*t:t}var As=xn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_height",components:1,type:"Uint16"}]),ks=xn([{name:"a_projected_pos",components:3,type:"Float32"}],4),Ss=(xn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),xn([{name:"a_placed",components:2,type:"Uint8"}],4)),zs=(xn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),xn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Bs=xn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);xn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),xn([{type:"Float32",name:"offsetX"}]),xn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);function Ts(t,e,r){var i=e.layout.get("text-transform").evaluate(r,{});return"uppercase"===i?t=t.toLocaleUpperCase():"lowercase"===i&&(t=t.toLocaleLowerCase()),Qi.applyArabicShaping&&(t=Qi.applyArabicShaping(t)),t}function Ms(t){var e={},r={},i=[],n=0;function a(e){i.push(t[e]),n++;}function o(t,e,n){var a=r[t];return delete r[t],r[e]=a,i[a].geometry[0].pop(),i[a].geometry[0]=i[a].geometry[0].concat(n[0]),a}function s(t,r,n){var a=e[r];return delete e[r],e[t]=a,i[a].geometry[0].shift(),i[a].geometry[0]=n[0].concat(i[a].geometry[0]),a}function u(t,e,r){var i=r?e[0][e[0].length-1]:e[0][0];return t+":"+i.x+":"+i.y}for(var p=0;p<t.length;p++){var l=t[p],h=l.geometry,c=l.text;if(c){var y=u(c,h),f=u(c,h,!0);if(y in r&&f in e&&r[y]!==e[f]){var d=s(y,f,h),m=o(y,f,i[d].geometry);delete e[y],delete r[f],r[u(c,i[m].geometry,!0)]=m,i[d].geometry=null;}else y in r?o(y,f,h):f in e?s(y,f,h):(a(p),e[y]=n-1,r[f]=n-1);}else a(p);}return i.filter(function(t){return t.geometry})}var Es={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Vs=function(t){function e(e,r,i,n){t.call(this,e,r),this.angle=i,void 0!==n&&(this.segment=n);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(l);function Is(t,e){var r=e.expression;if("constant"===r.kind)return{functionType:"constant",layoutSize:r.evaluate(new tn(t+1))};if("source"===r.kind)return{functionType:"source"};for(var i=r.zoomStops,n=0;n<i.length&&i[n]<=t;)n++;for(var a=n=Math.max(0,n-1);a<i.length&&i[a]<t+1;)a++;a=Math.min(i.length-1,a);var o={min:i[n],max:i[a]};return"composite"===r.kind?{functionType:"composite",zoomRange:o,propertyValue:e.value}:{functionType:"camera",layoutSize:r.evaluate(new tn(t+1)),zoomRange:o,sizeRange:{min:r.evaluate(new tn(o.min)),max:r.evaluate(new tn(o.max))},propertyValue:e.value}}Fi("Anchor",Vs);var Cs=ss.VectorTileFeature.types,Rs=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ls(t,e,r,i,n,a,o,s,u){t.emplaceBack(e,r,Math.round(32*i),Math.round(32*n),a,o,s?s[0]:0,s?s[1]:0,u);}function Ps(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r);}var Fs=function(t){this.layoutVertexArray=new On,this.indexArray=new Jn,this.programConfigurations=t,this.segments=new ha,this.dynamicLayoutVertexArray=new Ln,this.opacityVertexArray=new Dn,this.placedSymbolArray=new ia;};Fs.prototype.upload=function(t,e,r,i){r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,As.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ks.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Rs,!0),this.opacityVertexBuffer.itemSize=1),(r||i)&&this.programConfigurations.upload(t);},Fs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy());},Fi("SymbolBuffers",Fs);var Os=function(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new ha,this.collisionVertexArray=new Nn;};Os.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ss.members,!0);},Os.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy());},Fi("CollisionBuffers",Os);var Ds=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Is(this.zoom,e["text-size"]),this.iconSizeData=Is(this.zoom,e["icon-size"]);var r=this.layers[0].layout;this.sortFeaturesByY=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sourceID=t.sourceID;};function qs(t,e){return e.replace(/{([^{}]+)}/g,function(e,r){return r in t?String(t[r]):""})}Ds.prototype.createArrays=function(){this.text=new Fs(new va(As.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Fs(new va(As.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.collisionBox=new Os(Un,zs.members,Kn),this.collisionCircle=new Os(Un,Bs.members,Jn),this.glyphOffsetArray=new aa,this.lineVertexArray=new sa;},Ds.prototype.populate=function(t,e){var r=this.layers[0],i=r.layout,n=i.get("text-font"),a=i.get("text-field"),o=i.get("icon-image"),s=("constant"!==a.value.kind||a.value.value.length>0)&&("constant"!==n.value.kind||n.value.value.length>0),u="constant"!==o.value.kind||o.value.value&&o.value.value.length>0;if(this.features=[],s||u){for(var p=e.iconDependencies,l=e.glyphDependencies,h=new tn(this.zoom),c=0,y=t;c<y.length;c+=1){var f=y[c],d=f.feature,m=f.index,g=f.sourceLayerIndex;if(r._featureFilter(h,d)){var v=void 0;s&&(v=Ts(v=r.getValueAndResolveTokens("text-field",d),r,d));var x=void 0;if(u&&(x=r.getValueAndResolveTokens("icon-image",d)),v||x){var b={text:v,icon:x,index:m,sourceLayerIndex:g,geometry:Aa(d),properties:d.properties,type:Cs[d.type]};if(void 0!==d.id&&(b.id=d.id),this.features.push(b),x&&(p[x]=!0),v)for(var _=n.evaluate(d,{}).join(","),w=l[_]=l[_]||{},A="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement"),k=ji(v),S=0;S<v.length;S++)if(w[v.charCodeAt(S)]=!0,A&&k){var z=Es[v.charAt(S)];z&&(w[z.charCodeAt(0)]=!0);}}}}"line"===i.get("symbol-placement")&&(this.features=Ms(this.features));}},Ds.prototype.update=function(t,e){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers));},Ds.prototype.isEmpty=function(){return 0===this.symbolInstances.length},Ds.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Ds.prototype.upload=function(t){this.uploaded||(this.collisionBox.upload(t),this.collisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0;},Ds.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy();},Ds.prototype.addToLineVertexArray=function(t,e){var r=this.lineVertexArray.length;if(void 0!==t.segment){for(var i=t.dist(e[t.segment+1]),n=t.dist(e[t.segment]),a={},o=t.segment+1;o<e.length;o++)a[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:i},o<e.length-1&&(i+=e[o+1].dist(e[o]));for(var s=t.segment||0;s>=0;s--)a[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:n},s>0&&(n+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var p=a[u];this.lineVertexArray.emplaceBack(p.x,p.y,p.tileUnitDistanceFromAnchor);}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},Ds.prototype.addSymbols=function(t,e,r,i,n,a,o,s,u,p){for(var l=t.indexArray,h=t.layoutVertexArray,c=t.dynamicLayoutVertexArray,y=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray),f=this.glyphOffsetArray.length,d=y.vertexLength,m=0,g=e;m<g.length;m+=1){var v=g[m],x=v.tl,b=v.tr,_=v.bl,w=v.br,A=v.tex,k=y.vertexLength,S=v.glyphOffset[1],z=null!==a.properties&&void 0!==a.properties&&a.properties.hasOwnProperty("levels")?a.properties.levels:0;Ls(h,s.x,s.y,x.x,S+x.y,A.x,A.y,r,z),Ls(h,s.x,s.y,b.x,S+b.y,A.x+A.w,A.y,r,z),Ls(h,s.x,s.y,_.x,S+_.y,A.x,A.y+A.h,r,z),Ls(h,s.x,s.y,w.x,S+w.y,A.x+A.w,A.y+A.h,r,z),Ps(c,s,0),l.emplaceBack(k,k+1,k+2),l.emplaceBack(k+1,k+2,k+3),y.vertexLength+=4,y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(v.glyphOffset[0]);}t.placedSymbolArray.emplaceBack(s.x,s.y,f,this.glyphOffsetArray.length-f,d,u,p,s.segment,r?r[0]:0,r?r[1]:0,i[0],i[1],o,!1),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,a,a.index);},Ds.prototype._addCollisionDebugVertex=function(t,e,r,i,n){return e.emplaceBack(0,0),t.emplaceBack(r.x,r.y,i.x,i.y,Math.round(n.x),Math.round(n.y))},Ds.prototype.addCollisionDebugVertices=function(t,e,r,i,n,a,o,s){var u=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),p=u.vertexLength,h=n.layoutVertexArray,c=n.collisionVertexArray;if(this._addCollisionDebugVertex(h,c,a,o.anchor,new l(t,e)),this._addCollisionDebugVertex(h,c,a,o.anchor,new l(r,e)),this._addCollisionDebugVertex(h,c,a,o.anchor,new l(r,i)),this._addCollisionDebugVertex(h,c,a,o.anchor,new l(t,i)),u.vertexLength+=4,s){var y=n.indexArray;y.emplaceBack(p,p+1,p+2),y.emplaceBack(p,p+2,p+3),u.primitiveLength+=2;}else{var f=n.indexArray;f.emplaceBack(p,p+1),f.emplaceBack(p+1,p+2),f.emplaceBack(p+2,p+3),f.emplaceBack(p+3,p),u.primitiveLength+=4;}},Ds.prototype.generateCollisionDebugBuffers=function(){for(var t=0,e=this.symbolInstances;t<e.length;t+=1){var r=e[t];r.textCollisionFeature={boxStartIndex:r.textBoxStartIndex,boxEndIndex:r.textBoxEndIndex},r.iconCollisionFeature={boxStartIndex:r.iconBoxStartIndex,boxEndIndex:r.iconBoxEndIndex};for(var i=0;i<2;i++){var n=r[0===i?"textCollisionFeature":"iconCollisionFeature"];if(n)for(var a=n.boxStartIndex;a<n.boxEndIndex;a++){var o=this.collisionBoxArray.get(a),s=o.x1,u=o.y1,p=o.x2,l=o.y2,h=o.radius>0;this.addCollisionDebugVertices(s,u,p,l,h?this.collisionCircle:this.collisionBox,o.anchorPoint,r,h);}}}},Ds.prototype.deserializeCollisionBoxes=function(t,e,r,i,n){for(var a={},o=e;o<r;o++){var s=t.get(o);if(0===s.radius){a.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY},a.textFeatureIndex=s.featureIndex;break}a.textCircles||(a.textCircles=[],a.textFeatureIndex=s.featureIndex);a.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1);}for(var u=i;u<n;u++){var p=t.get(u);if(0===p.radius){a.iconBox={x1:p.x1,y1:p.y1,x2:p.x2,y2:p.y2,anchorPointX:p.anchorPointX,anchorPointY:p.anchorPointY},a.iconFeatureIndex=p.featureIndex;break}}return a},Ds.prototype.hasTextData=function(){return this.text.segments.get().length>0},Ds.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Ds.prototype.hasCollisionBoxData=function(){return this.collisionBox.segments.get().length>0},Ds.prototype.hasCollisionCircleData=function(){return this.collisionCircle.segments.get().length>0},Ds.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&(this.sortedAngle=t,!(this.text.segments.get().length>1||this.icon.segments.get().length>1))){for(var r=[],i=0;i<this.symbolInstances.length;i++)r.push(i);var n=Math.sin(t),a=Math.cos(t);r.sort(function(t,r){var i=e.symbolInstances[t],o=e.symbolInstances[r];return(0|Math.round(n*i.anchor.x+a*i.anchor.y))-(0|Math.round(n*o.anchor.x+a*o.anchor.y))||o.featureIndex-i.featureIndex}),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var o=0,s=r;o<s.length;o+=1){var u=s[o],p=e.symbolInstances[u];e.featureSortOrder.push(p.featureIndex);for(var l=0,h=p.placedTextSymbolIndices;l<h.length;l+=1)for(var c=h[l],y=e.text.placedSymbolArray.get(c),f=y.vertexStartIndex+4*y.numGlyphs,d=y.vertexStartIndex;d<f;d+=4)e.text.indexArray.emplaceBack(d,d+1,d+2),e.text.indexArray.emplaceBack(d+1,d+2,d+3);var m=e.icon.placedSymbolArray.get(u);if(m.numGlyphs){var g=m.vertexStartIndex;e.icon.indexArray.emplaceBack(g,g+1,g+2),e.icon.indexArray.emplaceBack(g+1,g+2,g+3);}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray);}},Fi("SymbolBucket",Ds,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances"]}),Ds.MAX_GLYPHS=65535,Ds.addDynamicAttributes=Ps;var Us=new fn({"symbol-placement":new ln(Jt.layout_symbol["symbol-placement"]),"symbol-spacing":new ln(Jt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ln(Jt.layout_symbol["symbol-avoid-edges"]),"icon-allow-overlap":new ln(Jt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ln(Jt.layout_symbol["icon-ignore-placement"]),"icon-optional":new ln(Jt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ln(Jt.layout_symbol["icon-rotation-alignment"]),"icon-size":new hn(Jt.layout_symbol["icon-size"]),"icon-text-fit":new ln(Jt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ln(Jt.layout_symbol["icon-text-fit-padding"]),"icon-image":new hn(Jt.layout_symbol["icon-image"]),"icon-rotate":new hn(Jt.layout_symbol["icon-rotate"]),"icon-padding":new ln(Jt.layout_symbol["icon-padding"]),"icon-keep-upright":new ln(Jt.layout_symbol["icon-keep-upright"]),"icon-offset":new hn(Jt.layout_symbol["icon-offset"]),"icon-anchor":new hn(Jt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ln(Jt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ln(Jt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ln(Jt.layout_symbol["text-rotation-alignment"]),"text-field":new hn(Jt.layout_symbol["text-field"]),"text-font":new hn(Jt.layout_symbol["text-font"]),"text-size":new hn(Jt.layout_symbol["text-size"]),"text-max-width":new hn(Jt.layout_symbol["text-max-width"]),"text-line-height":new ln(Jt.layout_symbol["text-line-height"]),"text-letter-spacing":new hn(Jt.layout_symbol["text-letter-spacing"]),"text-justify":new hn(Jt.layout_symbol["text-justify"]),"text-anchor":new hn(Jt.layout_symbol["text-anchor"]),"text-max-angle":new ln(Jt.layout_symbol["text-max-angle"]),"text-rotate":new hn(Jt.layout_symbol["text-rotate"]),"text-padding":new ln(Jt.layout_symbol["text-padding"]),"text-keep-upright":new ln(Jt.layout_symbol["text-keep-upright"]),"text-transform":new hn(Jt.layout_symbol["text-transform"]),"text-offset":new hn(Jt.layout_symbol["text-offset"]),"text-allow-overlap":new ln(Jt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ln(Jt.layout_symbol["text-ignore-placement"]),"text-optional":new ln(Jt.layout_symbol["text-optional"])}),Ns={paint:new fn({"icon-opacity":new hn(Jt.paint_symbol["icon-opacity"]),"icon-color":new hn(Jt.paint_symbol["icon-color"]),"icon-halo-color":new hn(Jt.paint_symbol["icon-halo-color"]),"icon-halo-width":new hn(Jt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new hn(Jt.paint_symbol["icon-halo-blur"]),"icon-translate":new ln(Jt.paint_symbol["icon-translate"]),"icon-translate-anchor":new ln(Jt.paint_symbol["icon-translate-anchor"]),"text-opacity":new hn(Jt.paint_symbol["text-opacity"]),"text-color":new hn(Jt.paint_symbol["text-color"]),"text-halo-color":new hn(Jt.paint_symbol["text-halo-color"]),"text-halo-width":new hn(Jt.paint_symbol["text-halo-width"]),"text-halo-blur":new hn(Jt.paint_symbol["text-halo-blur"]),"text-translate":new ln(Jt.paint_symbol["text-translate"]),"text-translate-anchor":new ln(Jt.paint_symbol["text-translate-anchor"]),"render-3d":new ln(Jt.paint_symbol["render-3d"]),"render-road-mark":new ln(Jt.paint_symbol["render-road-mark"]),"symbol-height-offset":new ln(Jt.paint_symbol["symbol-height-offset"])}),layout:Us},js=function(t){function e(e){t.call(this,e,Ns);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),"auto"===this.layout.get("icon-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));},e.prototype.getValueAndResolveTokens=function(t,e){var r=this.layout.get(t).evaluate(e,{}),i=this._unevaluatedLayout._values[t];return i.isDataDriven()||jr(i.value)?r:qs(e.properties,r)},e.prototype.createBucket=function(t){return new Ds(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("icon-opacity")&&0!==this.paint.get("text-opacity")&&"none"!==this.visibility},e}(dn),Gs={paint:new fn({"background-color":new ln(Jt.paint_background["background-color"]),"background-pattern":new cn(Jt.paint_background["background-pattern"]),"background-opacity":new ln(Jt.paint_background["background-opacity"])})},Xs=function(t){function e(e){t.call(this,e,Gs);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(dn),Ys={paint:new fn({"background-color":new ln(Jt["paint_sphere-background"]["background-color"]),"background-pattern":new cn(Jt["paint_sphere-background"]["background-pattern"]),"background-opacity":new ln(Jt["paint_sphere-background"]["background-opacity"])})},Hs=function(t){function e(e){t.call(this,e,Ys);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(dn),Zs={paint:new fn({"raster-opacity":new ln(Jt.paint_raster["raster-opacity"]),"raster-hue-rotate":new ln(Jt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ln(Jt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ln(Jt.paint_raster["raster-brightness-max"]),"raster-saturation":new ln(Jt.paint_raster["raster-saturation"]),"raster-contrast":new ln(Jt.paint_raster["raster-contrast"]),"raster-resampling":new ln(Jt.paint_raster["raster-resampling"]),"raster-fade-duration":new ln(Jt.paint_raster["raster-fade-duration"])})},$s=function(t){function e(e){t.call(this,e,Zs);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(dn),Js=xn([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"}],4).members,Ks=ss.VectorTileFeature.types,Ws=63,Qs=Math.cos(Math.PI/180*37.5),tu=.5,eu=Math.pow(2,14)/tu;function ru(t,e,r,i,n,a,o,s){t.emplaceBack(e.x,e.y,i?1:0,n?1:-1,Math.round(Ws*r.x)+128,Math.round(Ws*r.y)+128,1+(0===a?0:a<0?-1:1)|(o*tu&63)<<2,o*tu>>6,s);}var iu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Tn,this.indexArray=new Jn,this.programConfigurations=new va(Js,t.layers,t.zoom),this.segments=new ha;};iu.prototype.populate=function(t,e){for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new tn(this.zoom),a)){var u=Aa(a);this.addFeature(a,u,o),e.featureIndex.insert(a,u,o,s,this.index);}}},iu.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},iu.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},iu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},iu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Js),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},iu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},iu.prototype.addFeature=function(t,e,r){for(var i=this.layers[0].layout,n=i.get("tracking-join").evaluate(t,{}),a=i.get("tracking-cap"),o=i.get("tracking-miter-limit"),s=i.get("tracking-round-limit"),u=Number(t.properties.link_seq),p=0,l=e;p<l.length;p+=1){var h=l[p];this.addLine(h,t,n,a,o,s,r,u);}},iu.prototype.addLine=function(t,e,r,i,n,a,o,s){for(var u="Polygon"===Ks[e.type],p=t.length;p>=2&&t[p-1].equals(t[p-2]);)p--;for(var l=0;l<p-1&&t[l].equals(t[l+1]);)l++;if(!(p<(u?3:2))){"bevel"===r&&(n=1.05);var h=ba/(512*this.overscaling)*15,c=t[l],y=this.segments.prepareSegment(10*p,this.layoutVertexArray,this.indexArray);this.distance=0;var f,d,m,g=i,v=u?"butt":i,x=!0,b=void 0,_=void 0,w=void 0,A=void 0;this.e1=this.e2=this.e3=-1,u&&(f=t[p-2],A=c.sub(f)._unit()._perp());for(var k=l;k<p;k++)if(s+=1,!(_=u&&k===p-1?t[l+1]:t[k+1])||!t[k].equals(_)){A&&(w=A),f&&(b=f),f=t[k],A=_?_.sub(f)._unit()._perp():w;var S=(w=w||A).add(A);0===S.x&&0===S.y||S._unit();var z=S.x*A.x+S.y*A.y,B=0!==z?1/z:1/0,T=z<Qs&&b&&_;if(T&&k>l){var M=f.dist(b);if(M>2*h){var E=f.sub(f.sub(b)._mult(h/M)._round());this.distance+=E.dist(b),this.addCurrentVertex(E,this.distance,w.mult(1),0,0,!1,y,s),b=E;}}var V=b&&_,I=V?r:_?g:v;if(V&&"round"===I&&(B<a?I="miter":B<=2&&(I="fakeround")),"miter"===I&&B>n&&(I="bevel"),"bevel"===I&&(B>2&&(I="flipbevel"),B<n&&(I="miter")),b&&(this.distance+=f.dist(b)),"miter"===I)S._mult(B),this.addCurrentVertex(f,this.distance,S,0,0,!1,y,s);else if("flipbevel"===I){if(B>100)S=A.clone().mult(-1);else{var C=w.x*A.y-w.y*A.x>0?-1:1,R=B*w.add(A).mag()/w.sub(A).mag();S._perp()._mult(R*C);}this.addCurrentVertex(f,this.distance,S,0,0,!1,y,s),this.addCurrentVertex(f,this.distance,S.mult(-1),0,0,!1,y,s);}else if("bevel"===I||"fakeround"===I){var L=w.x*A.y-w.y*A.x>0,P=-Math.sqrt(B*B-1);if(L?(m=0,d=P):(d=0,m=P),x||this.addCurrentVertex(f,this.distance,w,d,m,!1,y,s),"fakeround"===I){for(var F=Math.floor(8*(.5-(z-.5))),O=void 0,D=0;D<F;D++)O=A.mult((D+1)/(F+1))._add(w)._unit(),this.addPieSliceVertex(f,this.distance,O,L,y,s);this.addPieSliceVertex(f,this.distance,S,L,y,s);for(var q=F-1;q>=0;q--)O=w.mult((q+1)/(F+1))._add(A)._unit(),this.addPieSliceVertex(f,this.distance,O,L,y,s);}_&&this.addCurrentVertex(f,this.distance,A,-d,-m,!1,y,s);}else"butt"===I?(x||this.addCurrentVertex(f,this.distance,w,0,0,!1,y,s),_&&this.addCurrentVertex(f,this.distance,A,0,0,!1,y,s)):"square"===I?(x||(this.addCurrentVertex(f,this.distance,w,1,1,!1,y,s),this.e1=this.e2=-1),_&&this.addCurrentVertex(f,this.distance,A,-1,-1,!1,y,s)):"round"===I&&(x||(this.addCurrentVertex(f,this.distance,w,0,0,!1,y,s),this.addCurrentVertex(f,this.distance,w,1,1,!0,y,s),this.e1=this.e2=-1),_&&(this.addCurrentVertex(f,this.distance,A,-1,-1,!0,y,s),this.addCurrentVertex(f,this.distance,A,0,0,!1,y,s)));if(T&&k<p-1){var U=f.dist(_);if(U>2*h){var N=f.add(_.sub(f)._mult(h/U)._round());this.distance+=N.dist(f),this.addCurrentVertex(N,this.distance,A.mult(1),0,0,!1,y,s),f=N;}}x=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o);}},iu.prototype.addCurrentVertex=function(t,e,r,i,n,a,o,s){var u,p=this.layoutVertexArray,l=this.indexArray;u=r.clone(),i&&u._sub(r.perp()._mult(i)),ru(p,t,u,a,!1,i,e,s),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=r.mult(-1),n&&u._sub(r.perp()._mult(n)),ru(p,t,u,a,!0,-n,e,s),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>eu/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,r,i,n,a,o,s));},iu.prototype.addPieSliceVertex=function(t,e,r,i,n,a){r=r.mult(i?-1:1);var o=this.layoutVertexArray,s=this.indexArray;ru(o,t,r,!1,i,0,e,a),this.e3=n.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),n.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3;},Fi("TrackingBucket",iu,{omit:["layers"]});var nu=new fn({"tracking-cap":new ln(Jt.layout_tracking["tracking-cap"]),"tracking-join":new hn(Jt.layout_tracking["tracking-join"]),"tracking-miter-limit":new ln(Jt.layout_tracking["tracking-miter-limit"]),"tracking-round-limit":new ln(Jt.layout_tracking["tracking-round-limit"]),"tracking-display-mode":new ln(Jt.layout_tracking["tracking-display-mode"])}),au={paint:new fn({"tracking-opacity":new hn(Jt.paint_tracking["tracking-opacity"]),"tracking-color":new hn(Jt.paint_tracking["tracking-color"]),"tracking-translate":new ln(Jt.paint_tracking["tracking-translate"]),"tracking-translate-anchor":new ln(Jt.paint_tracking["tracking-translate-anchor"]),"tracking-width":new hn(Jt.paint_tracking["tracking-width"]),"tracking-gap-width":new hn(Jt.paint_tracking["tracking-gap-width"]),"tracking-offset":new hn(Jt.paint_tracking["tracking-offset"]),"tracking-blur":new hn(Jt.paint_tracking["tracking-blur"]),"tracking-type":new ln(Jt.paint_tracking["tracking-type"]),"tracking-seg-count":new ln(Jt.paint_tracking["tracking-seg-count"]),"tracking-seg-group":new ln(Jt.paint_tracking["tracking-seg-group"]),"tracking-speed":new ln(Jt.paint_tracking["tracking-speed"]),"tracking-delay":new ln(Jt.paint_tracking["tracking-delay"]),"tracking-speed-factor":new ln(Jt.paint_tracking["tracking-speed-factor"])}),layout:nu},ou=new(function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new tn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,i,n){return r=x({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,i,n)},e}(hn))(au.paint.properties["tracking-width"].specification);ou.useIntegerZoom=!0;var su=function(t){function e(e){t.call(this,e,au);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["tracking-floorwidth"]=ou.possiblyEvaluate(this._transitioningPaint._values["tracking-width"].value,e);},e.prototype.createBucket=function(t){return new iu(t)},e.prototype.queryRadius=function(t){var e=t,r=uu(Oa("tracking-width",this,e),Oa("tracking-gap-width",this,e)),i=Oa("tracking-offset",this,e);return r/2+Math.abs(i)+Da(this.paint.get("tracking-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,a,o){var s=qa(t,this.paint.get("tracking-translate"),this.paint.get("tracking-translate-anchor"),a.angle,o),u=o/2*uu(this.paint.get("tracking-width").evaluate(e,r),this.paint.get("tracking-gap-width").evaluate(e,r)),p=this.paint.get("tracking-offset").evaluate(e,r);return p&&(i=function(t,e){for(var r=[],i=new l(0,0),n=0;n<t.length;n++){for(var a=t[n],o=[],s=0;s<a.length;s++){var u=a[s-1],p=a[s],h=a[s+1],c=0===s?i:p.sub(u)._unit()._perp(),y=s===a.length-1?i:h.sub(p)._unit()._perp(),f=c._add(y)._unit(),d=f.x*y.x+f.y*y.y;f._mult(1/d),o.push(f._mult(e)._add(p));}r.push(o);}return r}(i,p*o)),Ma(s,i,u)},e}(dn);function uu(t,e){return e>0?e+2*t:t}var pu={paint:new fn({"sphere-raster-opacity":new ln(Jt["paint_sphere-raster"]["sphere-raster-opacity"]),"sphere-raster-hue-rotate":new ln(Jt["paint_sphere-raster"]["sphere-raster-hue-rotate"]),"sphere-raster-brightness-min":new ln(Jt["paint_sphere-raster"]["sphere-raster-brightness-min"]),"sphere-raster-brightness-max":new ln(Jt["paint_sphere-raster"]["sphere-raster-brightness-max"]),"sphere-raster-saturation":new ln(Jt["paint_sphere-raster"]["sphere-raster-saturation"]),"sphere-raster-contrast":new ln(Jt["paint_sphere-raster"]["sphere-raster-contrast"]),"sphere-raster-resampling":new ln(Jt["paint_sphere-raster"]["sphere-raster-resampling"]),"sphere-raster-fade-duration":new ln(Jt["paint_sphere-raster"]["sphere-raster-fade-duration"])})},lu=function(t){function e(e){t.call(this,e,pu);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(dn),hu=xn([{name:"a_pos",components:3,type:"Float32"}],4).members;function cu(t,e,r,i,n,a,o,s,u,p){var l=[];yu(l,e.tileNumberToLngLat([n,a],o,o*Math.pow(2,s)).toArray(),u),p.emplaceBack(l[0],l[1],l[2],n/r,a/i);}function yu(t,e,r){var i=e[0]*Pt.TRANSFORM.DEG_TO_RAD,n=e[1]*Pt.TRANSFORM.DEG_TO_RAD,a=r*Math.cos(n);return t[0]=a*Math.cos(i),t[1]=r*Math.sin(n),t[2]=a*Math.sin(i),t}function fu(t,e){var r=e[0],i=e[2],n=e[1],a=Math.sqrt(r*r+i*i+n*n);return t[0]=Math.atan2(i,r)*Pt.TRANSFORM.RAD_TO_DEG,t[1]=Math.asin(n/a)*Pt.TRANSFORM.RAD_TO_DEG,t[2]=a,t}function du(t,e,r,i,n,a,o){var s=Math.pow(2,a),u=i+t/8192,p=n+e/8192,l=ts(o),h=[];return yu(h,[l.xLng(u,s),l.yLat(p,s)],Pt.TRANSFORM.R+Pt.TRANSFORM.R_SCALE*r),h}function mu(t,e,r,i){var n=r,a=t,o=e,s=ts(i);return[s.xLng(a,n),s.yLat(o,n)]}function gu(t,e,r,i){var n=[];return yu(n,mu(t,e,Math.pow(2,r),i),Pt.TRANSFORM.R),{out1:n,matrix:q([],[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n)}}function vu(t,e,r){var i=e.translation||[0,0,0],n=[];return yu(n,e.location,Pt.TRANSFORM.R),q(r,r,n),j(r,r,(90-e.location[0])*Pt.TRANSFORM.DEG_TO_RAD),N(r,r,((t?0:90)-e.location[1])*Pt.TRANSFORM.DEG_TO_RAD),G(r,r,180*Pt.TRANSFORM.DEG_TO_RAD),U(r,r,[Pt.TRANSFORM.R_SCALE,-Pt.TRANSFORM.R_SCALE,Pt.TRANSFORM.R_SCALE]),q(r,r,t?[i[0],i[2],i[1]]:i)}function xu(t,e,r){var i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return q(i,i,e),r&&U(i,i,[1.1,1.1,1.1]),i}function bu(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function _u(t){return t.slice()}function wu(t,e,r,i,n,a){if(n>=e&&a<=r)return t;if(n>r||a<e)return null;for(var o=[],s=0;s<t.length;s++){var u=t[s],p=u.geometry,l=u.type,h=u.min[i],c=u.max[i];if(h>=e&&c<=r)o.push(u);else if(!(h>r||c<e)){var y="Point"===l?Au(p,e,r,i):ku(p,e,r,i,0===i?Tu:Mu,"Polygon"===l);y.length&&o.push(zu(u.tags,l,y,u.id));}}return o.length?o:null}function Au(t,e,r,i){for(var n=[],a=0;a<t.length;a++){var o=t[a],s=o[i];s>=e&&s<=r&&n.push(o);}return n}function ku(t,e,r,i,n,a){for(var o=[],s=0;s<t.length;s++){var u,p,l,h=0,c=0,y=null,f=t[s],d=f.area,m=f.dist,g=f.outer,v=f.length,x=[];for(p=0;p<v-1;p++)u=y||f[p],y=f[p+1],h=c||u[i],c=y[i],h<e?c>r?(x.push(n(u,y,e),n(u,y,r)),a||(x=Su(o,x,d,m,g))):c>=e&&x.push(n(u,y,e)):h>r?c<e?(x.push(n(u,y,r),n(u,y,e)),a||(x=Su(o,x,d,m,g))):c<=r&&x.push(n(u,y,r)):(x.push(u),c<e?(x.push(n(u,y,e)),a||(x=Su(o,x,d,m,g))):c>r&&(x.push(n(u,y,r)),a||(x=Su(o,x,d,m,g))));(h=(u=f[v-1])[i])>=e&&h<=r&&x.push(u),l=x[x.length-1],a&&l&&(x[0][0]!==l[0]||x[0][1]!==l[1])&&x.push(x[0]),Su(o,x,d,m,g);}return o}function Su(t,e,r,i,n){return e.length&&(e.area=r,e.dist=i,void 0!==n&&(e.outer=n),t.push(e)),[]}function zu(t,e,r,i){var n={id:i||null,type:e,geometry:r,tags:t||null,min:[1/0,1/0],max:[-1/0,-1/0]};return function(t){var e=t.geometry,r=t.min,i=t.max;if(1===t.type)Bu(r,i,e);else for(var n=0;n<e.length;n++)Bu(r,i,e[n]);}(n),n}function Bu(t,e,r){for(var i=0,n=void 0;i<r.length;i++)n=r[i],t[0]=Math.min(n[0],t[0]),e[0]=Math.max(n[0],e[0]),t[1]=Math.min(n[1],t[1]),e[1]=Math.max(n[1],e[1]);}function Tu(t,e,r){return[r,(r-t[0])*(e[1]-t[1])/(e[0]-t[0])+t[1]]}function Mu(t,e,r){return[(r-t[1])*(e[0]-t[0])/(e[1]-t[1])+t[0],r]}function Eu(t,e,r,i,n,a,o){if(!(t>1))return o.push.apply(o,a);var s=wu(a,e,e+(r-e)/2,0,0,8192),u=wu(a,e+(r-e)/2,r,0,0,8192);if(s){var p=wu(s,i,i+(n-i)/2,1,0,8192),l=wu(s,i+(n-i)/2,n,1,0,8192);p&&Eu(t-1,e,e+(r-e)/2,i,i+(n-i)/2,p,o),l&&Eu(t-1,e,e+(r-e)/2,i+(n-i)/2,n,l,o);}if(u){var h=wu(u,i,i+(n-i)/2,1,0,8192),c=wu(u,i+(n-i)/2,n,1,0,8192);h&&Eu(t-1,e+(r-e)/2,r,i,i+(n-i)/2,h,o),c&&Eu(t-1,e+(r-e)/2,r,i+(n-i)/2,n,c,o);}}var Vu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Ln,this.indexArray=new Jn,this.indexArray2=new Kn,this.programConfigurations=new va(hu,t.layers,t.zoom),this.segments=new ha,this.segments2=new ha,this.projection=t.projection||Ko.MERCATOR;};Vu.prototype._getSampleNumber=function(t){var e=8;return(e-=t)<=1?2:e},Vu.prototype._convertGeometryPointToPolygon=function(t){for(var e=[],r=1/0,i=1/0,n=-1/0,a=-1/0,o=0;o<t[0].length;o++){var s=t[0][o].x,u=t[0][o].y;e.push([s,u]),r>s&&(r=s),n<s&&(n=s),i>u&&(i=u),a<u&&(a=u);}return[{type:"Polygon",geometry:[e],min:[r,i],max:[n,a]}]},Vu.prototype._convertPolygonToGeometry=function(t){for(var e=[],r=0;r<t.length;r++){var i=t[r].geometry.map(function(t){return t.map(function(t){return new l(t[0],t[1])})});e.push.apply(e,i);}return e},Vu.prototype.populate=function(t,e){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.tilePlane=gu(this.x,this.y,this.z,this.projection));for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new tn(this.zoom),a)){var u=Aa(a),p=this._getSampleNumber(this.z);if(p>1){var l=[];Eu(p,0,8192,0,8192,this._convertGeometryPointToPolygon(u),l);var h=this._convertPolygonToGeometry(l);this.addFeature(a,h,o);}else this.addFeature(a,u,o);e.featureIndex.insert(a,u,o,s,this.index);}}},Vu.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},Vu.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Vu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Vu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,hu),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0;},Vu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy());},Vu.prototype.calcTDSpacePoint=function(t,e){var r=yu([],mu(this.x+t/8192,this.y+e/8192,this.zPow,this.projection),Pt.TRANSFORM.R);return new l(r[0]-this.tilePlane.out1[0],r[1]-this.tilePlane.out1[1],r[2]-this.tilePlane.out1[2])},Vu.prototype.addFeature=function(t,e,r){for(var i=0,n=Co(e,500);i<n.length;i+=1){for(var a=n[i],o=0,s=0,u=a;s<u.length;s+=1){o+=u[s].length;}for(var p=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray),l=p.vertexLength,h=[],c=[],y=0,f=a;y<f.length;y+=1){var d=f[y];if(0!==d.length){d!==a[0]&&c.push(h.length/2);var m=this.segments2.prepareSegment(d.length,this.layoutVertexArray,this.indexArray2),g=m.vertexLength,v=d[0].x>8192||d[0].x;v=d[0].x<0?0:d[0].x;var x=d[0].y>8192||d[0].y;x=d[0].y<0?0:d[0].y;var b=this.calcTDSpacePoint(v,x);this.layoutVertexArray.emplaceBack(b.x,b.y,b.z),this.indexArray2.emplaceBack(g+d.length-1,g),h.push(d[0].x),h.push(d[0].y);for(var _=1;_<d.length;_++){var w=d[_].x>8192||d[_].x;w=d[_].x<0?0:d[_].x;var A=d[_].y>8192||d[_].y;A=d[_].y<0?0:d[_].y;var k=this.calcTDSpacePoint(w,A);this.layoutVertexArray.emplaceBack(k.x,k.y,k.z),this.indexArray2.emplaceBack(g+_-1,g+_),h.push(d[_].x),h.push(d[_].y);}m.vertexLength+=d.length,m.primitiveLength+=d.length;}}for(var S=io(h,c),z=0;z<S.length;z+=3)this.indexArray.emplaceBack(l+S[z],l+S[z+1],l+S[z+2]);p.vertexLength+=o,p.primitiveLength+=S.length/3;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r);},Fi("SphereFillBucket",Vu,{omit:["layers"]});var Iu={paint:new fn({"fill-antialias":new ln(Jt["paint_sphere-fill"]["fill-antialias"]),"fill-opacity":new hn(Jt["paint_sphere-fill"]["fill-opacity"]),"fill-color":new hn(Jt["paint_sphere-fill"]["fill-color"]),"fill-outline-color":new hn(Jt["paint_sphere-fill"]["fill-outline-color"]),"fill-translate":new ln(Jt["paint_sphere-fill"]["fill-translate"]),"fill-translate-anchor":new ln(Jt["paint_sphere-fill"]["fill-translate-anchor"]),"fill-pattern":new cn(Jt["paint_sphere-fill"]["fill-pattern"])})},Cu=function(t){function e(e){t.call(this,e,Iu);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint=this._transitioningPaint.possiblyEvaluate(e);var r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"]);},e.prototype.createBucket=function(t){return new Vu(t)},e.prototype.queryRadius=function(){return Da(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,a,o){return Ta(qa(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,o),i)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("fill-opacity")&&"none"!==this.visibility},e}(dn),Ru=xn([{name:"a_pos",components:3,type:"Float32"},{name:"a_normal",components:2,type:"Int8"},{name:"a_data",components:4,type:"Uint8"}],4).members,Lu=ss.VectorTileFeature.types,Pu=63,Fu=Math.cos(Math.PI/180*37.5),Ou=.5,Du=Math.pow(2,14)/Ou;function qu(t,e,r,i,n,a,o){t.emplaceBack(e.x,e.y,e.z,i?1:0,n?1:-1,Math.round(Pu*r.x)+128,Math.round(Pu*r.y)+128,1+(0===a?0:a<0?-1:1)|(o*Ou&63)<<2,o*Ou>>6);}var Uu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Rn,this.indexArray=new Jn,this.programConfigurations=new va(Ru,t.layers,t.zoom),this.segments=new ha,this.projection=t.projection||Ko.MERCATOR;};function Nu(t,e){return(t/e.tileTotal*(e.end-e.start)+e.start)*(Du-1)}Uu.prototype._getSampleNumber=function(t){var e=8;return(e-=t)<=1?2:e},Uu.prototype._convertGeometryPointToLine=function(t){for(var e=[],r=0;r<t.length;r++){for(var i=[],n=1/0,a=1/0,o=-1/0,s=-1/0,u=0;u<t[r].length;u++){var p=t[r][u].x,l=t[r][u].y;i.push([p,l]),n>p&&(n=p),o<p&&(o=p),a>l&&(a=l),s<l&&(s=l);}var h={type:"LineString",geometry:[i],min:[n,a],max:[o,s]};e.push(h);}return e},Uu.prototype._convertLineToGeometry=function(t){for(var e=[],r=0;r<t.length;r++){var i=t[r].geometry.map(function(t){return t.map(function(t){return new l(t[0],t[1])})});e.push.apply(e,i);}return e},Uu.prototype.populate=function(t,e){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.tilePlane=gu(this.x,this.y,this.z,this.projection));for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new tn(this.zoom),a)){var u=Aa(a),p=[];Eu(this._getSampleNumber(this.z),0,8192,0,8192,this._convertGeometryPointToLine(u),p);var l=this._convertLineToGeometry(p);this.addFeature(a,l,o),e.featureIndex.insert(a,u,o,s,this.index);}}},Uu.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},Uu.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Uu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Uu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ru),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},Uu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},Uu.prototype.addFeature=function(t,e,r){for(var i=this.layers[0].layout,n=i.get("line-join").evaluate(t,{}),a=i.get("line-cap"),o=i.get("line-miter-limit"),s=i.get("line-round-limit"),u=0,p=e;u<p.length;u+=1){var l=p[u];this.addLine(l,t,n,a,o,s,r);}},Uu.prototype.addLine=function(t,e,r,i,n,a,o){var s=null;e.properties&&e.properties.hasOwnProperty("minemap_clip_start")&&e.properties.hasOwnProperty("minemap_clip_end")&&(s={start:e.properties.minemap_clip_start,end:e.properties.minemap_clip_end,tileTotal:void 0});for(var u="Polygon"===Lu[e.type],p=t.length;p>=2&&t[p-1].equals(t[p-2]);)p--;for(var l=0;l<p-1&&t[l].equals(t[l+1]);)l++;if(!(p<(u?3:2))){s&&(s.tileTotal=function(t,e,r){for(var i,n,a=0,o=e;o<r-1;o++)i=t[o],n=t[o+1],a+=i.dist(n);return a}(t,l,p)),"bevel"===r&&(n=1.05);var h=ba/(512*this.overscaling)*15,c=t[l],y=this.segments.prepareSegment(10*p,this.layoutVertexArray,this.indexArray);this.distance=0;var f,d,m,g=i,v=u?"butt":i,x=!0,b=void 0,_=void 0,w=void 0,A=void 0;this.e1=this.e2=this.e3=-1,u&&(f=t[p-2],A=c.sub(f)._unit()._perp());for(var k=l;k<p;k++)if(!(_=u&&k===p-1?t[l+1]:t[k+1])||!t[k].equals(_)){A&&(w=A),f&&(b=f),f=t[k],A=_?_.sub(f)._unit()._perp():w;var S=(w=w||A).add(A);0===S.x&&0===S.y||S._unit();var z=S.x*A.x+S.y*A.y,B=0!==z?1/z:1/0,T=z<Fu&&b&&_;if(T&&k>l){var M=f.dist(b);if(M>2*h){var E=f.sub(f.sub(b)._mult(h/M)._round());this.distance+=E.dist(b),this.addCurrentVertex(E,this.distance,w.mult(1),0,0,!1,y,s),b=E;}}var V=b&&_,I=V?r:_?g:v;if(V&&"round"===I&&(B<a?I="miter":B<=2&&(I="fakeround")),"miter"===I&&B>n&&(I="bevel"),"bevel"===I&&(B>2&&(I="flipbevel"),B<n&&(I="miter")),b&&(this.distance+=f.dist(b)),"miter"===I)S._mult(B),this.addCurrentVertex(f,this.distance,S,0,0,!1,y,s);else if("flipbevel"===I){if(B>100)S=A.clone().mult(-1);else{var C=w.x*A.y-w.y*A.x>0?-1:1,R=B*w.add(A).mag()/w.sub(A).mag();S._perp()._mult(R*C);}this.addCurrentVertex(f,this.distance,S,0,0,!1,y,s),this.addCurrentVertex(f,this.distance,S.mult(-1),0,0,!1,y,s);}else if("bevel"===I||"fakeround"===I){var L=w.x*A.y-w.y*A.x>0,P=-Math.sqrt(B*B-1);if(L?(m=0,d=P):(d=0,m=P),x||this.addCurrentVertex(f,this.distance,w,d,m,!1,y,s),"fakeround"===I){for(var F=Math.floor(8*(.5-(z-.5))),O=void 0,D=0;D<F;D++)O=A.mult((D+1)/(F+1))._add(w)._unit(),this.addPieSliceVertex(f,this.distance,O,L,y,s);this.addPieSliceVertex(f,this.distance,S,L,y,s);for(var q=F-1;q>=0;q--)O=w.mult((q+1)/(F+1))._add(A)._unit(),this.addPieSliceVertex(f,this.distance,O,L,y,s);}_&&this.addCurrentVertex(f,this.distance,A,-d,-m,!1,y,s);}else"butt"===I?(x||this.addCurrentVertex(f,this.distance,w,0,0,!1,y,s),_&&this.addCurrentVertex(f,this.distance,A,0,0,!1,y,s)):"square"===I?(x||(this.addCurrentVertex(f,this.distance,w,1,1,!1,y,s),this.e1=this.e2=-1),_&&this.addCurrentVertex(f,this.distance,A,-1,-1,!1,y,s)):"round"===I&&(x||(this.addCurrentVertex(f,this.distance,w,0,0,!1,y,s),this.addCurrentVertex(f,this.distance,w,1,1,!0,y,s),this.e1=this.e2=-1),_&&(this.addCurrentVertex(f,this.distance,A,-1,-1,!0,y,s),this.addCurrentVertex(f,this.distance,A,0,0,!1,y,s)));if(T&&k<p-1){var U=f.dist(_);if(U>2*h){var N=f.add(_.sub(f)._mult(h/U)._round());this.distance+=N.dist(f),this.addCurrentVertex(N,this.distance,A.mult(1),0,0,!1,y,s),f=N;}}x=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o);}},Uu.prototype.calcTDSpacePoint=function(t){var e=yu([],mu(this.x+t.x/8192,this.y+t.y/8192,this.zPow,this.projection),Pt.TRANSFORM.R);return new l(e[0]-this.tilePlane.out1[0],e[1]-this.tilePlane.out1[1],e[2]-this.tilePlane.out1[2])},Uu.prototype.addCurrentVertex=function(t,e,r,i,n,a,o,s){var u,p=this.layoutVertexArray,l=this.indexArray;s&&(e=Nu(e,s)),u=r.clone(),i&&u._sub(r.perp()._mult(i));var h=this.calcTDSpacePoint(t);qu(p,h,u,a,!1,i,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=r.mult(-1),n&&u._sub(r.perp()._mult(n)),qu(p,h,u,a,!0,-n,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>Du/2&&!s&&(this.distance=0,this.addCurrentVertex(t,this.distance,r,i,n,a,o));},Uu.prototype.addPieSliceVertex=function(t,e,r,i,n,a){r=r.mult(i?-1:1);var o=this.layoutVertexArray,s=this.indexArray;a&&(e=Nu(e,a)),qu(o,this.calcTDSpacePoint(t),r,!1,i,0,e),this.e3=n.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),n.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3;},Fi("SphereLineBucket",Uu,{omit:["layers"]});var ju=new fn({"line-cap":new ln(Jt["layout_sphere-line"]["line-cap"]),"line-join":new hn(Jt["layout_sphere-line"]["line-join"]),"line-miter-limit":new ln(Jt["layout_sphere-line"]["line-miter-limit"]),"line-round-limit":new ln(Jt["layout_sphere-line"]["line-round-limit"]),"border-visibility":new ln(Jt["layout_sphere-line"]["border-visibility"])}),Gu={paint:new fn({"line-opacity":new hn(Jt["paint_sphere-line"]["line-opacity"]),"line-color":new hn(Jt["paint_sphere-line"]["line-color"]),"line-translate":new ln(Jt["paint_sphere-line"]["line-translate"]),"line-translate-anchor":new ln(Jt["paint_sphere-line"]["line-translate-anchor"]),"line-width":new hn(Jt["paint_sphere-line"]["line-width"]),"line-border-width":new hn(Jt["paint_sphere-line"]["line-border-width"]),"line-border-opacity":new hn(Jt["paint_sphere-line"]["line-border-opacity"]),"line-border-color":new hn(Jt["paint_sphere-line"]["line-border-color"]),"line-gap-width":new hn(Jt["paint_sphere-line"]["line-gap-width"]),"line-offset":new hn(Jt["paint_sphere-line"]["line-offset"]),"line-blur":new hn(Jt["paint_sphere-line"]["line-blur"]),"line-dasharray":new cn(Jt["paint_sphere-line"]["line-dasharray"]),"line-pattern":new cn(Jt["paint_sphere-line"]["line-pattern"]),"line-gradient":new yn(Jt["paint_sphere-line"]["line-gradient"])}),layout:ju},Xu=new(function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new tn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,i,n){return r=x({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,i,n)},e}(hn))(Gu.paint.properties["line-width"].specification);Xu.useIntegerZoom=!0;var Yu=function(t){function e(e){t.call(this,e,Gu);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&this._updateGradient();},e.prototype._updateGradient=function(){var t=this._transitionablePaint._values["line-gradient"].value.expression;this.gradient=Wa(t,"lineProgress"),this.gradientTexture=null;},e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["line-floorwidth"]=Xu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e);},e.prototype.createBucket=function(t){return new Uu(t)},e.prototype.queryRadius=function(t){var e=t,r=Hu(Oa("line-width",this,e),Oa("line-gap-width",this,e)),i=Oa("line-offset",this,e);return r/2+Math.abs(i)+Da(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,a,o){var s=qa(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,o),u=o/2*Hu(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),p=this.paint.get("line-offset").evaluate(e,r);return p&&(i=function(t,e){for(var r=[],i=new l(0,0),n=0;n<t.length;n++){for(var a=t[n],o=[],s=0;s<a.length;s++){var u=a[s-1],p=a[s],h=a[s+1],c=0===s?i:p.sub(u)._unit()._perp(),y=s===a.length-1?i:h.sub(p)._unit()._perp(),f=c._add(y)._unit(),d=f.x*y.x+f.y*y.y;f._mult(1/d),o.push(f._mult(e)._add(p));}r.push(o);}return r}(i,p*o)),Ma(s,i,u)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("line-opacity")&&"none"!==this.visibility},e}(dn);function Hu(t,e){return e>0?e+2*t:t}var Zu=xn([{name:"a_pos",components:3,type:"Float32"},{name:"a_extra",components:2,type:"Int16"}],4).members;function $u(t,e,r,i,n,a){t.emplaceBack(e,r,i,n,a);}var Ju=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Fn,this.indexArray=new Jn,this.segments=new ha,this.programConfigurations=new va(Zu,t.layers,t.zoom),this.projection=t.projection||Ko.MERCATOR;};Ju.prototype.populate=function(t,e){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.tilePlane=gu(this.x,this.y,this.z,this.projection));for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new tn(this.zoom),a)){var u=Aa(a);this.addFeature(a,u,o),e.featureIndex.insert(a,u,o,s,this.index);}}this.x=e.x,this.y=e.y,this.z=e.z;},Ju.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},Ju.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ju.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ju.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zu),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},Ju.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},Ju.prototype.calcTDSpacePoint=function(t,e){var r=yu([],mu(this.x+t/8192,this.y+e/8192,this.zPow,this.projection),Pt.TRANSFORM.R);return[r[0]-this.tilePlane.out1[0],r[1]-this.tilePlane.out1[1],r[2]-this.tilePlane.out1[2]]},Ju.prototype.addFeature=function(t,e,r){for(var i=0,n=e;i<n.length;i+=1)for(var a=0,o=n[i];a<o.length;a+=1){var s=o[a],u=s.x,p=s.y;if(!(u<.2*-ba||u>=1.2*ba||p<.2*-ba||p>=1.2*ba)){var l=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=l.vertexLength,c=this.calcTDSpacePoint(u,p);$u.apply(void 0,[this.layoutVertexArray].concat(c,[-1],[-1])),$u.apply(void 0,[this.layoutVertexArray].concat(c,[1],[-1])),$u.apply(void 0,[this.layoutVertexArray].concat(c,[1],[1])),$u.apply(void 0,[this.layoutVertexArray].concat(c,[-1],[1])),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),l.vertexLength+=4,l.primitiveLength+=2;}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r);},Fi("SphereCircleBucket",Ju,{omit:["layers"]});var Ku=function(t){function e(e){t.call(this,e,Ua);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new Ju(t)},e.prototype.queryRadius=function(t){var e=t;return Oa("circle-radius",this,e)+Oa("circle-stroke-width",this,e)+Da(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,a,o,s){for(var u=qa(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,o),p=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),l="map"===this.paint.get("circle-pitch-alignment"),h=l?u:function(t,e){return t.map(function(t){return Wu(t,e)})}(u,s),c=l?p*o:p,y=0,f=i;y<f.length;y+=1)for(var d=0,m=f[y];d<m.length;d+=1){var g=m[d],v=l?g:Wu(g,s),x=c,b=ft([],[g.x,g.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?x*=b[3]/a.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(x*=a.cameraToCenterDistance/b[3]),Ba(h,v,x))return!0}return!1},e}(dn);function Wu(t,e){var r=ft([],[t.x,t.y,0,1],e);return new l(r[0]/r[3],r[1]/r[3])}var Qu=xn([{name:"a_pos",components:3,type:"Float32"},{name:"a_extrude",components:2,type:"Int8"}],4).members;function tp(t,e,r,i,n,a){t.emplaceBack(e,r,i,n,a);}var ep=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Vn,this.indexArray=new Jn,this.segments=new ha,this.programConfigurations=new va(Qu,t.layers,t.zoom),this.projection=t.projection||Ko.MERCATOR;};ep.prototype.populate=function(t,e){this.x=e.x,this.y=e.y,this.z=e.z;for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new tn(this.zoom),a)){var u=Aa(a);this.addFeature(a,u,o),e.featureIndex.insert(a,u,o,s,this.index);}}},ep.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},ep.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},ep.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ep.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Qu),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},ep.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},ep.prototype.addFeature=function(t,e,r){for(var i=0,n=e;i<n.length;i+=1)for(var a=0,o=n[i];a<o.length;a+=1){var s=o[a],u=s.x,p=s.y,l=du(s.x,s.y,0,this.x,this.y,this.z,this.projection);if(!(u<0||u>=ba||p<0||p>=ba)){var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),c=h.vertexLength;tp(this.layoutVertexArray,l[0],l[1],l[2],-1,-1),tp(this.layoutVertexArray,l[0],l[1],l[2],1,-1),tp(this.layoutVertexArray,l[0],l[1],l[2],1,1),tp(this.layoutVertexArray,l[0],l[1],l[2],-1,1),this.indexArray.emplaceBack(c,c+1,c+2),this.indexArray.emplaceBack(c,c+3,c+2),h.vertexLength+=4,h.primitiveLength+=2;}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r);},Fi("SphereHeatmapBucket",ep,{omit:["layers"]});var rp={paint:new fn({"heatmap-radius":new hn(Jt["paint_sphere-heatmap"]["heatmap-radius"]),"heatmap-weight":new hn(Jt["paint_sphere-heatmap"]["heatmap-weight"]),"heatmap-intensity":new ln(Jt["paint_sphere-heatmap"]["heatmap-intensity"]),"heatmap-color":new yn(Jt["paint_sphere-heatmap"]["heatmap-color"]),"heatmap-opacity":new ln(Jt["paint_sphere-heatmap"]["heatmap-opacity"])})},ip=function(t){function e(e){t.call(this,e,rp),this._updateColorRamp();}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new ep(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp();},e.prototype._updateColorRamp=function(){var t=this._transitionablePaint._values["heatmap-color"].value.expression;this.colorRamp=Wa(t,"heatmapDensity"),this.colorRampTexture=null;},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null);},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(dn),np=xn([{name:"a_pos",components:3,type:"Float32"},{name:"a_offset",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}]),ap=xn([{name:"a_projected_pos",components:3,type:"Float32"}],4),op=(xn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),xn([{name:"a_placed",components:2,type:"Uint8"}],4)),sp=(xn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),xn([{name:"a_pos",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),up=xn([{name:"a_pos",components:3,type:"Float32"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),pp=(xn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),xn([{type:"Float32",name:"offsetX"}]),xn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ss.VectorTileFeature.types),lp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hp(t,e,r,i,n,a,o){t.emplaceBack(e.x,e.y,e.z,Math.round(32*r),Math.round(32*i),n,a,o?o[0]:0,o?o[1]:0);}function cp(t,e,r,i){t.emplaceBack(e.x-i.x,e.y-i.y,r),t.emplaceBack(e.x-i.x,e.y-i.y,r),t.emplaceBack(e.x-i.x,e.y-i.y,r),t.emplaceBack(e.x-i.x,e.y-i.y,r);}var yp=function(t){this.layoutVertexArray=new Hn,this.indexArray=new Jn,this.programConfigurations=t,this.segments=new ha,this.dynamicLayoutVertexArray=new Ln,this.opacityVertexArray=new Dn,this.placedSymbolArray=new ia;};yp.prototype.upload=function(t,e,r,i){r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,np.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ap.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,lp,!0),this.opacityVertexBuffer.itemSize=1),(r||i)&&this.programConfigurations.upload(t);},yp.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy());},Fi("SphereSymbolBuffers",yp);var fp=function(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new ha,this.collisionVertexArray=new Nn;};fp.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,op.members,!0);},fp.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy());},Fi("SphereCollisionBuffers",fp);var dp=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Is(this.zoom,e["text-size"]),this.iconSizeData=Is(this.zoom,e["icon-size"]);var r=this.layers[0].layout;this.sortFeaturesByY=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sourceID=t.sourceID,this.projection=t.projection||Ko.MERCATOR;};dp.prototype.createArrays=function(){this.text=new yp(new va(np.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new yp(new va(np.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.collisionBox=new fp(Zn,sp.members,Kn),this.collisionCircle=new fp(Zn,up.members,Jn),this.glyphOffsetArray=new aa,this.lineVertexArray=new sa;},dp.prototype.populate=function(t,e){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.tilePlane=gu(this.x,this.y,this.z,this.projection));var r=this.layers[0],i=r.layout,n=i.get("text-font"),a=i.get("text-field"),o=i.get("icon-image"),s=("constant"!==a.value.kind||a.value.value.length>0)&&("constant"!==n.value.kind||n.value.value.length>0),u="constant"!==o.value.kind||o.value.value&&o.value.value.length>0;if(this.features=[],s||u){for(var p=e.iconDependencies,l=e.glyphDependencies,h=new tn(this.zoom),c=0,y=t;c<y.length;c+=1){var f=y[c],d=f.feature,m=f.index,g=f.sourceLayerIndex;if(r._featureFilter(h,d)){var v=void 0;s&&(v=Ts(v=r.getValueAndResolveTokens("text-field",d),r,d));var x=void 0;if(u&&(x=r.getValueAndResolveTokens("icon-image",d)),v||x){var b={text:v,icon:x,index:m,sourceLayerIndex:g,geometry:Aa(d),properties:d.properties,type:pp[d.type]};if(void 0!==d.id&&(b.id=d.id),this.features.push(b),x&&(p[x]=!0),v)for(var _=n.evaluate(d,{}).join(","),w=l[_]=l[_]||{},A="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement"),k=ji(v),S=0;S<v.length;S++)if(w[v.charCodeAt(S)]=!0,A&&k){var z=Es[v.charAt(S)];z&&(w[z.charCodeAt(0)]=!0);}}}}"line"===i.get("symbol-placement")&&(this.features=Ms(this.features));}},dp.prototype.update=function(t,e){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers));},dp.prototype.isEmpty=function(){return 0===this.symbolInstances.length},dp.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},dp.prototype.upload=function(t){this.uploaded||(this.collisionBox.upload(t),this.collisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0;},dp.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy();},dp.prototype.addToLineVertexArray=function(t,e){var r=this.lineVertexArray.length;if(void 0!==t.segment){for(var i=t.dist(e[t.segment+1]),n=t.dist(e[t.segment]),a={},o=t.segment+1;o<e.length;o++)a[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:i},o<e.length-1&&(i+=e[o+1].dist(e[o]));for(var s=t.segment||0;s>=0;s--)a[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:n},s>0&&(n+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var p=a[u];this.lineVertexArray.emplaceBack(p.x,p.y,p.tileUnitDistanceFromAnchor);}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},dp.prototype.addSymbols=function(t,e,r,i,n,a,o,s,u,p){for(var l=t.indexArray,h=t.layoutVertexArray,c=t.dynamicLayoutVertexArray,y=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray),f=this.glyphOffsetArray.length,d=y.vertexLength,m=0,g=e;m<g.length;m+=1){var v=g[m],x=v.tl,b=v.tr,_=v.bl,w=v.br,A=v.tex,k=y.vertexLength,S=v.glyphOffset[1],z=this.calcTDSpacePoint(s.x,s.y);hp(h,z,x.x,S+x.y,A.x,A.y,r),hp(h,z,b.x,S+b.y,A.x+A.w,A.y,r),hp(h,z,_.x,S+_.y,A.x,A.y+A.h,r),hp(h,z,w.x,S+w.y,A.x+A.w,A.y+A.h,r),cp(c,s,0,s),l.emplaceBack(k,k+1,k+2),l.emplaceBack(k+1,k+2,k+3),y.vertexLength+=4,y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(v.glyphOffset[0]);}t.placedSymbolArray.emplaceBack(s.x,s.y,f,this.glyphOffsetArray.length-f,d,u,p,s.segment,r?r[0]:0,r?r[1]:0,i[0],i[1],o,!1),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,a,a.index);},dp.prototype._addCollisionDebugVertex=function(t,e,r,i,n){return e.emplaceBack(0,0),t.emplaceBack(r.x,r.y,r.z,i.x,i.y,Math.round(n.x),Math.round(n.y))},dp.prototype.addCollisionDebugVertices=function(t,e,r,i,n,a,o,s){var u=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),p=u.vertexLength,h=n.layoutVertexArray,c=n.collisionVertexArray,y=this.calcTDSpacePoint(a.x,a.y);if(this._addCollisionDebugVertex(h,c,y,o.anchor,new l(t,e)),this._addCollisionDebugVertex(h,c,y,o.anchor,new l(r,e)),this._addCollisionDebugVertex(h,c,y,o.anchor,new l(r,i)),this._addCollisionDebugVertex(h,c,y,o.anchor,new l(t,i)),u.vertexLength+=4,s){var f=n.indexArray;f.emplaceBack(p,p+1,p+2),f.emplaceBack(p,p+2,p+3),u.primitiveLength+=2;}else{var d=n.indexArray;d.emplaceBack(p,p+1),d.emplaceBack(p+1,p+2),d.emplaceBack(p+2,p+3),d.emplaceBack(p+3,p),u.primitiveLength+=4;}},dp.prototype.generateCollisionDebugBuffers=function(){for(var t=0,e=this.symbolInstances;t<e.length;t+=1){var r=e[t];r.textCollisionFeature={boxStartIndex:r.textBoxStartIndex,boxEndIndex:r.textBoxEndIndex},r.iconCollisionFeature={boxStartIndex:r.iconBoxStartIndex,boxEndIndex:r.iconBoxEndIndex};for(var i=0;i<2;i++){var n=r[0===i?"textCollisionFeature":"iconCollisionFeature"];if(n)for(var a=n.boxStartIndex;a<n.boxEndIndex;a++){var o=this.collisionBoxArray.get(a),s=o.x1,u=o.y1,p=o.x2,l=o.y2,h=o.radius>0;this.addCollisionDebugVertices(s,u,p,l,h?this.collisionCircle:this.collisionBox,o.anchorPoint,r,h);}}}},dp.prototype.deserializeCollisionBoxes=function(t,e,r,i,n){for(var a={},o=e;o<r;o++){var s=t.get(o);if(0===s.radius){a.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY},a.textFeatureIndex=s.featureIndex;break}a.textCircles||(a.textCircles=[],a.textFeatureIndex=s.featureIndex);a.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1);}for(var u=i;u<n;u++){var p=t.get(u);if(0===p.radius){a.iconBox={x1:p.x1,y1:p.y1,x2:p.x2,y2:p.y2,anchorPointX:p.anchorPointX,anchorPointY:p.anchorPointY},a.iconFeatureIndex=p.featureIndex;break}}return a},dp.prototype.hasTextData=function(){return this.text.segments.get().length>0},dp.prototype.hasIconData=function(){return this.icon.segments.get().length>0},dp.prototype.hasCollisionBoxData=function(){return this.collisionBox.segments.get().length>0},dp.prototype.hasCollisionCircleData=function(){return this.collisionCircle.segments.get().length>0},dp.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&(this.sortedAngle=t,!(this.text.segments.get().length>1||this.icon.segments.get().length>1))){for(var r=[],i=0;i<this.symbolInstances.length;i++)r.push(i);var n=Math.sin(t),a=Math.cos(t);r.sort(function(t,r){var i=e.symbolInstances[t],o=e.symbolInstances[r];return(0|Math.round(n*i.anchor.x+a*i.anchor.y))-(0|Math.round(n*o.anchor.x+a*o.anchor.y))||o.featureIndex-i.featureIndex}),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var o=0,s=r;o<s.length;o+=1){var u=s[o],p=e.symbolInstances[u];e.featureSortOrder.push(p.featureIndex);for(var l=0,h=p.placedTextSymbolIndices;l<h.length;l+=1)for(var c=h[l],y=e.text.placedSymbolArray.get(c),f=y.vertexStartIndex+4*y.numGlyphs,d=y.vertexStartIndex;d<f;d+=4)e.text.indexArray.emplaceBack(d,d+1,d+2),e.text.indexArray.emplaceBack(d+1,d+2,d+3);var m=e.icon.placedSymbolArray.get(u);if(m.numGlyphs){var g=m.vertexStartIndex;e.icon.indexArray.emplaceBack(g,g+1,g+2),e.icon.indexArray.emplaceBack(g+1,g+2,g+3);}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray);}},dp.prototype.calcTDSpacePoint=function(t,e){var r=yu([],mu(this.x+t/8192,this.y+e/8192,this.zPow,this.projection),Pt.TRANSFORM.R);return new l(r[0]-this.tilePlane.out1[0],r[1]-this.tilePlane.out1[1],r[2]-this.tilePlane.out1[2])},Fi("SphereSymbolBucket",dp,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances"]}),dp.MAX_GLYPHS=65535,dp.addDynamicAttributes=cp;var mp=new fn({"symbol-placement":new ln(Jt["layout_sphere-symbol"]["symbol-placement"]),"symbol-spacing":new ln(Jt["layout_sphere-symbol"]["symbol-spacing"]),"symbol-avoid-edges":new ln(Jt["layout_sphere-symbol"]["symbol-avoid-edges"]),"icon-allow-overlap":new ln(Jt["layout_sphere-symbol"]["icon-allow-overlap"]),"icon-ignore-placement":new ln(Jt["layout_sphere-symbol"]["icon-ignore-placement"]),"icon-optional":new ln(Jt["layout_sphere-symbol"]["icon-optional"]),"icon-rotation-alignment":new ln(Jt["layout_sphere-symbol"]["icon-rotation-alignment"]),"icon-size":new hn(Jt["layout_sphere-symbol"]["icon-size"]),"icon-text-fit":new ln(Jt["layout_sphere-symbol"]["icon-text-fit"]),"icon-text-fit-padding":new ln(Jt["layout_sphere-symbol"]["icon-text-fit-padding"]),"icon-image":new hn(Jt["layout_sphere-symbol"]["icon-image"]),"icon-rotate":new hn(Jt["layout_sphere-symbol"]["icon-rotate"]),"icon-padding":new ln(Jt["layout_sphere-symbol"]["icon-padding"]),"icon-keep-upright":new ln(Jt["layout_sphere-symbol"]["icon-keep-upright"]),"icon-offset":new hn(Jt["layout_sphere-symbol"]["icon-offset"]),"icon-anchor":new hn(Jt["layout_sphere-symbol"]["icon-anchor"]),"icon-pitch-alignment":new ln(Jt["layout_sphere-symbol"]["icon-pitch-alignment"]),"text-pitch-alignment":new ln(Jt["layout_sphere-symbol"]["text-pitch-alignment"]),"text-rotation-alignment":new ln(Jt["layout_sphere-symbol"]["text-rotation-alignment"]),"text-field":new hn(Jt["layout_sphere-symbol"]["text-field"]),"text-font":new hn(Jt["layout_sphere-symbol"]["text-font"]),"text-size":new hn(Jt["layout_sphere-symbol"]["text-size"]),"text-max-width":new hn(Jt["layout_sphere-symbol"]["text-max-width"]),"text-line-height":new ln(Jt["layout_sphere-symbol"]["text-line-height"]),"text-letter-spacing":new hn(Jt["layout_sphere-symbol"]["text-letter-spacing"]),"text-justify":new hn(Jt["layout_sphere-symbol"]["text-justify"]),"text-anchor":new hn(Jt["layout_sphere-symbol"]["text-anchor"]),"text-max-angle":new ln(Jt["layout_sphere-symbol"]["text-max-angle"]),"text-rotate":new hn(Jt["layout_sphere-symbol"]["text-rotate"]),"text-padding":new ln(Jt["layout_sphere-symbol"]["text-padding"]),"text-keep-upright":new ln(Jt["layout_sphere-symbol"]["text-keep-upright"]),"text-transform":new hn(Jt["layout_sphere-symbol"]["text-transform"]),"text-offset":new hn(Jt["layout_sphere-symbol"]["text-offset"]),"text-allow-overlap":new ln(Jt["layout_sphere-symbol"]["text-allow-overlap"]),"text-ignore-placement":new ln(Jt["layout_sphere-symbol"]["text-ignore-placement"]),"text-optional":new ln(Jt["layout_sphere-symbol"]["text-optional"])}),gp={paint:new fn({"icon-opacity":new hn(Jt["paint_sphere-symbol"]["icon-opacity"]),"icon-color":new hn(Jt["paint_sphere-symbol"]["icon-color"]),"icon-halo-color":new hn(Jt["paint_sphere-symbol"]["icon-halo-color"]),"icon-halo-width":new hn(Jt["paint_sphere-symbol"]["icon-halo-width"]),"icon-halo-blur":new hn(Jt["paint_sphere-symbol"]["icon-halo-blur"]),"icon-translate":new ln(Jt["paint_sphere-symbol"]["icon-translate"]),"icon-translate-anchor":new ln(Jt["paint_sphere-symbol"]["icon-translate-anchor"]),"text-opacity":new hn(Jt["paint_sphere-symbol"]["text-opacity"]),"text-color":new hn(Jt["paint_sphere-symbol"]["text-color"]),"text-halo-color":new hn(Jt["paint_sphere-symbol"]["text-halo-color"]),"text-halo-width":new hn(Jt["paint_sphere-symbol"]["text-halo-width"]),"text-halo-blur":new hn(Jt["paint_sphere-symbol"]["text-halo-blur"]),"text-translate":new ln(Jt["paint_sphere-symbol"]["text-translate"]),"text-translate-anchor":new ln(Jt["paint_sphere-symbol"]["text-translate-anchor"])}),layout:mp},vp=function(t){function e(e){t.call(this,e,gp);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),"auto"===this.layout.get("icon-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));},e.prototype.getValueAndResolveTokens=function(t,e){var r=this.layout.get(t).evaluate(e,{}),i=this._unevaluatedLayout._values[t];return i.isDataDriven()||jr(i.value)?r:qs(e.properties,r)},e.prototype.createBucket=function(t){return new dp(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("icon-opacity")&&0!==this.paint.get("text-opacity")&&"none"!==this.visibility},e}(dn),xp=xn([{name:"a_pos",components:3,type:"Float32"},{name:"a_normal_ed",components:3,type:"Float32"},{name:"a_st",components:3,type:"Float32"}],4).members;function bp(t,e){if(t&&t.length<=0)return[];var r=[];r.push(new kp(new l(0,0),new l(8192,0))),r.push(new kp(new l(8192,0),new l(8192,8192))),r.push(new kp(new l(8192,8192),new l(0,8192))),r.push(new kp(new l(0,8192),new l(0,0))),e=e||r;var i,n=[],a=[],o=t[t.length-1];for(var s in t)n.push(t[s]);for(var u in e){for(var p in i=!_p(o=n[n.length-1],e[u]),n)_p(n[p],e[u])?(i&&(i=!1,a.push(Ap(o,n[p],e[u].start,e[u].end))),a.push(n[p])):i||(i=!0,a.push(Ap(o,n[p],e[u].start,e[u].end))),o=n[p];for(var h in n=[],a)n.push(a[h]);a=[];}return n.push(n[n.length-1]),n}function _p(t,e){return!!t&&wp(t,e.start,e.end)>=0}function wp(t,e,r){return(e.x-t.x)*(r.y-t.y)-(r.x-t.x)*(e.y-t.y)}function Ap(t,e,r,i){var n=(wp(t,i,r)*e.x-wp(e,i,r)*t.x)/(wp(t,i,r)-wp(e,i,r)),a=(wp(t,i,r)*e.y-wp(e,i,r)*t.y)/(wp(t,i,r)-wp(e,i,r));return new l(n,a)}function kp(t,e){this.start=t,this.end=e;}function Sp(t,e,r,i,n,a,o,s,u,p){t.emplaceBack(e,r,i,n,a,o,s,u,p);}var zp=function(t){this.featureTrangles=[],this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new In,this.indexArray=new Jn,this.programConfigurations=new va(xp,t.layers,t.zoom),this.segments=new ha,this.projection=t.projection||Ko.MERCATOR;};function Bp(t,e){return t.x===e.x&&(t.x<0||t.x>ba)||t.y===e.y&&(t.y<0||t.y>ba)}function Tp(t){return t.every(function(t){return t.x<0})||t.every(function(t){return t.x>ba})||t.every(function(t){return t.y<0})||t.every(function(t){return t.y>ba})}function Mp(t){return!(t.every(function(t){return t.x>=0})&&t.every(function(t){return t.x<=ba})&&t.every(function(t){return t.y>=0})&&t.every(function(t){return t.y<=ba}))}function Ep(t,e){return t.x===e.x&&(0===t.x||8192===t.x)||t.y===e.y&&(0===t.y||8192===t.y)}function Vp(t){for(var e=1/0,r=-1/0,i=1/0,n=-1/0,a=0,o=t;a<o.length;a+=1)for(var s=0,u=o[a];s<u.length;s+=1){var p=u[s];e>p.x&&(e=p.x),r<p.x&&(r=p.x),i>p.y&&(i=p.y),n<p.y&&(n=p.y);}var l=r-e<512?512:r-e;return l<n-i&&(l=n-i),{minX:e,maxX:r,minY:i,maxY:n,maxLength:l}}zp.prototype.populate=function(t,e){this.x=e.x,this.y=e.y,this.z=e.z;for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index;if(this.layers[0]._featureFilter(new tn(this.zoom),a)){var s=Aa(a),u=[];this.addFeature(a,s,o,u),this.featureTrangles.push({feature:a.toGeoJSON(this.x,this.y,this.z),triangles:u});}}this.baseP&&(this.matrix=xu(0,this.baseP,!1));},zp.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},zp.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},zp.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},zp.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,xp),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},zp.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},zp.prototype.addFeature=function(t,e,r,i){var n=0,a=this.layers[0].paint.get("extrusion-height").value,o=this.layers[0].paint.get("extrusion-base"),s=o.value&&o.value.value&&Number(o.value.value)||0;if(a&&"constant"===a.kind)n=Number(a.value);else if(a&&"source"===a.kind){var u=a._parameters&&a._parameters.property;n=u?Number(t.properties[u]):0;}for(var p=0,l=Co(e,500);p<l.length;p+=1){for(var h=l[p],c=0,y=0,f=h;y<f.length;y+=1){c+=f[y].length;}for(var d=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),m=0,g=h;m<g.length;m+=1){var v=g[m];if(0!==v.length&&!Tp(v)){Mp(v)&&(v=bp(v));for(var x=0;x<v.length;x++){var b=v[x];if(x>=1){var _=v[x-1];if(Ep(b,_))continue;if(!Bp(b,_)){d.vertexLength+4>ha.MAX_VERTEX_ARRAY_LENGTH&&(d=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var w=du(b.x,b.y,s,this.x,this.y,this.z,this.projection);this.baseP||(this.baseP=w);var A=du(b.x,b.y,n,this.x,this.y,this.z,this.projection),k=du(_.x,_.y,s,this.x,this.y,this.z,this.projection),S=du(_.x,_.y,n,this.x,this.y,this.z,this.projection),z=this.baseP,B=nt([],st([],w,A),st([],w,k));Sp(this.layoutVertexArray,w[0]-z[0],w[1]-z[1],w[2]-z[2],B[0],B[1],B[2],0,s/5,0),Sp(this.layoutVertexArray,A[0]-z[0],A[1]-z[1],A[2]-z[2],B[0],B[1],B[2],0,n/5,0);var T=20*ut(k,w);Sp(this.layoutVertexArray,k[0]-z[0],k[1]-z[1],k[2]-z[2],B[0],B[1],B[2],T,s/5,0),Sp(this.layoutVertexArray,S[0]-z[0],S[1]-z[1],S[2]-z[2],B[0],B[1],B[2],T,n/5,0);var M=d.vertexLength;this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M+1,M+2,M+3),i.push([w,A,k],[A,k,S]),d.vertexLength+=4,d.primitiveLength+=2;}}}}}d.vertexLength+c>ha.MAX_VERTEX_ARRAY_LENGTH&&(d=this.segments.prepareSegment(c,this.layoutVertexArray,this.indexArray));for(var E=[],V=[],I=d.vertexLength,C=[],R=0,L=h;R<L.length;R+=1){var P=L[R];if(0!==P.length){P!==h[0]&&V.push(E.length/2);for(var F=Vp(h),O=0;O<P.length;O++){var D=P[O],q=[(D.x-F.minX)/F.maxLength,(D.y-F.minY)/F.maxLength],U=du(D.x,D.y,n+(this.x%2+this.y%2)/256,this.x,this.y,this.z,this.projection);C.push(U),this.baseP||(this.baseP=U),Sp(this.layoutVertexArray,U[0]-this.baseP[0],U[1]-this.baseP[1],U[2]-this.baseP[2],0,8,0,q[0],q[1],1),E.push(D.x),E.push(D.y);}}}for(var N=io(E,V),j=0;j<N.length;j+=3)this.indexArray.emplaceBack(I+N[j],I+N[j+1],I+N[j+2]),i.push([C[N[j]],C[N[j+1]],C[N[j+2]]]);d.primitiveLength+=N.length/3,d.vertexLength+=c;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r);},Fi("SphereExtrusionBucket",zp,{omit:["layers"]});var Ip={paint:new fn({"extrusion-opacity":new ln(Jt["paint_sphere-extrusion"]["extrusion-opacity"]),"extrusion-color":new hn(Jt["paint_sphere-extrusion"]["extrusion-color"]),"extrusion-translate":new ln(Jt["paint_sphere-extrusion"]["extrusion-translate"]),"extrusion-translate-anchor":new ln(Jt["paint_sphere-extrusion"]["extrusion-translate-anchor"]),"extrusion-pattern":new cn(Jt["paint_sphere-extrusion"]["extrusion-pattern"]),"extrusion-top-pattern":new cn(Jt["paint_sphere-extrusion"]["extrusion-top-pattern"]),"extrusion-height":new hn(Jt["paint_sphere-extrusion"]["extrusion-height"]),"extrusion-base":new hn(Jt["paint_sphere-extrusion"]["extrusion-base"]),"render-road":new ln(Jt["paint_sphere-extrusion"]["render-road"])})},Cp=function(t){function e(e){t.call(this,e,Ip),this.radiationRegions=[];for(var r=e["radiation-regions"]||[],i=0;i<r.length;i++)if(r[i].scan){var n=yu([],[r[i].location[0],r[i].location[1]+.1],Pt.TRANSFORM.R),a=yu([],r[i].location,Pt.TRANSFORM.R),o=yu([],[r[i].location[0]+.1,r[i].location[1]],Pt.TRANSFORM.R);this.radiationRegions.push({geo:a.concat([r[i].radius*Pt.TRANSFORM.R_SCALE]),location:r[i].location,scan:!0,north:n,cross:nt([],st([],n,a),st([],o,a)),speed:r[i].speed||10});}else this.radiationRegions.push({geo:yu([],r[i].location,Pt.TRANSFORM.R).concat([r[i].radius*Pt.TRANSFORM.R_SCALE]),location:r[i].location,scan:!1,speed:r[i].speed||10});}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new zp(t)},e.prototype.queryRadius=function(){return Da(this.paint.get("extrusion-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,a,o){qa(t,this.paint.get("extrusion-translate"),this.paint.get("extrusion-translate-anchor"),a.angle,o);return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("extrusion-opacity")&&"none"!==this.visibility},e.prototype.resize=function(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null);},e}(dn),Rp=xn([{name:"a_pos",components:3,type:"Float32"},{name:"a_normal",components:2,type:"Int8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_seq",components:1,type:"Uint16"}],4).members,Lp=ss.VectorTileFeature.types,Pp=63,Fp=Math.cos(Math.PI/180*37.5),Op=.5,Dp=Math.pow(2,14)/Op;function qp(t,e,r,i,n,a,o,s){t.emplaceBack(e.x,e.y,e.z,i?1:0,n?1:-1,Math.round(Pp*r.x)+128,Math.round(Pp*r.y)+128,1+(0===a?0:a<0?-1:1)|(o*Op&63)<<2,o*Op>>6,s);}var Up=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Pn,this.indexArray=new Jn,this.programConfigurations=new va(Rp,t.layers,t.zoom),this.segments=new ha,this.projection=t.projection||Ko.MERCATOR;};Up.prototype.populate=function(t,e){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.tilePlane=gu(this.x,this.y,this.z,this.projection));for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new tn(this.zoom),a)){var u=Aa(a);this.addFeature(a,u,o),e.featureIndex.insert(a,u,o,s,this.index);}}},Up.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},Up.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Up.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Up.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Rp),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},Up.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},Up.prototype.addFeature=function(t,e,r){for(var i=this.layers[0].layout,n=i.get("tracking-join").evaluate(t,{}),a=i.get("tracking-cap"),o=i.get("tracking-miter-limit"),s=i.get("tracking-round-limit"),u=Number(t.properties.link_seq),p=0,l=e;p<l.length;p+=1){var h=l[p];this.addLine(h,t,n,a,o,s,r,u);}},Up.prototype.addLine=function(t,e,r,i,n,a,o,s){for(var u="Polygon"===Lp[e.type],p=t.length;p>=2&&t[p-1].equals(t[p-2]);)p--;for(var l=0;l<p-1&&t[l].equals(t[l+1]);)l++;if(!(p<(u?3:2))){"bevel"===r&&(n=1.05);var h=ba/(512*this.overscaling)*15,c=t[l],y=this.segments.prepareSegment(10*p,this.layoutVertexArray,this.indexArray);this.distance=0;var f,d,m,g=i,v=u?"butt":i,x=!0,b=void 0,_=void 0,w=void 0,A=void 0;this.e1=this.e2=this.e3=-1,u&&(f=t[p-2],A=c.sub(f)._unit()._perp());for(var k=l;k<p;k++)if(s+=1,!(_=u&&k===p-1?t[l+1]:t[k+1])||!t[k].equals(_)){A&&(w=A),f&&(b=f),f=t[k],A=_?_.sub(f)._unit()._perp():w;var S=(w=w||A).add(A);0===S.x&&0===S.y||S._unit();var z=S.x*A.x+S.y*A.y,B=0!==z?1/z:1/0,T=z<Fp&&b&&_;if(T&&k>l){var M=f.dist(b);if(M>2*h){var E=f.sub(f.sub(b)._mult(h/M)._round());this.distance+=E.dist(b),this.addCurrentVertex(E,this.distance,w.mult(1),0,0,!1,y,s),b=E;}}var V=b&&_,I=V?r:_?g:v;if(V&&"round"===I&&(B<a?I="miter":B<=2&&(I="fakeround")),"miter"===I&&B>n&&(I="bevel"),"bevel"===I&&(B>2&&(I="flipbevel"),B<n&&(I="miter")),b&&(this.distance+=f.dist(b)),"miter"===I)S._mult(B),this.addCurrentVertex(f,this.distance,S,0,0,!1,y,s);else if("flipbevel"===I){if(B>100)S=A.clone().mult(-1);else{var C=w.x*A.y-w.y*A.x>0?-1:1,R=B*w.add(A).mag()/w.sub(A).mag();S._perp()._mult(R*C);}this.addCurrentVertex(f,this.distance,S,0,0,!1,y,s),this.addCurrentVertex(f,this.distance,S.mult(-1),0,0,!1,y,s);}else if("bevel"===I||"fakeround"===I){var L=w.x*A.y-w.y*A.x>0,P=-Math.sqrt(B*B-1);if(L?(m=0,d=P):(d=0,m=P),x||this.addCurrentVertex(f,this.distance,w,d,m,!1,y,s),"fakeround"===I){for(var F=Math.floor(8*(.5-(z-.5))),O=void 0,D=0;D<F;D++)O=A.mult((D+1)/(F+1))._add(w)._unit(),this.addPieSliceVertex(f,this.distance,O,L,y,s);this.addPieSliceVertex(f,this.distance,S,L,y,s);for(var q=F-1;q>=0;q--)O=w.mult((q+1)/(F+1))._add(A)._unit(),this.addPieSliceVertex(f,this.distance,O,L,y,s);}_&&this.addCurrentVertex(f,this.distance,A,-d,-m,!1,y,s);}else"butt"===I?(x||this.addCurrentVertex(f,this.distance,w,0,0,!1,y,s),_&&this.addCurrentVertex(f,this.distance,A,0,0,!1,y,s)):"square"===I?(x||(this.addCurrentVertex(f,this.distance,w,1,1,!1,y,s),this.e1=this.e2=-1),_&&this.addCurrentVertex(f,this.distance,A,-1,-1,!1,y,s)):"round"===I&&(x||(this.addCurrentVertex(f,this.distance,w,0,0,!1,y,s),this.addCurrentVertex(f,this.distance,w,1,1,!0,y,s),this.e1=this.e2=-1),_&&(this.addCurrentVertex(f,this.distance,A,-1,-1,!0,y,s),this.addCurrentVertex(f,this.distance,A,0,0,!1,y,s)));if(T&&k<p-1){var U=f.dist(_);if(U>2*h){var N=f.add(_.sub(f)._mult(h/U)._round());this.distance+=N.dist(f),this.addCurrentVertex(N,this.distance,A.mult(1),0,0,!1,y,s),f=N;}}x=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o);}},Up.prototype.calcTDSpacePoint=function(t){var e=yu([],mu(this.x+t.x/8192,this.y+t.y/8192,this.zPow,this.projection),Pt.TRANSFORM.R);return new l(e[0]-this.tilePlane.out1[0],e[1]-this.tilePlane.out1[1],e[2]-this.tilePlane.out1[2])},Up.prototype.addCurrentVertex=function(t,e,r,i,n,a,o,s){var u,p=this.layoutVertexArray,l=this.indexArray;u=r.clone(),i&&u._sub(r.perp()._mult(i));var h=this.calcTDSpacePoint(t);qp(p,h,u,a,!1,i,e,s),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,u=r.mult(-1),n&&u._sub(r.perp()._mult(n)),qp(p,h,u,a,!0,-n,e,s),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(l.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>Dp/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,r,i,n,a,o,s));},Up.prototype.addPieSliceVertex=function(t,e,r,i,n,a){r=r.mult(i?-1:1);var o=this.layoutVertexArray,s=this.indexArray;qp(o,this.calcTDSpacePoint(t),r,!1,i,0,e,a),this.e3=n.vertexLength++,this.e1>=0&&this.e2>=0&&(s.emplaceBack(this.e1,this.e2,this.e3),n.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3;},Fi("SphereTrackingBucket",Up,{omit:["layers"]});var Np=new fn({"tracking-cap":new ln(Jt["layout_sphere-tracking"]["tracking-cap"]),"tracking-join":new hn(Jt["layout_sphere-tracking"]["tracking-join"]),"tracking-miter-limit":new ln(Jt["layout_sphere-tracking"]["tracking-miter-limit"]),"tracking-round-limit":new ln(Jt["layout_sphere-tracking"]["tracking-round-limit"]),"tracking-display-mode":new ln(Jt["layout_sphere-tracking"]["tracking-display-mode"])}),jp={paint:new fn({"tracking-opacity":new hn(Jt["paint_sphere-tracking"]["tracking-opacity"]),"tracking-color":new hn(Jt["paint_sphere-tracking"]["tracking-color"]),"tracking-translate":new ln(Jt["paint_sphere-tracking"]["tracking-translate"]),"tracking-translate-anchor":new ln(Jt["paint_sphere-tracking"]["tracking-translate-anchor"]),"tracking-width":new hn(Jt["paint_sphere-tracking"]["tracking-width"]),"tracking-gap-width":new hn(Jt["paint_sphere-tracking"]["tracking-gap-width"]),"tracking-offset":new hn(Jt["paint_sphere-tracking"]["tracking-offset"]),"tracking-blur":new hn(Jt["paint_sphere-tracking"]["tracking-blur"]),"tracking-type":new ln(Jt["paint_sphere-tracking"]["tracking-type"]),"tracking-seg-count":new ln(Jt["paint_sphere-tracking"]["tracking-seg-count"]),"tracking-seg-group":new ln(Jt["paint_sphere-tracking"]["tracking-seg-group"]),"tracking-speed":new ln(Jt["paint_sphere-tracking"]["tracking-speed"]),"tracking-delay":new ln(Jt["paint_sphere-tracking"]["tracking-delay"]),"tracking-speed-factor":new ln(Jt["paint_sphere-tracking"]["tracking-speed-factor"])}),layout:Np},Gp=new(function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new tn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,i,n){return r=x({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,i,n)},e}(hn))(jp.paint.properties["tracking-width"].specification);Gp.useIntegerZoom=!0;var Xp=function(t){function e(e){t.call(this,e,jp);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["tracking-floorwidth"]=Gp.possiblyEvaluate(this._transitioningPaint._values["tracking-width"].value,e);},e.prototype.createBucket=function(t){return new Up(t)},e.prototype.queryRadius=function(t){var e=t,r=Yp(Oa("tracking-width",this,e),Oa("tracking-gap-width",this,e)),i=Oa("tracking-offset",this,e);return r/2+Math.abs(i)+Da(this.paint.get("tracking-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,a,o){var s=qa(t,this.paint.get("tracking-translate"),this.paint.get("tracking-translate-anchor"),a.angle,o),u=o/2*Yp(this.paint.get("tracking-width").evaluate(e,r),this.paint.get("tracking-gap-width").evaluate(e,r)),p=this.paint.get("tracking-offset").evaluate(e,r);return p&&(i=function(t,e){for(var r=[],i=new l(0,0),n=0;n<t.length;n++){for(var a=t[n],o=[],s=0;s<a.length;s++){var u=a[s-1],p=a[s],h=a[s+1],c=0===s?i:p.sub(u)._unit()._perp(),y=s===a.length-1?i:h.sub(p)._unit()._perp(),f=c._add(y)._unit(),d=f.x*y.x+f.y*y.y;f._mult(1/d),o.push(f._mult(e)._add(p));}r.push(o);}return r}(i,p*o)),Ma(s,i,u)},e}(dn);function Yp(t,e){return e>0?e+2*t:t}var Hp={paint:new fn({"3d-model-opacity":new ln(Jt["paint_3d-model"]["3d-model-opacity"])})},Zp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};var $p=setTimeout;function Jp(t){return Boolean(t&&void 0!==t.length)}function Kp(){}function Wp(t){if(!(this instanceof Wp))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],il(t,this);}function Qp(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,Wp._immediateFn(function(){var r=1===t._state?e.onFulfilled:e.onRejected;if(null!==r){var i;try{i=r(t._value);}catch(t){return void el(e.promise,t)}tl(e.promise,i);}else(1===t._state?tl:el)(e.promise,t._value);})):t._deferreds.push(e);}function tl(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var r=e.then;if(e instanceof Wp)return t._state=3,t._value=e,void rl(t);if("function"==typeof r)return void il((i=r,n=e,function(){i.apply(n,arguments);}),t)}t._state=1,t._value=e,rl(t);}catch(e){el(t,e);}var i,n;}function el(t,e){t._state=2,t._value=e,rl(t);}function rl(t){2===t._state&&0===t._deferreds.length&&Wp._immediateFn(function(){t._handled||Wp._unhandledRejectionFn(t._value);});for(var e=0,r=t._deferreds.length;e<r;e++)Qp(t,t._deferreds[e]);t._deferreds=null;}function il(t,e){var r=!1;try{t(function(t){r||(r=!0,tl(e,t));},function(t){r||(r=!0,el(e,t));});}catch(t){if(r)return;r=!0,el(e,t);}}Wp.prototype.catch=function(t){return this.then(null,t)},Wp.prototype.then=function(t,e){var r=new this.constructor(Kp);return Qp(this,new function(t,e,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=r;}(t,e,r)),r},Wp.prototype.finally=function(t){var e=this.constructor;return this.then(function(r){return e.resolve(t()).then(function(){return r})},function(r){return e.resolve(t()).then(function(){return e.reject(r)})})},Wp.all=function(t){return new Wp(function(e,r){if(!Jp(t))return r(new TypeError("Promise.all accepts an array"));var i=Array.prototype.slice.call(t);if(0===i.length)return e([]);var n=i.length;function a(t,o){try{if(o&&("object"==typeof o||"function"==typeof o)){var s=o.then;if("function"==typeof s)return void s.call(o,function(e){a(t,e);},r)}i[t]=o,0==--n&&e(i);}catch(t){r(t);}}for(var o=0;o<i.length;o++)a(o,i[o]);})},Wp.resolve=function(t){return t&&"object"==typeof t&&t.constructor===Wp?t:new Wp(function(e){e(t);})},Wp.reject=function(t){return new Wp(function(e,r){r(t);})},Wp.race=function(t){return new Wp(function(e,r){if(!Jp(t))return r(new TypeError("Promise.race accepts an array"));for(var i=0,n=t.length;i<n;i++)Wp.resolve(t[i]).then(e,r);})},Wp._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t);}||function(t){$p(t,0);},Wp._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t);};var nl=function(){this.jsonRequest=null,this.binRequest=null;};function al(t,e,r,i,n){var a,o=t.meshes,s=o[e].primitives[r||0].attributes,u=[];for(var p in s){var l=s[p],h=t.accessors[l],c=t.bufferViews[h.bufferView],y=(h.byteOffset?h.byteOffset:0)+(c.byteOffset?c.byteOffset:0),f=c.byteStride?c.byteStride:c.byteLength/h.count,d=h.componentType;"POSITION"===p&&(i.VB={offset:y,byteStride:f,type:d}),u.push({name:"a_"+p,type:d,components:Zp[h.type],offset:y,byteStride:f});}if(n)for(var m=0;m<o[e].primitives[r||0].targets.length;m++){var g=o[e].primitives[r||0].targets[m];for(var v in g){var x=g[v],b=t.accessors[x],_=t.bufferViews[b.bufferView],w=(b.byteOffset?b.byteOffset:0)+(_.byteOffset?_.byteOffset:0),A=_.byteStride?_.byteStride:_.byteLength/b.count,k=b.componentType;u.push({name:"a_"+v+"_"+(m+1),type:k,components:Zp[b.type],offset:w,byteStride:A});}}return void 0===a&&(a=1),{members:u.map(function(t){var e=t.components||1;return{name:t.name,type:t.type,components:e,offset:t.offset||0,byteStride:t.byteStride||4}}),size:bn(0,Math.max(0,a)),alignment:a}}nl.prototype.load=function(t,e){var r=this,i=null,n=[];this.jsonRequest=Nt(t,function(a,o){if(a)e(a,null);else if((i=o)&&Array.isArray(i.buffers)){for(var s=[],u=0,p=i.buffers;u<p.length;u+=1){var l=p[u];l&&"string"==typeof l.uri?function(e,i,n){n.push(new Wp(function(e,n){var a,o=t.url;-1!==i.indexOf("base64")?e((a=i,atob(a.substring(a.indexOf(",")+1)).split("").map(function(t){return t.charCodeAt(0)}))):r.binRequest=jt({url:o.substring(0,o.lastIndexOf("/")+1)+i},function(t,r){t?n(t):e(r?r.data:null);});}));}(0,l.uri,s):e("Missing buffer info",null);}Wp.all(s).then(function(t){for(var r=0;r<t.length;r++)n.push(new Uint8Array(t[r]));i&&i.buffer&&delete i.buffer,e(null,{bufferData:n,gltf:i});});}else e("no buffer item",null);});},nl.prototype.abort=function(){this.jsonRequest&&this.jsonRequest.cancel(),this.binRequest&&this.binRequest.cancel();},nl.prototype.dealWithLocation=function(t){};var ol=self.HTMLImageElement,sl=self.HTMLCanvasElement,ul=self.HTMLVideoElement,pl=self.ImageData,ll=function(t,e,r,i){this.context=t,this.format=r,this.texture=t.gl.createTexture(),this._powerOfTwoCalculated=!1,this.powerOfTwoNoneSquareFlag=!1,this.flipY=!(!i||!i.flipY),this.update(e,i);};ll.prototype.update=function(t,e){var r=t.width,i=t.height,n=!this.size||this.size[0]!==r||this.size[1]!==i,a=this.context,o=a.gl;this.useMipmap=Boolean(e&&e.useMipmap),o.bindTexture(o.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(this.flipY),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA&&(!e||!1!==e.premultiply)),n?(this.size=[r,i],this.format!==o.RGBA||e&&!1===e.premultiply||a.pixelStoreUnpackPremultiplyAlpha.set(!0),t instanceof ol||t instanceof sl||t instanceof ul||t instanceof pl?o.texImage2D(o.TEXTURE_2D,0,this.format,this.format,o.UNSIGNED_BYTE,t):o.texImage2D(o.TEXTURE_2D,0,this.format,r,i,0,this.format,o.UNSIGNED_BYTE,t.data)):t instanceof ol||t instanceof sl||t instanceof ul||t instanceof pl?o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,t):o.texSubImage2D(o.TEXTURE_2D,0,0,0,r,i,o.RGBA,o.UNSIGNED_BYTE,t.data),n&&(this._powerOfTwoCalculated=!1),this.isSizePowerOfTwoNoneSquare()&&this.useMipmap&&o.generateMipmap(o.TEXTURE_2D);},ll.prototype.bind=function(t,e){var r,i=this.context.gl;i.bindTexture(i.TEXTURE_2D,this.texture),r=this.isSizePowerOfTwoNoneSquare()&&this.useMipmap?i.LINEAR_MIPMAP_NEAREST:i.LINEAR,t!==this.filter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,r||t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t),this.filter=t),e!==this.wrap&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,e),this.wrap=e);},ll.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},ll.prototype.isSizePowerOfTwoNoneSquare=function(){return this._powerOfTwoCalculated?this.powerOfTwoNoneSquareFlag:(this._powerOfTwoCalculated=!0,this.powerOfTwoNoneSquareFlag=Math.log(this.size[0])/Math.LN2%1==0&&Math.log(this.size[1])/Math.LN2%1==0,this.powerOfTwoNoneSquareFlag)},ll.prototype.destroy=function(){this.context&&(this.context.gl.deleteTexture(this.texture),this.texture=null,this.context=null);};var hl=function(t,e,r,i,n,a,o,s){this.context=t;var u=t.gl;this.dynamicDraw=Boolean(o),this.offset=a,this.count=i,this.mode=r,this.type=n,this.unbindVAO(),s?this.buffer=s:(this.buffer=u.createBuffer(),t.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,e,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW));};hl.prototype.getBuffer=function(){return this.buffer},hl.prototype.unbindVAO=function(){this.context.extVertexArrayObject&&this.context.bindVertexArrayOES.set(null);},hl.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer);},hl.prototype.updateData=function(t){var e=this.context.gl;this.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t);},hl.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),this.buffer=null,this.context=null,delete this.buffer);};var cl=function(t,e,r,i,n){this.length=e.length,this.attributes=r,this.dynamicDraw=i,this.context=t;var a=t.gl;n?this.buffer=n:(this.buffer=a.createBuffer(),t.bindVertexBuffer.set(this.buffer),a.bufferData(a.ARRAY_BUFFER,e,this.dynamicDraw?a.DYNAMIC_DRAW:a.STATIC_DRAW));};cl.prototype.getBuffer=function(){return this.buffer},cl.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer);},cl.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t);},cl.prototype.enableAttributes=function(t,e){for(var r=0;r<this.attributes.length;r++){var i=this.attributes[r],n=e.attributes[i.name];void 0!==n&&t.enableVertexAttribArray(n);}},cl.prototype.setVertexAttribPointers=function(t,e,r){for(var i=0;i<this.attributes.length;i++){var n=this.attributes[i],a=e.attributes[n.name];void 0!==a&&t.vertexAttribPointer(a,n.components,n.type,!1,n.byteStride,n.offset);}},cl.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),this.buffer=null,this.context=null,delete this.buffer);};var yl=function(t,e,r){this.context=t;var i=t.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer;};yl.prototype.unbindVAO=function(){this.context.extVertexArrayObject&&this.context.bindVertexArrayOES.set(null);},yl.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer);},yl.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer);},yl.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer);};var fl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},dl=function(t,e,r,i){this.length=e.length,this.attributes=r,this.itemSize=e.bytesPerElement,this.dynamicDraw=i,this.context=t;var n=t.gl;this.buffer=n.createBuffer(),t.bindVertexBuffer.set(this.buffer),n.bufferData(n.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer;};dl.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer);},dl.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer);},dl.prototype.enableAttributes=function(t,e){for(var r=0;r<this.attributes.length;r++){var i=this.attributes[r],n=e.attributes[i.name];void 0!==n&&t.enableVertexAttribArray(n);}},dl.prototype.setVertexAttribPointers=function(t,e,r){for(var i=0;i<this.attributes.length;i++){var n=this.attributes[i],a=e.attributes[n.name];void 0!==a&&t.vertexAttribPointer(a,n.components,t[fl[n.type]],!1,this.itemSize,n.offset+this.itemSize*(r||0));}},dl.prototype.destroy=function(){var t=this.context.gl;this.buffer&&(t.deleteBuffer(this.buffer),delete this.buffer);};var ml=function(t){this.context=t,this.default=ve.transparent,this.current=this.default,this.dirty=!1;};ml.prototype.get=function(){return this.current},ml.prototype.setDefault=function(){this.set(this.default);},ml.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a&&!0!==this.dirty||(this.context.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1);};var gl=function(t){this.context=t,this.default=1,this.current=this.default,this.dirty=!1;};gl.prototype.get=function(){return this.current},gl.prototype.setDefault=function(){this.set(this.default);},gl.prototype.set=function(t){this.current===t&&!0!==this.dirty||(this.context.gl.clearDepth(t),this.current=t,this.dirty=!1);};var vl=function(t){this.context=t,this.default=0,this.current=this.default,this.dirty=!1;};vl.prototype.get=function(){return this.current},vl.prototype.setDefault=function(){this.set(this.default);},vl.prototype.set=function(t){this.current===t&&!0!==this.dirty||(this.context.gl.clearStencil(t),this.current=t,this.dirty=!1);};var xl=function(t){this.context=t,this.default=[!0,!0,!0,!0],this.current=this.default,this.dirty=!1;};xl.prototype.get=function(){return this.current},xl.prototype.setDefault=function(){this.set(this.default);},xl.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&!0!==this.dirty||(this.context.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1);};var bl=function(t){this.context=t,this.default=!0,this.current=this.default,this.dirty=!1;};bl.prototype.get=function(){return this.current},bl.prototype.setDefault=function(){this.set(this.default);},bl.prototype.set=function(t){this.current===t&&!0!==this.dirty||(this.context.gl.depthMask(t),this.current=t,this.dirty=!1);};var _l=function(t){this.context=t,this.default=255,this.current=this.default,this.dirty=!1;};_l.prototype.get=function(){return this.current},_l.prototype.setDefault=function(){this.set(this.default);},_l.prototype.set=function(t){this.current===t&&!0!==this.dirty||(this.context.gl.stencilMask(t),this.current=t,this.dirty=!1);};var wl=function(t){this.context=t,this.default={func:t.gl.ALWAYS,ref:0,mask:255},this.current=this.default,this.dirty=!1;};wl.prototype.get=function(){return this.current},wl.prototype.setDefault=function(){this.set(this.default);},wl.prototype.set=function(t){var e=this.current;t.func===e.func&&t.ref===e.ref&&t.mask===e.mask&&!0!==this.dirty||(this.context.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1);};var Al=function(t){this.context=t;var e=this.context.gl;this.default=[e.KEEP,e.KEEP,e.KEEP],this.current=this.default,this.dirty=!1;};Al.prototype.get=function(){return this.current},Al.prototype.setDefault=function(){this.set(this.default);},Al.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&!0!==this.dirty||(this.context.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1);};var kl=function(t){this.context=t,this.default=!1,this.current=this.default,this.dirty=!1;};kl.prototype.get=function(){return this.current},kl.prototype.setDefault=function(){this.set(this.default);},kl.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1;}};var Sl=function(t){this.context=t,this.default=[0,1],this.current=this.default,this.dirty=!1;};Sl.prototype.get=function(){return this.current},Sl.prototype.setDefault=function(){this.set(this.default);},Sl.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&!0!==this.dirty||(this.context.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1);};var zl=function(t){this.context=t,this.default=!1,this.current=this.default,this.dirty=!1;};zl.prototype.get=function(){return this.current},zl.prototype.setDefault=function(){this.set(this.default);},zl.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1;}};var Bl=function(t){this.context=t,this.default=t.gl.LESS,this.current=this.default,this.dirty=!1;};Bl.prototype.get=function(){return this.current},Bl.prototype.setDefault=function(){this.set(this.default);},Bl.prototype.set=function(t){this.current===t&&!0!==this.dirty||(this.context.gl.depthFunc(t),this.current=t,this.dirty=!1);};var Tl=function(t){this.context=t,this.default=!1,this.current=this.default,this.dirty=!1;};Tl.prototype.get=function(){return this.current},Tl.prototype.setDefault=function(){this.set(this.default);},Tl.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1;}};var Ml=function(t){this.context=t,this.default=!1,this.current=this.default,this.dirty=!1;};Ml.prototype.get=function(){return this.current},Ml.prototype.setDefault=function(){this.set(this.default);},Ml.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1;}};var El=function(t){this.context=t;var e=this.context.gl;this.default=[e.ONE,e.ZERO],this.current=this.default,this.dirty=!1;};El.prototype.get=function(){return this.current},El.prototype.setDefault=function(){this.set(this.default);},El.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&!0!==this.dirty||(this.context.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1);};var Vl=function(t){this.context=t,this.default=ve.transparent,this.current=this.default,this.dirty=!1;};Vl.prototype.get=function(){return this.current},Vl.prototype.setDefault=function(){this.set(this.default);},Vl.prototype.set=function(t){var e=this.current;t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a&&!0!==this.dirty||(this.context.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1);};var Il=function(t){this.context=t,this.default=this.context.gl.FUNC_ADD,this.current=this.default,this.dirty=!1;};Il.prototype.get=function(){return this.current},Il.prototype.setDefault=function(){this.set(this.default);},Il.prototype.set=function(t){t===this.current&&!0!==this.dirty||(this.context.gl.blendEquation(t),this.current=t,this.dirty=!1);};var Cl=function(t){this.context=t,this.current=this.context.gl.CCW,this.default=this.context.gl.CCW,this.dirty=!1;};Cl.prototype.set=function(t){t!==this.current&&(this.context.gl.frontFace(t),this.current=t);},Cl.prototype.get=function(){return this.current||this.context.gl.CCW},Cl.prototype.setDefault=function(){this.set(this.default);};var Rl=function(t){this.context=t,this.default=null,this.current=this.default,this.dirty=!1;};Rl.prototype.get=function(){return this.current},Rl.prototype.setDefault=function(){this.set(this.default);},Rl.prototype.set=function(t){this.current===t&&!0!==this.dirty||(this.context.gl.useProgram(t),this.current=t,this.dirty=!1);};var Ll=function(t){this.context=t,this.default=t.gl.TEXTURE0,this.current=this.default,this.dirty=!1;};Ll.prototype.get=function(){return this.current},Ll.prototype.setDefault=function(){this.set(this.default);},Ll.prototype.set=function(t){this.current===t&&!0!==this.dirty||(this.context.gl.activeTexture(t),this.current=t,this.dirty=!1);};var Pl=function(t){this.context=t;var e=this.context.gl;this.default=[0,0,e.drawingBufferWidth,e.drawingBufferHeight],this.current=this.default,this.dirty=!1;};Pl.prototype.get=function(){return this.current},Pl.prototype.setDefault=function(){this.set(this.default);},Pl.prototype.set=function(t){var e=this.current;t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&!0!==this.dirty||(this.context.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1);};var Fl=function(t){this.context=t,this.default=null,this.current=this.default,this.dirty=!1;};Fl.prototype.get=function(){return this.current},Fl.prototype.setDefault=function(){this.set(this.default);},Fl.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1;}};var Ol=function(t){this.context=t,this.default=null,this.current=this.default,this.dirty=!1;};Ol.prototype.get=function(){return this.current},Ol.prototype.setDefault=function(){this.set(this.default);},Ol.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1;}};var Dl=function(t){this.context=t,this.default=null,this.current=this.default,this.dirty=!1;};Dl.prototype.get=function(){return this.current},Dl.prototype.setDefault=function(){this.set(this.default);},Dl.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1;}};var ql=function(t){this.context=t,this.default=null,this.current=this.default,this.dirty=!1;};ql.prototype.get=function(){return this.current},ql.prototype.setDefault=function(){this.set(this.default);},ql.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1;}};var Ul=function(t){this.context=t,this.default=null,this.current=this.default,this.dirty=!1;};Ul.prototype.get=function(){return this.current},Ul.prototype.setDefault=function(){this.set(this.default);},Ul.prototype.set=function(t){var e=this.context.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1;};var Nl=function(t){this.context=t,this.default=null,this.current=this.default,this.dirty=!1;};Nl.prototype.get=function(){return this.current},Nl.prototype.setDefault=function(){this.set(this.default);},Nl.prototype.set=function(t){(this.current!==t&&this.context.extVertexArrayObject||!0===this.dirty)&&(this.context.extVertexArrayObject.bindVertexArrayOES(t),this.current=t,this.dirty=!1);};var jl=function(t){this.context=t,this.default=4,this.current=this.default,this.dirty=!1;};jl.prototype.get=function(){return this.current},jl.prototype.setDefault=function(){this.set(this.default);},jl.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1;}};var Gl=function(t){this.context=t,this.default=!1,this.current=this.default,this.dirty=!1;};Gl.prototype.get=function(){return this.current},Gl.prototype.setDefault=function(){this.set(this.default);},Gl.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1;}};var Xl=function(t){this.context=t,this.default=!1,this.current=this.default,this.dirty=!1;};Xl.prototype.get=function(){return this.current},Xl.prototype.setDefault=function(){this.set(this.default);},Xl.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1;}};var Yl=function(t,e){this.context=t,this.default=null,this.current=this.default,this.dirty=!1,this.parent=e;};Yl.prototype.get=function(){return this.current};var Hl=function(t){function e(e,r){t.call(this,e,r),this.dirty=!1;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setDefault=function(){this.set(this.default);},e.prototype.set=function(t){if(this.dirty||this.current!==t){var e=this.context.gl;this.context.bindFramebuffer.set(this.parent),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1;}},e.prototype.setDirty=function(){this.dirty=!0;},e}(Yl),Zl=function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setDefault=function(){this.set(this.default);},e.prototype.set=function(t){if(this.current!==t||!0===this.dirty){var e=this.context.gl;this.context.bindFramebuffer.set(this.parent),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1;}},e}(Yl),$l=function(t){this.context=t,this.current=this.context.gl.BACK,this.default=this.context.gl.BACK,this.dirty=!1;};$l.prototype.set=function(t){t!==this.current&&(this.context.gl.cullFace(t),this.current=t);},$l.prototype.get=function(){return this.current},$l.prototype.setDefault=function(){this.set(this.default);};var Jl=function(t,e,r,i){this.context=t,this.width=e,this.height=r,this.depthPick=i||!1;var n=t.gl,a=this.framebuffer=n.createFramebuffer();this.colorAttachment=new Hl(t,a),this.depthAttachment=new Zl(t,a);};Jl.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();e&&t.deleteTexture(e);var r=this.depthAttachment.get();r&&(this.depthPick?t.deleteTexture(r):t.deleteRenderbuffer(r)),t.deleteFramebuffer(this.framebuffer);};var Kl=function(t,e,r){this.func=t,this.mask=e,this.range=r;};Kl.ReadOnly=!1,Kl.ReadWrite=!0,Kl.ALWAYS=519,Kl.disabled=new Kl(519,Kl.ReadOnly,[0,1]);var Wl=function(t,e,r,i,n,a){this.test=t,this.ref=e,this.mask=r,this.fail=i,this.depthFail=n,this.pass=a;};Wl.disabled=new Wl({func:519,mask:0},0,0,7680,7680,7680),Wl.enableClipGround=new Wl({func:519,mask:255},1,255,7680,7680,7681),Wl.openClipGround=new Wl({func:517,mask:255},1,0,7680,7680,7680);var Ql=function(t,e,r){this.blendFunction=t,this.blendColor=e,this.mask=r;};Ql.disabled=new Ql(Ql.Replace=[1,0],ve.transparent,[!1,!1,!1,!1]),Ql.unblended=new Ql(Ql.Replace,ve.transparent,[!0,!0,!0,!0]),Ql.alphaBlended=new Ql([1,771],ve.transparent,[!0,!0,!0,!0]);var th=function(t,e,r){this.enable=t,this.mode=e,this.frontFace=r;};th.disabled=new th(!1,1029,2305),th.backCCW=new th(!0,1029,2305);var eh=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ml(this),this.clearDepth=new gl(this),this.clearStencil=new vl(this),this.colorMask=new xl(this),this.depthMask=new bl(this),this.cullFace=new Tl(this),this.cullFaceSide=new $l(this),this.frontFace=new Cl(this),this.stencilMask=new _l(this),this.stencilFunc=new wl(this),this.stencilOp=new Al(this),this.stencilTest=new kl(this),this.depthRange=new Sl(this),this.depthTest=new zl(this),this.depthFunc=new Bl(this),this.blend=new Ml(this),this.blendFunc=new El(this),this.blendColor=new Vl(this),this.blendEquation=new Il(this),this.program=new Rl(this),this.activeTexture=new Ll(this),this.viewport=new Pl(this),this.bindFramebuffer=new Fl(this),this.bindRenderbuffer=new Ol(this),this.bindTexture=new Dl(this),this.bindVertexBuffer=new ql(this),this.bindElementBuffer=new Ul(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Nl(this),this.pixelStoreUnpack=new jl(this),this.pixelStoreUnpackPremultiplyAlpha=new Gl(this),this.pixelStoreUnpackFlipY=new Xl(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear"),this.extDepthTexture=t.getExtension("WEBGL_depth_texture"),this.extDepthTexture||t.getExtension("WEBKIT_WEBGL_depth_texture"),this.extElementIndexUint||t.getExtension("OES_element_index_uint");for(var e=t.getSupportedExtensions(),r=0;r<e.length;r++)"EXT_frag_depth"===e[r]&&(this.extFragDepth=t.getExtension("EXT_frag_depth"));};eh.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.cullFace.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0;},eh.prototype.createIndexBuffer=function(t,e){return new yl(this,t,e)},eh.prototype.createVertexBuffer=function(t,e,r){return new dl(this,t,e,r)},eh.prototype.createRenderbuffer=function(t,e,r){var i=this.gl,n=i.createRenderbuffer();return this.bindRenderbuffer.set(n),i.renderbufferStorage(i.RENDERBUFFER,t,e,r),this.bindRenderbuffer.set(null),n},eh.prototype.createFramebuffer=function(t,e,r){return new Jl(this,t,e,r||!1)},eh.prototype.clear=function(t){var e=t.color,r=t.depth,i=this.gl,n=0;e&&(n|=i.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==r&&(n|=i.DEPTH_BUFFER_BIT,this.clearDepth.set(r),this.depthMask.set(!0)),i.clear(n);},eh.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1);},eh.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1);},eh.prototype.setColorMode=function(t){c(t.blendFunction,Ql.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask);},eh.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace));},eh.prototype.czm_unpackDepth=function(t){return(t[0]+t[1]/255+t[2]/65025+t[3]/16581375)/255},eh.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null);};var rh=function(t,e){this.origin=void 0!==t?t:[0,0,0],this.direction=void 0!==e?e:[0,0,0];};rh.prototype.set=function(t,e){return J(this.origin,t),J(this.direction,e),this},rh.prototype.clone=function(){return new rh(this.origin,this.direction)},rh.prototype.copy=function(t){J(this.origin,t.origin),J(this.direction,t.direction);},rh.prototype.at=function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=[0,0,0]),J(e,this.direction),Q(e,e,t),K(e,e,this.origin),e},rh.prototype.lookAt=function(t){return J(this.direction,t),st(this.direction,this.direction,this.origin),rt(this.direction,this.direction),this},rh.prototype.closestPointToPoint=function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=[0,0,0]),st(e,t,this.origin);var r=it(e,this.direction);return r<0?J(e,this.origin):(J(e,this.direction),Q(e,e,r),K(e,e,this.origin),e)},rh.prototype.distanceToPoint=function(t){return Math.sqrt(this.distanceSqToPoint(t))},rh.prototype.distanceSqToPoint=function(){var t=[0,0,0],e=it(st(t,point,this.origin),this.direction);return e<0?et(this.origin,point):(J(t,this.direction),Q(t,t,e),K(t,t,this.origin),et(t,point))},rh.prototype.distanceSqToSegment=function(t,e,r,i){var n=[0,0,0],a=[0,0,0],o=[0,0,0];n.copy(t).add(e).multiplyScalar(.5),a.copy(e).sub(t).normalize(),o.copy(this.origin).sub(n);var s,u,p,l,h=.5*t.distanceTo(e),c=-this.direction.dot(a),y=o.dot(this.direction),f=-o.dot(a),d=o.lengthSq(),m=Math.abs(1-c*c);if(m>0)if(u=c*y-f,l=h*m,(s=c*f-y)>=0)if(u>=-l)if(u<=l){var g=1/m;p=(s*=g)*(s+c*(u*=g)+2*y)+u*(c*s+u+2*f)+d;}else u=h,p=-(s=Math.max(0,-(c*u+y)))*s+u*(u+2*f)+d;else u=-h,p=-(s=Math.max(0,-(c*u+y)))*s+u*(u+2*f)+d;else u<=-l?p=-(s=Math.max(0,-(-c*h+y)))*s+(u=s>0?-h:Math.min(Math.max(-h,-f),h))*(u+2*f)+d:u<=l?(s=0,p=(u=Math.min(Math.max(-h,-f),h))*(u+2*f)+d):p=-(s=Math.max(0,-(c*h+y)))*s+(u=s>0?h:Math.min(Math.max(-h,-f),h))*(u+2*f)+d;else u=c>0?-h:h,p=-(s=Math.max(0,-(c*u+y)))*s+u*(u+2*f)+d;return r&&r.copy(this.direction).multiplyScalar(s).add(this.origin),i&&i.copy(a).multiplyScalar(u).add(n),p},rh.prototype.intersectSphere=function(t,e){var r=[0,0,0];st(r,t.center,this.origin);var i=it(r,this.direction),n=it(r,r)-i*i,a=t.radius*t.radius;if(n>a)return null;var o=Math.sqrt(a-n),s=i-o,u=i+o;return s<0&&u<0?null:s<0?this.at(u,e):this.at(s,e)},rh.prototype.intersectsSphere=function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},rh.prototype.distanceToPlane=function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var r=-(this.origin.dot(t.normal)+t.constant)/e;return r>=0?r:null},rh.prototype.intersectPlane=function(t,e){var r=this.distanceToPlane(t);return null===r?null:this.at(r,e)},rh.prototype.intersectsPlane=function(t){var e=t.distanceToPoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},rh.prototype.intersectBox=function(t,e){var r,i,n,a,o,s,u=1/this.direction[0],p=1/this.direction[1],l=1/this.direction[2],h=this.origin;return u>=0?(r=(t[0][0]-h[0])*u,i=(t[1][0]-h[0])*u):(r=(t[1][0]-h[0])*u,i=(t[0][0]-h[0])*u),p>=0?(n=(t[0][1]-h[1])*p,a=(t[1][1]-h[1])*p):(n=(t[1][1]-h[1])*p,a=(t[0][1]-h[1])*p),r>a||n>i?null:((n>r||r!=r)&&(r=n),(a<i||i!=i)&&(i=a),l>=0?(o=(t[0][2]-h[2])*l,s=(t[1][2]-h[2])*l):(o=(t[1][2]-h[2])*l,s=(t[0][2]-h[2])*l),r>s||o>i?null:((o>r||r!=r)&&(r=o),(s<i||i!=i)&&(i=s),i<0?null:this.at(r>=0?r:i,e)))},rh.prototype.intersectTriangle=function(t,e,r,i,n){var a=[0,0,0],o=[0,0,0],s=[0,0,0],u=[0,0,0];st(o,e,t),st(s,r,t),nt(u,o,s);var p,l=it(this.direction,u);if(l>0){if(i)return null;p=1;}else{if(!(l<0))return null;p=-1,l=-l;}st(a,this.origin,t);var h=p*it(this.direction,nt(s,a,s));if(h<0)return null;var c=p*it(this.direction,nt(o,o,a));if(c<0)return null;if(h+c>l)return null;var y=-p*it(a,u);return y<0?null:this.at(y/l,n)},rh.prototype.applyMatrix4=function(t){return ft(this.origin,this.origin,t),ft(this.direction,this.direction,t),this},rh.prototype.equals=function(t){return t.origin===this.origin&&t.direction===this.direction};var ih=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null;};ih.prototype.bind=function(t,e,r,i,n,a,o,s){this.context=t;for(var u=this.boundPaintVertexBuffers.length!==i.length,p=0;!u&&p<i.length;p++)this.boundPaintVertexBuffers[p]!==i[p]&&(u=!0);var l=!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==r||u||this.boundIndexBuffer!==n||this.boundVertexOffset!==a||this.boundDynamicVertexBuffer!==o||this.boundDynamicVertexBuffer2!==s;!t.extVertexArrayObject||l?this.freshBind(e,r,i,n,a,o,s):(t.bindVertexArrayOES.set(this.vao),o&&o.bind(),n&&n.dynamicDraw&&n.bind(),s&&s.bind());},ih.prototype.freshBind=function(t,e,r,i,n,a,o){var s,u=t.numAttributes,p=this.context,l=p.gl;if(p.extVertexArrayObject)this.vao&&this.destroy(),this.vao=p.extVertexArrayObject.createVertexArrayOES(),p.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=i,this.boundVertexOffset=n,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=o;else{s=p.currentNumAttributes||0;for(var h=u;h<s;h++)l.disableVertexAttribArray(h);}e.enableAttributes(l,t);for(var c=0,y=r;c<y.length;c+=1){y[c].enableAttributes(l,t);}a&&a.enableAttributes(l,t),o&&o.enableAttributes(l,t),e.bind(),e.setVertexAttribPointers(l,t,n);for(var f=0,d=r;f<d.length;f+=1){var m=d[f];m.bind(),m.setVertexAttribPointers(l,t,n);}a&&(a.bind(),a.setVertexAttribPointers(l,t,n)),i&&i.bind(),o&&(o.bind(),o.setVertexAttribPointers(l,t,n)),p.currentNumAttributes=u;},ih.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null);},ih.prototype.remove=function(){this.destroy(),this.context=null,this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=null,this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.boundDynamicVertexBuffer2=null;};var nh=function(t,e,r,i,n,a,o,s){this.tileID=t,this.uid=_(),this.uses=0,this.expirationTime=null,this.queryPadding=0,this.childJson=e,this.expiredRequestCount=0,this.state="loading",this.projType=r||Ko.MERCATOR,this.isRaster=i||!1,this.meshes=[],this.textures=[],this.materials=[],this.result={},this.modelFolder=n,this.modelType=a||Pt.MODEL_TYPE.OSGB,this.sharedTexture=o,this.identityMatrix=!0,this.noHighlighting=s||!1,this.vao=new ih,this.finishedImages=0;};nh.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<a.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e);},nh.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},nh.prototype.loadVectorData=function(t){this.result=t,this.state="data-down-finished";},nh.prototype.unloadVectorData=function(){if(this.meshes){for(var t=null,e=null,r=0;r<this.meshes.length;r++){var i=this.meshes[r];t||(t=i.gltfIndexBuffer,e=i.gltfVertexBuffer),i.gltfIndexBuffer=null,i.gltfVertexBuffer=null;}t&&(t.destroy(),e.destroy());for(var n=0;n<this.textures.length;n++)this.sharedTexture&&this.sharedTexture.removeATexture(this.textures[n]);this.meshes=[],this.textures=[],this.materials=[];}this.sharedTexture=null,this.childJson=null,this.matrix=null,this.result.bufferData=[],this.result=null,this.vao.remove(),this.vao=null,this.state="unloaded";},nh.prototype.upload=function(t,e){this._processGLBuffers(this.result,t,e);},nh.prototype._processGLBuffers=function(t,e,r){if("data-down-finished"!==this.state&&console.log(this.state,"非法解析"),t&&t.gltf&&"data-down-finished"===this.state){var i=t.gltf;!this.matrix&&i.nodes[i.scenes[i.scene].nodes[0]].matrix?(this.matrix=i.nodes[0].matrix,this.identityMatrix=!1):this.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.samplers=i.samplers||[{magFilter:9729,minFilter:9986,wrapS:10497,wrapT:10497}],this.state="parsing",function(t,e,r,i,n){for(var a=[],o=[],s=t.scenes[0].name,u=function(n){for(var u=t.nodes[n],p=(u.extras,u.mesh||0),l=[],h=void 0,c=function(u){var c={},y=!!(t.meshes[p].primitives[u].targets&&t.meshes[p].primitives[u].targets.length>0),f=al(t,p,u,c,y),d=t.meshes[p].primitives[u].indices,m=t.accessors[d],g=t.bufferViews[m.bufferView];a[g.buffer]?h=new cl(e,r[g.buffer],f.members,!1,a[g.buffer]):(h=new cl(e,r[g.buffer],f.members,!1),a[g.buffer]=h.getBuffer());var v=t.meshes[p].primitives[u].attributes.POSITION,x=t.accessors[v],b=x?[x.min.concat(1),x.max.concat(1)]:[],_=t.meshes[p].primitives[u].mode,w=t.meshes[p].primitives[u].material||0,A=void 0,k=(m.byteOffset?m.byteOffset:0)+(g.byteOffset?g.byteOffset:0),S=m.componentType,z=m.count;c.IB={offset:k,byteStride:2,count:z,type:S},o[g.buffer]?A=new hl(e,r[g.buffer],void 0===_?e.gl.TRIANGLES:_,z,S,k,!1,o[g.buffer]):(A=new hl(e,r[g.buffer],void 0===_?e.gl.TRIANGLES:_,z,S,k,!1),o[g.buffer]=A.getBuffer());var B=null;t.animations&&t.animations.length>0&&i.animations.map(function(t,e){return t.channels.map(function(t,r){return n===t.node&&(B={ani:e,cha:r}),null})}),i.meshes.push({gltfVertexBuffer:h,gltfIndexBuffer:A,matrix:null,material:w,aabb:b,location:l,identityMatrix:!0,intersectOptions:{bufViewBufferIndex:g.buffer,bufferDataConfig:c,triangleData:[],placedTriangleData:[]},animation:B,isSkinModel:y,properties:{name:"",sceneName:s}}),t.asset.range&&(i.range=t.asset.range);},y=0;y<t.meshes[p].primitives.length;y++)c(y);},p=0;p<t.nodes.length;p++)u(p);}(i,e,t.bufferData,this,r._featureFilter),function(t,e,r,i){var n=t.textures,o=e.gl;if(!t.materials)return;for(var s=t.materials,u=0;u<s.length;u++){var p=s[u],l={baseColorFactor:p.pbrMetallicRoughness.baseColorFactor?p.pbrMetallicRoughness.baseColorFactor:null,baseColorTexture:{index:p.pbrMetallicRoughness.baseColorTexture?p.pbrMetallicRoughness.baseColorTexture.index:Pt.SOURCE.ERROR_IMG_INDEX},alphaMode:p.alphaMode||"OPAQUE",doubleSided:p.doubleSided||!1,materialParams:null,sampler:0};t.textures&&t.textures.length>0&&(l.sampler=t.textures[p.pbrMetallicRoughness.baseColorTexture?p.pbrMetallicRoughness.baseColorTexture.index:0].sampler),p.materialParams&&(l.materialParams=p.materialParams),r.materials.push(l);}if(!t.images)return void(r&&(r.state="loaded"));if(r instanceof nh)for(var h=0;h<n.length;h++){var c=t.images[n[h].source].uri,y=t.nodes[0].name,f=r.modelType===Pt.MODEL_TYPE.OSGB?r.modelFolder+"/"+oh(y,i)+"/"+c:r.modelFolder+"/"+c;c=a.resolveURL(f),r.textures[h]=t.images[n[h].source].uri,r.sharedTexture.addATexture(t.images[n[h].source].uri,c,e,r);}else for(var d=function(i){var a,s,u=t.images[n[i].source].uri;if(u.startsWith("data:image")){var p=new Image;p.onload=function(){var t=new ll(e,p,o.RGBA,{useMipmap:!0});t.bind(o.LINEAR,o.CLAMP_TO_EDGE),r.textures[i]=t;},p.src=u;}else s=i,Gt((a=r).map._transformRequest(r.modelFolder+"\\"+u,Dt.Image),function(t,r){if(t)a.fire(new Zt(t));else if(r){var i=new ll(e,r,o.RGBA,{useMipmap:!0});i.bind(o.LINEAR,o.CLAMP_TO_EDGE),a.textures[s]=i;}});},m=0;m<n.length;m++)d(m);}(i,e,this,r),r.fire(new Ht("data",{data:"dataContext.state = 'loaded';"}));}},nh.prototype.queryRenderedFeatures=function(t,e,r,i,n,a){for(var o=[],s=[],u=1/0,p=0;p<this.meshes.length;p++)for(var l=this.meshes[p],h=uh(a._source,a._source,this,l.aabb),c=0;c<h.length;c++){var y=n.intersectTriangle.apply(n,h[c].concat([!1],[[]]));if(y){for(var f=lh(this.result.bufferData[l.intersectOptions.bufViewBufferIndex],l.intersectOptions.bufferDataConfig),d=sh(a._source,a._source,this,f),m=0;m<d.length;m++){var g=n.intersectTriangle.apply(n,d[m].concat([!1],[[]]));if(g){var v=ut(n.origin,g);v<u&&(s=g,u=v,o[0]=this.meshes[p]);}}d=null;}y=null;}return o[0]?[{_parent:this,properties:Object.assign({},o[0].properties),intersectionPoint:s,intersectionZ:u}]:o},nh.prototype.highlightMesh=function(t){if(this.clearPick(),!this.noHighlighting)for(var e=0;e<this.meshes.length;e++)this.meshes[e].properties.name===t.properties.name&&(this.meshes[e].highlight=!0);},nh.prototype.clearPick=function(){for(var t=0;t<this.meshes.length;t++)this.meshes[t].highlight=!1;},nh.prototype.querySourceFeatures=function(){},nh.prototype.clearMask=function(){},nh.prototype.setMask=function(t,e){},nh.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},nh.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var r=V(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"]);}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var i=Date.now(),n=!1;if(this.expirationTime>i)n=!1;else if(e)if(this.expirationTime<e)n=!0;else{var a=this.expirationTime-e;a?this.expirationTime=i+Math.max(a,Pt.SOURCE.CLOCK_SKEW_RETRY_TIMEOUT):n=!0;}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0;}},nh.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},nh.prototype.setFeatureState=function(t,e){};var ah=[[1,3,2],[1,4,3],[1,2,5],[2,6,5],[2,3,6],[3,7,6],[5,6,8],[8,6,7],[1,5,4],[4,5,8],[3,4,8],[3,8,7]];function oh(t,e){for(var r=t.split("/"),i=0;i<r.length;i++)for(var n in e.tileJson.chd){var a=n.substring(0,n.lastIndexOf("~00"));if(r[i]===a)return a}}function sh(t,e,r,i){var n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];t.respectiveTransformation||vu(t.tileJson&&"osgb"===t.tileJson.type,e,n),t.respectiveTransformation&&vu(t.tileJson&&"osgb"===t.tileJson.type,r,n);var a=[],o=_u(n);if(r.identityMatrix||Y(o,o,r.matrix),e.identityMatrix||Y(o,o,e.matrix),i)for(var s=0;s<i.length;s++)a.push([ft([],i[s][0].concat([1]),o),ft([],i[s][1].concat([1]),o),ft([],i[s][2].concat([1]),o)]);return a}function uh(t,e,r,i){var n=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];t.respectiveTransformation||vu(t.tileJson&&"osgb"===t.tileJson.type,e,n),t.respectiveTransformation&&vu(t.tileJson&&"osgb"===t.tileJson.type,r,n);var a=_u(n);r.identityMatrix||Y(a,a,r.matrix),e.identityMatrix||Y(a,a,e.matrix);for(var o=[[i[0][0],i[0][1],i[0][2],1],[i[0][0],i[0][1],i[1][2],1],[i[1][0],i[0][1],i[1][2],1],[i[1][0],i[0][1],i[0][2],1],[i[0][0],i[1][1],i[0][2],1],[i[0][0],i[1][1],i[1][2],1],[i[1][0],i[1][1],i[1][2],1],[i[1][0],i[1][1],i[0][2],1]],s=[],u=0;u<8;u++)s.push(ft([],o[u],a));for(var p=[],l=0;l<ah.length;l++){var h=ah[l];p.push([s[h[0]-1],s[h[1]-1],s[h[2]-1]]);}return p}function ph(t,e){if(t.result&&t.result.gltf){var r=t.result.gltf;e.matrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t.respectiveTransformation||(e.rotation&&e.rotation[0]&&(e.identityMatrix=!1,N(e.matrix,e.matrix,e.rotation[0]*Pt.TRANSFORM.DEG_TO_RAD)),e.rotation&&e.rotation[1]&&(e.identityMatrix=!1,j(e.matrix,e.matrix,e.rotation[1]*Pt.TRANSFORM.DEG_TO_RAD)),e.rotation&&e.rotation[2]&&(e.identityMatrix=!1,G(e.matrix,e.matrix,e.rotation[2]*Pt.TRANSFORM.DEG_TO_RAD)),!e.scale||3!==e.scale.length||1===e.scale[0]&&1===e.scale[1]&&1===e.scale[2]||(e.identityMatrix=!1,U(e.matrix,e.matrix,e.scale)),r.nodes[r.scenes[r.scene||0].nodes[0]].matrix&&(e.identityMatrix=!1,Y(e.matrix,r.nodes[0].matrix,e.matrix)));}}function lh(t,e){try{var r=new DataView(t.buffer),i=e.IB,n=e.VB;if(void 0===n)return[[[0,0,0],[0,0,0],[0,0,0]]];for(var a=[],o=0;o<i.count;o+=3){var s=void 0,u=void 0,p=void 0;5121===i.type?(s=r.getUint8(i.offset+o),u=r.getUint8(i.offset+o+1),p=r.getUint8(i.offset+o+2)):5123===i.type?(s=r.getUint16(i.offset+2*o,!0),u=r.getUint16(i.offset+2*(o+1),!0),p=r.getUint16(i.offset+2*(o+2),!0)):(s=r.getUint32(i.offset+4*o,!0),u=r.getUint32(i.offset+4*(o+1),!0),p=r.getUint32(i.offset+4*(o+2),!0));var l=r.getFloat32(n.offset+s*n.byteStride,!0),h=r.getFloat32(n.offset+s*n.byteStride+4,!0),c=r.getFloat32(n.offset+s*n.byteStride+8,!0),y=r.getFloat32(n.offset+u*n.byteStride,!0),f=r.getFloat32(n.offset+u*n.byteStride+4,!0),d=r.getFloat32(n.offset+u*n.byteStride+8,!0),m=r.getFloat32(n.offset+p*n.byteStride,!0),g=r.getFloat32(n.offset+p*n.byteStride+4,!0),v=r.getFloat32(n.offset+p*n.byteStride+8,!0);a.push([[l,h,c],[y,f,d],[m,g,v]]);}return r=null,a}catch(t){return[[[0,0,0],[0,0,0],[0,0,0]]]}}var hh=function(t){function e(e){if(t.call(this,e,Hp),this.baseMatrixCalculated=!1,this.useLayerPosition=!1,this.respectiveTransformation=!1,this.boolAABBCalculated=!1,this.identityMatrix=!0,this.highLightColorsIndex=0,this.matrix=[],this.isSpecialLight=!!e.isSpecialLight,e.translation&&(this.translation=e.translation,this.useLayerPosition=!0),e.rotation&&(this.rotation=e.rotation,this.useLayerPosition=!0),e.scale&&(this.scale=e.scale,this.useLayerPosition=!0),e.location)this.location=e.location,this.useLayerPosition=!0;else if(this.useLayerPosition)throw new Error("3d_model_style_layer,constructor(): 不允许图层在未设置经纬度参考点的情况下，设置其他的空间变换参数，即一旦想要进行按照layer图层进行空间变化，那么position是必须的");if(Array.isArray(e.highLightColors)){this.highLightColors=[];for(var r=0,i=e.highLightColors||[];r<i.length;r+=1){var n=i[r];this.highLightColors.push(ve.parse(n));}}"number"!=typeof e.highLightColorsIndex||isNaN(e.highLightColorsIndex)||(this.highLightColorsIndex=e.highLightColorsIndex),this.nodes=[],this.meshes=[],this.primitives=[],this.isSpecialLight=e.isSpecialLight||!1,this.specialLights=null,this.isSpecialLight&&this.setSpecialLights(e.specialLights||[]),e.hasOwnProperty("viewshed-render")?this.viewshedRender=!!e["viewshed-render"]:this.viewshedRender=!0;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.calcBaseMatrix=function(t,e){if(!this.baseMatrixCalculated||e){ph(t,this);for(var r=0;r<t.nodes.length;r++)this.nodes.push(t.nodes[r]);this.baseMatrixCalculated=!0;}},e.prototype.queryLayerRenderedFeatures=function(t,e,r,i,n,a){var o=a.getSource();this.clearPick();for(var s=[],u=1/0,p=[],l=0;l<this.nodes.length;l++){var h=this.nodes[l],c=o.meshes[this.nodes[l].mesh];if(h.primitiveStack)for(var y=0;y<c.primitivesInd.length;y++){for(var f=o.primitives[c.primitivesInd[y]],d=uh(o,this,h,f.aabb),m=0;m<d.length;m++){if(n.intersectTriangle.apply(n,d[m].concat([!1],[[]]))){for(var g=sh(o,this,h,lh(o.gltfParser.bufferData[f.intersectOptions.bufViewBufferIndex],f.intersectOptions.bufferDataConfig)),v=0;v<g.length;v++){var x=n.intersectTriangle.apply(n,g[v].concat([!1],[[]]));if(x){var b=ut(n.origin,x);b<u&&(p=x,u=b,s[0]=h.primitiveStack[y]);}}g=null;}}d=null;}}return s[0]?[{_parent:this,primitiveData:s[0],intersectionZ:u,intersectionPoint:p,layer:this.id}]:s},e.prototype.clearPick=function(t){for(var e=0;e<this.nodes.length;e++){var r=this.nodes[e];if(r.primitiveStack)for(var i=0;i<r.primitiveStack.length;i++){r.primitiveStack[i].highlight=!1;}}t&&t.fire(new Ht("data",{}));},e.prototype.highlightMesh=function(t){this.clearPick();for(var e=0;e<this.nodes.length;e++){var r=this.nodes[e];if(r.primitiveStack)for(var i=0;i<r.primitiveStack.length;i++){var n=r.primitiveStack[i];n.primitiveDataInd===t.primitiveData.primitiveDataInd&&(n.highlight=!0);}}},e.prototype.setSpecialLights=function(t){this.specialLights=[];for(var e=0;e<t.length;e++){var r=t[e],i=yu([],r.position,Pt.TRANSFORM.R+(r.position[2]||0)*Pt.TRANSFORM.R_SCALE),n=yu([],r.direction,Pt.TRANSFORM.R+(r.direction[2]||0)*Pt.TRANSFORM.R_SCALE),a=[i[0]-n[0],i[1]-n[1],i[2]-n[2]];r.position=i,r.direction=a,this.specialLights.push(r);}},e.prototype.setHighlightIndex=function(t){"number"!=typeof t||isNaN(t)||(this.highLightColorsIndex=t);},e}(dn),ch={paint:new fn({"3d-tile-opacity":new ln(Jt["paint_3d-tile"]["3d-tile-opacity"])})},yh=function(t){function e(e){t.call(this,e,ch),e.hasOwnProperty("viewshed-render")?this.viewshedRender=!!e["viewshed-render"]:this.viewshedRender=!0,e.hasOwnProperty("cvtBGR2RGB")?this.cvtBGR2RGB=!!e.cvtBGR2RGB:this.cvtBGR2RGB=!1;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(dn),fh=xn([{name:"a_pos_normal",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_extra_m",components:3,type:"Uint8"},{name:"a_i_p_e",components:2,type:"Uint16"}],4).members,dh=ss.VectorTileFeature.types,mh=63,gh=Math.cos(Math.PI/180*37.5),vh=.5,xh=Math.pow(2,14)/vh,bh=0,_h=0,wh=1,Ah=0;function kh(t,e,r,i,n,a,o){t.emplaceBack(e.x,e.y,i?1:0,n?1:-1,Math.round(mh*r.x)+128,Math.round(mh*r.y)+128,1+(0===a?0:a<0?-1:1)|(o*vh&63)<<2,o*vh>>6,255&bh,parseInt(_h),parseInt(wh),parseInt(0===e.z?0:e.z-500<6?6:e.z-500+6),parseInt(Ah));}var Sh=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Mn,this.indexArray=new Jn,this.programConfigurations=new va(fh,t.layers,t.zoom),this.segments=new ha;};Sh.prototype.populate=function(t,e){for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new tn(this.zoom),a)){var u=Aa(a);this.addFeature(a,u,o),e.featureIndex.insert(a,u,o,s,this.index);}}},Sh.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},Sh.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Sh.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Sh.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,fh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},Sh.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},Sh.prototype.addFeature=function(t,e,r){var i=this.layers[0].layout,n=i.get("sprite-join").evaluate(t,{}),a=i.get("sprite-cap"),o=i.get("sprite-miter-limit"),s=i.get("sprite-round-limit");_h=t.properties.link_seq?Number(t.properties.link_seq):_h,_h%=10,wh=Number(t.properties.status)||1,Ah=100*Number(t.properties.link_seq)/Number(t.properties.total)||1;for(var u=0,p=e;u<p.length;u+=1){var l=p[u];this.addLine(l,t,n,a,o,s,r);}},Sh.prototype.addLine=function(t,e,r,i,n,a,o){for(var s="Polygon"===dh[e.type],u=t.length;u>=2&&t[u-1].equals(t[u-2]);)u--;for(var p=0;p<u-1&&t[p].equals(t[p+1]);)p++;if(!(u<(s?3:2))){"bevel"===r&&(n=1.05);var l=ba/(512*this.overscaling)*15,h=t[p],c=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray);this.distance=0;var y,f,d,m=i,g=s?"butt":i,v=!0,x=void 0,b=void 0,_=void 0,w=void 0;this.e1=this.e2=this.e3=-1,s&&(y=t[u-2],w=h.sub(y)._unit()._perp());for(var A=p;A<u;A++)if(bh=Math.round(255/u*A),!(b=s&&A===u-1?t[p+1]:t[A+1])||!t[A].equals(b)){w&&(_=w),y&&(x=y),y=t[A],w=b?b.sub(y)._unit()._perp():_;var k=(_=_||w).add(w);0===k.x&&0===k.y||k._unit();var S=k.x*w.x+k.y*w.y,z=0!==S?1/S:1/0,B=S<gh&&x&&b;if(B&&A>p){var T=y.dist(x);if(T>2*l){var M=y.sub(y.sub(x)._mult(l/T)._round());this.distance+=M.dist(x),this.addCurrentVertex(M,this.distance,_.mult(1),0,0,!1,c),x=M;}}var E=x&&b,V=E?r:b?m:g;if(E&&"round"===V&&(z<a?V="miter":z<=2&&(V="fakeround")),"miter"===V&&z>n&&(V="bevel"),"bevel"===V&&(z>2&&(V="flipbevel"),z<n&&(V="miter")),x&&(this.distance+=y.dist(x)),"miter"===V)k._mult(z),this.addCurrentVertex(y,this.distance,k,0,0,!1,c);else if("flipbevel"===V){if(z>100)k=w.clone().mult(-1);else{var I=_.x*w.y-_.y*w.x>0?-1:1,C=z*_.add(w).mag()/_.sub(w).mag();k._perp()._mult(C*I);}this.addCurrentVertex(y,this.distance,k,0,0,!1,c),this.addCurrentVertex(y,this.distance,k.mult(-1),0,0,!1,c);}else if("bevel"===V||"fakeround"===V){var R=_.x*w.y-_.y*w.x>0,L=-Math.sqrt(z*z-1);if(R?(d=0,f=L):(f=0,d=L),v||this.addCurrentVertex(y,this.distance,_,f,d,!1,c),"fakeround"===V){for(var P=Math.floor(8*(.5-(S-.5))),F=void 0,O=0;O<P;O++)F=w.mult((O+1)/(P+1))._add(_)._unit(),this.addPieSliceVertex(y,this.distance,F,R,c);this.addPieSliceVertex(y,this.distance,k,R,c);for(var D=P-1;D>=0;D--)F=_.mult((D+1)/(P+1))._add(w)._unit(),this.addPieSliceVertex(y,this.distance,F,R,c);}b&&this.addCurrentVertex(y,this.distance,w,-f,-d,!1,c);}else"butt"===V?(v||this.addCurrentVertex(y,this.distance,_,0,0,!1,c),b&&this.addCurrentVertex(y,this.distance,w,0,0,!1,c)):"square"===V?(v||(this.addCurrentVertex(y,this.distance,_,1,1,!1,c),this.e1=this.e2=-1),b&&this.addCurrentVertex(y,this.distance,w,-1,-1,!1,c)):"round"===V&&(v||(this.addCurrentVertex(y,this.distance,_,0,0,!1,c),this.addCurrentVertex(y,this.distance,_,1,1,!0,c),this.e1=this.e2=-1),b&&(this.addCurrentVertex(y,this.distance,w,-1,-1,!0,c),this.addCurrentVertex(y,this.distance,w,0,0,!1,c)));if(B&&A<u-1){var q=y.dist(b);if(q>2*l){var U=y.add(b.sub(y)._mult(l/q)._round());this.distance+=U.dist(y),this.addCurrentVertex(U,this.distance,w.mult(1),0,0,!1,c),y=U;}}v=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o);}},Sh.prototype.addCurrentVertex=function(t,e,r,i,n,a,o){var s,u=this.layoutVertexArray,p=this.indexArray;s=r.clone(),i&&s._sub(r.perp()._mult(i)),kh(u,t,s,a,!1,i,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,s=r.mult(-1),n&&s._sub(r.perp()._mult(n)),kh(u,t,s,a,!0,-n,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>xh/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,r,i,n,a,o));},Sh.prototype.addPieSliceVertex=function(t,e,r,i,n){r=r.mult(i?-1:1);var a=this.layoutVertexArray,o=this.indexArray;kh(a,t,r,!1,i,0,e),this.e3=n.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),n.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3;},Fi("SpriteBucket",Sh,{omit:["layers"]});var zh=new fn({"sprite-cap":new ln(Jt.layout_sprite["sprite-cap"]),"sprite-join":new hn(Jt.layout_sprite["sprite-join"]),"sprite-miter-limit":new ln(Jt.layout_sprite["sprite-miter-limit"]),"sprite-round-limit":new ln(Jt.layout_sprite["sprite-round-limit"])}),Bh={paint:new fn({"sprite-opacity":new hn(Jt.paint_sprite["sprite-opacity"]),"sprite-color":new hn(Jt.paint_sprite["sprite-color"]),"sprite-translate":new ln(Jt.paint_sprite["sprite-translate"]),"sprite-translate-anchor":new ln(Jt.paint_sprite["sprite-translate-anchor"]),"sprite-width":new hn(Jt.paint_sprite["sprite-width"]),"sprite-gap-width":new hn(Jt.paint_sprite["sprite-gap-width"]),"sprite-offset":new hn(Jt.paint_sprite["sprite-offset"]),"sprite-blur":new hn(Jt.paint_sprite["sprite-blur"]),"sprite-speed-factor":new ln(Jt.paint_sprite["sprite-speed-factor"]),"render-3d":new ln(Jt.paint_sprite["render-3d"]),"sprite-interpolate":new ln(Jt.paint_sprite["sprite-interpolate"]),"sprite-status":new hn(Jt.paint_sprite["sprite-status"]),"sprite-instatus":new hn(Jt.paint_sprite["sprite-instatus"]),"sprite-height-offset":new ln(Jt.paint_sprite["sprite-height-offset"])}),layout:zh},Th=new(function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new tn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,i,n){return r=x({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,i,n)},e}(hn))(Bh.paint.properties["sprite-width"].specification);Th.useIntegerZoom=!0;var Mh=function(t){function e(e){t.call(this,e,Bh);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["sprite-floorwidth"]=Th.possiblyEvaluate(this._transitioningPaint._values["sprite-width"].value,e);},e.prototype.createBucket=function(t){return new Sh(t)},e.prototype.queryRadius=function(t){var e=t,r=Eh(Oa("sprite-width",this,e),Oa("sprite-gap-width",this,e)),i=Oa("sprite-offset",this,e);return r/2+Math.abs(i)+Da(this.paint.get("sprite-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,a,o){var s=qa(t,this.paint.get("sprite-translate"),this.paint.get("sprite-translate-anchor"),a.angle,o),u=o/2*Eh(this.paint.get("sprite-width").evaluate(e,r),this.paint.get("sprite-gap-width").evaluate(e,r)),p=this.paint.get("sprite-offset").evaluate(e,r);return p&&(i=function(t,e){for(var r=[],i=new l(0,0),n=0;n<t.length;n++){for(var a=t[n],o=[],s=0;s<a.length;s++){var u=a[s-1],p=a[s],h=a[s+1],c=0===s?i:p.sub(u)._unit()._perp(),y=s===a.length-1?i:h.sub(p)._unit()._perp(),f=c._add(y)._unit(),d=f.x*y.x+f.y*y.y;f._mult(1/d),o.push(f._mult(e)._add(p));}r.push(o);}return r}(i,p*o)),Ma(s,i,u)},e}(dn);function Eh(t,e){return e>0?e+2*t:t}var Vh=xn([{name:"a_pos",components:3,type:"Float32"},{name:"a_normal",components:2,type:"Int8"},{name:"a_data",components:4,type:"Uint8"},{name:"a_extra_m",components:3,type:"Uint8"}],4).members,Ih=ss.VectorTileFeature.types,Ch=63,Rh=Math.cos(Math.PI/180*37.5),Lh=.5,Ph=Math.pow(2,14)/Lh,Fh=0,Oh=0,Dh=1;function qh(t,e,r,i,n,a,o){t.emplaceBack(e.x,e.y,e.z,i?1:0,n?1:-1,Math.round(Ch*r.x)+128,Math.round(Ch*r.y)+128,1+(0===a?0:a<0?-1:1)|(o*Lh&63)<<2,o*Lh>>6,255&Fh,parseInt(Oh),parseInt(Dh));}var Uh=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new Cn,this.indexArray=new Jn,this.programConfigurations=new va(Vh,t.layers,t.zoom),this.segments=new ha,this.projection=t.projection||Ko.MERCATOR;};Uh.prototype.populate=function(t,e){this.tilePlane||(this.x=e.x,this.y=e.y,this.z=e.z,this.zPow=Math.pow(2,this.z),this.tilePlane=gu(this.x,this.y,this.z,this.projection));for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new tn(this.zoom),a)){var u=Aa(a);this.addFeature(a,u,o),e.featureIndex.insert(a,u,o,s,this.index);}}},Uh.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},Uh.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Uh.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Uh.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},Uh.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},Uh.prototype.addFeature=function(t,e,r){var i=this.layers[0].layout,n=i.get("sprite-join").evaluate(t,{}),a=i.get("sprite-cap"),o=i.get("sprite-miter-limit"),s=i.get("sprite-round-limit");Oh=t.properties.link_seq?Number(t.properties.link_seq):Oh,Oh%=10,Dh=Number(t.properties.status)||1,100*Number(t.properties.link_seq)/Number(t.properties.total)||1;for(var u=0,p=e;u<p.length;u+=1){var l=p[u];this.addLine(l,t,n,a,o,s,r);}},Uh.prototype.addLine=function(t,e,r,i,n,a,o){for(var s="Polygon"===Ih[e.type],u=t.length;u>=2&&t[u-1].equals(t[u-2]);)u--;for(var p=0;p<u-1&&t[p].equals(t[p+1]);)p++;if(!(u<(s?3:2))){"bevel"===r&&(n=1.05);var l=ba/(512*this.overscaling)*15,h=t[p],c=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray);this.distance=0;var y,f,d,m=i,g=s?"butt":i,v=!0,x=void 0,b=void 0,_=void 0,w=void 0;this.e1=this.e2=this.e3=-1,s&&(y=t[u-2],w=h.sub(y)._unit()._perp());for(var A=p;A<u;A++)if(Fh=Math.round(255/u*A),!(b=s&&A===u-1?t[p+1]:t[A+1])||!t[A].equals(b)){w&&(_=w),y&&(x=y),y=t[A],w=b?b.sub(y)._unit()._perp():_;var k=(_=_||w).add(w);0===k.x&&0===k.y||k._unit();var S=k.x*w.x+k.y*w.y,z=0!==S?1/S:1/0,B=S<Rh&&x&&b;if(B&&A>p){var T=y.dist(x);if(T>2*l){var M=y.sub(y.sub(x)._mult(l/T)._round());this.distance+=M.dist(x),this.addCurrentVertex(M,this.distance,_.mult(1),0,0,!1,c),x=M;}}var E=x&&b,V=E?r:b?m:g;if(E&&"round"===V&&(z<a?V="miter":z<=2&&(V="fakeround")),"miter"===V&&z>n&&(V="bevel"),"bevel"===V&&(z>2&&(V="flipbevel"),z<n&&(V="miter")),x&&(this.distance+=y.dist(x)),"miter"===V)k._mult(z),this.addCurrentVertex(y,this.distance,k,0,0,!1,c);else if("flipbevel"===V){if(z>100)k=w.clone().mult(-1);else{var I=_.x*w.y-_.y*w.x>0?-1:1,C=z*_.add(w).mag()/_.sub(w).mag();k._perp()._mult(C*I);}this.addCurrentVertex(y,this.distance,k,0,0,!1,c),this.addCurrentVertex(y,this.distance,k.mult(-1),0,0,!1,c);}else if("bevel"===V||"fakeround"===V){var R=_.x*w.y-_.y*w.x>0,L=-Math.sqrt(z*z-1);if(R?(d=0,f=L):(f=0,d=L),v||this.addCurrentVertex(y,this.distance,_,f,d,!1,c),"fakeround"===V){for(var P=Math.floor(8*(.5-(S-.5))),F=void 0,O=0;O<P;O++)F=w.mult((O+1)/(P+1))._add(_)._unit(),this.addPieSliceVertex(y,this.distance,F,R,c);this.addPieSliceVertex(y,this.distance,k,R,c);for(var D=P-1;D>=0;D--)F=_.mult((D+1)/(P+1))._add(w)._unit(),this.addPieSliceVertex(y,this.distance,F,R,c);}b&&this.addCurrentVertex(y,this.distance,w,-f,-d,!1,c);}else"butt"===V?(v||this.addCurrentVertex(y,this.distance,_,0,0,!1,c),b&&this.addCurrentVertex(y,this.distance,w,0,0,!1,c)):"square"===V?(v||(this.addCurrentVertex(y,this.distance,_,1,1,!1,c),this.e1=this.e2=-1),b&&this.addCurrentVertex(y,this.distance,w,-1,-1,!1,c)):"round"===V&&(v||(this.addCurrentVertex(y,this.distance,_,0,0,!1,c),this.addCurrentVertex(y,this.distance,_,1,1,!0,c),this.e1=this.e2=-1),b&&(this.addCurrentVertex(y,this.distance,w,-1,-1,!0,c),this.addCurrentVertex(y,this.distance,w,0,0,!1,c)));if(B&&A<u-1){var q=y.dist(b);if(q>2*l){var U=y.add(b.sub(y)._mult(l/q)._round());this.distance+=U.dist(y),this.addCurrentVertex(U,this.distance,w.mult(1),0,0,!1,c),y=U;}}v=!1;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o);}},Uh.prototype.calcTDSpacePoint=function(t){var e=yu([],mu(this.x+t.x/8192,this.y+t.y/8192,this.zPow,this.projection),Pt.TRANSFORM.R);return new l(e[0]-this.tilePlane.out1[0],e[1]-this.tilePlane.out1[1],e[2]-this.tilePlane.out1[2])},Uh.prototype.addCurrentVertex=function(t,e,r,i,n,a,o){var s,u=this.layoutVertexArray,p=this.indexArray;s=r.clone(),i&&s._sub(r.perp()._mult(i));var l=this.calcTDSpacePoint(t);qh(u,l,s,a,!1,i,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,s=r.mult(-1),n&&s._sub(r.perp()._mult(n)),qh(u,l,s,a,!0,-n,e),this.e3=o.vertexLength++,this.e1>=0&&this.e2>=0&&(p.emplaceBack(this.e1,this.e2,this.e3),o.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>Ph/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,r,i,n,a,o));},Uh.prototype.addPieSliceVertex=function(t,e,r,i,n){r=r.mult(i?-1:1);var a=this.layoutVertexArray,o=this.indexArray;qh(a,this.calcTDSpacePoint(t),r,!1,i,0,e),this.e3=n.vertexLength++,this.e1>=0&&this.e2>=0&&(o.emplaceBack(this.e1,this.e2,this.e3),n.primitiveLength++),i?this.e2=this.e3:this.e1=this.e3;},Fi("SphereSpriteBucket",Uh,{omit:["layers"]});var Nh=new fn({"sprite-cap":new ln(Jt["layout_sphere-sprite"]["sprite-cap"]),"sprite-join":new hn(Jt["layout_sphere-sprite"]["sprite-join"]),"sprite-miter-limit":new ln(Jt["layout_sphere-sprite"]["sprite-miter-limit"]),"sprite-round-limit":new ln(Jt["layout_sphere-sprite"]["sprite-round-limit"])}),jh={paint:new fn({"sprite-opacity":new hn(Jt["paint_sphere-sprite"]["sprite-opacity"]),"sprite-color":new hn(Jt["paint_sphere-sprite"]["sprite-color"]),"sprite-translate":new ln(Jt["paint_sphere-sprite"]["sprite-translate"]),"sprite-translate-anchor":new ln(Jt["paint_sphere-sprite"]["sprite-translate-anchor"]),"sprite-width":new hn(Jt["paint_sphere-sprite"]["sprite-width"]),"sprite-gap-width":new hn(Jt["paint_sphere-sprite"]["sprite-gap-width"]),"sprite-offset":new hn(Jt["paint_sphere-sprite"]["sprite-offset"]),"sprite-blur":new hn(Jt["paint_sphere-sprite"]["sprite-blur"]),"sprite-speed-factor":new ln(Jt["paint_sphere-sprite"]["sprite-speed-factor"]),"sprite-interpolate":new ln(Jt["paint_sphere-sprite"]["sprite-interpolate"]),"sprite-status":new hn(Jt["paint_sphere-sprite"]["sprite-status"]),"sprite-instatus":new hn(Jt["paint_sphere-sprite"]["sprite-instatus"]),"sprite-height-offset":new ln(Jt["paint_sphere-sprite"]["sprite-height-offset"])}),layout:Nh},Gh=new(function(t){function e(){t.apply(this,arguments);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new tn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,i,n){return r=x({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,i,n)},e}(hn))(jh.paint.properties["sprite-width"].specification);Gh.useIntegerZoom=!0;var Xh=function(t){function e(e){t.call(this,e,jh);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),this.paint._values["sprite-floorwidth"]=Gh.possiblyEvaluate(this._transitioningPaint._values["sprite-width"].value,e);},e.prototype.createBucket=function(t){return new Uh(t)},e.prototype.queryRadius=function(t){var e=t,r=Yh(Oa("sprite-width",this,e),Oa("sprite-gap-width",this,e)),i=Oa("sprite-offset",this,e);return r/2+Math.abs(i)+Da(this.paint.get("sprite-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,a,o){var s=qa(t,this.paint.get("sprite-translate"),this.paint.get("sprite-translate-anchor"),a.angle,o),u=o/2*Yh(this.paint.get("sprite-width").evaluate(e,r),this.paint.get("sprite-gap-width").evaluate(e,r)),p=this.paint.get("sprite-offset").evaluate(e,r);return p&&(i=function(t,e){for(var r=[],i=new l(0,0),n=0;n<t.length;n++){for(var a=t[n],o=[],s=0;s<a.length;s++){var u=a[s-1],p=a[s],h=a[s+1],c=0===s?i:p.sub(u)._unit()._perp(),y=s===a.length-1?i:h.sub(p)._unit()._perp(),f=c._add(y)._unit(),d=f.x*y.x+f.y*y.y;f._mult(1/d),o.push(f._mult(e)._add(p));}r.push(o);}return r}(i,p*o)),Ma(s,i,u)},e}(dn);function Yh(t,e){return e>0?e+2*t:t}var Hh=xn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_extra",components:2,type:"Uint16"}]),Zh=xn([{name:"a_projected_pos",components:3,type:"Float32"}],4),$h=(xn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),xn([{name:"a_placed",components:2,type:"Uint8"}],4)),Jh=(xn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),xn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Kh=xn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Wh=(xn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"hidden"}]),xn([{type:"Float32",name:"offsetX"}]),xn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),ss.VectorTileFeature.types),Qh=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tc(t,e,r,i,n,a,o,s,u){t.emplaceBack(e,r,Math.round(32*i),Math.round(32*n),a,o,s?s[0]:0,s?s[1]:0,u,0);}function ec(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r);}var rc=function(t){this.layoutVertexArray=new Yn,this.indexArray=new Jn,this.programConfigurations=t,this.segments=new ha,this.dynamicLayoutVertexArray=new Ln,this.opacityVertexArray=new Dn,this.placedSymbolArray=new ia;};rc.prototype.upload=function(t,e,r,i){r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Hh.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Zh.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Qh,!0),this.opacityVertexBuffer.itemSize=1),(r||i)&&this.programConfigurations.upload(t);},rc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy());},Fi("SymtrackingBuffers",rc);var ic=function(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new ha,this.collisionVertexArray=new Nn;};ic.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,$h.members,!0);},ic.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy());},Fi("SymtrackingCollisionBuffers",ic);var nc=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Is(this.zoom,e["text-size"]),this.iconSizeData=Is(this.zoom,e["icon-size"]);var r=this.layers[0].layout;this.sortFeaturesByY=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sourceID=t.sourceID;};nc.prototype.createArrays=function(){this.text=new rc(new va(Hh.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new rc(new va(Hh.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.collisionBox=new ic(Un,Jh.members,Kn),this.collisionCircle=new ic(Un,Kh.members,Jn),this.glyphOffsetArray=new aa,this.lineVertexArray=new sa;},nc.prototype.populate=function(t,e){var r=this.layers[0],i=r.layout,n=i.get("text-font"),a=i.get("text-field"),o=i.get("icon-image"),s=("constant"!==a.value.kind||a.value.value.length>0)&&("constant"!==n.value.kind||n.value.value.length>0),u="constant"!==o.value.kind||o.value.value&&o.value.value.length>0;if(this.features=[],s||u){for(var p=e.iconDependencies,l=e.glyphDependencies,h=new tn(this.zoom),c=0,y=t;c<y.length;c+=1){var f=y[c],d=f.feature,m=f.index,g=f.sourceLayerIndex;if(r._featureFilter(h,d)){var v=void 0;s&&(v=Ts(v=r.getValueAndResolveTokens("text-field",d),r,d));var x=void 0;if(u&&(x=r.getValueAndResolveTokens("icon-image",d)),v||x){var b={text:v,icon:x,index:m,sourceLayerIndex:g,geometry:Aa(d),properties:d.properties,type:Wh[d.type]};if(void 0!==d.id&&(b.id=d.id),this.features.push(b),x&&(p[x]=!0),v)for(var _=n.evaluate(d,{}).join(","),w=l[_]=l[_]||{},A="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement"),k=ji(v),S=0;S<v.length;S++)if(w[v.charCodeAt(S)]=!0,A&&k){var z=Es[v.charAt(S)];z&&(w[z.charCodeAt(0)]=!0);}}}}"line"===i.get("symbol-placement")&&(this.features=Ms(this.features));}},nc.prototype.update=function(t,e){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers));},nc.prototype.isEmpty=function(){return 0===this.symbolInstances.length},nc.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},nc.prototype.upload=function(t){this.uploaded||(this.collisionBox.upload(t),this.collisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0;},nc.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.collisionBox.destroy(),this.collisionCircle.destroy();},nc.prototype.addToLineVertexArray=function(t,e){var r=this.lineVertexArray.length;if(void 0!==t.segment){for(var i=t.dist(e[t.segment+1]),n=t.dist(e[t.segment]),a={},o=t.segment+1;o<e.length;o++)a[o]={x:e[o].x,y:e[o].y,tileUnitDistanceFromAnchor:i},o<e.length-1&&(i+=e[o+1].dist(e[o]));for(var s=t.segment||0;s>=0;s--)a[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:n},s>0&&(n+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var p=a[u];this.lineVertexArray.emplaceBack(p.x,p.y,p.tileUnitDistanceFromAnchor);}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},nc.prototype.addSymbols=function(t,e,r,i,n,a,o,s,u,p){for(var l=t.indexArray,h=t.layoutVertexArray,c=t.dynamicLayoutVertexArray,y=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray),f=this.glyphOffsetArray.length,d=y.vertexLength,m=0,g=e;m<g.length;m+=1){var v=g[m],x=v.tl,b=v.tr,_=v.bl,w=v.br,A=v.tex,k=y.vertexLength,S=v.glyphOffset[1];tc(h,s.x,s.y,x.x,S+x.y,A.x,A.y,r,a.properties.link_seq),tc(h,s.x,s.y,b.x,S+b.y,A.x+A.w,A.y,r,a.properties.link_seq),tc(h,s.x,s.y,_.x,S+_.y,A.x,A.y+A.h,r,a.properties.link_seq),tc(h,s.x,s.y,w.x,S+w.y,A.x+A.w,A.y+A.h,r,a.properties.link_seq),ec(c,s,0),l.emplaceBack(k,k+1,k+2),l.emplaceBack(k+1,k+2,k+3),y.vertexLength+=4,y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(v.glyphOffset[0]);}t.placedSymbolArray.emplaceBack(s.x,s.y,f,this.glyphOffsetArray.length-f,d,u,p,s.segment,r?r[0]:0,r?r[1]:0,i[0],i[1],o,!1),t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,a,a.index);},nc.prototype._addCollisionDebugVertex=function(t,e,r,i,n){return e.emplaceBack(0,0),t.emplaceBack(r.x,r.y,i.x,i.y,Math.round(n.x),Math.round(n.y))},nc.prototype.addCollisionDebugVertices=function(t,e,r,i,n,a,o,s){var u=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),p=u.vertexLength,h=n.layoutVertexArray,c=n.collisionVertexArray;if(this._addCollisionDebugVertex(h,c,a,o.anchor,new l(t,e)),this._addCollisionDebugVertex(h,c,a,o.anchor,new l(r,e)),this._addCollisionDebugVertex(h,c,a,o.anchor,new l(r,i)),this._addCollisionDebugVertex(h,c,a,o.anchor,new l(t,i)),u.vertexLength+=4,s){var y=n.indexArray;y.emplaceBack(p,p+1,p+2),y.emplaceBack(p,p+2,p+3),u.primitiveLength+=2;}else{var f=n.indexArray;f.emplaceBack(p,p+1),f.emplaceBack(p+1,p+2),f.emplaceBack(p+2,p+3),f.emplaceBack(p+3,p),u.primitiveLength+=4;}},nc.prototype.generateCollisionDebugBuffers=function(){for(var t=0,e=this.symbolInstances;t<e.length;t+=1){var r=e[t];r.textCollisionFeature={boxStartIndex:r.textBoxStartIndex,boxEndIndex:r.textBoxEndIndex},r.iconCollisionFeature={boxStartIndex:r.iconBoxStartIndex,boxEndIndex:r.iconBoxEndIndex};for(var i=0;i<2;i++){var n=r[0===i?"textCollisionFeature":"iconCollisionFeature"];if(n)for(var a=n.boxStartIndex;a<n.boxEndIndex;a++){var o=this.collisionBoxArray.get(a),s=o.x1,u=o.y1,p=o.x2,l=o.y2,h=o.radius>0;this.addCollisionDebugVertices(s,u,p,l,h?this.collisionCircle:this.collisionBox,o.anchorPoint,r,h);}}}},nc.prototype.deserializeCollisionBoxes=function(t,e,r,i,n){for(var a={},o=e;o<r;o++){var s=t.get(o);if(0===s.radius){a.textBox={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2,anchorPointX:s.anchorPointX,anchorPointY:s.anchorPointY},a.textFeatureIndex=s.featureIndex;break}a.textCircles||(a.textCircles=[],a.textFeatureIndex=s.featureIndex);a.textCircles.push(s.anchorPointX,s.anchorPointY,s.radius,s.signedDistanceFromAnchor,1);}for(var u=i;u<n;u++){var p=t.get(u);if(0===p.radius){a.iconBox={x1:p.x1,y1:p.y1,x2:p.x2,y2:p.y2,anchorPointX:p.anchorPointX,anchorPointY:p.anchorPointY},a.iconFeatureIndex=p.featureIndex;break}}return a},nc.prototype.hasTextData=function(){return this.text.segments.get().length>0},nc.prototype.hasIconData=function(){return this.icon.segments.get().length>0},nc.prototype.hasCollisionBoxData=function(){return this.collisionBox.segments.get().length>0},nc.prototype.hasCollisionCircleData=function(){return this.collisionCircle.segments.get().length>0},nc.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&(this.sortedAngle=t,!(this.text.segments.get().length>1||this.icon.segments.get().length>1))){for(var r=[],i=0;i<this.symbolInstances.length;i++)r.push(i);var n=Math.sin(t),a=Math.cos(t);r.sort(function(t,r){var i=e.symbolInstances[t],o=e.symbolInstances[r];return(0|Math.round(n*i.anchor.x+a*i.anchor.y))-(0|Math.round(n*o.anchor.x+a*o.anchor.y))||o.featureIndex-i.featureIndex}),this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var o=0,s=r;o<s.length;o+=1){var u=s[o],p=e.symbolInstances[u];e.featureSortOrder.push(p.featureIndex);for(var l=0,h=p.placedTextSymbolIndices;l<h.length;l+=1)for(var c=h[l],y=e.text.placedSymbolArray.get(c),f=y.vertexStartIndex+4*y.numGlyphs,d=y.vertexStartIndex;d<f;d+=4)e.text.indexArray.emplaceBack(d,d+1,d+2),e.text.indexArray.emplaceBack(d+1,d+2,d+3);var m=e.icon.placedSymbolArray.get(u);if(m.numGlyphs){var g=m.vertexStartIndex;e.icon.indexArray.emplaceBack(g,g+1,g+2),e.icon.indexArray.emplaceBack(g+1,g+2,g+3);}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray);}},Fi("SymtrackingBucket",nc,{omit:["layers","collisionBoxArray","features","compareText"],shallow:["symbolInstances"]}),nc.MAX_GLYPHS=65535,nc.addDynamicAttributes=ec;var ac=new fn({"symbol-placement":new ln(Jt.layout_symtracking["symbol-placement"]),"symbol-spacing":new ln(Jt.layout_symtracking["symbol-spacing"]),"symbol-avoid-edges":new ln(Jt.layout_symtracking["symbol-avoid-edges"]),"icon-allow-overlap":new ln(Jt.layout_symtracking["icon-allow-overlap"]),"icon-ignore-placement":new ln(Jt.layout_symtracking["icon-ignore-placement"]),"icon-optional":new ln(Jt.layout_symtracking["icon-optional"]),"icon-rotation-alignment":new ln(Jt.layout_symtracking["icon-rotation-alignment"]),"icon-size":new hn(Jt.layout_symtracking["icon-size"]),"icon-text-fit":new ln(Jt.layout_symtracking["icon-text-fit"]),"icon-text-fit-padding":new ln(Jt.layout_symtracking["icon-text-fit-padding"]),"icon-image":new hn(Jt.layout_symtracking["icon-image"]),"icon-rotate":new hn(Jt.layout_symtracking["icon-rotate"]),"icon-padding":new ln(Jt.layout_symtracking["icon-padding"]),"icon-keep-upright":new ln(Jt.layout_symtracking["icon-keep-upright"]),"icon-offset":new hn(Jt.layout_symtracking["icon-offset"]),"icon-anchor":new hn(Jt.layout_symtracking["icon-anchor"]),"icon-pitch-alignment":new ln(Jt.layout_symtracking["icon-pitch-alignment"]),"text-pitch-alignment":new ln(Jt.layout_symtracking["text-pitch-alignment"]),"text-rotation-alignment":new ln(Jt.layout_symtracking["text-rotation-alignment"]),"text-field":new hn(Jt.layout_symtracking["text-field"]),"text-font":new hn(Jt.layout_symtracking["text-font"]),"text-size":new hn(Jt.layout_symtracking["text-size"]),"text-max-width":new hn(Jt.layout_symtracking["text-max-width"]),"text-line-height":new ln(Jt.layout_symtracking["text-line-height"]),"text-letter-spacing":new hn(Jt.layout_symtracking["text-letter-spacing"]),"text-justify":new hn(Jt.layout_symtracking["text-justify"]),"text-anchor":new hn(Jt.layout_symtracking["text-anchor"]),"text-max-angle":new ln(Jt.layout_symtracking["text-max-angle"]),"text-rotate":new hn(Jt.layout_symtracking["text-rotate"]),"text-padding":new ln(Jt.layout_symtracking["text-padding"]),"text-keep-upright":new ln(Jt.layout_symtracking["text-keep-upright"]),"text-transform":new hn(Jt.layout_symtracking["text-transform"]),"text-offset":new hn(Jt.layout_symtracking["text-offset"]),"text-allow-overlap":new ln(Jt.layout_symtracking["text-allow-overlap"]),"text-ignore-placement":new ln(Jt.layout_symtracking["text-ignore-placement"]),"text-optional":new ln(Jt.layout_symtracking["text-optional"]),"symtracking-time-segment":new ln(Jt.layout_symtracking["symtracking-time-segment"]),"symtracking-fps":new ln(Jt.layout_symtracking["symtracking-fps"]),"compatible-mode":new ln(Jt.layout_symtracking["compatible-mode"])}),oc={paint:new fn({"icon-opacity":new hn(Jt.paint_symtracking["icon-opacity"]),"icon-color":new hn(Jt.paint_symtracking["icon-color"]),"icon-halo-color":new hn(Jt.paint_symtracking["icon-halo-color"]),"icon-halo-width":new hn(Jt.paint_symtracking["icon-halo-width"]),"icon-halo-blur":new hn(Jt.paint_symtracking["icon-halo-blur"]),"icon-translate":new ln(Jt.paint_symtracking["icon-translate"]),"icon-translate-anchor":new ln(Jt.paint_symtracking["icon-translate-anchor"]),"text-opacity":new hn(Jt.paint_symtracking["text-opacity"]),"text-color":new hn(Jt.paint_symtracking["text-color"]),"text-halo-color":new hn(Jt.paint_symtracking["text-halo-color"]),"text-halo-width":new hn(Jt.paint_symtracking["text-halo-width"]),"text-halo-blur":new hn(Jt.paint_symtracking["text-halo-blur"]),"text-translate":new ln(Jt.paint_symtracking["text-translate"]),"text-translate-anchor":new ln(Jt.paint_symtracking["text-translate-anchor"]),"symtracking-delay":new ln(Jt.paint_symtracking["symtracking-delay"]),"render-3d":new ln(Jt.paint_symtracking["render-3d"]),"symtracking-height-offset":new ln(Jt.paint_symtracking["symtracking-height-offset"]),"render-road-mark":new ln(Jt.paint_symtracking["render-road-mark"])}),layout:ac},sc=function(t){function e(e){t.call(this,e,oc);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.recalculate=function(e){t.prototype.recalculate.call(this,e),"auto"===this.layout.get("icon-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["icon-rotation-alignment"]="map":this.layout._values["icon-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-rotation-alignment")&&("point"!==this.layout.get("symbol-placement")?this.layout._values["text-rotation-alignment"]="map":this.layout._values["text-rotation-alignment"]="viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));},e.prototype.getValueAndResolveTokens=function(t,e){var r=this.layout.get(t).evaluate(e,{}),i=this._unevaluatedLayout._values[t];return i.isDataDriven()||jr(i.value)?r:qs(e.properties,r)},e.prototype.createBucket=function(t){return new nc(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e}(dn),uc=xn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,pc=Math.pow(2,13);function lc(t,e,r,i,n,a,o,s){t.emplaceBack(e,r,2*Math.floor(i*pc)+o,n*pc*2,a*pc*2,Math.round(s));}var hc=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.layoutVertexArray=new En,this.indexArray=new Jn,this.programConfigurations=new va(uc,t.layers,t.zoom),this.segments=new ha;};function cc(t,e){return t.x===e.x&&(t.x<0||t.x>ba)||t.y===e.y&&(t.y<0||t.y>ba)}function yc(t){return t.every(function(t){return t.x<0})||t.every(function(t){return t.x>ba})||t.every(function(t){return t.y<0})||t.every(function(t){return t.y>ba})}hc.prototype.populate=function(t,e){for(var r=0,i=t;r<i.length;r+=1){var n=i[r],a=n.feature,o=n.index,s=n.sourceLayerIndex;if(this.layers[0]._featureFilter(new tn(this.zoom),a)){var u=Aa(a);this.addFeature(a,u,o),e.featureIndex.insert(a,u,o,s,this.index,!0);}}},hc.prototype.update=function(t,e){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers);},hc.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},hc.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},hc.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,uc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0;},hc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy());},hc.prototype.addFeature=function(t,e,r){for(var i=0,n=Co(e,500);i<n.length;i+=1){for(var a=n[i],o=0,s=0,u=a;s<u.length;s+=1){o+=u[s].length;}for(var p=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),l=0,h=a;l<h.length;l+=1){var c=h[l];if(0!==c.length&&!yc(c))for(var y=0,f=0;f<c.length;f++){var d=c[f];if(f>=1){var m=c[f-1];if(!cc(d,m)){p.vertexLength+4>ha.MAX_VERTEX_ARRAY_LENGTH&&(p=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var g=d.sub(m)._perp()._unit(),v=m.dist(d);y+v>32768&&(y=0),lc(this.layoutVertexArray,d.x,d.y,g.x,g.y,0,0,y),lc(this.layoutVertexArray,d.x,d.y,g.x,g.y,0,1,y),y+=v,lc(this.layoutVertexArray,m.x,m.y,g.x,g.y,0,0,y),lc(this.layoutVertexArray,m.x,m.y,g.x,g.y,0,1,y);var x=p.vertexLength;this.indexArray.emplaceBack(x,x+1,x+2),this.indexArray.emplaceBack(x+1,x+2,x+3),p.vertexLength+=4,p.primitiveLength+=2;}}}}p.vertexLength+o>ha.MAX_VERTEX_ARRAY_LENGTH&&(p=this.segments.prepareSegment(o,this.layoutVertexArray,this.indexArray));for(var b=[],_=[],w=p.vertexLength,A=0,k=a;A<k.length;A+=1){var S=k[A];if(0!==S.length){S!==a[0]&&_.push(b.length/2);for(var z=0;z<S.length;z++){var B=S[z];lc(this.layoutVertexArray,B.x,B.y,0,0,1,1,0),b.push(B.x),b.push(B.y);}}}for(var T=io(b,_),M=0;M<T.length;M+=3)this.indexArray.emplaceBack(w+T[M],w+T[M+1],w+T[M+2]);p.primitiveLength+=T.length/3,p.vertexLength+=o;}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r);},Fi("HistogramBucket",hc,{omit:["layers"]});var fc=new fn({"histogram-color-render":new ln(Jt.layout_histogram["histogram-color-render"]),"histogram-max-height-render":new ln(Jt.layout_histogram["histogram-max-height-render"])}),dc={paint:new fn({"histogram-opacity":new ln(Jt.paint_histogram["histogram-opacity"]),"histogram-color":new hn(Jt.paint_histogram["histogram-color"]),"histogram-translate":new ln(Jt.paint_histogram["histogram-translate"]),"histogram-translate-anchor":new ln(Jt.paint_histogram["histogram-translate-anchor"]),"histogram-pattern":new cn(Jt.paint_histogram["histogram-pattern"]),"histogram-height":new hn(Jt.paint_histogram["histogram-height"]),"histogram-base":new hn(Jt.paint_histogram["histogram-base"]),"histogram-dynamic":new ln(Jt.paint_histogram["histogram-dynamic"]),"histogram-heightArr1":new hn(Jt.paint_histogram["histogram-heightArr1"]),"histogram-heightArr2":new hn(Jt.paint_histogram["histogram-heightArr2"]),"histogram-heightArr3":new hn(Jt.paint_histogram["histogram-heightArr3"]),"histogram-time":new ln(Jt.paint_histogram["histogram-time"]),"histogram-count":new ln(Jt.paint_histogram["histogram-count"]),"histogram-colors":new ln(Jt.paint_histogram["histogram-colors"]),"histogram-max-height":new ln(Jt.paint_histogram["histogram-max-height"]),"histogram-fluorescent":new ln(Jt.paint_histogram["histogram-fluorescent"])}),layout:fc};var mc=function(t){function e(e){t.call(this,e,dc);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new hc(t)},e.prototype.queryRadius=function(){return Da(this.paint.get("histogram-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,i,n,a,o,s){var u=qa(t,this.paint.get("histogram-translate"),this.paint.get("histogram-translate-anchor"),a.angle,o),p=this.paint.get("histogram-height").evaluate(e,r),h=this.paint.get("histogram-base").evaluate(e,r),c=function(t,e,r,i){for(var n=[],a=0,o=t;a<o.length;a+=1){var s=o[a],u=[s.x,s.y,i,1];ft(u,u,e),n.push(new l(u[0]/u[3],u[1]/u[3]));}return n}(u,s,0,0),y=function(t,e,r,i){for(var n=[],a=[],o=i[8]*e,s=i[9]*e,u=i[10]*e,p=i[11]*e,h=i[8]*r,c=i[9]*r,y=i[10]*r,f=i[11]*r,d=0,m=t;d<m.length;d+=1){for(var g=m[d],v=[],x=[],b=0,_=g;b<_.length;b+=1){var w=_[b],A=w.x,k=w.y,S=i[0]*A+i[4]*k+i[12],z=i[1]*A+i[5]*k+i[13],B=i[2]*A+i[6]*k+i[14],T=i[3]*A+i[7]*k+i[15],M=S+o,E=z+s,V=B+u,I=T+p,C=S+h,R=z+c,L=B+y,P=T+f,F=new l(M/I,E/I);F.z=V/I,v.push(F);var O=new l(C/P,R/P);O.z=L/P,x.push(O);}n.push(v),a.push(x);}return[n,a]}(i,h,p,s);return function(t,e,r){var i=1/0;Ta(r,e)&&(i=vc(r,e[0]));for(var n=0;n<e.length;n++)for(var a=e[n],o=t[n],s=0;s<a.length-1;s++){var u=a[s],p=a[s+1],l=o[s],h=o[s+1],c=[u,p,h,l,u];za(r,c)&&(i=Math.min(i,vc(r,c)));}return i!==1/0&&i}(y[0],y[1],c)},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("histogram-opacity")&&"none"!==this.visibility},e.prototype.resize=function(){var t;(t=this)&&t.viewportFrame&&(t.viewportFrame.destroy(),t.viewportFrame=null);},e}(dn);function gc(t,e){return t.x*e.x+t.y*e.y}function vc(t,e){if(1===t.length){var r=e[0],i=e[1],n=e[3],a=t[0],o=i.sub(r),s=n.sub(r),u=a.sub(r),p=gc(o,o),l=gc(o,s),h=gc(s,s),c=gc(u,o),y=gc(u,s),f=p*h-l*l,d=(h*c-l*y)/f,m=(p*y-l*c)/f,g=1-d-m;return r.z*g+i.z*d+n.z*m}for(var v=1/0,x=0,b=e;x<b.length;x+=1){var _=b[x];v=Math.min(v,_.z);}return v}var xc={paint:new fn({"3d-point-cloud-mode":new ln(Jt["paint_3d-point-cloud"]["3d-point-cloud-mode"]),"3d-point-cloud-size":new ln(Jt["paint_3d-point-cloud"]["3d-point-cloud-size"]),"3d-point-cloud-opacity":new ln(Jt["paint_3d-point-cloud"]["3d-point-cloud-opacity"])})},bc=function(t){function e(e){t.call(this,e,xc);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(dn),_c=function(t){function e(e){t.call(this,e,{}),this.id=e.id,this.type=e.type,this.anchor=e.anchor,this.renderingMode=e.renderingMode,this.implementation=e;}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender||"3d"===this.implementation.renderingMode},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.resize=function(){this.viewportFrame&&(this.viewportFrame.destroy(),this.viewportFrame=null);},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl);},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t);},e}(dn),wc={paint:new fn({"panorama-opacity":new ln(Jt.paint_panorama["panorama-opacity"])})},Ac={circle:Na,heatmap:Qa,hillshade:eo,fill:Fo,extrusion:Xo,line:_s,symbol:js,background:Xs,raster:$s,tracking:su,"sphere-raster":lu,"sphere-fill":Cu,"sphere-line":Yu,"sphere-circle":Ku,"sphere-heatmap":ip,"sphere-symbol":vp,"sphere-extrusion":Cp,"sphere-sprite":Xh,"sphere-background":Hs,"sphere-tracking":Xp,sprite:Mh,symtracking:sc,histogram:mc,"3d-model":hh,"3d-tile":yh,"3d-point-cloud":bc,panorama:function(t){function e(e){t.call(this,e,wc);}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(dn)};function kc(t,e,r){r=r||{},this.w=t||64,this.h=e||64,this.autoResize=!!r.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0;}function Sc(t,e,r){this.x=0,this.y=t,this.w=this.free=e,this.h=r;}kc.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var r,i,n,a,o=[],s=0;s<t.length;s++)if(r=t[s].w||t[s].width,i=t[s].h||t[s].height,n=t[s].id,r&&i){if(!(a=this.packOne(r,i,n)))continue;e.inPlace&&(t[s].x=a.x,t[s].y=a.y,t[s].id=a.id),o.push(a);}return this.shrink(),o},kc.prototype.packOne=function(t,e,r){var i,n,a,o,s,u,p,l,h={freebin:-1,shelf:-1,waste:1/0},c=0;if("string"==typeof r||"number"==typeof r){if(i=this.getBin(r))return this.ref(i),i;"number"==typeof r&&(this.maxId=Math.max(r,this.maxId));}else r=++this.maxId;for(o=0;o<this.freebins.length;o++){if(e===(i=this.freebins[o]).maxh&&t===i.maxw)return this.allocFreebin(o,t,e,r);e>i.maxh||t>i.maxw||e<=i.maxh&&t<=i.maxw&&(a=i.maxw*i.maxh-t*e)<h.waste&&(h.waste=a,h.freebin=o);}for(o=0;o<this.shelves.length;o++)if(c+=(n=this.shelves[o]).h,!(t>n.free)){if(e===n.h)return this.allocShelf(o,t,e,r);e>n.h||e<n.h&&(a=(n.h-e)*t)<h.waste&&(h.freebin=-1,h.waste=a,h.shelf=o);}return-1!==h.freebin?this.allocFreebin(h.freebin,t,e,r):-1!==h.shelf?this.allocShelf(h.shelf,t,e,r):e<=this.h-c&&t<=this.w?(n=new Sc(c,this.w,e),this.allocShelf(this.shelves.push(n)-1,t,e,r)):this.autoResize?(s=u=this.h,((p=l=this.w)<=s||t>p)&&(l=2*Math.max(t,p)),(s<p||e>s)&&(u=2*Math.max(e,s)),this.resize(l,u),this.packOne(t,e,r)):null},kc.prototype.allocFreebin=function(t,e,r,i){var n=this.freebins.splice(t,1)[0];return n.id=i,n.w=e,n.h=r,n.refcount=0,this.bins[i]=n,this.ref(n),n},kc.prototype.allocShelf=function(t,e,r,i){var n=this.shelves[t].alloc(e,r,i);return this.bins[i]=n,this.ref(n),n},kc.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,e=0,r=0;r<this.shelves.length;r++){var i=this.shelves[r];e+=i.h,t=Math.max(i.w-i.free,t);}this.resize(t,e);}},kc.prototype.getBin=function(t){return this.bins[t]},kc.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e]);}return t.refcount},kc.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},kc.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0;},kc.prototype.resize=function(t,e){this.w=t,this.h=e;for(var r=0;r<this.shelves.length;r++)this.shelves[r].resize(t);return!0},Sc.prototype.alloc=function(t,e,r){if(t>this.free||e>this.h)return null;var i=this.x;return this.x+=t,this.free-=t,new function(t,e,r,i,n,a,o){this.id=t,this.x=e,this.y=r,this.w=i,this.h=n,this.maxw=a||i,this.maxh=o||n,this.refcount=0;}(r,i,this.y,t,e,t,this.h)},Sc.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0};var zc=function(t,e){var r=e.pixelRatio;this.paddedRect=t,this.pixelRatio=r;},Bc={tl:{configurable:!0},br:{configurable:!0},displaySize:{configurable:!0}};Bc.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Bc.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Bc.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(zc.prototype,Bc);var Tc=function(t){var e=new Ja({width:0,height:0}),r={},i=new kc(0,0,{autoResize:!0});for(var n in t){var a=t[n],o=i.packOne(a.data.width+2,a.data.height+2);e.resize({width:i.w,height:i.h}),Ja.copy(a.data,e,{x:0,y:0},{x:o.x+1,y:o.y+1},a.data),r[n]=new zc(o,a);}i.shrink(),e.resize({width:i.w,height:i.h}),this.image=e,this.positions=r;};Fi("ImagePosition",zc),Fi("ImageAtlas",Tc);var Mc=function(t,e,r,i,n){var a,o,s=8*n-i-1,u=(1<<s)-1,p=u>>1,l=-7,h=r?n-1:0,c=r?-1:1,y=t[e+h];for(h+=c,a=y&(1<<-l)-1,y>>=-l,l+=s;l>0;a=256*a+t[e+h],h+=c,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=i;l>0;o=256*o+t[e+h],h+=c,l-=8);if(0===a)a=1-p;else{if(a===u)return o?NaN:1/0*(y?-1:1);o+=Math.pow(2,i),a-=p;}return(y?-1:1)*o*Math.pow(2,a-i)},Ec=function(t,e,r,i,n,a){var o,s,u,p=8*a-n-1,l=(1<<p)-1,h=l>>1,c=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,y=i?0:a-1,f=i?1:-1,d=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=l):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+h>=1?c/u:c*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=l?(s=0,o=l):o+h>=1?(s=(e*u-1)*Math.pow(2,n),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,n),o=0));n>=8;t[r+y]=255&s,y+=f,s/=256,n-=8);for(o=o<<n|s,p+=n;p>0;t[r+y]=255&o,y+=f,o/=256,p-=8);t[r+y-f]|=128*d;},Vc=Ic;function Ic(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length;}Ic.Varint=0,Ic.Fixed64=1,Ic.Bytes=2,Ic.Fixed32=5;var Cc="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Rc(t){return t.type===Ic.Bytes?t.readVarint()+t.pos:t.pos+1}function Lc(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Pc(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(i);for(var n=r.pos-1;n>=t;n--)r.buf[n+i]=r.buf[n];}function Fc(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r]);}function Oc(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r]);}function Dc(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r]);}function qc(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r]);}function Uc(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r]);}function Nc(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r]);}function jc(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r]);}function Gc(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r]);}function Xc(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r]);}function Yc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Hc(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24;}function Zc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Ic.prototype={destroy:function(){this.buf=null;},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,a=this.pos;this.type=7&i,t(n,e,this),this.pos===a&&this.skip(i);}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Yc(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Zc(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Yc(this.buf,this.pos)+4294967296*Yc(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=Yc(this.buf,this.pos)+4294967296*Zc(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Mc(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Mc(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,i=this.buf;return e=127&(r=i[this.pos++]),r<128?e:(e|=(127&(r=i[this.pos++]))<<7,r<128?e:(e|=(127&(r=i[this.pos++]))<<14,r<128?e:(e|=(127&(r=i[this.pos++]))<<21,r<128?e:function(t,e,r){var i,n,a=r.buf;if(n=a[r.pos++],i=(112&n)>>4,n<128)return Lc(t,i,e);if(n=a[r.pos++],i|=(127&n)<<3,n<128)return Lc(t,i,e);if(n=a[r.pos++],i|=(127&n)<<10,n<128)return Lc(t,i,e);if(n=a[r.pos++],i|=(127&n)<<17,n<128)return Lc(t,i,e);if(n=a[r.pos++],i|=(127&n)<<24,n<128)return Lc(t,i,e);if(n=a[r.pos++],i|=(1&n)<<31,n<128)return Lc(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Cc?function(t,e,r){return Cc.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){var i="",n=e;for(;n<r;){var a,o,s,u=t[n],p=null,l=u>239?4:u>223?3:u>191?2:1;if(n+l>r)break;1===l?u<128&&(p=u):2===l?128==(192&(a=t[n+1]))&&(p=(31&u)<<6|63&a)<=127&&(p=null):3===l?(a=t[n+1],o=t[n+2],128==(192&a)&&128==(192&o)&&((p=(15&u)<<12|(63&a)<<6|63&o)<=2047||p>=55296&&p<=57343)&&(p=null)):4===l&&(a=t[n+1],o=t[n+2],s=t[n+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&((p=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||p>=1114112)&&(p=null)),null===p?(p=65533,l=1):p>65535&&(p-=65536,i+=String.fromCharCode(p>>>10&1023|55296),p=56320|1023&p),i+=String.fromCharCode(p),n+=l;}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Ic.Bytes)return t.push(this.readVarint(e));var r=Rc(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Ic.Bytes)return t.push(this.readSVarint());var e=Rc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ic.Bytes)return t.push(this.readBoolean());var e=Rc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ic.Bytes)return t.push(this.readFloat());var e=Rc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ic.Bytes)return t.push(this.readDouble());var e=Rc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ic.Bytes)return t.push(this.readFixed32());var e=Rc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ic.Bytes)return t.push(this.readSFixed32());var e=Rc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ic.Bytes)return t.push(this.readFixed64());var e=Rc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ic.Bytes)return t.push(this.readSFixed64());var e=Rc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Ic.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ic.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ic.Fixed32)this.pos+=4;else{if(e!==Ic.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8;}},writeTag:function(t,e){this.writeVarint(t<<3|e);},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e;}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Hc(this.buf,t,this.pos),this.pos+=4;},writeSFixed32:function(t){this.realloc(4),Hc(this.buf,t,this.pos),this.pos+=4;},writeFixed64:function(t){this.realloc(8),Hc(this.buf,-1&t,this.pos),Hc(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8;},writeSFixed64:function(t){this.realloc(8),Hc(this.buf,-1&t,this.pos),Hc(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8;},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,i;t>=0?(r=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,i=i+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t;}(r,0,e),function(t,e){var r=(7&t)<<4;if(e.buf[e.pos++]|=r|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t;}(i,e);}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))));},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t);},writeBoolean:function(t){this.writeVarint(Boolean(t));},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var i,n,a=0;a<e.length;a++){if((i=e.charCodeAt(a))>55295&&i<57344){if(!n){i>56319||a+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):n=i;continue}if(i<56320){t[r++]=239,t[r++]=191,t[r++]=189,n=i;continue}i=n-55296<<10|i-56320|65536,n=null;}else n&&(t[r++]=239,t[r++]=191,t[r++]=189,n=null);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:(i<65536?t[r++]=i>>12|224:(t[r++]=i>>18|240,t[r++]=i>>12&63|128),t[r++]=i>>6&63|128),t[r++]=63&i|128);}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&Pc(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r;},writeFloat:function(t){this.realloc(4),Ec(this.buf,t,this.pos,!0,23,4),this.pos+=4;},writeDouble:function(t){this.realloc(8),Ec(this.buf,t,this.pos,!0,52,8),this.pos+=8;},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r];},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&Pc(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i;},writeMessage:function(t,e,r){this.writeTag(t,Ic.Bytes),this.writeRawMessage(e,r);},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Fc,e);},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Oc,e);},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Uc,e);},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Dc,e);},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,qc,e);},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Nc,e);},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,jc,e);},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Gc,e);},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,Xc,e);},writeBytesField:function(t,e){this.writeTag(t,Ic.Bytes),this.writeBytes(e);},writeFixed32Field:function(t,e){this.writeTag(t,Ic.Fixed32),this.writeFixed32(e);},writeSFixed32Field:function(t,e){this.writeTag(t,Ic.Fixed32),this.writeSFixed32(e);},writeFixed64Field:function(t,e){this.writeTag(t,Ic.Fixed64),this.writeFixed64(e);},writeSFixed64Field:function(t,e){this.writeTag(t,Ic.Fixed64),this.writeSFixed64(e);},writeVarintField:function(t,e){this.writeTag(t,Ic.Varint),this.writeVarint(e);},writeSVarintField:function(t,e){this.writeTag(t,Ic.Varint),this.writeSVarint(e);},writeStringField:function(t,e){this.writeTag(t,Ic.Bytes),this.writeString(e);},writeFloatField:function(t,e){this.writeTag(t,Ic.Fixed32),this.writeFloat(e);},writeDoubleField:function(t,e){this.writeTag(t,Ic.Fixed64),this.writeDouble(e);},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e));}};var $c=3;function Jc(t,e,r){1===t&&r.readMessage(Kc,e);}function Kc(t,e,r){if(3===t){var i=r.readMessage(Wc,{}),n=i.id,a=i.bitmap,o=i.width,s=i.height,u=i.left,p=i.top,l=i.advance;e.push({id:n,bitmap:new $a({width:o+2*$c,height:s+2*$c},a),metrics:{width:o,height:s,left:u,top:p,advance:l}});}}function Wc(t,e,r){1===t?e.id=r.readVarint():2===t?e.bitmap=r.readBytes():3===t?e.width=r.readVarint():4===t?e.height=r.readVarint():5===t?e.left=r.readSVarint():6===t?e.top=r.readSVarint():7===t&&(e.advance=r.readVarint());}var Qc=$c,ty=function(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.callbackID=0,w(["receive"],this),this.target.addEventListener("message",this.receive,!1);};ty.prototype.send=function(t,e,r,i){var n=r?this.mapId+":"+this.callbackID++:null;r&&(this.callbacks[n]=r);var a=[];this.target.postMessage({targetMapId:i,sourceMapId:this.mapId,type:t,id:String(n),data:Di(e,a)},a);},ty.prototype.receive=function(t){var e,r=this,i=t.data,n=i.id;if(!i.targetMapId||this.mapId===i.targetMapId){var a=function(t,e){var i=[];r.target.postMessage({sourceMapId:r.mapId,type:"<response>",id:String(n),error:t?Di(t):null,data:Di(e,i)},i);};if("<response>"===i.type)e=this.callbacks[i.id],delete this.callbacks[i.id],e&&i.error?e(qi(i.error)):e&&e(null,qi(i.data));else if(void 0!==i.id&&this.parent[i.type])this.parent[i.type](i.sourceMapId,qi(i.data),a);else if(void 0!==i.id&&this.parent.getWorkerSource){var o=i.type.split("."),s=qi(i.data);this.parent.getWorkerSource(i.sourceMapId,o[0],s.source)[o[1]](s,a);}else this.parent[i.type](qi(i.data));}},ty.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1);};var ey=function t(e,r){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=_();for(var i=this.workerPool.acquire(this.id),n=0;n<i.length;n++){var a=i[n],o=new t.Actor(a,r,this.id);o.name="Worker "+n,this.actors.push(o);}};function ry(t,e,r){var i=2*Math.PI*6378137/256/Math.pow(2,r);return[t*i-2*Math.PI*6378137/2,e*i-2*Math.PI*6378137/2]}function iy(t){return 2*Math.PI*6378137*Math.cos(t*Math.PI/180)}function ny(t){var e=180-360*t;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}ey.prototype.broadcast=function(t,e,r){r=r||function(){},v(this.actors,function(r,i){r.send(t,e,i);},r);},ey.prototype.send=function(t,e,r,i){return("number"!=typeof i||isNaN(i))&&(i=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[i].send(t,e,r),i},ey.prototype.remove=function(){this.actors.forEach(function(t){t.remove();}),this.actors=[],this.workerPool.release(this.id);},ey.Actor=ty;var ay=function(t,e,r){void 0===r&&(r=0),this.x=+t,this.y=+e,this.z=+r;};ay.fromLngLat=function(t,e){void 0===e&&(e=0);var r,i=Jo.convert(t);return new ay((180+i.lng)/360,(r=i.lat,(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360),function(t,e){return t/iy(e)}(e,i.lat))},ay.prototype.toLngLat=function(){return new Jo(360*this.x-180,ny(this.y))},ay.prototype.toAltitude=function(){return t=this.z,e=this.y,t*iy(ny(e));var t,e;};var oy=function(t,e,r){this.z=t,this.x=e,this.y=r,this.key=py(0,t,e,r);};oy.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},oy.prototype.url=function(t,e){var r=function(t,e,r){var i=ry(256*t,256*(e=Math.pow(2,r)-e-1),r),n=ry(256*(t+1),256*(e+1),r);return i[0]+","+i[1]+","+n[0]+","+n[1]}(this.x,this.y,this.z),i=function(t,e,r){for(var i,n="",a=t;a>0;a--)n+=(e&(i=1<<a-1)?1:0)+(r&i?2:0);return n}(this.z,this.x,this.y),n="tms"===e?Math.pow(2,this.z)-this.y-1:this.y;return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(n)).replace("{m}",String(Math.floor(this.x/16))).replace("{n}",String(Math.floor(n/16))).replace("{quadkey}",i).replace("{bbox-epsg-3857}",r)},oy.prototype.toRealCoord=function(t){var e="tms"===t?Math.pow(2,this.z)-this.y-1:this.y;return{x:this.x,y:e,z:this.z}},oy.prototype.getTilePoint=function(t){return new l((t.x-this.x)*ba,(t.y-this.y)*ba)};var sy=function(t,e){this.wrap=t,this.canonical=e,this.key=py(t,e.z,e.x,e.y);},uy=function(t,e,r,i,n){this.overscaledZ=t,this.wrap=e,this.canonical=new oy(r,+i,+n),this.key=py(e,t,i,n);};function py(t,e,r,i){return t+"_"+e+"_"+r+"_"+i}uy.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},uy.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new uy(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new uy(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},uy.prototype.isChildOf=function(t){var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},uy.prototype.children=function(t){if(this.overscaledZ>=t)return[new uy(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,r=2*this.canonical.x,i=2*this.canonical.y;return[new uy(e,this.wrap,e,r,i),new uy(e,this.wrap,e,r+1,i),new uy(e,this.wrap,e,r,i+1),new uy(e,this.wrap,e,r+1,i+1)]},uy.prototype.isLessThan=function(t){return"string"!=typeof t&&(this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y)))},uy.prototype.wrapped=function(){return new uy(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},uy.prototype.unwrapTo=function(t){return new uy(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},uy.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},uy.prototype.toUnwrapped=function(){return new sy(this.wrap,this.canonical)},uy.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},uy.prototype.toCoordinate=function(){return new p(this.canonical.x+Math.pow(2,this.wrap),this.canonical.y,this.canonical.z)},uy.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new ay(t.x-this.wrap,t.y))},Fi("CanonicalTileID",oy),Fi("OverscaledTileID",uy,{omit:["posMatrix"]});var ly=xn([{name:"a_pos",type:"Float32",components:3},{name:"a_texture_pos",type:"Float32",components:2}]),hy=function(t,e){this.maxCacheSize=e||1e3,this.terrainTiles={},this.dispatcher=t,this.order=[],this.clearTileCacheInstance=null;};hy.prototype.addATerrainTile=function(t,e,r,i){var n=this;if(this.translation||(this.translation=i),this.clearTileCacheInstance?(clearTimeout(this.clearTileCacheInstance),this.clearTileCacheInstance=setTimeout(function(){n.setMaxCacheSize(n.maxCacheSize);},1e4)):this.clearTileCacheInstance=setTimeout(function(){n.setMaxCacheSize(n.maxCacheSize);},1e4),this.terrainTiles[t.key])return this.getTerrainTileByKey(t.key);if(this.order.push(t.key),!e.terrainData||e.terrainData&&(0===e.terrainData.row||0===e.terrainData.col))return null;var a=this.terrainTiles[t.key]={terrainJson:e.terrainData,triangleData:[],sphereSegments:new ha,sphereMaskedBoundsBuffer:null,sphereMaskedIndexBuffer:null,col:0,row:0,dpi:0,inUse:!0,withDepthRange:!1,rP:[0,0,0],matrix:[]},o=a.sphereSegments,s=new An,u=new Jn;o.prepareSegment(0,s,u);for(var p=Pt.TRANSFORM.R_SCALE,l=a.terrainJson.row,h=a.terrainJson.col,c=a.terrainJson.minlon,y=a.terrainJson.minlat,f=a.terrainJson.maxlon,d=[c,a.terrainJson.maxlat],m=[f,y],g=a.terrainJson.Geometrys[0],v=yu([],[g.x/36e4,g.y/36e4],Pt.TRANSFORM.R),x=[v[0]+i[0]*p,v[1]+g.z*p,v[2]+i[2]*p],b=m[0]-d[0],_=m[1]-d[1],w=[],A=0;A<l-1;A++){var k=o.prepareSegment(2*h,s,u);n._pushArrData(a.terrainJson.Geometrys[A*h],b,_,s,w,x,d,i),n._pushArrData(a.terrainJson.Geometrys[(A+1)*h],b,_,s,w,x,d,i),k.vertexLength+=2;for(var S=1;S<h;S++){n._pushArrData(a.terrainJson.Geometrys[A*h+S],b,_,s,w,x,d,i),n._pushArrData(a.terrainJson.Geometrys[(A+1)*h+S],b,_,s,w,x,d,i);var z=k.vertexLength;u.emplaceBack(z-2,z-1,z),u.emplaceBack(z,z-1,z+1),k.vertexLength+=2,k.primitiveLength+=2,a.triangleData.push([w[z-2],w[z-1],w[z]]),a.triangleData.push([w[z],w[z-1],w[z+1]]);}}return x=[x[0]+i[0]*p,x[1]+i[1]*p,x[2]+i[2]*p],a.sphereMaskedBoundsBuffer=r.createVertexBuffer(s,ly.members),a.sphereMaskedIndexBuffer=r.createIndexBuffer(u),a.col=h,a.row=l,a.dpi=a.terrainJson.dpi,a.rP=x,a.matrix=xu(0,x,!1),a},hy.prototype._pushArrData=function(t,e,r,i,n,a,o,s){var u=Pt.TILE.EXTENT,p=Pt.TRANSFORM.R_SCALE,l=yu([],[t.x/36e4,t.y/36e4],Pt.TRANSFORM.R);i.emplaceBack(l[0]-a[0],l[1]+t.z*p-a[1],l[2]-a[2],(t.x-o[0])/(e*(t.z<15?513/512:1))*u,(t.y-o[1])/(r*(t.z<15?513/512:1))*u),n.push([l[0]+s[0]*p,l[1]+t.z*p+s[1]*p,l[2]+s[2]*p]);},hy.prototype.getTerrainTileByKey=function(t){return this.terrainTiles[t]},hy.prototype.getTerrainTileByID=function(t){return this.getTerrainTileByKey(t.key)},hy.prototype.removeATerrainTile=function(t){var e=this.terrainTiles[t];e&&!e.inUse&&(e.sphereSegments.destroy(),e.sphereMaskedBoundsBuffer.destroy(),e.sphereMaskedIndexBuffer.destroy(),this.terrainTiles[t]=null,delete this.terrainTiles[t],this.order.splice(this.order.indexOf(t),1));},hy.prototype.clearInUseStatus=function(){for(var t in this.terrainTiles)this.terrainTiles[t].inUse=!1,this.terrainTiles[t].withDepthRange=!1;},hy.prototype.setMaxCacheSize=function(t){this.maxCacheSize=t;for(var e=this.order.length;e>this.maxCacheSize;){var r=this.order[0];this.terrainTiles[r]&&this.terrainTiles[r].inUse?(this.order.splice(this.order.indexOf(r),1),this.order.push(r)):(this.removeATerrainTile(r),e--);}this.clearTileCacheInstance=null;},hy.prototype.removeAllTerrainTile=function(){for(var t in this.terrainTiles)this.removeATerrainTile(t);},hy.prototype._calcAabb=function(t){for(var e=1/0,r=1/0,i=1/0,n=-1/0,a=-1/0,o=-1/0,s=0;s<t.length;s++)for(var u=t[s],p=0;p<3;p++){var l=u[p];e>l[0]&&(e=l[0]),n<l[0]&&(n=l[0]),r>l[1]&&(r=l[1]),a<l[1]&&(a=l[1]),i>l[2]&&(i=l[2]),o<l[2]&&(o=l[2]);}for(var h=[[e,r,i],[n,a,o]],c=[[1,3,2],[1,4,3],[1,2,5],[2,6,5],[2,3,6],[3,7,6],[5,6,8],[8,6,7],[1,5,4],[4,5,8],[3,4,8],[3,8,7]],y=[[h[0][0],h[0][1],h[0][2]],[h[0][0],h[0][1],h[1][2]],[h[1][0],h[0][1],h[1][2]],[h[1][0],h[0][1],h[0][2]],[h[0][0],h[1][1],h[0][2]],[h[0][0],h[1][1],h[1][2]],[h[1][0],h[1][1],h[1][2]],[h[1][0],h[1][1],h[0][2]]],f=[],d=0;d<c.length;d++){var m=c[d];f.push([y[m[0]-1],y[m[1]-1],y[m[2]-1]]);}return f},hy.prototype._findHeight=function(t,e){for(var r=t[0].z,i=r,n=1;n<t.length;n++)t[n].z>r&&(r=t[n].z),t[n].z<i&&(i=t[n].z);return{max:r,min:i,middle:(r+i)/2}},hy.prototype.queryOneTileIntersectPoint=function(t){var e=Math.floor(t.zoom),r=fu([],t.td_camPos),i=new p(t.lngX(r[0])/t.tileSize,t.latY(r[1])/t.tileSize,t.zoom)._zoomTo(e),n=i.column,a=i.row;return this._findParentTileHeightOffset(n,a,e,t)},hy.prototype._findParentTileHeightOffset=function(t,e,r,i){var n=this.translation?this.translation[1]+10:10,a=new uy(r,0,r,Math.round(t),Math.round(e)),o=this.getTerrainTileByKey(a.key);if(o){if(o.hasOwnProperty("_h"))return o._h+n;var s=this._findHeight(o.terrainJson.Geometrys,i.zoom).max;return o._h=s,s+n}var u=1/0,p=0;for(var l in this.terrainTiles){var h=l.split("_");h[1]!==r&&(h[2]/=Math.pow(2,h[1]-r),h[3]/=Math.pow(2,h[1]-r),h[1]=r);var c=Math.sqrt(Math.pow(t-h[2],2)+Math.pow(e-h[3],2));if(c<u){u=c;var y=this.terrainTiles[l];if(y.hasOwnProperty("_h"))p=y._h+n;else{var f=this._findHeight(y.terrainJson.Geometrys,i.zoom).max;y._h=f,p=f+n;}}}return p},hy.prototype.queryTileIntersectPoint=function(t,e,r,i,n){for(var a=t.coveringTiles({tileSize:e.tileSize,minzoom:e.minzoom,maxzoom:e.maxzoom,roundZoom:e.roundZoom,reparseOverscaled:e.reparseOverscaled}),o=1/0,s=[],u=0;u<a.length;u++){var p=this.getTerrainTileByKey(a[u].key);if(p){p.placedAabb||(p.placedAabb=this._calcAabb(p.triangleData));for(var l=0;l<p.placedAabb.length;l++){if(i.intersectTriangle.apply(i,p.placedAabb[l].concat([!1],[[]])))for(var h=0;h<p.triangleData.length;h++){var c=i.intersectTriangle.apply(i,p.triangleData[h].concat([!1],[[]]));if(c){var y=ut(i.origin,c);y<o&&(s=c,o=y);}}}}}var f=fu([],s);return s?{intersectionZ:o,intersectionPoint:s,lngLat:[f[0],f[1]],alt:f[2]*Pt.TRANSFORM.R_ZOOM-Pt.TRANSFORM.REAL_R}:{}};var cy=xn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);var yy=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r;}};yy.prototype.encode=function(t){return this._stringToNumber[t]},yy.prototype.decode=function(t){return this._numberToString[t]};var fy=function(t,e,r,i){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=r,t._y=i,this.properties=t.properties,null!=t.id&&(this.id=t.id);},dy={geometry:{configurable:!0}};dy.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},dy.geometry.set=function(t){this._geometry=t;},fy.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(fy.prototype,dy);var my=function(t,e,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=e||new Ii(ba,16,0),this.grid3D=new Ii(ba,16,0),this.featureIndexArray=r||new pa;};function gy(t,e){return e-t}function vy(t){for(var e=1/0,r=1/0,i=-1/0,n=-1/0,a=0,o=t;a<o.length;a+=1){var s=o[a];e=Math.min(e,s.x),r=Math.min(r,s.y),i=Math.max(i,s.x),n=Math.max(n,s.y);}return{minX:e,minY:r,maxX:i,maxY:n}}my.prototype.insert=function(t,e,r,i,n,a){var o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,i,n);for(var s=a?this.grid3D:this.grid,u=0;u<e.length;u++){for(var p=e[u],l=[1/0,1/0,-1/0,-1/0],h=0;h<p.length;h++){var c=p[h];l[0]=Math.min(l[0],c.x),l[1]=Math.min(l[1],c.y),l[2]=Math.max(l[2],c.x),l[3]=Math.max(l[3],c.y);}l[0]<ba&&l[1]<ba&&l[2]>=0&&l[3]>=0&&s.insert(o,l[0],l[1],l[2],l[3]);}},my.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new ss.VectorTile(new Vc(this.rawTileData)).layers,this.sourceLayerCoder=new yy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},my.prototype.query=function(t,e,r){var i=this;this.loadVTLayers();for(var n=t.params||{},a=ba/t.tileSize/t.scale,o=ni(n.filter),s=t.queryGeometry,u=t.queryPadding*a,p=vy(s),h=this.grid.query(p.minX-u,p.minY-u,p.maxX+u,p.maxY+u),c=vy(t.cameraQueryGeometry),y=this.grid3D.query(c.minX-u,c.minY-u,c.maxX+u,c.maxY+u,function(e,r,i,n){return function(t,e,r,i,n){for(var a=0,o=t;a<o.length;a+=1){var s=o[a];if(e<=s.x&&r<=s.y&&i>=s.x&&n>=s.y)return!0}var u=[new l(e,r),new l(e,n),new l(i,n),new l(i,r)];if(t.length>2)for(var p=0,h=u;p<h.length;p+=1)if(Pa(t,h[p]))return!0;for(var c=0;c<t.length-1;c++)if(Fa(t[c],t[c+1],u))return!0;return!1}(t.cameraQueryGeometry,e-u,r-u,i+u,n+u)}),f=0,d=y;f<d.length;f+=1){var m=d[f];h.push(m);}h.sort(gy);for(var g,v={},x=function(u){var p=h[u];if(p!==g){g=p;var l=i.featureIndexArray.get(p),c=null;i.loadMatchingFeature(v,l.bucketIndex,l.sourceLayerIndex,l.featureIndex,o,n.layers,e,function(e,n){c||(c=Aa(e));var o={};return e.id&&(o=r.getState(n.sourceLayer||"_geojsonTileLayer",String(e.id))),n.queryIntersectsFeature(s,e,o,c,i.z,t.transform,a,t.posMatrix)});}},b=0;b<h.length;b++)x(b);return v},my.prototype.loadMatchingFeature=function(t,e,r,i,n,a,o,s){var u=this.bucketLayerIDs[e];if(!a||function(t,e){for(var r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return!0;return!1}(a,u)){var p=this.sourceLayerCoder.decode(r),l=this.vtLayers[p].feature(i);if(n(new tn(this.tileID.overscaledZ),l))for(var h=0;h<u.length;h++){var c=u[h];if(!(a&&a.indexOf(c)<0)){var y=o[c];if(y){var f=!s||s(l,y);if(f){var d=new fy(l,this.z,this.x,this.y);d.layer=y.serialize();var m=t[c];void 0===m&&(m=t[c]=[]),m.push({featureIndex:i,feature:d,intersectionZ:f});}}}}}},my.prototype.lookupSymbolFeatures=function(t,e,r,i,n,a){var o={};this.loadVTLayers();for(var s=ni(i),u=0,p=t;u<p.length;u+=1){var l=p[u];this.loadMatchingFeature(o,e,r,l,s,n,a);}return o},my.prototype.hasLayer=function(t){for(var e=0,r=this.bucketLayerIDs;e<r.length;e+=1)for(var i=0,n=r[e];i<n.length;i+=1){if(t===n[i])return!0}return!1},Fi("FeatureIndex",my,{omit:["rawTileData","sourceLayerCoder"]});var xy=function(t,e,r,i,n){this.tileID=t,this.uid=_(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.expiredRequestCount=0,this.state="loading",this.projType=r||Ko.MERCATOR,this.isRaster=i||!1,this.sphereRender=n||!1;};xy.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<a.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e);},xy.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},xy.prototype.loadVectorData=function(t,e,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){if(t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var r={};if(!e)return r;for(var i=0,n=t;i<n.length;i+=1){var a=n[i],o=a.layerIds.map(function(t){return e.getLayer(t)}).filter(Boolean);if(0!==o.length){a.layers=o,a.stateDependentLayers=o.filter(function(t){return t.isStateDependent()});for(var s=0,u=o;s<u.length;s+=1)r[u[s].id]=a;}}return r}(t.buckets,e.style),r)for(var i in this.buckets){var n=this.buckets[i];(n instanceof Ds||n instanceof nc||n instanceof dp)&&(n.justReloaded=!0);}for(var a in this.queryPadding=0,this.buckets){var o=this.buckets[a];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(o.layerIds[0]).queryRadius(o));}t.iconAtlasImage&&(this.iconAtlasImage=t.iconAtlasImage),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage);}else this.collisionBoxArray=new ea;},xy.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.iconAtlasTexture&&this.iconAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded";},xy.prototype.loadImgAOTerrainData=function(t,e,r,i,n,a,o){var s=this,u=e.context;if(t.img){var p=new self.Image,l=self.URL||self.webkitURL;p.onload=function(){l.revokeObjectURL(p.src);var t=u.gl;s.texture=e.getTileTexture(p.width),s.texture?s.texture.update(p,{useMipmap:!0}):(s.texture=new ll(u,p,t.RGBA,{useMipmap:!0}),s.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),u.extTextureFilterAnisotropic&&t.texParameterf(t.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax)),s.state="loaded",o(null);};var h=new self.Blob([new Uint8Array(t.img.data)],{type:"image/png"});p.src=t.img.data.byteLength?l.createObjectURL(h):Pt.SOURCE.TRANSPARENT_PNG_URL;}i&&this._renderTerrain(t,u,n,a);},xy.prototype._renderTerrain=function(t,e,r,i){this.terrainData=i.addATerrainTile(this.tileID,t,e,r);},xy.prototype.getBucket=function(t){return this.buckets[t.id]},xy.prototype.upload=function(t){for(var e in this.buckets){var r=this.buckets[e];r.uploadPending()&&r.upload(t);}var i=t.gl;this.iconAtlasImage&&(this.iconAtlasTexture=new ll(t,this.iconAtlasImage,i.RGBA),this.iconAtlasImage=null),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ll(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null);},xy.prototype.queryRenderedFeatures=function(t,e,r,i,n,a,o,s,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:i,scale:n,tileSize:this.tileSize,posMatrix:u,transform:o,params:a,queryPadding:this.queryPadding*s},t,e):{}},xy.prototype.querySourceFeatures=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData){var r=this.latestFeatureIndex.loadVTLayers(),i=e?e.sourceLayer:"",n=r._geojsonTileLayer||r[i];if(n)for(var a=ni(e&&e.filter),o={z:this.tileID.overscaledZ,x:this.tileID.canonical.x,y:this.tileID.canonical.y},s=0;s<n.length;s++){var u=n.feature(s);if(a(new tn(this.tileID.overscaledZ),u)){var p=new fy(u,o.z,o.x,o.y);p.tile=o,t.push(p);}}}},xy.prototype.clearMask=function(){this.segments&&(this.segments.destroy(),delete this.segments),this.maskedBoundsBuffer&&(this.maskedBoundsBuffer.destroy(),delete this.maskedBoundsBuffer),this.maskedIndexBuffer&&(this.maskedIndexBuffer.destroy(),delete this.maskedIndexBuffer),this.sphereSegments&&(this.sphereSegments.destroy(),delete this.sphereSegments),this.sphereMaskedBoundsBuffer&&(this.sphereMaskedBoundsBuffer.destroy(),delete this.sphereMaskedBoundsBuffer),this.sphereMaskedIndexBuffer&&(this.sphereMaskedIndexBuffer.destroy(),delete this.sphereMaskedIndexBuffer);},xy.prototype.setMask=function(t,e){if(!this.terrainData&&!c(this.mask,t)&&(this.mask=t,this.clearMask(),!c(t,{0:!0}))){var r=new wn,i=new Jn;this.segments=new ha,this.segments.prepareSegment(0,r,i);var n=new An,a=new Jn;this.sphereSegments=new ha,this.sphereSegments.prepareSegment(0,n,a);for(var o=Object.keys(t),s=ts(this.projType),u=[],p=0;p<o.length;p++){var h=t[o[p]],y=ba>>h.z,f=new l(h.x*y,h.y*y),d=new l(f.x+y,f.y+y),m=Math.pow(2,this.tileID.canonical.z);if(this.sphereRender){var g=2;(g=this.tileID.canonical.z<Pt.TILE_GRIDSAMPLES_SPLIT.SMALL?Pt.TILE_GRIDSAMPLES_SPLIT.SMALL_Z_SAMPLES>>h.z:this.tileID.canonical.z<Pt.TILE_GRIDSAMPLES_SPLIT.MIDDLE?Pt.TILE_GRIDSAMPLES_SPLIT.MIDDLE_Z_SAMPLES>>h.z:this.tileID.canonical.z<Pt.TILE_GRIDSAMPLES_SPLIT.LARGE?Pt.TILE_GRIDSAMPLES_SPLIT.LARGE_Z_SAMPLES>>h.z:Pt.TILE_GRIDSAMPLES_SPLIT.LARGE_S_Z_SAMPLES>>h.z)<Pt.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES&&(g=Pt.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES);for(var v=0;v<g;v++){var x=g*(d.y-f.y),b=this.sphereSegments.prepareSegment(2*(g+1),n,a);this._xyToECEF(u,f.x,f.y+v/x,s,m),n.emplaceBack(u[0],u[1],u[2],f.x,f.y+v/x),this._xyToECEF(u,f.x,f.y+(v+1)/x,s,m),n.emplaceBack(u[0],u[1],u[2],f.x,f.y+(v+1)/x),b.vertexLength+=2;for(var _=1;_<=g;_++){this._xyToECEF(u,f.x+_/x,f.y+v/x,s,m),n.emplaceBack(u[0],u[1],u[2],f.x+_/x,f.y+v/x),this._xyToECEF(u,f.x+_/x,f.y+(v+1)/x,s,m),n.emplaceBack(u[0],u[1],u[2],f.x+_/x,f.y+(v+1)/x);var w=b.vertexLength;a.emplaceBack(w-2,w-1,w),a.emplaceBack(w,w-1,w+1),b.vertexLength+=2,b.primitiveLength+=2;}}}else{var A=this.segments.prepareSegment(4,r,i);r.emplaceBack(f.x,f.y,f.x,f.y),r.emplaceBack(d.x,f.y,d.x,f.y),r.emplaceBack(f.x,d.y,f.x,d.y),r.emplaceBack(d.x,d.y,d.x,d.y);var k=A.vertexLength;i.emplaceBack(k,k+1,k+2),i.emplaceBack(k+1,k+2,k+3),A.vertexLength+=4,A.primitiveLength+=2;}}this.maskedBoundsBuffer=e.createVertexBuffer(r,cy.members),this.maskedIndexBuffer=e.createIndexBuffer(i),this.sphereMaskedBoundsBuffer=e.createVertexBuffer(n,ly.members),this.sphereMaskedIndexBuffer=e.createIndexBuffer(a);}},xy.prototype._xyToECEF=function(t,e,r,i,n){yu(t,[this._xToLng(i,e,n),this._yToLat(i,r,n)],Pt.TRANSFORM.R);},xy.prototype._xToLng=function(t,e,r){return t.xLng(this.tileID.canonical.x+e/ba,r)},xy.prototype._yToLat=function(t,e,r){return t.yLat(this.tileID.canonical.y+e/ba,r)},xy.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},xy.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var r=V(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"]);}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var i=Date.now(),n=!1;if(this.expirationTime>i)n=!1;else if(e)if(this.expirationTime<e)n=!0;else{var a=this.expirationTime-e;a?this.expirationTime=i+Math.max(a,Pt.SOURCE.CLOCK_SKEW_RETRY_TIMEOUT):n=!0;}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0;}},xy.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},xy.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var r=this.latestFeatureIndex.loadVTLayers();for(var i in this.buckets){var n=this.buckets[i],a=n.layers[0].sourceLayer||"_geojsonTileLayer",o=r[a],s=t[a];o&&s&&0!==Object.keys(s).length&&(n.update(s,o),e&&e.style&&(this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(n.layerIds[0]).queryRadius(n))));}}};var by=function(){this.state={},this.stateChanges={};};by.prototype.updateState=function(t,e,r){e=String(e),this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][e]=this.stateChanges[t][e]||{},x(this.stateChanges[t][e],r);},by.prototype.getState=function(t,e){e=String(e);var r=this.state[t]||{},i=this.stateChanges[t]||{};return x({},r[e],i[e])},by.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e);},by.prototype.coalesceChanges=function(t,e){var r={};for(var i in this.stateChanges){this.state[i]=this.state[i]||{};var n={};for(var a in this.stateChanges[i])this.state[i][a]||(this.state[i][a]={}),x(this.state[i][a],this.stateChanges[i][a]),n[a]=this.state[i][a];r[i]=n;}if(this.stateChanges={},0!==Object.keys(r).length)for(var o in t){t[o].setFeatureState(r,e);}};var _y={horizontal:1,vertical:2,horizontalOnly:3};var wy={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ay={};function ky(t,e,r,i){var n=Math.pow(t-e,2);return i?t<e?n/2:2*n:n+Math.abs(r)*r}function Sy(t,e){var r=0;return 10===t&&(r-=1e4),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function zy(t,e,r,i,n,a){for(var o=null,s=ky(e,r,n,a),u=0,p=i;u<p.length;u+=1){var l=p[u],h=ky(e-l.x,r,n,a)+l.badness;h<=s&&(o=l,s=h);}return{index:t,x:e,priorBreak:o,badness:s}}function By(t,e,r,i){if(!r)return[];if(!t)return[];for(var n,a=[],o=function(t,e,r,i){for(var n=0,a=0;a<t.length;a++){var o=i[t.charCodeAt(a)];o&&(n+=o.metrics.advance+e);}return n/Math.max(1,Math.ceil(n/r))}(t,e,r,i),s=0,u=0;u<t.length;u++){var p=t.charCodeAt(u),l=i[p];l&&!wy[p]&&(s+=l.metrics.advance+e),u<t.length-1&&(Ay[p]||!((n=p)<11904)&&(Ni["Bopomofo Extended"](n)||Ni.Bopomofo(n)||Ni["CJK Compatibility Forms"](n)||Ni["CJK Compatibility Ideographs"](n)||Ni["CJK Compatibility"](n)||Ni["CJK Radicals Supplement"](n)||Ni["CJK Strokes"](n)||Ni["CJK Symbols and Punctuation"](n)||Ni["CJK Unified Ideographs Extension A"](n)||Ni["CJK Unified Ideographs"](n)||Ni["Enclosed CJK Letters and Months"](n)||Ni["Halfwidth and Fullwidth Forms"](n)||Ni.Hiragana(n)||Ni["Ideographic Description Characters"](n)||Ni["Kangxi Radicals"](n)||Ni["Katakana Phonetic Extensions"](n)||Ni.Katakana(n)||Ni["Vertical Forms"](n)||Ni["Yi Radicals"](n)||Ni["Yi Syllables"](n)))&&a.push(zy(u+1,s,o,a,Sy(p,t.charCodeAt(u+1)),!1));}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(zy(t.length,s,o,a,0,!0))}function Ty(t){var e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0;}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;}return{horizontalAlign:e,verticalAlign:r}}function My(t,e,r,i,n){if(n){var a=e[t[i].glyph];if(a)for(var o=a.metrics.advance,s=(t[i].x+o)*n,u=r;u<=i;u++)t[u].x-=s;}}Ay[10]=!0,Ay[32]=!0,Ay[38]=!0,Ay[40]=!0,Ay[41]=!0,Ay[43]=!0,Ay[45]=!0,Ay[47]=!0,Ay[173]=!0,Ay[183]=!0,Ay[8203]=!0,Ay[8208]=!0,Ay[8211]=!0,Ay[8231]=!0,t.createCommonjsModule=e,t.default=a,t.default$1=l,t.default$2=self,t.getJSON=Nt,t.getImage=Gt,t.ResourceType=Dt,t.RGBAImage=Ja,t.default$3=kc,t.ImagePosition=zc,t.default$4=ll,t.getArrayBuffer=jt,t.default$5=function(t){return new Vc(t).readFields(Jc,[])},t.default$6=Ni,t.asyncAll=v,t.AlphaImage=$a,t.default$7=Jt,t.endsWith=A,t.extend=x,t.sphericalToCartesian=function(t){var e=t[0],r=t[1],i=t[2];return r+=90,r*=Math.PI/180,i*=Math.PI/180,{x:e*Math.cos(r)*Math.sin(i),y:e*Math.sin(r)*Math.sin(i),z:e*Math.cos(i)}},t.Evented=$t,t.validateStyle=Bi,t.validateLight=Ti,t.emitValidationErrors=Vi,t.default$8=ve,t.number=Ue,t.Properties=fn,t.Transitionable=nn,t.Transitioning=on,t.PossiblyEvaluated=pn,t.DataConstantProperty=ln,t.warnOnce=T,t.pick=function(t,e){for(var r={},i=0;i<e.length;i++){var n=e[i];n in t&&(r[n]=t[n]);}return r},t.default$9=$o,t.clamp=m,t.Event=Ht,t.ErrorEvent=Zt,t.default$10=hy,t.default$11=Pt,t.default$12=ba,t.createLayout=xn,t.getCoordinatesCenter=function(t){for(var e=1/0,r=1/0,i=-1/0,n=-1/0,a=0;a<t.length;a++)e=Math.min(e,t[a].column),r=Math.min(r,t[a].row),i=Math.max(i,t[a].column),n=Math.max(n,t[a].row);var o=i-e,s=n-r,u=Math.max(o,s),l=Math.max(0,Math.floor(-Math.log(u)/Math.LN2));return new p((e+i)/2,(r+n)/2,0).zoomTo(l)},t.CanonicalTileID=oy,t.default$13=Jo,t.RasterBoundsArray=wn,t.TriangleIndexArray=Jn,t.SphereImageArray=An,t.default$14=yl,t.default$15=ha,t.default$16=cy,t.getSpherePos=du,t.calc3dVectorTileTranslateMatrix=xu,t.getVideo=function(t,e){var r,i,n=self.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n);};for(var a=0;a<t.length;a++){var o=self.document.createElement("source");r=t[a],i=void 0,(i=self.document.createElement("a")).href=r,(i.protocol!==self.document.location.protocol||i.host!==self.document.location.host)&&(n.crossOrigin="Anonymous"),o.src=t[a],n.appendChild(o);}return{cancel:function(){}}},t.default$17=ih,t.default$18=Kt,t.default$19=eh,t.createFloat64ArrayIdentityMatrix=bu,t.default$20=tn,t.default$21=al,t.default$22=cl,t.default$23=hl,t.default$24=nh,t.create=F,t.clone=function(t){var e=new C(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.identity=O,t.transpose=function(t,e){if(t===e){var r=e[1],i=e[2],n=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=a,t[11]=e[14],t[12]=n,t[13]=o,t[14]=s;}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},t.invert=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],u=e[6],p=e[7],l=e[8],h=e[9],c=e[10],y=e[11],f=e[12],d=e[13],m=e[14],g=e[15],v=r*s-i*o,x=r*u-n*o,b=r*p-a*o,_=i*u-n*s,w=i*p-a*s,A=n*p-a*u,k=l*d-h*f,S=l*m-c*f,z=l*g-y*f,B=h*m-c*d,T=h*g-y*d,M=c*g-y*m,E=v*M-x*T+b*B+_*z-w*S+A*k;return E?(E=1/E,t[0]=(s*M-u*T+p*B)*E,t[1]=(n*T-i*M-a*B)*E,t[2]=(d*A-m*w+g*_)*E,t[3]=(c*w-h*A-y*_)*E,t[4]=(u*z-o*M-p*S)*E,t[5]=(r*M-n*z+a*S)*E,t[6]=(m*b-f*A-g*x)*E,t[7]=(l*A-c*b+y*x)*E,t[8]=(o*T-s*z+p*k)*E,t[9]=(i*z-r*T-a*k)*E,t[10]=(f*w-d*b+g*v)*E,t[11]=(h*b-l*w-y*v)*E,t[12]=(s*S-o*B-u*k)*E,t[13]=(r*B-i*S+n*k)*E,t[14]=(d*x-f*_-m*v)*E,t[15]=(l*_-h*x+c*v)*E,t):null},t.multiply=D,t.translate=q,t.scale=U,t.rotateX=N,t.rotateY=j,t.rotateZ=G,t.fromRotation=function(t,e,r){var i,n,a,o=r[0],s=r[1],u=r[2],p=Math.sqrt(o*o+s*s+u*u);return p<I?null:(o*=p=1/p,s*=p,u*=p,i=Math.sin(e),a=1-(n=Math.cos(e)),t[0]=o*o*a+n,t[1]=s*o*a+u*i,t[2]=u*o*a-s*i,t[3]=0,t[4]=o*s*a-u*i,t[5]=s*s*a+n,t[6]=u*s*a+o*i,t[7]=0,t[8]=o*u*a+s*i,t[9]=s*u*a-o*i,t[10]=u*u*a+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},t.fromRotationTranslationScale=function(t,e,r,i){var n=e[0],a=e[1],o=e[2],s=e[3],u=n+n,p=a+a,l=o+o,h=n*u,c=n*p,y=n*l,f=a*p,d=a*l,m=o*l,g=s*u,v=s*p,x=s*l,b=i[0],_=i[1],w=i[2];return t[0]=(1-(f+m))*b,t[1]=(c+x)*b,t[2]=(y-v)*b,t[3]=0,t[4]=(c-x)*_,t[5]=(1-(h+m))*_,t[6]=(d+g)*_,t[7]=0,t[8]=(y+v)*w,t[9]=(d-g)*w,t[10]=(1-(h+f))*w,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},t.fromQuat=function(t,e){var r=e[0],i=e[1],n=e[2],a=e[3],o=r+r,s=i+i,u=n+n,p=r*o,l=i*o,h=i*s,c=n*o,y=n*s,f=n*u,d=a*o,m=a*s,g=a*u;return t[0]=1-h-f,t[1]=l+g,t[2]=c-m,t[3]=0,t[4]=l-g,t[5]=1-p-f,t[6]=y+d,t[7]=0,t[8]=c+m,t[9]=y-d,t[10]=1-p-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.perspective=function(t,e,r,i,n){var a,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=n&&n!==1/0?(a=1/(i-n),t[10]=(n+i)*a,t[14]=2*n*i*a):(t[10]=-1,t[14]=-2*i),t},t.ortho=X,t.lookAt=function(t,e,r,i){var n,a,o,s,u,p,l,h,c,y,f=e[0],d=e[1],m=e[2],g=i[0],v=i[1],x=i[2],b=r[0],_=r[1],w=r[2];return Math.abs(f-b)<I&&Math.abs(d-_)<I&&Math.abs(m-w)<I?O(t):(l=f-b,h=d-_,c=m-w,n=v*(c*=y=1/Math.sqrt(l*l+h*h+c*c))-x*(h*=y),a=x*(l*=y)-g*c,o=g*h-v*l,(y=Math.sqrt(n*n+a*a+o*o))?(n*=y=1/y,a*=y,o*=y):(n=0,a=0,o=0),s=h*o-c*a,u=c*n-l*o,p=l*a-h*n,(y=Math.sqrt(s*s+u*u+p*p))?(s*=y=1/y,u*=y,p*=y):(s=0,u=0,p=0),t[0]=n,t[1]=s,t[2]=l,t[3]=0,t[4]=a,t[5]=u,t[6]=h,t[7]=0,t[8]=o,t[9]=p,t[10]=c,t[11]=0,t[12]=-(n*f+a*d+o*m),t[13]=-(s*f+u*d+p*m),t[14]=-(l*f+h*d+c*m),t[15]=1,t)},t.mul=Y,t.create$1=ht,t.normalize=ct,t.lerp=yt,t.transformMat4=ft,t.forEach=dt,t.readArrayToTriangleFloatArray=lh,t.readArrayToAnimationData=function(t,e,r){var i,n=[];i=(i=new Float32Array(t.buffer,e.byteOffset,e.count)).slice(0);for(var a=0;a<r.count;a++)if("SCALAR"===r.type){var o=new Float32Array(t.buffer,r.byteOffset+1*a*4,1);n.push(o[0]);}else if("VEC2"===r.type){var s=new Float32Array(t.buffer,r.byteOffset+2*a*4,2);n.push(s.slice(0));}else if("VEC3"===r.type){var u=new Float32Array(t.buffer,r.byteOffset+3*a*4,3);n.push(u.slice(0));}else if("VEC4"===r.type){var p=new Float32Array(t.buffer,r.byteOffset+4*a*4,4);n.push(p.slice(0));}return{input:i,output:n}},t.default$25=ni,t.calcLocalCoords=function(t,e,r){var i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return at([],yu([],t,t[2]?Pt.TRANSFORM.REAL_R+t[2]:Pt.TRANSFORM.REAL_R),i=function(t,e,r){U(e,e,[1,-1,1]),G(e,e,-180*Pt.TRANSFORM.DEG_TO_RAD),N(e,e,((r?0:-90)+t[1])*Pt.TRANSFORM.DEG_TO_RAD),j(e,e,(t[0]-90)*Pt.TRANSFORM.DEG_TO_RAD);var i=[];return yu(i,t,t[2]?Pt.TRANSFORM.REAL_R+t[2]:Pt.TRANSFORM.REAL_R),q(e,e,[-i[0],-i[1],-i[2]]),e}(e,i,r))},t.calcTDModelAreaData=function(t,e,r,i){var n=[],a=[],o=[],s=[];yu(n,t,Pt.TRANSFORM.R+t[2]*Pt.TRANSFORM.R_SCALE),yu(a,e,Pt.TRANSFORM.R+e[2]*Pt.TRANSFORM.R_SCALE),yu(o,r,Pt.TRANSFORM.R+r[2]*Pt.TRANSFORM.R_SCALE),yu(s,i,Pt.TRANSFORM.R+i[2]*Pt.TRANSFORM.R_SCALE);var u=nt([],st([],n,a),st([],s,n)),p=nt([],st([],a,n),u),l=nt([],st([],o,a),u),h=nt([],st([],s,o),u),c=nt([],st([],n,s),u),y=-(n[0]*p[0]+n[1]*p[1]+n[2]*p[2]),f=-(a[0]*l[0]+a[1]*l[1]+a[2]*l[2]),d=-(o[0]*h[0]+o[1]*h[1]+o[2]*h[2]),m=-(s[0]*c[0]+s[1]*c[1]+s[2]*c[2]);return{planeP1P2:p,planeP2P3:l,planeP3P4:h,planeP4P1:c,p1:n,p2:a,p3:o,p4:s,d1Sqrt:[y,Math.sqrt(p[0]*p[0]+p[1]*p[1]+p[2]*p[2])],d2Sqrt:[f,Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])],d3Sqrt:[d,Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2])],d4Sqrt:[m,Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2])]}},t.getTranslatedLngLatPoint=function(t,e){var r=fu([],at([],e,function(t,e,r){var i=r||[0,0,0],n=[];return t[2]=t[2]||0,yu(n,t,Pt.TRANSFORM.REAL_R+t[2]),q(e,e,[n[0],n[1],n[2]]),j(e,e,-(t[0]-90)*Pt.TRANSFORM.DEG_TO_RAD),N(e,e,(90-t[1])*Pt.TRANSFORM.DEG_TO_RAD),G(e,e,180*Pt.TRANSFORM.DEG_TO_RAD),U(e,e,[1,-1,1]),q(e,e,i)}(t,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])));return r[2]=r[2]-Pt.TRANSFORM.REAL_R,r},t.default$26=by,t.default$27=p,t.calc3dModelTranslateMatrix=vu,t.create$2=H,t.length=Z,t.fromValues=$,t.copy=J,t.add=K,t.subtract=W,t.scale$1=Q,t.distance=tt,t.squaredDistance=et,t.normalize$1=rt,t.dot=it,t.cross=nt,t.lerp$1=function(t,e,r,i){var n=e[0],a=e[1],o=e[2];return t[0]=n+i*(r[0]-n),t[1]=a+i*(r[1]-a),t[2]=o+i*(r[2]-o),t},t.transformMat4$1=at,t.transformMat3=function(t,e,r){var i=e[0],n=e[1],a=e[2];return t[0]=i*r[0]+n*r[3]+a*r[6],t[1]=i*r[1]+n*r[4]+a*r[7],t[2]=i*r[2]+n*r[5]+a*r[8],t},t.transformQuat=function(t,e,r){var i=r[0],n=r[1],a=r[2],o=r[3],s=e[0],u=e[1],p=e[2],l=n*p-a*u,h=a*s-i*p,c=i*u-n*s,y=n*c-a*h,f=a*l-i*c,d=i*h-n*l,m=2*o;return l*=m,h*=m,c*=m,y*=2,f*=2,d*=2,t[0]=s+l+y,t[1]=u+h+f,t[2]=p+c+d,t},t.sub=st,t.dist=ut,t.len=pt,t.forEach$1=lt,t.calcLayerOrSourceAccessorBox=sh,t.calcNodeBBox=uh,t.calculateLayerOrSourceBaseMatrix=ph,t.default$28=rh,t.sphereGenerator=function(t,e,r,i,n){var a={arr:[]},o=ts(i),s=Math.pow(2,e),u=s;i===Ko.LATLON&&(u=s/2);for(var p=0;p<u;p++)for(var l=0;l<=s;l++)cu(0,o,s,u,l,p,r,e,t,n),cu(0,o,s,u,l,p+1,r,e,t,n);return a},t.ProjectionType=Ko,t.bindAll=w,t.default$29=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.default$30=c,t.getSizeData=Is,t.evaluateSizeForFeature=function(t,e,r){var i=e;return"source"===t.functionType?r.lowerSize/10:"composite"===t.functionType?Ue(r.lowerSize/10,r.upperSize/10,i.uSizeT):i.uSize},t.evaluateSizeForZoom=function(t,e,r){if("constant"===t.functionType)return{uSizeT:0,uSize:t.layoutSize};if("source"===t.functionType)return{uSizeT:0,uSize:0};if("camera"===t.functionType){var i=t.propertyValue,n=t.zoomRange,a=t.sizeRange,o=m($r(i,r.specification).interpolationFactor(e,n.min,n.max),0,1);return{uSizeT:0,uSize:a.min+o*(a.max-a.min)}}var s=t.propertyValue,u=t.zoomRange;return{uSizeT:m($r(s,r.specification).interpolationFactor(e,u.min,u.max),0,1),uSize:0}},t.addDynamicAttributes=Ps,t.addDynamicAttributes$1=cp,t.default$31=Ns,t.default$32=dp,t.WritingMode=_y,t.polygonIntersectsPolygon=za,t.OverscaledTileID=uy,t.default$33=xy,t.keysDifference=function(t,e){var r=[];for(var i in t)i in e||r.push(i);return r},t.default$34=function(t){return"custom"===t.type?new _c(t):new Ac[t.type](t)},t.clone$1=z,t.filterObject=S,t.mapObject=k,t.default$35=ey,t.registerForPluginAvailability=function(t){return Ji?t({pluginURL:Ji,completionCallback:Zi}):Wi.once("pluginAvailable",t),t},t.evented=Wi,t.default$36=Ui,t.default$37=ga,t.default$38=Kl,t.default$39=Wl,t.drawToExtrusionFramebuffer=function(t,e){var r=t.context,i=r.gl,n=e.viewportFrame;if(t.depthRboNeedsClear&&t.setupOffscreenDepthRenderbuffer(),!n){var a=new ll(r,{width:t.width,height:t.height,data:null},i.RGBA);a.bind(i.LINEAR,i.CLAMP_TO_EDGE),(n=e.viewportFrame=r.createFramebuffer(t.width,t.height)).colorAttachment.set(a.texture);}r.bindFramebuffer.set(n.framebuffer),n.depthAttachment.set(t.depthRbo),t.depthRboNeedsClear&&(r.clear({depth:1}),t.depthRboNeedsClear=!1),r.clear({color:ve.transparent}),r.setStencilMode(Wl.disabled),r.setDepthMode(new Kl(i.LEQUAL,Kl.ReadWrite,[0,1])),r.setColorMode(t.colorModeForRenderPass());},t.drawExtrusionTexture=function(t,e){var r=e.viewportFrame;if(r){var i=t.context,n=i.gl,a=t.useProgram("extrusionTexture");i.setStencilMode(Wl.disabled),i.setDepthMode(Kl.disabled),i.setColorMode(t.colorModeForRenderPass()),i.activeTexture.set(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,r.colorAttachment.get()),"object"==typeof e.paint.get(e.type+"-opacity")?n.uniform1f(a.uniforms.u_opacity,e.paint.get(e.type+"-opacity").value.value):n.uniform1f(a.uniforms.u_opacity,e.paint.get(e.type+"-opacity")),n.uniform1i(a.uniforms.u_image,0);var o=F();X(o,0,t.width,t.height,0,0,1),n.uniformMatrix4fv(a.uniforms.u_matrix,!1,o),n.uniform2f(a.uniforms.u_world,n.drawingBufferWidth,n.drawingBufferHeight),t.viewportVAO.bind(i,a,t.viewportBuffer,[]),n.drawArrays(n.TRIANGLE_STRIP,0,4);}},t.default$40=Ql,t.create$3=P,t.fromRotation$1=function(t,e){var r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.PosArray=_n,t.default$41=oc,t.default$42=me,t.default$43=th,t.create$4=function(){var t=new C(4);return C!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.multiply$1=R,t.rotate=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=i*u+a*s,t[1]=n*u+o*s,t[2]=i*-s+a*u,t[3]=n*-s+o*u,t},t.scale$2=function(t,e,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=r[0],u=r[1];return t[0]=i*s,t[1]=n*s,t[2]=a*u,t[3]=o*u,t},t.mul$1=L,t.createFloat64ArrayFromAMatrix=_u,t.default$44=Up,t.default$45=Jl,t.create$5=mt,t.setAxisAngle=gt,t.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>I?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r},t.rotateZ$1=function(t,e,r){r*=.5;var i=e[0],n=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=i*u+n*s,t[1]=n*u-i*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t},t.slerp=vt,t.fromMat3=xt,t.lerp$2=zt,t.normalize$2=Bt,t.rotationTo=Tt,t.sqlerp=Mt,t.setAxes=Et,t.default$46=hh,t.transformGeographicToECEF=fu,t.default$47=yh,t.default$48=ly,t.xyToLngLat=function(t,e,r,i,n,a,o){var s=Math.pow(2,a),u=i+t/8192,p=n+e/8192,l=ts(o);return[l.xLng(u,s),l.yLat(p,s)]},t.transformECEFToGeographic=yu,t.calcCustomLayerTranslateMatrix=function(t,e,r){var i=r||[0,0,0],n=[];return t[2]=t[2]||0,yu(n,t,Pt.TRANSFORM.R+t[2]),q(e,e,n),j(e,e,(90-t[0])*Pt.TRANSFORM.DEG_TO_RAD),N(e,e,(90-t[1])*Pt.TRANSFORM.DEG_TO_RAD),G(e,e,180*Pt.TRANSFORM.DEG_TO_RAD),U(e,e,[Pt.TRANSFORM.R_SCALE,-Pt.TRANSFORM.R_SCALE,Pt.TRANSFORM.R_SCALE]),q(e,e,i)},t.ease=f,t.bezier=y,t.wrap=g,t.easeForSphere=d,t.UnwrappedTileID=sy,t.create$6=Vt,t.rotate$1=function(t,e,r,i){var n=e[0]-r[0],a=e[1]-r[1],o=Math.sin(i),s=Math.cos(i);return t[0]=n*s-a*o+r[0],t[1]=n*o+a*s+r[1],t},t.forEach$2=It,t.getCameraDistanceFromZoom=function t(e,r,i){if(r>=3)return i*(Math.sin(Math.PI/4/Math.pow(2,r-2))/Math.tan(e/2)+Math.cos(Math.PI/4/Math.pow(2,r-2)));var n=i/Math.sin(e/2),a=t(e,3,i);return r>=2&&r<3?a+(n-a)*(3-r):n*(2-r+1)},t.default$49=ts,t.setRTLTextPlugin=function(t,e){if($i)throw new Error("setRTLTextPlugin cannot be called multiple times.");$i=!0,Ji=a.resolveURL(t),Zi=function(t){t?($i=!1,Ji=null,e&&e(t)):Ki=!0;},Wi.fire(new Ht("pluginAvailable",{pluginURL:Ji,completionCallback:Zi}));},t.default$50=dn,t.values=function(t){var e=[];for(var r in t)e.push(t[r]);return e},t.default$51=Vs,t.register=Fi,t.GLYPH_PBF_BORDER=Qc,t.default$52=sc,t.distToSegmentSquared=Ra,t.shapeText=function(t,e,r,i,n,a,o,s,u,p){var l=t.trim();p===_y.vertical&&(l=function(t){for(var e="",r=0;r<t.length;r++){var i=t.charCodeAt(r+1)||null,n=t.charCodeAt(r-1)||null;i&&Yi(i)&&!Es[t[r+1]]||n&&Yi(n)&&!Es[t[r-1]]||!Es[t[r]]?e+=t[r]:e+=Es[t[r]];}return e}(l));var h=[],c={positionedGlyphs:h,text:l,top:s[1],bottom:s[1],left:s[0],right:s[0],writingMode:p},y=Qi.processBidirectionalText;return function(t,e,r,i,n,a,o,s,u){for(var p=0,l=-17,h=0,c=t.positionedGlyphs,y="right"===a?1:"left"===a?0:.5,f=0,d=r;f<d.length;f+=1){var m=d[f];if((m=m.trim()).length){for(var g=c.length,v=0;v<m.length;v++){var x=m.charCodeAt(v),b=e[x];b&&(Xi(x)&&o!==_y.horizontal?(c.push({glyph:x,x:p,y:0,vertical:!0}),p+=u+s):(c.push({glyph:x,x:p,y:l,vertical:!1}),p+=b.metrics.advance+s));}if(c.length!==g){var _=p-s;h=Math.max(_,h),My(c,e,g,c.length-1,y);}p=0,l+=i;}else l+=i;}var w=Ty(n),A=w.horizontalAlign,k=w.verticalAlign;!function(t,e,r,i,n,a,o){for(var s=(e-r)*n,u=(-i*o+.5)*a,p=0;p<t.length;p++)t[p].x+=s,t[p].y+=u;}(c,y,A,k,h,i,r.length);var S=r.length*i;t.top+=-k*S,t.bottom=t.top+S,t.left+=-A*h,t.right=t.left+h;}(c,e,y?y(l,By(l,o,r,e)):function(t,e){for(var r=[],i=0,n=0,a=e;n<a.length;n+=1){var o=a[n];r.push(t.substring(i,o)),i=o;}return i<t.length&&r.push(t.substring(i,t.length)),r}(l,By(l,o,r,e)),i,n,a,p,o,u),!!h.length&&c},t.shapeIcon=function(t,e,r){var i=Ty(r),n=i.horizontalAlign,a=i.verticalAlign,o=e[0],s=e[1],u=o-t.displaySize[0]*n,p=u+t.displaySize[0],l=s-t.displaySize[1]*a;return{image:t,top:l,bottom:l+t.displaySize[1],left:u,right:p}},t.allowsVerticalWritingMode=ji,t.allowsLetterSpacing=function(t){for(var e=0,r=t;e<r.length;e+=1)if(!Gi(r[e].charCodeAt(0)))return!1;return!0},t.default$53=Co,t.default$54=Ds,t.default$55=nc,t.default$56=my,t.CollisionBoxArray=ea,t.default$57=yy,t.default$58=Tc,t.default$59=ss,t.default$60=Vc,t.__moduleExports=Vc,t.GLTFReader=nl,t.default$61=ty,t.plugin=Qi;});

define(["./chunk1.js"],function(t){"use strict";function e(t){var r=typeof t;if("number"===r||"boolean"===r||"string"===r||void 0===t||null===t)return JSON.stringify(t);if(Array.isArray(t)){for(var i="[",n=0,o=t;n<o.length;n+=1){i+=e(o[n])+",";}return i+"]"}for(var a=Object.keys(t).sort(),s="{",l=0;l<a.length;l++)s+=JSON.stringify(a[l])+":"+e(t[a[l]])+",";return s+"}"}function r(r){for(var i="",n=0,o=t.default$29;n<o.length;n+=1){i+="/"+e(r[o[n]]);}return i}var i=function(t){t&&this.replace(t);};function n(t,e,r,i,n){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-r/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a];}s+=t[a].dist(t[a+1]),a++;for(var l=[],u=0;s<r/2;){var h=t[a-1],c=t[a],f=t[a+1];if(!f)return!1;var d=h.angleTo(c)-c.angleTo(f);for(d=Math.abs((d+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:d}),u+=d;s-l[0].distance>i;)u-=l.shift().angleDelta;if(u>n)return!1;a++,s+=c.dist(f);}return!0}function o(t){for(var e=0,r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function a(t,e,r){return t?.6*e*r:0}function s(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function l(e,r,i,l,u,h){for(var c=a(i,u,h),f=s(i,l),d=0,p=o(e)/2,g=0;g<e.length-1;g++){var y=e[g],m=e[g+1],v=y.dist(m);if(d+v>p){var x=(p-d)/v,w=t.number(y.x,m.x,x),_=t.number(y.y,m.y,x),b=new t.default$51(w,_,m.angleTo(y),g);if(b._round(),c&&!n(e,b,f,c,r))return;return b}d+=v;}}function u(e,r,i,l,u,h,c,f,d){var p=a(l,h,c),g=s(l,u),y=0===e[0].x||e[0].x===d||0===e[0].y||e[0].y===d;return r-g*c<r/4&&(r=g*c+r/4),function e(r,i,a,s,l,u,h,c,f){var d=u/2;var p=o(r);var g=0,y=i-a;var m=[];for(var v=0;v<r.length-1;v++){for(var x=r[v],w=r[v+1],_=x.dist(w),b=w.angleTo(x);y+a<g+_;){var S=((y+=a)-g)/_,M=t.number(x.x,w.x,S),T=t.number(x.y,w.y,S);if(M>=0&&M<f&&T>=0&&T<f&&y-d>=0&&y+d<=p){var I=new t.default$51(M,T,b,v);I._round(),s&&!n(r,I,u,s,l)||m.push(I);}}g+=_;}c||m.length||h||(m=e(r,g/2,a,s,l,u,h,!0,f));return m}(e,y?r/2*f%r:(g/2+2*h)*c*f%r,r,p,i,g*c,y,!1,d)}i.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[]);},i.prototype.update=function(e,i){for(var n=this,o=0,a=e;o<a.length;o+=1){var s=a[o];n._layerConfigs[s.id]=s;var l=n._layers[s.id]=t.default$34(s);l._featureFilter=t.default$25(l.filter);}for(var u=0,h=i;u<h.length;u+=1){var c=h[u];delete n._layerConfigs[c],delete n._layers[c];}this.familiesBySource={};for(var f=0,d=function(t){for(var e={},i=0;i<t.length;i++){var n=r(t[i]),o=e[n];o||(o=e[n]=[]),o.push(t[i]);}var a=[];for(var s in e)a.push(e[s]);return a}(t.values(this._layerConfigs));f<d.length;f+=1){var p=d[f].map(function(t){return n._layers[t.id]}),g=p[0];if("none"!==g.visibility){var y=g.source||"",m=n.familiesBySource[y];m||(m=n.familiesBySource[y]={});var v=g.sourceLayer||"_geojsonTileLayer",x=m[v];x||(x=m[v]=[]),x.push(p);}}};var h=function(){this.opacity=0,this.targetOpacity=0,this.time=0;};function c(t,e){var r=t.geometry[0];return r.length>2&&(!t.properties.hasOwnProperty("name")||-1===t.properties.name.indexOf("箭头"))?0:1===r.length?0:r[1].angleTo(r[0])+(e||0)}h.prototype.clone=function(){var t=new h;return t.opacity=this.opacity,t.targetOpacity=this.targetOpacity,t.time=this.time,t},t.register("OpacityState",h);var f=function(e,r,i,n,o,a,s,l,u,h,c,f){var d=s.top*l-u,p=s.bottom*l+u,g=s.left*l-u,y=s.right*l+u;if(this.boxStartIndex=e.length,h){var m=p-d,v=y-g;m>0&&(m=Math.max(10*l,m),this._addLineCollisionCircles(e,r,i,i.segment,v,m,n,o,a,c));}else{if(f){var x=new t.default$1(g,d),w=new t.default$1(y,d),_=new t.default$1(g,p),b=new t.default$1(y,p),S=f*Math.PI/180;x._rotate(S),w._rotate(S),_._rotate(S),b._rotate(S),g=Math.min(x.x,w.x,_.x,b.x),y=Math.max(x.x,w.x,_.x,b.x),d=Math.min(x.y,w.y,_.y,b.y),p=Math.max(x.y,w.y,_.y,b.y);}e.emplaceBack(i.x,i.y,g,d,y,p,n,o,a,0,0);}this.boxEndIndex=e.length;};f.prototype._addLineCollisionCircles=function(t,e,r,i,n,o,a,s,l,u){var h=o/2,c=Math.floor(n/h)||1,f=1+.4*Math.log(u)/Math.LN2,d=Math.floor(c*f/2),p=-o/2,g=r,y=i+1,m=p,v=-n/2,x=v-n/4;do{if(--y<0){if(m>v)return;y=0;break}m-=e[y].dist(g),g=e[y];}while(m>x);for(var w=e[y].dist(e[y+1]),_=-d;_<c+d;_++){var b=_*h,S=v+b;if(b<0&&(S+=b),b>n&&(S+=b-n),!(S<m)){for(;m+w<S;){if(m+=w,++y+1>=e.length)return;w=e[y].dist(e[y+1]);}var M=S-m,T=e[y],I=e[y+1].sub(T)._unit()._mult(M)._add(T)._round(),k=Math.abs(S-p)<h?0:.8*(S-p);t.emplaceBack(I.x,I.y,-o/2,-o/2,o/2,o/2,a,s,l,o/2,k);}}};var d=g,p=g;function g(t,e){if(!(this instanceof g))return new g(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||y,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r);}function y(t,e){return t<e?-1:t>e?1:0}function m(e,r,i){void 0===r&&(r=1),void 0===i&&(i=!1);for(var n=1/0,o=1/0,a=-1/0,s=-1/0,l=e[0],u=0;u<l.length;u++){var h=l[u];(!u||h.x<n)&&(n=h.x),(!u||h.y<o)&&(o=h.y),(!u||h.x>a)&&(a=h.x),(!u||h.y>s)&&(s=h.y);}var c=a-n,f=s-o,p=Math.min(c,f),g=p/2,y=new d(null,v);if(0===p)return new t.default$1(n,o);for(var m=n;m<a;m+=p)for(var w=o;w<s;w+=p)y.push(new x(m+g,w+g,g,e));for(var _=function(t){for(var e=0,r=0,i=0,n=t[0],o=0,a=n.length,s=a-1;o<a;s=o++){var l=n[o],u=n[s],h=l.x*u.y-u.x*l.y;r+=(l.x+u.x)*h,i+=(l.y+u.y)*h,e+=3*h;}return new x(r/e,i/e,0,t)}(e),b=y.length;y.length;){var S=y.pop();(S.d>_.d||!_.d)&&(_=S,i&&console.log("found best %d after %d probes",Math.round(1e4*S.d)/1e4,b)),S.max-_.d<=r||(g=S.h/2,y.push(new x(S.p.x-g,S.p.y-g,g,e)),y.push(new x(S.p.x+g,S.p.y-g,g,e)),y.push(new x(S.p.x-g,S.p.y+g,g,e)),y.push(new x(S.p.x+g,S.p.y+g,g,e)),b+=4);}return i&&(console.log("num probes: "+b),console.log("best distance: "+_.d)),_.p}function v(t,e){return e.max-t.max}function x(e,r,i,n){this.p=new t.default$1(e,r),this.h=i,this.d=function(e,r){for(var i=!1,n=1/0,o=0;o<r.length;o++)for(var a=r[o],s=0,l=a.length,u=l-1;s<l;u=s++){var h=a[s],c=a[u];h.y>e.y!=c.y>e.y&&e.x<(c.x-h.x)*(e.y-h.y)/(c.y-h.y)+h.x&&(i=!i),n=Math.min(n,t.distToSegmentSquared(e,h,c));}return(i?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2;}function w(e,r,i,n,o,a){e.createArrays(),e.symbolInstances=[];var s=512*e.overscaling;e.tilePixelRatio=t.default$12/s,e.compareText={},e.iconsNeedLinear=!1;var l=e.layers[0].layout,u=e.layers[0]._unevaluatedLayout._values,h={};if("composite"===e.textSizeData.functionType){var c=e.textSizeData.zoomRange,f=c.min,d=c.max;h.compositeTextSizes=[u["text-size"].possiblyEvaluate(new t.default$20(f)),u["text-size"].possiblyEvaluate(new t.default$20(d))];}if("composite"===e.iconSizeData.functionType){var p=e.iconSizeData.zoomRange,g=p.min,y=p.max;h.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new t.default$20(g)),u["icon-size"].possiblyEvaluate(new t.default$20(y))];}h.layoutTextSize=u["text-size"].possiblyEvaluate(new t.default$20(e.zoom+1)),h.layoutIconSize=u["icon-size"].possiblyEvaluate(new t.default$20(e.zoom+1)),h.textMaxSize=u["text-size"].possiblyEvaluate(new t.default$20(18));for(var m=24*l.get("text-line-height"),v="map"===l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),x=l.get("text-keep-upright"),w=0,b=e.features;w<b.length;w+=1){var S=b[w],M=l.get("text-font").evaluate(S,{}).join(","),T=r[M]||{},I=i[M]||{},k={},z=S.text;if(z){var P=l.get("text-offset").evaluate(S,{}).map(function(t){return 24*t}),D=24*l.get("text-letter-spacing").evaluate(S,{}),O=t.allowsLetterSpacing(z)?D:0,$=l.get("text-anchor").evaluate(S,{}),C=l.get("text-justify").evaluate(S,{}),L="point"===l.get("symbol-placement")?24*l.get("text-max-width").evaluate(S,{}):0;k.horizontal=t.shapeText(z,T,L,m,$,C,O,P,24,t.WritingMode.horizontal),t.allowsVerticalWritingMode(z)&&v&&x&&(k.vertical=t.shapeText(z,T,L,m,$,C,O,P,24,t.WritingMode.vertical));}var V=void 0;if(S.icon){var R=n[S.icon];R&&(V=t.shapeIcon(o[S.icon],l.get("icon-offset").evaluate(S,{}),l.get("icon-anchor").evaluate(S,{})),void 0===e.sdfIcons?e.sdfIcons=R.sdf:e.sdfIcons!==R.sdf&&t.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),R.pixelRatio!==e.pixelRatio?e.iconsNeedLinear=!0:0!==l.get("icon-rotate").constantOr(1)&&(e.iconsNeedLinear=!0));}(k.horizontal||V)&&_(e,S,k,V,I,h);}a&&e.generateCollisionDebugBuffers();}function _(e,r,i,n,o,a){var s=a.layoutTextSize.evaluate(r,{}),d=a.layoutIconSize.evaluate(r,{}),p=a.textMaxSize.evaluate(r,{});void 0===p&&(p=s);var g=e.layers[0].layout,y=g.get("text-offset").evaluate(r,{}),v=g.get("icon-offset").evaluate(r,{}),x=s/24,w=e.tilePixelRatio*x,_=e.tilePixelRatio*p/24,M=e.tilePixelRatio*d,T=e.tilePixelRatio*g.get("symbol-spacing"),I=g.get("text-padding")*e.tilePixelRatio,k=g.get("icon-padding")*e.tilePixelRatio,z=g.get("text-max-angle")/180*Math.PI,P="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement"),D="map"===g.get("icon-rotation-alignment")&&"point"!==g.get("symbol-placement"),O=g.get("symbol-placement"),$=T/2,C=function(s,l){l.x<0||l.x>=t.default$12||l.y<0||l.y>=t.default$12||e.symbolInstances.push(function(e,r,i,n,o,a,s,l,u,d,p,g,y,m,v,x,w,_,S,M,T){var I,k,z=e.addToLineVertexArray(r,i),P=0,D=0,O=0,$=n.horizontal?n.horizontal.text:"",C=[];if(n.horizontal){var L=a.layout.get("text-rotate").evaluate(S,{});I=new f(s,i,r,l,u,d,n.horizontal,p,g,y,e.overscaling,L),D+=b(e,r,n.horizontal,a,y,S,m,z,n.vertical?t.WritingMode.horizontal:t.WritingMode.horizontalOnly,C,M,T),n.vertical&&(O+=b(e,r,n.vertical,a,y,S,m,z,t.WritingMode.vertical,C,M,T));}var V=I?I.boxStartIndex:e.collisionBoxArray.length,R=I?I.boxEndIndex:e.collisionBoxArray.length;if(o){var F=function(e,r,i,n,o,a){var s,l,u,h,f,d=r.image,p=i.layout,g=r.top-1/d.pixelRatio,y=r.left-1/d.pixelRatio,m=r.bottom+1/d.pixelRatio,v=r.right+1/d.pixelRatio;if("none"!==p.get("icon-text-fit")&&o){var x=v-y,w=m-g,_=p.get("text-size").evaluate(a,{})/24,b=o.left*_,S=o.right*_,M=o.top*_,T=S-b,I=o.bottom*_-M,k=p.get("icon-text-fit-padding")[0],z=p.get("icon-text-fit-padding")[1],P=p.get("icon-text-fit-padding")[2],D=p.get("icon-text-fit-padding")[3],O="width"===p.get("icon-text-fit")?.5*(I-w):0,$="height"===p.get("icon-text-fit")?.5*(T-x):0,C="width"===p.get("icon-text-fit")||"both"===p.get("icon-text-fit")?T:x,L="height"===p.get("icon-text-fit")||"both"===p.get("icon-text-fit")?I:w;s=new t.default$1(b+$-D,M+O-k),l=new t.default$1(b+$+z+C,M+O-k),u=new t.default$1(b+$+z+C,M+O+P+L),h=new t.default$1(b+$-D,M+O+P+L);}else s=new t.default$1(y,g),l=new t.default$1(v,g),u=new t.default$1(v,m),h=new t.default$1(y,m);if(f="symtracking"===i.type&&i instanceof t.default$52&&!i.layout.get("compatible-mode")?a.properties.car_rotate*Math.PI/180:"symtracking"===i.type?c(a,0):"symbol"===i.type&&i.paint.get("render-road-mark")?c(a,Math.PI/2):i.layout.get("icon-rotate").evaluate(a,{})*Math.PI/180){var V=Math.sin(f),R=Math.cos(f),F=[R,-V,V,R];s._matMult(F),l._matMult(F),h._matMult(F),u._matMult(F);}return[{tl:s,tr:l,bl:h,br:u,tex:d.paddedRect,writingMode:void 0,glyphOffset:[0,0]}]}(0,o,a,0,n.horizontal,S),j=a.layout.get("icon-rotate").evaluate(S,{});k=new f(s,i,r,l,u,d,o,v,x,!1,e.overscaling,j),P=4*F.length;var A=e.iconSizeData,N=null;"source"===A.functionType?N=[10*a.layout.get("icon-size").evaluate(S,{})]:"composite"===A.functionType&&(N=[10*T.compositeIconSizes[0].evaluate(S,{}),10*T.compositeIconSizes[1].evaluate(S,{})]),e instanceof t.default$54?e.addSymbols(e.icon,F,N,_,w,S,!1,r,z.lineStartIndex,z.lineLength):(t.default$55,e.addSymbols(e.icon,F,N,_,w,S,!1,r,z.lineStartIndex,z.lineLength));}var E=k?k.boxStartIndex:e.collisionBoxArray.length,G=k?k.boxEndIndex:e.collisionBoxArray.length;e.glyphOffsetArray.length>=t.default$54.MAX_GLYPHS&&t.warnOnce("Too many glyphs being rendered in a tile. See https://github.com/minemap/minemap-gl-js/issues/2907");var B=new h,q=new h;return{key:$,textBoxStartIndex:V,textBoxEndIndex:R,iconBoxStartIndex:E,iconBoxEndIndex:G,textOffset:m,iconOffset:_,anchor:r,line:i,featureIndex:l,feature:S,numGlyphVertices:D,numVerticalGlyphVertices:O,numIconVertices:P,textOpacityState:B,iconOpacityState:q,isDuplicate:!1,placedTextSymbolIndices:C,crossTileID:0}}(e,l,s,i,n,e.layers[0],e.collisionBoxArray,r.index,r.sourceLayerIndex,e.index,w,I,P,y,M,k,D,v,r,o,a));};if("line"===O)for(var L=0,V=function(e,r,i,n,o){for(var a=[],s=0;s<e.length;s++)for(var l=e[s],u=void 0,h=0;h<l.length-1;h++){var c=l[h],f=l[h+1];c.x<r&&f.x<r||(c.x<r?c=new t.default$1(r,c.y+(f.y-c.y)*((r-c.x)/(f.x-c.x)))._round():f.x<r&&(f=new t.default$1(r,c.y+(f.y-c.y)*((r-c.x)/(f.x-c.x)))._round()),c.y<i&&f.y<i||(c.y<i?c=new t.default$1(c.x+(f.x-c.x)*((i-c.y)/(f.y-c.y)),i)._round():f.y<i&&(f=new t.default$1(c.x+(f.x-c.x)*((i-c.y)/(f.y-c.y)),i)._round()),c.x>=n&&f.x>=n||(c.x>=n?c=new t.default$1(n,c.y+(f.y-c.y)*((n-c.x)/(f.x-c.x)))._round():f.x>=n&&(f=new t.default$1(n,c.y+(f.y-c.y)*((n-c.x)/(f.x-c.x)))._round()),c.y>=o&&f.y>=o||(c.y>=o?c=new t.default$1(c.x+(f.x-c.x)*((o-c.y)/(f.y-c.y)),o)._round():f.y>=o&&(f=new t.default$1(c.x+(f.x-c.x)*((o-c.y)/(f.y-c.y)),o)._round()),u&&c.equals(u[u.length-1])||(u=[c],a.push(u)),u.push(f)))));}return a}(r.geometry,0,0,t.default$12,t.default$12);L<V.length;L+=1)for(var R=V[L],F=0,j=u(R,T,z,i.vertical||i.horizontal,n,24,_,e.overscaling,t.default$12);F<j.length;F+=1){var A=j[F],N=i.horizontal;N&&S(e,N.text,$,A)||C(R,A);}else if("line-center"===O)for(var E=0,G=r.geometry;E<G.length;E+=1){var B=G[E];if(B.length>1){var q=l(B,z,i.vertical||i.horizontal,n,24,_);q&&C(B,q);}}else if("Polygon"===r.type)for(var J=0,Z=t.default$53(r.geometry,0);J<Z.length;J+=1){var W=Z[J],Y=m(W,16);C(W[0],new t.default$51(Y.x,Y.y,0));}else if("LineString"===r.type)for(var X=0,U=r.geometry;X<U.length;X+=1){var H=U[X];C(H,new t.default$51(H[0].x,H[0].y,0));}else if("Point"===r.type)for(var Q=0,K=r.geometry;Q<K.length;Q+=1)for(var tt=0,et=K[Q];tt<et.length;tt+=1){var rt=et[tt];C([rt],new t.default$51(rt.x,rt.y,0));}}function b(e,r,i,n,o,a,s,l,u,h,c,f){var d=function(e,r,i,n,o,a){for(var s=i.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,l=i.layout.get("text-offset").evaluate(o,{}).map(function(t){return 24*t}),u=r.positionedGlyphs,h=[],c=0;c<u.length;c++){var f=u[c],d=a[f.glyph];if(d){var p=d.rect;if(p){var g=t.GLYPH_PBF_BORDER+1,y=d.metrics.advance/2,m=n?[f.x+y,f.y]:[0,0],v=n?[0,0]:[f.x+y+l[0],f.y+l[1]],x=d.metrics.left-g-y+v[0],w=-d.metrics.top-g+v[1],_=x+p.w,b=w+p.h,S=new t.default$1(x,w),M=new t.default$1(_,w),T=new t.default$1(x,b),I=new t.default$1(_,b);if(n&&f.vertical){var k=new t.default$1(-y,y),z=-Math.PI/2,P=new t.default$1(5,0);S._rotateAround(z,k)._add(P),M._rotateAround(z,k)._add(P),T._rotateAround(z,k)._add(P),I._rotateAround(z,k)._add(P);}if(s){var D=Math.sin(s),O=Math.cos(s),$=[O,-D,D,O];S._matMult($),M._matMult($),T._matMult($),I._matMult($);}h.push({tl:S,tr:M,bl:T,br:I,tex:p,writingMode:r.writingMode,glyphOffset:m});}}}return h}(0,i,n,o,a,c),p=e.textSizeData,g=null;return"source"===p.functionType?g=[10*n.layout.get("text-size").evaluate(a,{})]:"composite"===p.functionType&&(g=[10*f.compositeTextSizes[0].evaluate(a,{}),10*f.compositeTextSizes[1].evaluate(a,{})]),e instanceof t.default$54?e.addSymbols(e.text,d,g,s,o,a,u,r,l.lineStartIndex,l.lineLength):(t.default$55,e.addSymbols(e.text,d,g,s,o,a,u,r,l.lineStartIndex,l.lineLength)),h.push(e.text.placedSymbolArray.length-1),4*d.length}function S(t,e,r,i){var n=t.compareText;if(e in n){for(var o=n[e],a=o.length-1;a>=0;a--)if(i.dist(o[a])<r)return!0}else n[e]=[];return n[e].push(i),!1}g.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1);},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,r=this.compare,i=e[t];t>0;){var n=t-1>>1,o=e[n];if(r(i,o)>=0)break;e[t]=o,t=n;}e[t]=i;},_down:function(t){for(var e=this.data,r=this.compare,i=this.length>>1,n=e[t];t<i;){var o=1+(t<<1),a=o+1,s=e[o];if(a<this.length&&r(e[a],s)<0&&(o=a,s=e[a]),r(s,n)>=0)break;e[t]=s,t=o;}e[t]=n;}},d.default=p;var M=function(e){var r=new t.AlphaImage({width:0,height:0}),i={},n=new t.default$3(0,0,{autoResize:!0});for(var o in e){var a=e[o],s=i[o]={};for(var l in a){var u=a[+l];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var h=n.packOne(u.bitmap.width+2,u.bitmap.height+2);r.resize({width:n.w,height:n.h}),t.AlphaImage.copy(u.bitmap,r,{x:0,y:0},{x:h.x+1,y:h.y+1},u.bitmap),s[l]={rect:h,metrics:u.metrics};}}}n.shrink(),r.resize({width:n.w,height:n.h}),this.image=r,this.positions=i;};t.register("GlyphAtlas",M);var T=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.projection=e.projection||t.ProjectionType.MERCATOR;};function I(e,r){for(var i=new t.default$20(r),n=0,o=e;n<o.length;n+=1){o[n].recalculate(i);}}T.prototype.parse=function(e,r,i,n){var o=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var a=new t.default$57(Object.keys(e.layers).sort()),s=new t.default$56(this.tileID);s.bucketLayerIDs=[];var l,u,h,c={},f={featureIndex:s,iconDependencies:{},glyphDependencies:{},x:this.tileID.canonical.x,y:this.tileID.canonical.y,z:this.tileID.canonical.z},d=r.familiesBySource[this.source];for(var p in d){var g=e.layers[p];if(g){1===g.version&&t.warnOnce('Vector tile source "'+o.source+'" layer "'+p+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var y=a.encode(p),m=[],v=0;v<g.length;v++){var x=g.feature(v);m.push({feature:x,index:v,sourceLayerIndex:y});}for(var _=0,b=d[p];_<b.length;_+=1){var S=b[_],T=S[0];if(!(T.minzoom&&o.zoom<Math.floor(T.minzoom)))if(!(T.maxzoom&&o.zoom>=T.maxzoom))if("none"!==T.visibility)I(S,o.zoom),(c[T.id]=T.createBucket({index:s.bucketLayerIDs.length,layers:S,zoom:o.zoom,pixelRatio:o.pixelRatio,overscaling:o.overscaling,collisionBoxArray:o.collisionBoxArray,sourceLayerIndex:y,sourceID:o.source,projection:o.projection})).populate(m,f),s.bucketLayerIDs.push(S.map(function(t){return t.id}));}}}var k=t.mapObject(f.glyphDependencies,function(t){return Object.keys(t).map(Number)});Object.keys(k).length?i.send("getGlyphs",{uid:this.uid,stacks:k},function(t,e){l||(l=t,u=e,P.call(o));}):u={};var z=Object.keys(f.iconDependencies);function P(){if(l)return n(l);if(u&&h){var e=new M(u),r=new t.default$58(h);for(var i in c){var o=c[i];(o instanceof t.default$54||o instanceof t.default$55||o instanceof t.default$32)&&(I(o.layers,this.zoom),w(o,u,e.positions,h,r.positions,this.showCollisionBoxes));}this.status="done",n(null,{buckets:t.values(c).filter(function(t){return!t.isEmpty()}),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,iconAtlasImage:r.image});}}z.length?i.send("getImages",{icons:z},function(t,e){l||(l=t,h=e,P.call(o));}):h={},P.call(this);};var k="undefined"!=typeof performance,z={getEntriesByName:function(t){return!!(k&&performance&&performance.getEntriesByName)&&performance.getEntriesByName(t)},mark:function(t){return!!(k&&performance&&performance.mark)&&performance.mark(t)},measure:function(t,e,r){return!!(k&&performance&&performance.measure)&&performance.measure(t,e,r)},clearMarks:function(t){return!!(k&&performance&&performance.clearMarks)&&performance.clearMarks(t)},clearMeasures:function(t){return!!(k&&performance&&performance.clearMeasures)&&performance.clearMeasures(t)}},P=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},z.mark(this._marks.start);};function D(e,r){var i=t.getArrayBuffer(e.request,function(i,n){i?r(i):n&&r(null,{vectorTile:new t.default$59.VectorTile(new t.default$60(n.data),null,e&&e.projection),rawData:n.data,cacheControl:n.cacheControl,expires:n.expires});});return function(){i.cancel(),r();}}P.prototype.finish=function(){z.mark(this._marks.end);var t=z.getEntriesByName(this._marks.measure);return 0===t.length&&(z.measure(this._marks.measure,this._marks.start,this._marks.end),t=z.getEntriesByName(this._marks.measure),z.clearMarks(this._marks.start),z.clearMarks(this._marks.end),z.clearMeasures(this._marks.measure)),t},z.Performance=P;var O=function(t,e,r){this.actor=t,this.layerIndex=e,this.loadVectorData=r||D,this.loading={},this.loaded={};};O.prototype.loadTile=function(e,r){var i=this,n=e.uid;this.loading||(this.loading={});var o=!!(e&&e.request&&e.request.collectResourceTiming)&&new z.Performance(e.request),a=this.loading[n]=new T(e);a.abort=this.loadVectorData(e,function(e,s){if(delete i.loading[n],e||!s)return r(e);var l=s.rawData,u={};s.expires&&(u.expires=s.expires),s.cacheControl&&(u.cacheControl=s.cacheControl);var h={};if(o){var c=o.finish();c&&(h.resourceTiming=JSON.parse(JSON.stringify(c)));}a.vectorTile=s.vectorTile,a.parse(s.vectorTile,i.layerIndex,i.actor,function(e,i){if(e||!i)return r(e);r(null,t.extend({rawTileData:l.slice(0)},i,u,h));}),i.loaded=i.loaded||{},i.loaded[n]=a;});},O.prototype.reloadTile=function(t,e){var r=this.loaded,i=t.uid,n=this;if(r&&r[i]){var o=r[i];o.showCollisionBoxes=t.showCollisionBoxes;var a=function(t,r){var i=o.reloadCallback;i&&(delete o.reloadCallback,o.parse(o.vectorTile,n.layerIndex,n.actor,i)),e(t,r);};"parsing"===o.status?o.reloadCallback=a:"done"===o.status&&o.parse(o.vectorTile,this.layerIndex,this.actor,a);}},O.prototype.abortTile=function(t,e){var r=this.loading,i=t.uid;r&&r[i]&&r[i].abort&&(r[i].abort(),delete r[i]),e();},O.prototype.removeTile=function(t,e){var r=this.loaded,i=t.uid;r&&r[i]&&delete r[i],e();};var $={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function C(t){var e=0;if(t&&t.length>0){e+=Math.abs(L(t[0]));for(var r=1;r<t.length;r++)e-=Math.abs(L(t[r]));}return e}function L(t){var e,r,i,n,o,a,s=0,l=t.length;if(l>2){for(a=0;a<l;a++)a===l-2?(i=l-2,n=l-1,o=0):a===l-1?(i=l-1,n=0,o=1):(i=a,n=a+1,o=a+2),e=t[i],r=t[n],s+=(V(t[o][0])-V(e[0]))*Math.sin(V(r[1]));s=s*$.RADIUS*$.RADIUS/2;}return s}function V(t){return t*Math.PI/180}var R={geometry:function t(e){var r,i=0;switch(e.type){case"Polygon":return C(e.coordinates);case"MultiPolygon":for(r=0;r<e.coordinates.length;r++)i+=C(e.coordinates[r]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<e.geometries.length;r++)i+=t(e.geometries[r]);return i}},ring:L},F=function t(e,r){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(j(t,r)),e;case"Feature":return e.geometry=t(e.geometry,r),e;case"Polygon":case"MultiPolygon":return function(t,e){"Polygon"===t.type?t.coordinates=A(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(j(A,e)));return t}(e,r);default:return e}};function j(t,e){return function(r){return t(r,e)}}function A(t,e){e=!!e,t[0]=N(t[0],e);for(var r=1;r<t.length;r++)t[r]=N(t[r],!e);return t}function N(t,e){return function(t){return R.ring(t)>=0}(t)===e?t:t.reverse()}var E=t.default$59.VectorTileFeature.prototype.toGeoJSON,G=function(e,r){this._feature=e,this.extent=t.default$12,this.type=e.type,this.properties=e.tags,this.projObj=t.default$49(r),"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10));};G.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],r=0,i=this._feature.geometry;r<i.length;r+=1){var n=i[r];e.push([new(Function.prototype.bind.apply(t.default$1,[null].concat(n)))]);}return e}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var l=[],u=0,h=s[a];u<h.length;u+=1){var c=h[u];l.push(new(Function.prototype.bind.apply(t.default$1,[null].concat(c))));}o.push(l);}return o},G.prototype.toGeoJSON=function(t,e,r){return E.call(this,t,e,r)};var B=function(e,r){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.default$12,this.length=e.length,this._features=e,this.projection=r;};B.prototype.feature=function(t){return new G(this._features[t],this.projection)};var q=J;function J(t,e){this.x=t,this.y=e;}J.prototype={clone:function(){return new J(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=e*this.x-r*this.y,n=r*this.x+e*this.y;return this.x=i,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),n=e.x+r*(this.x-e.x)-i*(this.y-e.y),o=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},J.convert=function(t){return t instanceof J?t:Array.isArray(t)?new J(t[0],t[1]):t};var Z=W;function W(t,e,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=n,t.readFields(Y,this,e);}function Y(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){var r=t.readVarint()+t.pos;for(;t.pos<r;){var i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n;}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos);}function X(t){for(var e,r,i=0,n=0,o=t.length,a=o-1;n<o;a=n++)e=t[n],i+=((r=t[a]).x-e.x)*(e.y+r.y);return i}W.types=["Unknown","Point","LineString","Polygon"],W.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,i=1,n=0,o=0,a=0,s=[];t.pos<r;){if(n<=0){var l=t.readVarint();i=7&l,n=l>>3;}if(n--,1===i||2===i)o+=t.readSVarint(),a+=t.readSVarint(),1===i&&(e&&s.push(e),e=[]),e.push(new q(o,a));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone());}}return e&&s.push(e),s},W.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,n=0,o=0,a=1/0,s=-1/0,l=1/0,u=-1/0;t.pos<e;){if(i<=0){var h=t.readVarint();r=7&h,i=h>>3;}if(i--,1===r||2===r)n+=t.readSVarint(),o+=t.readSVarint(),n<a&&(a=n),n>s&&(s=n),o<l&&(l=o),o>u&&(u=o);else if(7!==r)throw new Error("unknown command "+r)}return[a,l,s,u]},W.prototype.toGeoJSON=function(t,e,r){var i,n,o=this.extent*Math.pow(2,r),a=this.extent*t,s=this.extent*e,l=this.loadGeometry(),u=W.types[this.type];function h(t){for(var e=0;e<t.length;e++){var r=t[e],i=180-360*(r.y+s)/o;t[e]=[360*(r.x+a)/o-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90];}}switch(this.type){case 1:var c=[];for(i=0;i<l.length;i++)c[i]=l[i][0];h(l=c);break;case 2:for(i=0;i<l.length;i++)h(l[i]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var r,i,n=[],o=0;o<e;o++){var a=X(t[o]);0!==a&&(void 0===i&&(i=a<0),i===a<0?(r&&n.push(r),r=[t[o]]):r.push(t[o]));}r&&n.push(r);return n}(l),i=0;i<l.length;i++)for(n=0;n<l[i].length;n++)h(l[i][n]);}1===l.length?l=l[0]:u="Multi"+u;var f={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(f.id=this.id),f};var U=H;function H(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Q,this,e),this.length=this._features.length;}function Q(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){var e=null,r=t.readVarint()+t.pos;for(;t.pos<r;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null;}return e}(r));}function K(t,e,r){if(3===t){var i=new U(r,r.readVarint()+r.pos);i.length&&(e[i.name]=i);}}H.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Z(this._pbf,e,this.extent,this._keys,this._values)};var tt={VectorTile:function(t,e){this.layers=t.readFields(K,{},e);},VectorTileFeature:Z,VectorTileLayer:U}.VectorTileFeature,et=rt;function rt(t,e){this.options=e||{},this.features=t,this.length=t.length;}function it(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096;}rt.prototype.feature=function(t){return new it(this.features[t],this.options.extent)},it.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var r=t[e],i=[],n=0;n<r.length;n++)i.push(new q(r[n][0],r[n][1]));this.geometry.push(i);}return this.geometry},it.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,r=-1/0,i=1/0,n=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var l=a[s];e=Math.min(e,l.x),r=Math.max(r,l.x),i=Math.min(i,l.y),n=Math.max(n,l.y);}return[e,i,r,n]},it.prototype.toGeoJSON=tt.prototype.toGeoJSON;var nt=lt,ot=lt,at=function(t,e){e=e||{};var r={};for(var i in t)r[i]=new et(t[i].features,e),r[i].name=i,r[i].version=e.version,r[i].extent=e.extent;return lt({layers:r})},st=et;function lt(e){var r=new t.__moduleExports;return function(t,e){for(var r in t.layers)e.writeMessage(3,ut,t.layers[r]);}(e,r),r.finish()}function ut(t,e){var r;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var i={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<t.length;r++)i.feature=t.feature(r),e.writeMessage(2,ht,i);var n=i.keys;for(r=0;r<n.length;r++)e.writeStringField(3,n[r]);var o=i.values;for(r=0;r<o.length;r++)e.writeMessage(4,gt,o[r]);}function ht(t,e){var r=t.feature;void 0!==r.id&&e.writeVarintField(1,r.id),e.writeMessage(2,ct,t),e.writeVarintField(3,r.type),e.writeMessage(4,pt,r);}function ct(t,e){var r=t.feature,i=t.keys,n=t.values,o=t.keycache,a=t.valuecache;for(var s in r.properties){var l=o[s];void 0===l&&(i.push(s),l=i.length-1,o[s]=l),e.writeVarint(l);var u=r.properties[s],h=typeof u;"string"!==h&&"boolean"!==h&&"number"!==h&&(u=JSON.stringify(u));var c=h+":"+u,f=a[c];void 0===f&&(n.push(u),f=n.length-1,a[c]=f),e.writeVarint(f);}}function ft(t,e){return(e<<3)+(7&t)}function dt(t){return t<<1^t>>31}function pt(t,e){for(var r=t.loadGeometry(),i=t.type,n=0,o=0,a=r.length,s=0;s<a;s++){var l=r[s],u=1;1===i&&(u=l.length),e.writeVarint(ft(1,u));for(var h=3===i?l.length-1:l.length,c=0;c<h;c++){1===c&&1!==i&&e.writeVarint(ft(2,h-1));var f=l[c].x-n,d=l[c].y-o;e.writeVarint(dt(f)),e.writeVarint(dt(d)),n+=f,o+=d;}3===i&&e.writeVarint(ft(7,1));}}function gt(t,e){var r=typeof t;"string"===r?e.writeStringField(1,t):"boolean"===r?e.writeBooleanField(7,t):"number"===r&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t));}function yt(t,e,r,i,n,o){if(!(n-i<=r)){var a=Math.floor((i+n)/2);!function t(e,r,i,n,o,a){for(;o>n;){if(o-n>600){var s=o-n+1,l=i-n+1,u=Math.log(s),h=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*h*(s-h)/s)*(l-s/2<0?-1:1),f=Math.max(n,Math.floor(i-l*h/s+c)),d=Math.min(o,Math.floor(i+(s-l)*h/s+c));t(e,r,i,f,d,a);}var p=r[2*i+a],g=n,y=o;for(mt(e,r,n,i),r[2*o+a]>p&&mt(e,r,n,o);g<y;){for(mt(e,r,g,y),g++,y--;r[2*g+a]<p;)g++;for(;r[2*y+a]>p;)y--;}r[2*n+a]===p?mt(e,r,n,y):mt(e,r,++y,o),y<=i&&(n=y+1),i<=y&&(o=y-1);}}(t,e,a,i,n,o%2),yt(t,e,r,i,a-1,o+1),yt(t,e,r,a+1,n,o+1);}}function mt(t,e,r,i){vt(t,r,i),vt(e,2*r,2*i),vt(e,2*r+1,2*i+1);}function vt(t,e,r){var i=t[e];t[e]=t[r],t[r]=i;}function xt(t,e,r,i){var n=t-r,o=e-i;return n*n+o*o}function wt(t,e,r,i,n){return new _t(t,e,r,i,n)}function _t(t,e,r,i,n){e=e||bt,r=r||St,n=n||Array,this.nodeSize=i||64,this.points=t,this.ids=new n(t.length),this.coords=new n(2*t.length);for(var o=0;o<t.length;o++)this.ids[o]=o,this.coords[2*o]=e(t[o]),this.coords[2*o+1]=r(t[o]);yt(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0);}function bt(t){return t[0]}function St(t){return t[1]}function Mt(e){this.options=kt(Object.create(this.options),e),this.trees=new Array(this.options.maxZoom+1),this.projection=e&&e.projection?e.projection:"MERCATOR",this.projObj=t.default$49(this.projection);}function Tt(t,e,r,i,n){return{x:t,y:e,zoom:1/0,id:r,parentId:-1,numPoints:i,properties:n}}function It(t){var e=t.numPoints,r=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return kt(kt({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:r})}function kt(t,e){for(var r in e)t[r]=e[r];return t}function zt(t){return t.x}function Pt(t){return t.y}nt.fromVectorTileJs=ot,nt.fromGeojsonVt=at,nt.GeoJSONWrapper=st,_t.prototype={range:function(t,e,r,i){return function(t,e,r,i,n,o,a){for(var s,l,u=[0,t.length-1,0],h=[];u.length;){var c=u.pop(),f=u.pop(),d=u.pop();if(f-d<=a)for(var p=d;p<=f;p++)s=e[2*p],l=e[2*p+1],s>=r&&s<=n&&l>=i&&l<=o&&h.push(t[p]);else{var g=Math.floor((d+f)/2);s=e[2*g],l=e[2*g+1],s>=r&&s<=n&&l>=i&&l<=o&&h.push(t[g]);var y=(c+1)%2;(0===c?r<=s:i<=l)&&(u.push(d),u.push(g-1),u.push(y)),(0===c?n>=s:o>=l)&&(u.push(g+1),u.push(f),u.push(y));}}return h}(this.ids,this.coords,t,e,r,i,this.nodeSize)},within:function(t,e,r){return function(t,e,r,i,n,o){for(var a=[0,t.length-1,0],s=[],l=n*n;a.length;){var u=a.pop(),h=a.pop(),c=a.pop();if(h-c<=o)for(var f=c;f<=h;f++)xt(e[2*f],e[2*f+1],r,i)<=l&&s.push(t[f]);else{var d=Math.floor((c+h)/2),p=e[2*d],g=e[2*d+1];xt(p,g,r,i)<=l&&s.push(t[d]);var y=(u+1)%2;(0===u?r-n<=p:i-n<=g)&&(a.push(c),a.push(d-1),a.push(y)),(0===u?r+n>=p:i+n>=g)&&(a.push(d+1),a.push(h),a.push(y));}}return s}(this.ids,this.coords,t,e,r,this.nodeSize)}},Mt.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,initial:function(){return{}},map:function(t){return t}},latY:function(t){return this.projObj.latY(t,1)},lngX:function(t){return this.projObj.lngX(t,1)},xLng:function(t){return this.projObj.xLng(t,1)},yLat:function(t){return this.projObj.yLat(t,1)},load:function(t){var e=this.options.log;e&&console.time("total time");var r="prepare "+t.length+" points";e&&console.time(r),this.points=t;for(var i=[],n=0;n<t.length;n++)t[n].geometry&&i.push(this.createPointCluster(t[n],n));this.trees[this.options.maxZoom+1]=wt(i,zt,Pt,this.options.nodeSize,Float32Array),e&&console.timeEnd(r);for(var o=this.options.maxZoom;o>=this.options.minZoom;o--){var a=+Date.now();i=this._cluster(i,o),this.trees[o]=wt(i,zt,Pt,this.options.nodeSize,Float32Array),e&&console.log("z%d: %d clusters in %dms",o,i.length,+Date.now()-a);}return e&&console.timeEnd("total time"),this},getClusters:function(t,e){var r=((t[0]+180)%360+360)%360-180,i=Math.max(-90,Math.min(90,t[1])),n=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)r=-180,n=180;else if(r>n){var a=this.getClusters([r,i,180,o],e),s=this.getClusters([-180,i,n,o],e);return a.concat(s)}for(var l=this.trees[this._limitZoom(e)],u=l.range(this.lngX(r),this.latY(o),this.lngX(n),this.latY(i)),h=[],c=0;c<u.length;c++){var f=l.points[u[c]];h.push(f.numPoints?getClusterJSON(f):this.points[f.id]);}return h},getChildren:function(t){var e=t>>5,r=t%32,i="No cluster with the specified id.",n=this.trees[r];if(!n)throw new Error(i);var o=n.points[e];if(!o)throw new Error(i);for(var a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=n.within(o.x,o.y,a),l=[],u=0;u<s.length;u++){var h=n.points[s[u]];h.parentId===t&&l.push(h.numPoints?getClusterJSON(h):this.points[h.id]);}if(0===l.length)throw new Error(i);return l},getLeaves:function(t,e,r){e=e||10,r=r||0;var i=[];return this._appendLeaves(i,t,e,r,0),i},getTile:function(t,e,r){var i=this.trees[this._limitZoom(t)],n=Math.pow(2,t),o=this.options.extent,a=this.options.radius/o,s=(r-a)/n,l=(r+1+a)/n,u={features:[]};return this._addTileFeatures(i.range((e-a)/n,s,(e+1+a)/n,l),i.points,e,r,n,u),0===e&&this._addTileFeatures(i.range(1-a/n,s,1,l),i.points,n,r,n,u),e===n-1&&this._addTileFeatures(i.range(0,s,a/n,l),i.points,-1,r,n,u),u.features.length?u:null},getClusterExpansionZoom:function(t){for(var e=t%32-1;e<this.options.maxZoom;){var r=this.getChildren(t);if(e++,1!==r.length)break;t=r[0].properties.cluster_id;}return e},_appendLeaves:function(t,e,r,i,n){for(var o=this.getChildren(e),a=0;a<o.length;a++){var s=o[a].properties;if(s&&s.cluster?n+s.point_count<=i?n+=s.point_count:n=this._appendLeaves(t,s.cluster_id,r,i,n):n<i?n++:t.push(o[a]),t.length===r)break}return n},_addTileFeatures:function(t,e,r,i,n,o){for(var a=0;a<t.length;a++){var s=e[t[a]];o.features.push({type:1,geometry:[[Math.round(this.options.extent*(s.x*n-r)),Math.round(this.options.extent*(s.y*n-i))]],tags:s.numPoints?It(s):this.points[s.id].properties});}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,e){for(var r=[],i=this.options.radius/(this.options.extent*Math.pow(2,e)),n=0;n<t.length;n++){var o=t[n];if(!(o.zoom<=e)){o.zoom=e;var a=this.trees[e+1],s=a.within(o.x,o.y,i),l=o.numPoints||1,u=o.x*l,h=o.y*l,c=null;this.options.reduce&&(c=this.options.initial(),this._accumulate(c,o));for(var f=(n<<5)+(e+1),d=0;d<s.length;d++){var p=a.points[s[d]];if(!(p.zoom<=e)){p.zoom=e;var g=p.numPoints||1;u+=p.x*g,h+=p.y*g,l+=g,p.parentId=f,this.options.reduce&&this._accumulate(c,p);}}1===l?r.push(o):(o.parentId=f,r.push(Tt(u/l,h/l,f,l,c)));}}return r},_accumulate:function(t,e){var r=e.numPoints?e.properties:this.options.map(this.points[e.id].properties);this.options.reduce(t,r);},createPointCluster:function(t,e){var r=t.geometry.coordinates;return{x:this.lngX(r[0]),y:this.latY(r[1]),zoom:1/0,id:e,parentId:-1}},getClusterJSON:function(t){return{type:"Feature",properties:It(t),geometry:{type:"Point",coordinates:[this.xLng(t.x),this.yLat(t.y)]}}}};var Dt=function(t,e){var r,i,n,o,a=e*e,s=0,l=t.length-1,u=[];t[s][3]=1,t[l][3]=1;for(;l;){for(i=0,r=s+1;r<l;r++)(n=Ot(t[r],t[s],t[l]))>i&&(o=r,i=n);i>a?(t[o][3]=i,u.push(s),u.push(o),s=o):(l=u.pop(),s=u.pop());}};function Ot(t,e,r){var i=e[0],n=e[1],o=r[0],a=r[1],s=t[0],l=t[1],u=o-i,h=a-n;if(0!==u||0!==h){var c=((s-i)*u+(l-n)*h)/(u*u+h*h);c>1?(i=o,n=a):c>0&&(i+=u*c,n+=h*c);}return(u=s-i)*u+(h=l-n)*h}var $t=function(t,e,r,i){var n={id:i||null,type:e,geometry:r,tags:t||null,min:[1/0,1/0],max:[-1/0,-1/0]};return function(t){var e=t.geometry,r=t.min,i=t.max;if(1===t.type)Ct(r,i,e);else for(var n=0;n<e.length;n++)Ct(r,i,e[n]);}(n),n};function Ct(t,e,r){for(var i,n=0;n<r.length;n++)i=r[n],t[0]=Math.min(i[0],t[0]),e[0]=Math.max(i[0],e[0]),t[1]=Math.min(i[1],t[1]),e[1]=Math.max(i[1],e[1]);}var Lt=function(t,e,r){var i=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)Vt(i,t.features[n],e,r);else"Feature"===t.type?Vt(i,t,e,r):Vt(i,{geometry:t},e,r);return i};function Vt(t,e,r,i){if(null!==e.geometry){var n,o,a,s,l=e.geometry,u=l.type,h=l.coordinates,c=e.properties,f=e.id;if("Point"===u)t.push($t(c,1,[Ft(h,i)],f));else if("MultiPoint"===u)t.push($t(c,1,Rt(h,null,i),f));else if("LineString"===u)t.push($t(c,2,[Rt(h,r,i)],f));else if("MultiLineString"===u||"Polygon"===u){for(a=[],n=0;n<h.length;n++)s=Rt(h[n],r,i),"Polygon"===u&&(s.outer=0===n),a.push(s);t.push($t(c,"Polygon"===u?3:2,a,f));}else if("MultiPolygon"===u){for(a=[],n=0;n<h.length;n++)for(o=0;o<h[n].length;o++)(s=Rt(h[n][o],r,i)).outer=0===o,a.push(s);t.push($t(c,3,a,f));}else{if("GeometryCollection"!==u)throw new Error("Input data is not a valid GeoJSON object.");for(n=0;n<l.geometries.length;n++)Vt(t,{geometry:l.geometries[n],properties:c},r);}}}function Rt(t,e,r){for(var i=[],n=0;n<t.length;n++)i.push(Ft(t[n],r));return e&&(Dt(i,e),function(t){for(var e,r,i=0,n=0,o=0;o<t.length-1;o++)e=r||t[o],r=t[o+1],i+=e[0]*r[1]-r[0]*e[1],n+=Math.abs(r[0]-e[0])+Math.abs(r[1]-e[1]);t.area=Math.abs(i/2),t.dist=n;}(i)),i}function Ft(e,r){var i=t.default$49(r),n=i.lngX(e[0],1),o=i.latY(e[1],1);return[n,o=o<0?0:o>1?1:o,e[2],0]}function jt(t,e,r,i,n){return[Math.round(e*(t[0]*r-i)),Math.round(e*(t[1]*r-n))].concat(t.slice(2))}var At={tile:function(t,e){if(t.transformed)return t;var r,i,n,o=t.z2,a=t.x,s=t.y;for(r=0;r<t.features.length;r++){var l=t.features[r],u=l.geometry,h=l.type;if(1===h)for(i=0;i<u.length;i++)u[i]=jt(u[i],e,o,a,s);else for(i=0;i<u.length;i++){var c=u[i];for(n=0;n<c.length;n++)c[n]=jt(c[n],e,o,a,s);}}return t.transformed=!0,t},point:jt},Nt=function(t,e,r,i,n,o,a,s){if(i/=e,a>=(r/=e)&&s<=i)return t;if(a>i||s<r)return null;for(var l=[],u=0;u<t.length;u++){var h,c,f=t[u],d=f.geometry,p=f.type;if(h=f.min[n],c=f.max[n],h>=r&&c<=i)l.push(f);else if(!(h>i||c<r)){var g=1===p?Et(d,r,i,n):Gt(d,r,i,n,o,3===p);g.length&&l.push($t(f.tags,p,g,f.id));}}return l.length?l:null};function Et(t,e,r,i){for(var n=[],o=0;o<t.length;o++){var a=t[o],s=a[i];s>=e&&s<=r&&n.push(a);}return n}function Gt(t,e,r,i,n,o){for(var a=[],s=0;s<t.length;s++){var l,u,h,c=0,f=0,d=null,p=t[s],g=p.area,y=p.dist,m=p.outer,v=p.length,x=[];for(u=0;u<v-1;u++)l=d||p[u],d=p[u+1],c=f||l[i],f=d[i],c<e?f>r?(x.push(n(l,d,e),n(l,d,r)),o||(x=Bt(a,x,g,y,m))):f>=e&&x.push(n(l,d,e)):c>r?f<e?(x.push(n(l,d,r),n(l,d,e)),o||(x=Bt(a,x,g,y,m))):f<=r&&x.push(n(l,d,r)):(x.push(l),f<e?(x.push(n(l,d,e)),o||(x=Bt(a,x,g,y,m))):f>r&&(x.push(n(l,d,r)),o||(x=Bt(a,x,g,y,m))));(c=(l=p[v-1])[i])>=e&&c<=r&&x.push(l),h=x[x.length-1],o&&h&&(x[0][0]!==h[0]||x[0][1]!==h[1])&&x.push(x[0]),Bt(a,x,g,y,m);}return a}function Bt(t,e,r,i,n){return e.length&&(e.area=r,e.dist=i,void 0!==n&&(e.outer=n),t.push(e)),[]}var qt=function(t,e,r){var i=t,n=Nt(t,1,-1-e,e,0,r,-1,2),o=Nt(t,1,1-e,2+e,0,r,-1,2);(n||o)&&(i=Nt(t,1,-e,1+e,0,r,-1,2)||[],n&&(i=Jt(n,1).concat(i)),o&&(i=i.concat(Jt(o,-1))));return i};function Jt(t,e){for(var r=[],i=0;i<t.length;i++){var n,o=t[i],a=o.type;if(1===a)n=Zt(o.geometry,e);else{n=[];for(var s=0;s<o.geometry.length;s++)n.push(Zt(o.geometry[s],e));}r.push($t(o.tags,a,n,o.id));}return r}function Zt(t,e){var r=[];r.area=t.area,r.dist=t.dist;for(var i=0;i<t.length;i++)r.push([t[i][0]+e,t[i][1],t[i][2],t[i][3]]);return r}var Wt=function(t,e,r,i,n,o){for(var a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:i,z2:e,transformed:!1,min:[2,1],max:[-1,0]},s=0;s<t.length;s++){a.numFeatures++,Yt(a,t[s],n,o);var l=t[s].min,u=t[s].max;l[0]<a.min[0]&&(a.min[0]=l[0]),l[1]<a.min[1]&&(a.min[1]=l[1]),u[0]>a.max[0]&&(a.max[0]=u[0]),u[1]>a.max[1]&&(a.max[1]=u[1]);}return a};function Yt(t,e,r,i){var n,o,a,s,l=e.geometry,u=e.type,h=[],c=r*r;if(1===u)for(n=0;n<l.length;n++)h.push(l[n]),t.numPoints++,t.numSimplified++;else for(n=0;n<l.length;n++)if(a=l[n],i||!(2===u&&a.dist<r||3===u&&a.area<c)){var f=[];for(o=0;o<a.length;o++)s=a[o],(i||s[3]>c)&&(f.push(s),t.numSimplified++),t.numPoints++;3===u&&Xt(f,a.outer),h.push(f);}else t.numPoints+=a.length;if(h.length){var d={geometry:h,type:u,tags:e.tags||null};null!==e.id&&(d.id=e.id),t.features.push(d);}}function Xt(t,e){(function(t){for(var e,r,i=0,n=0,o=t.length,a=o-1;n<o;a=n++)e=t[n],r=t[a],i+=(r[0]-e[0])*(e[1]+r[1]);return i})(t)<0===e&&t.reverse();}var Ut=function(t,e,r){return new Ht(t,e,r)};function Ht(t,e,r){var i=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;i&&console.time("preprocess data");var n=1<<e.maxZoom,o=Lt(t,e.tolerance/(n*e.extent),r);this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(o=qt(o,e.buffer/e.extent,Kt)).length&&this.splitTile(o,0,0,0),i&&(o.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)));}function Qt(t,e,r){return 32*((1<<t)*r+e)+t}function Kt(t,e,r){return[r,(r-t[0])*(e[1]-t[1])/(e[0]-t[0])+t[1],(r-t[0])*(e[2]-t[2])/(e[0]-t[0])+t[2],1]}function te(t,e,r){return[(r-t[1])*(e[0]-t[0])/(e[1]-t[1])+t[0],r,(r-t[1])*(e[2]-t[2])/(e[1]-t[1])+t[2],1]}function ee(t,e,r){var i=t.source;if(1!==i.length)return!1;var n=i[0];if(3!==n.type||n.geometry.length>1)return!1;var o=n.geometry[0].length;if(5!==o)return!1;for(var a=0;a<o;a++){var s=At.point(n.geometry[0][a],e,t.z2,t.x,t.y);if(s[0]!==-r&&s[0]!==e+r||s[1]!==-r&&s[1]!==e+r)return!1}return!0}function re(t,e,r){var i=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var n=this._geoJSONIndex.getTile(i.z,i.x,i.y);if(!n)return e(null,null);var o=new B(n.features,r),a=nt(o);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),e(null,{vectorTile:o,rawData:a.buffer});}Ht.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:!1,tolerance:3,extent:4096,buffer:64,debug:0},Ht.prototype.splitTile=function(t,e,r,i,n,o,a){for(var s=[t,e,r,i],l=this.options,u=l.debug,h=null;s.length;){i=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,f=Qt(e,r,i),d=this.tiles[f],p=e===l.maxZoom?0:l.tolerance/(c*l.extent);if(!d&&(u>1&&console.time("creation"),d=this.tiles[f]=Wt(t,c,r,i,p,e===l.maxZoom),this.tileCoords.push({z:e,x:r,y:i}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,i,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var g="z"+e;this.stats[g]=(this.stats[g]||0)+1,this.total++;}if(d.source=t,n){if(e===l.maxZoom||e===n)continue;var y=1<<n-e;if(r!==Math.floor(o/y)||i!==Math.floor(a/y))continue}else if(e===l.indexMaxZoom||d.numPoints<=l.indexMaxPoints)continue;if(l.solidChildren||!ee(d,l.extent,l.buffer)){d.source=null,u>1&&console.time("clipping");var m,v,x,w,_,b,S=.5*l.buffer/l.extent,M=.5-S,T=.5+S,I=1+S;m=v=x=w=null,_=Nt(t,c,r-S,r+T,0,Kt,d.min[0],d.max[0]),b=Nt(t,c,r+M,r+I,0,Kt,d.min[0],d.max[0]),_&&(m=Nt(_,c,i-S,i+T,1,te,d.min[1],d.max[1]),v=Nt(_,c,i+M,i+I,1,te,d.min[1],d.max[1])),b&&(x=Nt(b,c,i-S,i+T,1,te,d.min[1],d.max[1]),w=Nt(b,c,i+M,i+I,1,te,d.min[1],d.max[1])),u>1&&console.timeEnd("clipping"),t.length&&(s.push(m||[],e+1,2*r,2*i),s.push(v||[],e+1,2*r,2*i+1),s.push(x||[],e+1,2*r+1,2*i),s.push(w||[],e+1,2*r+1,2*i+1));}else n&&(h=e);}return h},Ht.prototype.getTile=function(t,e,r){var i=this.options,n=i.extent,o=i.debug,a=1<<t,s=Qt(t,e=(e%a+a)%a,r);if(this.tiles[s])return At.tile(this.tiles[s],n);o>1&&console.log("drilling down to z%d-%d-%d",t,e,r);for(var l,u=t,h=e,c=r;!l&&u>0;)u--,h=Math.floor(h/2),c=Math.floor(c/2),l=this.tiles[Qt(u,h,c)];if(!l||!l.source)return null;if(o>1&&console.log("found parent tile z%d-%d-%d",u,h,c),ee(l,n,i.buffer))return At.tile(l,n);o>1&&console.time("drilling down");var f=this.splitTile(l.source,u,h,c,t,e,r);if(o>1&&console.timeEnd("drilling down"),null!==f){var d=1<<t-f;s=Qt(f,Math.floor(e/d),Math.floor(r/d));}return this.tiles[s]?At.tile(this.tiles[s],n):null};var ie=function(e){function r(r,i,n,o){e.call(this,r,i,re),n&&(this.loadGeoJSON=n),this.projection=o||t.ProjectionType.MERCATOR;}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData());},r.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var r=this._pendingCallback,i=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var n=!!(i&&i.request&&i.request.collectResourceTiming)&&new z.Performance(i.request);this.loadGeoJSON(i,function(o,a){if(o||!a)return r(o);if("object"!=typeof a)return r(new Error("Input data is not a valid GeoJSON object."));F(a,!0);try{i.superclusterOptions&&(i.superclusterOptions.projection=e.projection||t.ProjectionType.MERCATOR),e._geoJSONIndex=i.cluster?(s=i.superclusterOptions,new Mt(s)).load(a.features):Ut(a,i.geojsonVtOptions,e.projection);}catch(o){return r(o)}e.loaded={};var s,l={};if(n){var u=n.finish();u&&(l.resourceTiming={},l.resourceTiming[i.source]=JSON.parse(JSON.stringify(u)));}r(null,l);});}},r.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData());},r.prototype.reloadTile=function(t,r){var i=this.loaded,n=t.uid;return i&&i[n]?e.prototype.reloadTile.call(this,t,r):this.loadTile(t,r)},r.prototype.loadGeoJSON=function(e,r){if(e.request)t.getJSON(e.request,r);else{if("string"!=typeof e.data)return r(new Error("Input data is not a valid GeoJSON object."));try{return r(null,JSON.parse(e.data))}catch(t){return r(new Error("Input data is not a valid GeoJSON object."))}}},r.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e();},r.prototype.getClusterExpansionZoom=function(t,e){e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId));},r.prototype.getClusterChildren=function(t,e){e(null,this._geoJSONIndex.getChildren(t.clusterId));},r.prototype.getClusterLeaves=function(t,e){e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset));},r}(O),ne=function(e,r,i){this.loadGltf=i||new t.GLTFReader;};ne.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData());},ne.prototype._loadData=function(){if(this._pendingCallback&&this._pendingLoadDataParams){var t=this._pendingCallback,e=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;!!(e&&e.request&&e.request.collectResourceTiming)&&new z.Performance(e.request);this.loaded={},this.loadGltf.load(e.request,function(e,r){e&&t(e,null),t(null,{gltf:r.gltf,bufferData:r.bufferData,resourceTiming:{}});});}},ne.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData());},ne.prototype.reloadTile=function(t,e){},ne.prototype.loadTile=function(t,e){},ne.prototype.abortTile=function(t,e){},ne.prototype.removeTile=function(t,e){};var oe=function(t,e,r){this.actor=t,this.loading={},this.loaded={};};oe.prototype.loadTile=function(t,e){this.loaded[t.uid]?e(null,this.loaded[t.uid]):this._loadData(t,e);},oe.prototype._loadData=function(e,r){var i=this,n=!!(e&&e.request&&e.request.collectResourceTiming)&&new z.Performance(e.request);this.loading[e.uid]=new t.GLTFReader,this.loading[e.uid].load(e.request,function(t,o){!t&&o||r(t,null),delete i.loading[e.uid],o.gltf;var a={gltf:o.gltf,bufferData:o.bufferData,resourceTiming:{}};if(n){var s=n.finish();s&&(a.resourceTiming[e.source]=JSON.parse(JSON.stringify(s)));}r(null,a);});},oe.prototype.reloadTile=function(t,e){var r=this.loaded,i=t.uid;r&&r[i]&&e(null,this.loaded[t.uid]);},oe.prototype.abortTile=function(t,e){var r=this.loading,i=t.uid;r&&r[i]&&r[i].abort&&(r[i].abort(),delete r[i]),e();},oe.prototype.removeTile=function(t,e){var r=this.loaded,i=t.uid;r&&r[i]&&delete r[i],e();};var ae={read:function(t,e){return t.readFields(ae._readField,{Geometrys:[],row:0,col:0,col_dpi:0,row_dpi:0,minlon:0,minlat:0,maxlon:0,maxlat:0},e)},_readField:function(t,e,r){1===t?e.Geometrys.push(ae.Geometry.read(r,r.readVarint()+r.pos)):2===t?e.row=r.readVarint():3===t?e.col=r.readVarint():4===t?e.col_dpi=r.readVarint():5===t?e.row_dpi=r.readVarint():6===t?e.minlon=r.readVarint():7===t?e.minlat=r.readVarint():8===t?e.maxlon=r.readVarint():9===t&&(e.maxlat=r.readVarint());},write:function(t,e){if(t.Geometrys)for(var r=0;r<t.Geometrys.length;r++)e.writeMessage(1,ae.Geometry.write,t.Geometrys[r]);t.row&&e.writeVarintField(2,t.row),t.col&&e.writeVarintField(3,t.col),t.col_dpi&&e.writeVarintField(4,t.col_dpi),t.row_dpi&&e.writeVarintField(5,t.row_dpi),t.minlon&&e.writeVarintField(6,t.minlon),t.minlat&&e.writeVarintField(7,t.minlat),t.maxlon&&e.writeVarintField(8,t.maxlon),t.maxlat&&e.writeVarintField(9,t.maxlat);},Geometry:{}};ae.Geometry.read=function(t,e){return t.readFields(ae.Geometry._readField,{x:0,y:0,z:0},e)},ae.Geometry._readField=function(t,e,r){1===t?e.x=r.readVarint():2===t?e.y=r.readVarint():3===t&&(e.z=r.readVarint(!0));},ae.Geometry.write=function(t,e){t.x&&e.writeVarintField(1,t.x),t.y&&e.writeVarintField(2,t.y),t.z&&e.writeVarintField(3,t.z);};var se=function(t){this.originData=t;};se.prototype.parse=function(){this.data=ae.read(new t.default$60(this.originData));},se.prototype.setData=function(t){this.originData=t;},se.prototype.getResult=function(){return this.data};var le=function(t,e,r){this.actor=t,this.loading={},this.loaded={};};le.prototype.loadTile=function(t,e){this._loadData(t,e);},le.prototype._loadData=function(e,r){var i=this;this.loading[e.uid]={imgRequest:null,binRequest:null},this.loading[e.uid].imgRequest=t.getArrayBuffer(e.request,function(n,o){n?r(n,null):e.terrainRequest&&e.terrainRequest.url&&e.terrainRequest.url.length>0?i.loading[e.uid].binRequest=t.getArrayBuffer(e.terrainRequest,function(t,n){if(t)r(t,null);else{var a={img:o};i.parseTerrainData(n),a.terrainData=i.demTileData.getResult(),delete i.loading[e.uid],i.loaded[e.uid]=a,r(null,a);}}):r(null,{img:o});});},le.prototype.reloadTile=function(t,e){this._loadData(t,e);},le.prototype.abortTile=function(t,e){var r=this.loading,i=t.uid;r&&r[i]&&(r[i].imgRequest&&r[i].imgRequest.cancel(),r[i].binRequest&&r[i].binRequest.cancel(),delete r[i]),e();},le.prototype.removeTile=function(t,e){var r=this.loaded,i=t.uid;r&&r[i]&&delete r[i],e();},le.prototype.parseTerrainData=function(t){this.demTileData?this.demTileData.setData(t.data):this.demTileData=new se(t.data),this.demTileData.parse();},le.prototype.trianglesIntersact=function(e,r){var i,n=1/0,o=[],a=new t.default$28(e.ray.origin,e.ray.direction),s={};for(var l in e.tiles){var u=e.tiles[l],h=u.placedAabb;if(h){var c=a.intersectBox(h,[]);if(c){if(t.dot(a.direction,t.sub([],c,a.origin))<0)continue;s[l]=u;}}}for(var f in s)for(var d=s[f],p=0;p<d.data.length;p++){var g=a.intersectTriangle.apply(a,d.data[p].concat([!1],[[]]));if(g){var y=t.dist(e.ray.origin,g);y<n&&(n=y,i=f,o=g);}}if(n!==1/0){var m=[];t.transformGeographicToECEF(m,o),r(null,{dist:n*t.default$11.TRANSFORM.R_ZOOM,savedPoint:o,savedTile:i,lng:m[0],lat:m[1],alt:m[2]*t.default$11.TRANSFORM.R_ZOOM-t.default$11.TRANSFORM.REAL_R});}else r(null,{});},le.prototype._calcAabb=function(t){for(var e=1/0,r=1/0,i=1/0,n=-1/0,o=-1/0,a=-1/0,s=0;s<t.length;s++)for(var l=t[s],u=0;u<3;u++){var h=l[u];e>h[0]&&(e=h[0]),n<h[0]&&(n=h[0]),r>h[1]&&(r=h[1]),o<h[1]&&(o=h[1]),i>h[2]&&(i=h[2]),a<h[2]&&(a=h[2]);}return[[e,r,i],[n,o,a]]};var ue=function(e){var r=this;this.self=e,this.actor=new t.default$61(e,this),this.layerIndexes={},this.workerSourceTypes={vector:O,geojson:ie,"3d-model":ne,"3d-tile":oe,raster:le},this.workerSources={},this.self.registerWorkerSource=function(t,e){if(r.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');r.workerSourceTypes[t]=e;},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isLoaded())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText;};};return ue.prototype.setProjection=function(t,e,r){this.projection=e.projection,r();},ue.prototype.setLayers=function(t,e,r){this.getLayerIndex(t).replace(e),r();},ue.prototype.updateLayers=function(t,e,r){this.getLayerIndex(t).update(e.layers,e.removedIds),r();},ue.prototype.loadTile=function(t,e,r){e.projection=this.projection,this.getWorkerSource(t,e.type,e.source).loadTile(e,r);},ue.prototype.reloadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).reloadTile(e,r);},ue.prototype.abortTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).abortTile(e,r);},ue.prototype.removeTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).removeTile(e,r);},ue.prototype.removeSource=function(t,e,r){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var i=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==i.removeSource?i.removeSource(e,r):r();}},ue.prototype.trianglesIntersact=function(t,e,r){"raster"===e.type&&this.getWorkerSource(t,e.type,e.source).trianglesIntersact(e,r);},ue.prototype.loadWorkerSource=function(t,e,r){try{this.self.importScripts(e.url),r();}catch(t){r(t.toString());}},ue.prototype.loadRTLTextPlugin=function(e,r,i){try{t.plugin.isLoaded()||(this.self.importScripts(r),i(t.plugin.isLoaded()?null:new Error("RTL Text Plugin failed to import scripts from "+r)));}catch(t){i(t.toString());}},ue.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new i),e},ue.prototype.getWorkerSource=function(e,r,i){var n=this;if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][r]||(this.workerSources[e][r]={}),!this.workerSources[e][r][i]){var o={send:function(t,r,i){n.actor.send(t,r,i,e);}},a=this.projection||t.ProjectionType.MERCATOR;this.workerSources[e][r][i]=new this.workerSourceTypes[r](o,this.getLayerIndex(e),null,a);}return this.workerSources[e][r][i]},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&new ue(self),ue});

define(["./chunk1.js"],function(e){"use strict";var t=e.createCommonjsModule(function(e){function t(e){return!i(e)}function i(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,i=new Blob([""],{type:"text/javascript"}),a=URL.createObjectURL(i);try{t=new Worker(a),e=!0;}catch(t){e=!1;}t&&t.terminate();return URL.revokeObjectURL(a),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var i=t.getImageData(0,0,1,1);return i&&i.width===e.width}()?function(e){void 0===a[e]&&(a[e]=function(e){var i=function(e){var i=document.createElement("canvas"),a=Object.create(t.webGLContextAttributes);return a.failIfMajorPerformanceCaveat=e,i.probablySupportsContext?i.probablySupportsContext("webgl",a)||i.probablySupportsContext("experimental-webgl",a):i.supportsContext?i.supportsContext("webgl",a)||i.supportsContext("experimental-webgl",a):i.getContext("webgl",a)||i.getContext("experimental-webgl",a)}(e);if(!i)return!1;var a=i.createShader(i.VERTEX_SHADER);if(!a||i.isContextLost())return!1;return i.shaderSource(a,"void main() {}"),i.compileShader(a),!0===i.getShaderParameter(a,i.COMPILE_STATUS)}(e));return a[e]}(e&&e.failIfMajorPerformanceCaveat)?void 0:"insufficient WebGL support":"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support"}e.exports?e.exports=t:window&&(window.minemap=window.minemap||{},window.minemap.supported=t,window.minemap.notSupportedReason=i);var a={};t.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};}),i={DOMAIN:"//minedata.cn",DATA_DOMAIN:"//datahive.minedata.cn",API_BASE:"/data/",API_URL:"//datahive.minedata.cn/data/",DYN_BASE:"/dynamicdata/",DYN_URL:"//datahive.minedata.cn/dynamicdata/",MERGE_BASE:"/mergeddata/",MERGE_URL:"//datahive.minedata.cn/mergeddata/",OTHER_BASE:"/otherdata/",OTHER_URL:"//datahive.minedata.cn/otherdata/",SRC_BASE:"/minemapapi/v3.1.0/",SRC_URL:"//minedata.cn/minemapapi/v3.1.0/",SERVICE_BASE:"/service",SERVICE_URL:"//minedata.cn/service",REQUIRE_ACCESS_TOKEN:!0,APP_KEY:null,ACCESS_TOKEN:null},a="参见minedata.cn帮助页面";function o(e,t){return Array.isArray(e)?t&&t.x&&t.y?e[(t.x+t.y)%e.length]:e[0]:e}function r(e,t,r,n,s){switch(e.protocol){case"minemap":var l=p(i.SRC_URL);e.protocol=l.protocol,e.authority=l.authority;break;case"minemapdata":var u=p(o(i.API_URL,s));e.path=u.path+e.authority+e.path,e.protocol=u.protocol,e.authority=u.authority;break;case"minemapdatad":var c=p(o(i.DYN_URL||"",s));e.path=c.path+e.authority+e.path,e.protocol=c.protocol,e.authority=c.authority;break;case"minemapdatam":var _=p(o(i.MERGE_URL||"",s));e.path=_.path+e.authority+e.path,e.protocol=_.protocol,e.authority=_.authority;break;case"minemapdatao":var f=p(o(i.OTHER_URL||"",s));e.path=f.path+e.authority+e.path,e.protocol=f.protocol,e.authority=f.authority;}if(!i.REQUIRE_ACCESS_TOKEN)return h(e);if(t=t||i.APP_KEY,r=r||i.SOLU,n=n||i.DATA_VERSION,!t&&!i.ACCESS_TOKEN)throw new Error("需要申请appKey. "+a);if(!r)throw new Error("需要申请solution id. "+a);return i.ACCESS_TOKEN&&e.params.push("token="+i.ACCESS_TOKEN),t&&e.params.push("appKey="+t),e.params.push("solu="+r),n&&e.params.push("version="+n),h(e)}function n(e){return 0===e.indexOf("minemap:")||0===e.indexOf("minemapdata:")||0===e.indexOf("minemapdatad:")||0===e.indexOf("minemapdatam:")||0===e.indexOf("minemapdatao:")}var s=function(e,t){if(!n(e))return e;var i=p(e);return i.path="/styles/v1"+i.path,r(i,t)},l=function(e){if(!n(e)&&!i.fontsUrl)return e;var t=p(e);return i.fontsUrl&&i.fontsUrl+"/{fontstack}"+t.path.substr(t.path.lastIndexOf("/"))+".pbf"||i.SRC_URL+"fonts/{fontstack}/"+t.path.substr(t.path.lastIndexOf("/"))+".pbf"},u=function(e,t){if(!n(e))return e;var i=p(e);return i.path="/v4/"+i.authority+".json",i.params.push("secure"),r(i,t)},c=function(e,t,a){if(!n(e)&&!i.spriteUrl)return""+e+t+a;var o=p(e);return o.path=i.SRC_URL+"sprite/sprite"+t+a,i.spriteUrl&&""+i.spriteUrl+t+a||o.path},_=/(\.(png|jpg)\d*)(?=$)/,f=function(t,a,o,s){if(!t||!n(t))return t.startsWith("//")?""+window.document.location.protocol+t:t;var l=p(t),u=e.default.devicePixelRatio>=2||512===o?"@2x":"",c=e.default.supportsWebp?".webp":"$1";return l.path=l.path.replace(_,""+u+c),function(e){for(var t=0;t<e.length;t++)0===e[t].indexOf("access_token=tk.")&&(e[t]="access_token="+(i.ACCESS_TOKEN||""));}(l.params),r(l,void 0,void 0,void 0,s)};var m=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function p(e){var t=e.match(m);if(!t){var i=e.match(/^\/\/([^/?]+)(\/[^?]+)?\??(.+)?/);if(!i)throw new Error("Unable to parse URL object");return{protocol:"",authority:i[1],path:i[2]||"/",params:i[3]?i[3].split("&"):[]}}return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function h(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol&&e.protocol.length>0?e.protocol+"://"+e.authority+e.path+t:window.document.location.protocol+"//"+e.authority+e.path+t}var d={create:function(t,i,a){var o=e.default$2.document.createElement(t);return i&&(o.className=i),a&&a.appendChild(o),o},createNS:function(t,i){return e.default$2.document.createElementNS(t,i)}},g=e.default$2.document?e.default$2.document.documentElement.style:null;function v(e){if(!g)return null;for(var t=0;t<e.length;t++)if(e[t]in g)return e[t];return e[0]}var y,x=v(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);d.disableDrag=function(){g&&x&&(y=g[x],g[x]="none");},d.enableDrag=function(){g&&x&&(g[x]=y);};var b=v(["transform","WebkitTransform"]);d.setTransform=function(e,t){e.style[b]=t;};var w=v(["transformOrigin","WebkitTransformOrigin"]);d.setTransformOrigin=function(e,t){e.style[w]=t;},d.getAllStyle=function(t){return e.default$2.getComputedStyle(t)};var A=!1;try{var T=Object.defineProperty({},"passive",{get:function(){A=!0;}});e.default$2.addEventListener("test",T,T),e.default$2.removeEventListener("test",T,T);}catch(e){A=!1;}d.addEventListener=function(e,t,i,a){void 0===a&&(a={}),"passive"in a&&A?e.addEventListener(t,i,a):e.addEventListener(t,i,a.capture);},d.removeEventListener=function(e,t,i,a){void 0===a&&(a={}),"passive"in a&&A?e.removeEventListener(t,i,a):e.removeEventListener(t,i,a.capture);};var E=function(t){t.preventDefault(),t.stopPropagation(),e.default$2.removeEventListener("click",E,!0);};d.suppressClick=function(){e.default$2.addEventListener("click",E,!0),e.default$2.setTimeout(function(){e.default$2.removeEventListener("click",E,!0);},0);},d.mousePos=function(t,i){var a=t.getBoundingClientRect();return i=i.touches?i.touches[0]:i,new e.default$1(i.clientX-a.left-t.clientLeft,i.clientY-a.top-t.clientTop)},d.touchPos=function(t,i){for(var a=t.getBoundingClientRect(),o=[],r="touchend"===i.type?i.changedTouches:i.touches,n=0;n<r.length;n++)o.push(new e.default$1(r[n].clientX-a.left-t.clientLeft,r[n].clientY-a.top-t.clientTop));return o},d.mouseButton=function(t){return void 0!==e.default$2.InstallTrigger&&2===t.button&&t.ctrlKey&&e.default$2.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},d.remove=function(e){e.parentNode&&e.parentNode.removeChild(e);};var P=function(){this.images={},this.loaded=!1,this.requestors=[],this.shelfPack=new e.default$3(64,64,{autoResize:!0}),this.patterns={},this.atlasImage=new e.RGBAImage({width:64,height:64}),this.dirty=!0;};P.prototype.isLoaded=function(){return this.loaded},P.prototype.setLoaded=function(e){if(this.loaded!==e&&(this.loaded=e,e)){for(var t=0,i=this.requestors;t<i.length;t+=1){var a=i[t],o=a.ids,r=a.callback;this._notify(o,r);}this.requestors=[];}},P.prototype.getImage=function(e){return this.images[e]},P.prototype.addImage=function(e,t){this.images[e]=t;},P.prototype.removeImage=function(e){delete this.images[e];var t=this.patterns[e];t&&(this.shelfPack.unref(t.bin),delete this.patterns[e]);},P.prototype.listImages=function(){return Object.keys(this.images)},P.prototype.getImages=function(e,t){var i=!0;if(!this.isLoaded())for(var a=0,o=e;a<o.length;a+=1){var r=o[a];this.images[r]||(i=!1);}this.isLoaded()||i?this._notify(e,t):this.requestors.push({ids:e,callback:t});},P.prototype._notify=function(e,t){for(var i={},a=0,o=e;a<o.length;a+=1){var r=o[a],n=this.images[r];n&&(i[r]={data:n.data.clone(),pixelRatio:n.pixelRatio,sdf:n.sdf});}t(null,i);},P.prototype.getPixelSize=function(){return{width:this.shelfPack.w,height:this.shelfPack.h}},P.prototype.getPattern=function(t){var i=this.patterns[t];if(i)return i.position;var a=this.getImage(t);if(!a)return null;var o=a.data.width+2,r=a.data.height+2,n=this.shelfPack.packOne(o,r);if(!n)return null;this.atlasImage.resize(this.getPixelSize());var s=a.data,l=this.atlasImage,u=n.x+1,c=n.y+1,_=s.width,f=s.height;e.RGBAImage.copy(s,l,{x:0,y:0},{x:u,y:c},{width:_,height:f}),e.RGBAImage.copy(s,l,{x:0,y:f-1},{x:u,y:c-1},{width:_,height:1}),e.RGBAImage.copy(s,l,{x:0,y:0},{x:u,y:c+f},{width:_,height:1}),e.RGBAImage.copy(s,l,{x:_-1,y:0},{x:u-1,y:c},{width:1,height:f}),e.RGBAImage.copy(s,l,{x:0,y:0},{x:u+_,y:c},{width:1,height:f}),this.dirty=!0;var m=new e.ImagePosition(n,a);return this.patterns[t]={bin:n,position:m},m},P.prototype.bind=function(t){var i=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.default$4(t,this.atlasImage,i.RGBA),this.atlasTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE);};var S=M,I=1e20;function M(e,t,i,a,o,r){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=a||.25,this.fontFamily=o||"sans-serif",this.fontWeight=r||"normal",this.radius=i||8;var n=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=n,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(n*n),this.gridInner=new Float64Array(n*n),this.f=new Float64Array(n),this.d=new Float64Array(n),this.z=new Float64Array(n+1),this.v=new Int16Array(n),this.middle=Math.round(n/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1));}function R(e,t,i,a,o,r,n){for(var s=0;s<t;s++){for(var l=0;l<i;l++)a[l]=e[l*t+s];for(C(a,o,r,n,i),l=0;l<i;l++)e[l*t+s]=o[l];}for(l=0;l<i;l++){for(s=0;s<t;s++)a[s]=e[l*t+s];for(C(a,o,r,n,t),s=0;s<t;s++)e[l*t+s]=Math.sqrt(o[s]);}}function C(e,t,i,a,o){i[0]=0,a[0]=-I,a[1]=+I;for(var r=1,n=0;r<o;r++){for(var s=(e[r]+r*r-(e[i[n]]+i[n]*i[n]))/(2*r-2*i[n]);s<=a[n];)n--,s=(e[r]+r*r-(e[i[n]]+i[n]*i[n]))/(2*r-2*i[n]);i[++n]=r,a[n]=s,a[n+1]=+I;}for(r=0,n=0;r<o;r++){for(;a[n+1]<r;)n++;t[r]=(r-i[n])*(r-i[n])+e[i[n]];}}M.prototype.draw=function(e){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(e,this.buffer,this.middle);for(var t=this.ctx.getImageData(0,0,this.size,this.size),i=new Uint8ClampedArray(this.size*this.size),a=0;a<this.size*this.size;a++){var o=t.data[4*a+3]/255;this.gridOuter[a]=1===o?0:0===o?I:Math.pow(Math.max(0,.5-o),2),this.gridInner[a]=1===o?I:0===o?0:Math.pow(Math.max(0,o-.5),2);}for(R(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),R(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),a=0;a<this.size*this.size;a++){var r=this.gridOuter[a]-this.gridInner[a];i[a]=Math.max(0,Math.min(255,Math.round(255-255*(r/this.radius+this.cutoff))));}return i};var O=function(e,t){this.requestTransform=e,this.localIdeographFontFamily=t,this.entries={};};O.prototype.setURL=function(e){this.url=e;},O.prototype.getGlyphs=function(t,i){var a=this,o=[];for(var r in t)for(var n=0,s=t[r];n<s.length;n+=1){var l=s[n];o.push({stack:r,id:l});}e.asyncAll(o,function(e,t){var i=e.stack,o=e.id,r=a.entries[i];r||(r=a.entries[i]={glyphs:{},requests:{}});var n=r.glyphs[o];if(void 0===n)if(n=a._tinySDF(r,i,o))t(null,{stack:i,id:o,glyph:n});else{var s=Math.floor(o/256);if(256*s>65535)t(new Error("glyphs > 65535 not supported"));else{var l=r.requests[s];l||(l=r.requests[s]=[],O.loadGlyphRange(i,s,a.url,a.requestTransform,function(e,t){if(t)for(var i in t)r.glyphs[+i]=t[+i];for(var a=0,o=l;a<o.length;a+=1){(0,o[a])(e,t);}delete r.requests[s];})),l.push(function(e,a){e?t(e):a&&t(null,{stack:i,id:o,glyph:a[o]||null});});}}else t(null,{stack:i,id:o,glyph:n});},function(e,t){if(e)i(e);else if(t){for(var a={},o=0,r=t;o<r.length;o+=1){var n=r[o],s=n.stack,l=n.id,u=n.glyph;(a[s]||(a[s]={}))[l]=u&&{id:u.id,bitmap:u.bitmap.clone(),metrics:u.metrics};}i(null,a);}});},O.prototype._tinySDF=function(t,i,a){var o=this.localIdeographFontFamily;if(o&&(e.default$6["CJK Unified Ideographs"](a)||e.default$6["Hangul Syllables"](a))){var r=t.tinySDF;if(!r){r=t.tinySDF=new O.TinySDF(24,3,10,.25,o,"600");}return{id:a,bitmap:new e.AlphaImage({width:30,height:30},r.draw(String.fromCharCode(a))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},O.loadGlyphRange=function(t,i,a,o,r){var n=256*i,s=n+255,u=o(l(a).replace("{fontstack}",t).replace("{range}",n+"-"+s),e.ResourceType.Glyphs);e.getArrayBuffer(u,function(t,i){if(t)r(t);else if(i){for(var a={},o=0,n=e.default$5(i.data);o<n.length;o+=1){var s=n[o];a[s.id]=s;}r(null,a);}});},O.TinySDF=S;var F=function(){this.specification=e.default$7.light.position;};F.prototype.possiblyEvaluate=function(t,i){return e.sphericalToCartesian(t.expression.evaluate(i))},F.prototype.interpolate=function(t,i,a){return{x:e.number(t.x,i.x,a),y:e.number(t.y,i.y,a),z:e.number(t.z,i.z,a)}};var L=new e.Properties({anchor:new e.DataConstantProperty(e.default$7.light.anchor),position:new F,color:new e.DataConstantProperty(e.default$7.light.color),intensity:new e.DataConstantProperty(e.default$7.light.intensity)}),D=function(t){function i(i){t.call(this),this._transitionable=new e.Transitionable(L),this.setLight(i),this._transitioning=this._transitionable.untransitioned();}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.getLight=function(){return this._transitionable.serialize()},i.prototype.setLight=function(t){if(!this._validate(e.validateLight,t))for(var i in t){var a=t[i];e.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-"-transition".length),a):this._transitionable.setValue(i,a);}},i.prototype.updateTransitions=function(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning);},i.prototype.hasTransition=function(){return this._transitioning.hasTransition()},i.prototype.recalculate=function(e){this.properties=this._transitioning.possiblyEvaluate(e);},i.prototype._validate=function(t,i){return e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:i,style:{glyphs:!0,sprite:!0},styleSpec:e.default$7})))},i}(e.Evented),z=function(e,t){this.width=e,this.height=t,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={};};function N(t,i,a){var o=function(t,i){if(t)return a(t);if(i){var o=e.pick(i,["tiles","minzoom","maxzoom","attribution","minemap_logo","bounds"]);i.vector_layers&&(o.vectorLayers=i.vector_layers,o.vectorLayerIds=o.vectorLayers.map(function(e){return e.id})),a(null,o);}};return t.url?e.getJSON(i(u(t.url),e.ResourceType.Source),o):e.default.frame(function(){return o(null,t)})}z.prototype.getDash=function(e,t){var i=e.join(",")+String(t);return this.positions[i]||(this.positions[i]=this.addDash(e,t)),this.positions[i]},z.prototype.addDash=function(t,i){var a=i?7:0,o=2*a+1;if(this.nextRow+o>this.height)return e.warnOnce("LineAtlas out of space"),null;for(var r=0,n=0;n<t.length;n++)r+=t[n];for(var s=this.width/r,l=s/2,u=t.length%2==1,c=-a;c<=a;c++)for(var _=this.nextRow+a+c,f=this.width*_,m=u?-t[t.length-1]:0,p=t[0],h=1,d=0;d<this.width;d++){for(;p<d/s;)m=p,p+=t[h],u&&h===t.length-1&&(p+=t[0]),h++;var g=Math.abs(d-m*s),v=Math.abs(d-p*s),y=Math.min(g,v),x=h%2==1,b=void 0;if(i){var w=a?c/a*(l+1):0;if(x){var A=l-Math.abs(w);b=Math.sqrt(y*y+A*A);}else b=l-Math.sqrt(y*y+w*w);}else b=(x?1:-1)*y;this.data[3+4*(f+d)]=Math.max(0,Math.min(255,b+128));}var T={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:r};return this.nextRow+=o,this.dirty=!0,T},z.prototype.bind=function(e){var t=e.gl;this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,this.data));};var B=function(t,i,a){this.bounds=e.default$9.convert(this.validateBounds(t)),this.minzoom=i||0,this.maxzoom=a||24;};B.prototype.validateBounds=function(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]},B.prototype.contains=function(e){var t=Math.floor(this.lngX(this.bounds.getWest(),e.z)),i=Math.floor(this.latY(this.bounds.getNorth(),e.z)),a=Math.ceil(this.lngX(this.bounds.getEast(),e.z)),o=Math.ceil(this.latY(this.bounds.getSouth(),e.z));return e.x>=t&&e.x<a&&e.y>=i&&e.y<o},B.prototype.lngX=function(e,t){return(e+180)*(Math.pow(2,t)/360)},B.prototype.latY=function(t,i){var a=e.clamp(Math.sin(Math.PI/180*t),-.9999,.9999),o=Math.pow(2,i)/(2*Math.PI);return Math.pow(2,i-1)+.5*Math.log((1+a)/(1-a))*-o};var k=function(t){function i(i,a,o,r){if(t.call(this),this.id=i,this.dispatcher=o,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this.tileUsage=a.tileUsage||"plain",e.extend(this,e.pick(a,["url","scheme","tileSize"])),this._options=e.extend({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r);}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.load=function(){var t=this;this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=N(this._options,this.map._transformRequest,function(i,a){t._tileJSONRequest=null,i?t.fire(new e.ErrorEvent(i)):a&&(e.extend(t,a),a.bounds&&(t.tileBounds=new B(a.bounds,t.minzoom,t.maxzoom)),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})));});},i.prototype.hasTile=function(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)},i.prototype.onAdd=function(e){this.map=e,this.load();},i.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);},i.prototype.serialize=function(){return e.extend({},this._options)},i.prototype.loadTile=function(t,i){var a=t.tileID.canonical.toRealCoord(this.scheme),o=f(t.tileID.canonical.url(this.tiles,this.scheme),this.url,void 0,a),r={request:this.map._transformRequest(o,e.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.default.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};function n(e,a){return t.aborted?i(null):e?i(e):(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}r.request.collectResourceTiming=this._collectResourceTiming,void 0===t.workerID||"expired"===t.state?t.workerID=this.dispatcher.send("loadTile",r,n.bind(this)):"loading"===t.state?t.reloadCallback=i:this.dispatcher.send("reloadTile",r,n.bind(this),t.workerID);},i.prototype.abortTile=function(e){this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);},i.prototype.unloadTile=function(e){e.unloadVectorData(),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);},i.prototype.hasTransition=function(){return!1},i.prototype.isEarthSource=function(){return"all"===this.tileUsage||"sphere"===this.tileUsage},i}(e.Evented),$=function(t){function i(i,a,o,r){t.call(this),this.id=i,this.dispatcher=o,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this.tileUsage="plain",this.noLowLevelCover=!!a.noLowLevelCover,this._options=e.extend({},a),e.extend(this,e.pick(a,["url","scheme","tileSize","tileUsage","tiles","renderWithTerrain","terrainTiles","translation"])),this.translation||(this.translation=[0,0,0]);}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.setSharedTerrainTileCache=function(e){this.sttc=e;},i.prototype.load=function(){var t=this;this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=N(this._options,this.map._transformRequest,function(i,a){t._tileJSONRequest=null,i?t.fire(new e.ErrorEvent(i)):a&&(e.extend(t,a),a.bounds&&(t.tileBounds=new B(a.bounds,t.minzoom,t.maxzoom)),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})));});},i.prototype.onAdd=function(e){this.map=e,this.load();},i.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);},i.prototype.serialize=function(){return e.extend({},this._options)},i.prototype.hasTile=function(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)},i.prototype.loadTile=function(t,i){var a=t.tileID.canonical.toRealCoord(this.scheme),o=f(t.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize,a),r=this.renderWithTerrain?f(t.tileID.canonical.url(this.terrainTiles,this.scheme),this.url,this.tileSize,a):"",n={request:this.map._transformRequest(o,e.ResourceType.Tile),terrainRequest:{url:r},renderWithTerrain:this.renderWithTerrain&&t.tileID.canonical.z>=e.default$11.TRANSFORM.TERRAIN_FIND_ZOOM_MIN,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.default.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};function s(a,o){return t.aborted?i(null):a?i(a):(o&&o.resourceTiming&&(t.resourceTiming=o.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(o),t.loadImgAOTerrainData(o,this.map.painter,!1,this.renderWithTerrain&&t.tileID.canonical.z>=e.default$11.TRANSFORM.TERRAIN_FIND_ZOOM_MIN,this.translation,this.sttc,i),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}void 0===t.workerID||"expired"===t.state?t.workerID=this.dispatcher.send("loadTile",n,s.bind(this)):"loading"===t.state?t.reloadCallback=i:this.dispatcher.send("reloadTile",n,s.bind(this),t.workerID);},i.prototype.abortTile=function(e,t){this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID),t();},i.prototype.unloadTile=function(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID),t();},i.prototype.hasTransition=function(){return!1},i.prototype.isEarthSource=function(){return"all"===this.tileUsage||"sphere"===this.tileUsage},i}(e.Evented),U=function(t){function i(i,a,o,r){t.call(this),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.tileUsage=a.tileUsage||"plain",this.dispatcher=o,this.setEventedParent(r),this._data=a.data,this._options=e.extend({},a),this._collectResourceTiming=a.collectResourceTiming,this._resourceTiming=[],void 0!==a.maxzoom&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.noBox=a.noBox;var n=e.default$12/this.tileSize;this.workerOptions=e.extend({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:(void 0!==a.buffer?a.buffer:128)*n,tolerance:(void 0!==a.tolerance?a.tolerance:.375)*n,extent:e.default$12,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1},superclusterOptions:{maxZoom:void 0!==a.clusterMaxZoom?Math.min(a.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:e.default$12,radius:(a.clusterRadius||50)*n,log:!1}},a.workerOptions);}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.load=function(){var t=this;this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(i){if(i)t.fire(new e.ErrorEvent(i));else{var a={dataType:"source",sourceDataType:"metadata"};t._collectResourceTiming&&t._resourceTiming&&t._resourceTiming.length>0&&(a.resourceTiming=t._resourceTiming,t._resourceTiming=[]),t.fire(new e.Event("data",a));}});},i.prototype.onAdd=function(e){this.map=e,this.load();},i.prototype.setData=function(t){var i=this;return this._data=t,this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(t){if(t)i.fire(new e.ErrorEvent(t));else{var a={dataType:"source",sourceDataType:"content"};i._collectResourceTiming&&i._resourceTiming&&i._resourceTiming.length>0&&(a.resourceTiming=i._resourceTiming,i._resourceTiming=[]),i.fire(new e.Event("data",a));}}),this},i.prototype.getClusterExpansionZoom=function(e,t){return this.dispatcher.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t,this.workerID),this},i.prototype.getClusterChildren=function(e,t){return this.dispatcher.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t,this.workerID),this},i.prototype.getClusterLeaves=function(e,t,i,a){return this.dispatcher.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:i},a,this.workerID),this},i.prototype._updateWorkerData=function(t){var i=this,a=e.extend({},this.workerOptions),o=this._data;"string"==typeof o?(a.request=this.map._transformRequest(e.default.resolveURL(o),e.ResourceType.Source),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(o),this.workerID=this.dispatcher.send(this.type+".loadData",a,function(e,o){i._removed||o&&o.abandoned||(i._loaded=!0,o&&o.resourceTiming&&o.resourceTiming[i.id]&&(i._resourceTiming=o.resourceTiming[i.id].slice(0)),i.dispatcher.send(i.type+".coalesce",{source:a.source},null,i.workerID),t(e));},this.workerID);},i.prototype.loadTile=function(t,i){var a=this,o=void 0===t.workerID?"loadTile":"reloadTile",r={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.default.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};t.workerID=this.dispatcher.send(o,r,function(e,r){return t.unloadVectorData(),t.aborted?i(null):e?i(e):(t.loadVectorData(r,a.map.painter,"reloadTile"===o),i(null))},this.workerID);},i.prototype.abortTile=function(e){e.aborted=!0;},i.prototype.unloadTile=function(e){e.unloadVectorData(),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},null,e.workerID);},i.prototype.onRemove=function(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID);},i.prototype.serialize=function(){return e.extend({},this._options,{type:this.type,data:this._data})},i.prototype.hasTransition=function(){return!1},i.prototype.isEarthSource=function(){return"all"===this.tileUsage||"sphere"===this.tileUsage},i}(e.Evented),V=e.createLayout([{name:"a_pos",type:"Float32",components:3},{name:"a_texture_pos",type:"Float32",components:2}]);function G(e){for(var t=0,i=Object.getOwnPropertyNames(e.constructor.prototype);t<i.length;t+=1){var a=i[t],o=e[a];"constructor"!==a&&"function"==typeof o&&(e[a]=o.bind(e));}return e}var X=function(t){function i(e,i,a,o){t.call(this),this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.grid=i.grid,this.wms=!!i.wms&&i.wms,this.url=i.url,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this.setEventedParent(o),this.options=i,this.tileUsage=i.tileUsage,G(this);}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype._moveFn=function(){var e=this.map,t=e.unproject([0,0]),i=e.unproject([e.transform.width,0]),a=e.unproject([e.transform.width,e.transform.height]),o=e.unproject([0,e.transform.height]),r=Math.min(t.lat,i.lat,a.lat,o.lat),n=Math.min(t.lng,i.lng,a.lng,o.lng),s=Math.max(t.lat,i.lat,a.lat,o.lat),l=Math.max(t.lng,i.lng,a.lng,o.lng),u=n+","+r+","+l+","+s,c=Math.ceil(e.transform.width),_=Math.ceil(e.transform.height),f=Math.ceil(e.transform.zoom);this.options.url=this.wmsUrl.replace("{bounds}",u).replace("{width}",c.toString()).replace("{height}",_.toString()).replace("{z}",f.toString());var m=[[n,s],[l,s],[l,r],[n,r]];this.setUrl(this.options.url,m);},i.prototype.setUrl=function(t,i){var a=this;this.url=t,this.options.url=t,e.getImage(this.map._transformRequest(this.url,e.ResourceType.Image),function(t,o){t?a.fire(new e.ErrorEvent(t)):o&&(a.image=e.default.getImageData(o),delete a.texture,i&&(a.coordinates=i),a._finishLoading());});},i.prototype.load=function(){var t=this;this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,e.getImage(this.map._transformRequest(this.url,e.ResourceType.Image),function(i,a){i?t.fire(new e.ErrorEvent(i)):a&&(t.image=e.default.getImageData(a),t._finishLoading());});},i.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})));},i.prototype.onAdd=function(e){if(this.map=e,this.wms){this.wmsUrl||(this.wmsUrl=this.options.url);var t=Math.ceil(e.transform.width),i=Math.ceil(e.transform.height),a=Math.ceil(e.transform.zoom),o=e.getBounds()._sw.lng+","+e.getBounds()._sw.lat+","+e.getBounds()._ne.lng+","+e.getBounds()._ne.lat;this.options.url=this.wmsUrl.replace("{bounds}",o).replace("{width}",t.toString()).replace("{height}",i.toString()).replace("{z}",a.toString()),this.coordinates=[e.getBounds().getNorthWest().toArray(),e.getBounds().getNorthEast().toArray(),e.getBounds().getSouthEast().toArray(),e.getBounds().getSouthWest().toArray()],this.setCoordinates(this.coordinates),this.map.on("moveend",this._moveFn);}this.load();},i.prototype.onRemove=function(){this.map.off("moveend",this._moveFn);},i.prototype.setCoordinates=function(t){this.coordinates=t;var i=this.map,a=t.map(function(t){return i.transform.locationCoordinate(e.default$13.convert(t)).zoomTo(0)}),o=this.centerCoord=e.getCoordinatesCenter(a);o.column=Math.floor(o.column),o.row=Math.floor(o.row),this.tileID=new e.CanonicalTileID(o.zoom,o.column,o.row),this.minzoom=this.maxzoom=o.zoom;var r=a.map(function(t){var i=t.zoomTo(o.zoom);return new e.default$1(Math.round((i.column-o.column)*e.default$12),Math.round((i.row-o.row)*e.default$12))}),n=[r[3].x,r[3].y],s=[r[2].x,r[2].y],l=[r[0].x,r[0].y],u=[r[1].x,r[1].y],c=!1,_=null;"all"!==this.tileUsage&&"sphere"!==this.tileUsage||(c=!0,this._sphereBoundsArray=new e.SphereImageArray,this._sphereIndexArray=new e.TriangleIndexArray,this.sphereSegments=new e.default$15,this.sphereSegments.prepareSegment(0,this._sphereBoundsArray,this._sphereIndexArray),_=this.sphereSegments.prepareSegment(4,this._sphereBoundsArray,this._sphereIndexArray)),this._boundsArray=new e.RasterBoundsArray,this._indexArray=new e.TriangleIndexArray,this.segments=new e.default$15,this.segments.prepareSegment(0,this._boundsArray,this._indexArray);for(var f=this.segments.prepareSegment(4,this._boundsArray,this._indexArray),m=0;m<=19;m++)for(var p=[n[0]+(l[0]-n[0])/19*m,n[1]+(l[1]-n[1])/19*m],h=[s[0]+(u[0]-s[0])/19*m,s[1]+(u[1]-s[1])/19*m],d=0;d<=19;d++){var g=[p[0]+(h[0]-p[0])/19*d,p[1]+(h[1]-p[1])/19*d],v=[d/19*e.default$12,(1-m/19)*e.default$12];if(this._boundsArray.emplaceBack(parseInt(g[0]),parseInt(g[1]),parseInt(v[0]),parseInt(v[1])),f.vertexLength++,c){var y=e.getSpherePos(g[0],g[1],1,o.column,o.row,o.zoom,null);this.spaceBasePos||(this.spaceBasePos=y,this.matrix=e.calc3dVectorTileTranslateMatrix([],this.spaceBasePos,!1)),this._sphereBoundsArray.emplaceBack(y[0]-this.spaceBasePos[0],y[1]-this.spaceBasePos[1],y[2]-this.spaceBasePos[2],parseInt(v[0]),parseInt(v[1])),_.vertexLength++;}var x=d+20*m;19!==m&&19!==d&&(this._indexArray.emplaceBack(x,x+20+1,x+20),this._indexArray.emplaceBack(x,x+1,x+20+1),f.primitiveLength+=2,c&&(this._sphereIndexArray.emplaceBack(x,x+20+1,x+20),this._sphereIndexArray.emplaceBack(x,x+1,x+20+1),_.primitiveLength+=2));}return this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.indexBuffer&&(this.indexBuffer.destroy(),delete this.indexBuffer),this.sphereBoundsBuffer&&(this.sphereBoundsBuffer.destroy(),delete this.sphereBoundsBuffer),this.sphereIndexBuffer&&(this.sphereIndexBuffer.destroy(),delete this.sphereIndexBuffer),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})),this},i.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var t=this.map.painter.context,i=t.gl;for(var a in"all"!==this.tileUsage&&"plane"!==this.tileUsage||this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,e.default$16.members),this.indexBuffer=t.createIndexBuffer(this._indexArray)),"all"!==this.tileUsage&&"sphere"!==this.tileUsage||this.sphereBoundsBuffer||(this.sphereBoundsBuffer=t.createVertexBuffer(this._sphereBoundsArray,V.members),this.sphereIndexBuffer=t.createIndexBuffer(this._sphereIndexArray)),this.texture||(this.texture=new e.default$4(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.tiles){var o=this.tiles[a];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture);}}},i.prototype.loadTile=function(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null));},i.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},i.prototype.hasTransition=function(){return!1},i.prototype.isEarthSource=function(){return"all"===this.tileUsage||"sphere"===this.tileUsage},i}(e.Evented),W=function(t){function i(e,i,a,o){t.call(this,e,i,a,o),this.roundZoom=!0,this.type="video",this.options=i;}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.load=function(){var t=this,i=this.options;this.urls=[];for(var a=0,o=i.urls;a<o.length;a+=1){var r=o[a];t.urls.push(t.map._transformRequest(r,e.ResourceType.Source).url);}e.getVideo(this.urls,function(i,a){i?t.fire(new e.ErrorEvent(i)):a&&(t.video=a,t.video.loop=!0,t.video.addEventListener("playing",function(){t.map.triggerRepaint();}),t.map&&t.video.play(),t._finishLoading());});},i.prototype.getVideo=function(){return this.video},i.prototype.onAdd=function(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)));},i.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var t=this.map.painter.context,i=t.gl;for(var a in"all"!==this.tileUsage&&"plane"!==this.tileUsage||this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,e.default$16.members),this.indexBuffer=t.createIndexBuffer(this._indexArray)),"all"!==this.tileUsage&&"sphere"!==this.tileUsage||this.sphereBoundsBuffer||(this.sphereBoundsBuffer=t.createVertexBuffer(this._sphereBoundsArray,V.members),this.sphereIndexBuffer=t.createIndexBuffer(this._sphereIndexArray)),this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new e.default$4(t,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.tiles){var o=this.tiles[a];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture);}}},i.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},i.prototype.hasTransition=function(){return this.video&&!this.video.paused},i}(X),j=function(t){function i(i,a,o,r){t.call(this,i,a,o,r),a.coordinates?Array.isArray(a.coordinates)&&4===a.coordinates.length&&!a.coordinates.some(function(e){return!Array.isArray(e)||2!==e.length||e.some(function(e){return"number"!=typeof e})})||this.fire(new e.ErrorEvent(new e.default$18("sources."+i,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.ErrorEvent(new e.default$18("sources."+i,null,'missing required property "coordinates"'))),a.animate&&"boolean"!=typeof a.animate&&this.fire(new e.ErrorEvent(new e.default$18("sources."+i,null,'optional "animate" property must be a boolean value'))),a.canvas?"string"==typeof a.canvas||a.canvas instanceof e.default$2.HTMLCanvasElement||this.fire(new e.ErrorEvent(new e.default$18("sources."+i,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.ErrorEvent(new e.default$18("sources."+i,null,'missing required property "canvas"'))),this.options=a,this.animate=void 0===a.animate||a.animate;}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.load=function(){this.canvas||(this.canvas=this.options.canvas instanceof e.default$2.HTMLCanvasElement?this.options.canvas:e.default$2.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint();},this.pause=function(){this._playing=!1;},this._finishLoading());},i.prototype.getCanvas=function(){return this.canvas},i.prototype.onAdd=function(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play();},i.prototype.onRemove=function(){this.pause();},i.prototype.prepare=function(){var t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var i=this.map.painter.context,a=i.gl;for(var o in this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,e.default$16.members)),this.boundsVAO||(this.boundsVAO=new e.default$17),this.texture?t?this.texture.update(this.canvas):this._playing&&(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.canvas)):(this.texture=new e.default$4(i,this.canvas,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this.tiles){var r=this.tiles[o];"loaded"!==r.state&&(r.state="loaded",r.texture=this.texture);}}},i.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},i.prototype.hasTransition=function(){return this._playing},i.prototype._hasInvalidDimensions=function(){for(var e=0,t=[this.canvas.width,this.canvas.height];e<t.length;e+=1){var i=t[e];if(isNaN(i)||i<=0)return!0}return!1},i.prototype.isEarthSource=function(){return!1},i}(X),Y=function(t){function i(e,i,a,o){t.call(this),this.id=e,this.dispatcher=a,this.type="sphere-image",this.minzoom=0,this.maxzoom=22,this.setEventedParent(o),this._options=i,this.renderAtmosphere=i.renderAtmosphere||!1,this.dayTextureUrl=i.dayTextureUrl||null,this.nightTextureUrl=i.nightTextureUrl||null;}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.load=function(){var t=this;this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this._options.url;var i=[];e.getImage(this.map._transformRequest(this.url,e.ResourceType.Image),function(a,o){a?t.fire(new e.ErrorEvent(a)):o&&(t.image=o),i.push(0),t._promiseDelegate(i);}),this.dayTextureUrl?e.getImage(this.map._transformRequest(this.dayTextureUrl,e.ResourceType.Image),function(a,o){a?t.fire(new e.ErrorEvent(a)):o&&(t.dayTextureImage=o),i.push(0),t._promiseDelegate(i);}):this.nightTextureUrl&&e.getImage(this.map._transformRequest(this.nightTextureUrl,e.ResourceType.Image),function(a,o){a?t.fire(new e.ErrorEvent(a)):o&&(t.nightTextureImage=o),i.push(0),t._promiseDelegate(i);});},i.prototype._promiseDelegate=function(e){this.dayTextureUrl&&2!==e.length||this.nightTextureUrl&&2!==e.length||this._finishLoading();},i.prototype._finishLoading=function(){this.map&&(this.prepare(),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})));},i.prototype.onAdd=function(e){this.map=e,this.load();},i.prototype.prepare=function(){var t=this.map.painter.context,i=t.gl;!this.texture&&this.image&&(this.texture=new e.default$4(t,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.dayTextureImage&&!this.dayTexture&&(this.dayTexture=new e.default$4(t,this.dayTextureImage,i.RGBA),this.dayTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this.nightTextureImage&&!this.nightTexture&&(this.nightTexture=new e.default$4(t,this.nightTextureImage,i.RGBA),this.nightTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE));},i.prototype.serialize=function(){return{type:"sphere-image",url:this._options.url,renderInner:this._options.renderInner,radius:this._options.radius,gridSamples:this._options.gridSamples,extractRadius:this._options.extractRadius,debug:this._options.debug||!1,renderAtmosphere:this._options.renderAtmosphere||!1,dayTextureUrl:this._options.dayTextureUrl||null,nightTextureUrl:this._options.nightTextureUrl||null}},i.prototype.loadTile=function(){},i.prototype.hasTransition=function(){return!1},i.prototype.isEarthSource=function(){return!0},i}(e.Evented),Z=function(e,t,i,a,o,r){void 0===r&&(r=!1),this.gltf=e,this.context=t,this.bufferData=i,this.dataContext=a,this.filter=o,this.primitiveInd=0,this.primitiveDataInd=0,this.vbuffer=[],this.ibuffer=[],this.nodeInd=void 0,this.needTriangle=r,this.requestingImageCount=0,this.imageRequestQueueArray=[],this.textureRequestObject={},this.__totalTextureCount=0,this.__beenRequestedTextureCount=0;};Z.prototype.processGLTF=function(){var e=this,t=this.dataContext,i=this.gltf,a=i.scene||0;this.sceneName=i.scenes[a].name,this.processAnimation(),i.scenes.forEach(function(t,i){e.processScene(i);}),i.materials.forEach(function(t,i){e.processMaterial(i);}),i.asset.range&&(t.range=i.asset.range);},Z.prototype.processAnimation=function(){var t=this.dataContext,i=this.gltf,a=this.bufferData;i.animations&&i.animations.length>0&&(t.animations=[],t._hasModelAnimation=!0);for(var o=0;i.animations&&o<i.animations.length;o++){for(var r=i.animations[o],n={channels:[]},s=0;s<r.channels.length;s++){var l=r.samplers[r.channels[s].sampler],u=Object.assign({},i.bufferViews[i.accessors[l.input].bufferView]);u.count=i.accessors[l.input].count,u.type=i.accessors[l.input].type,u.componentType=i.accessors[l.input].componentType,u.byteOffset+=i.accessors[l.input].byteOffset||0;var c=Object.assign({},i.bufferViews[i.accessors[l.output].bufferView]);c.count=i.accessors[l.output].count,c.type=i.accessors[l.output].type,c.componentType=i.accessors[l.output].componentType,c.byteOffset+=i.accessors[l.output].byteOffset||0;var _=c.buffer,f=e.readArrayToAnimationData(a[_],u,c);n.channels.push({count:f.input.length,node:r.channels[s].target.node,path:r.channels[s].target.path,input:f.input,output:f.output,interpolation:l.interpolation});}t.animations.push(n);}},Z.prototype.processScene=function(e){var t=this;this.dataContext;this.gltf.scenes[e].nodes.forEach(function(e){t.processNode(e);});},Z.prototype.processNode=function(t,i){var a=this,o=this.dataContext,r=this.gltf,n=this.filter;this.context;if(!o.nodes||!o.nodes.hasOwnProperty(t)){var s=r.nodes[t];this.nodeInd=t;var l={};o.nodes[t]=l;var u=null;if(r.animations&&r.animations.length>0&&o.animations.map(function(e,t){return e.channels.map(function(e,i){return a.nodeInd===e.node&&(u={ani:t,cha:i}),null})}),s.children&&s.children.length>0&&(o.nodes[t]=Object.assign(l,{hasChild:!0,nodeInd:t,children:s.children,properties:{name:s.name||"",sceneName:this.sceneName,fatherName:i}}),s.children.forEach(function(e){a.processNode(e,s.name);})),s.hasOwnProperty("mesh")){var c=e.createFloat64ArrayIdentityMatrix(),_=s.name||"",f=s.extras,m=[],p=!0;if(n&&!n(new e.default$20(17),{properties:{name:_}}))return;s.translation&&(s.translation[0]||s.translation[1]||s.translation[2])&&(e.translate(c,c,s.translation),p=!1),s.rotation&&(p=!1,3===s.rotation.length?(s.rotation[0]&&(p=!1,e.rotateX(c,c,s.rotation[0]*e.default$11.TRANSFORM.DEG_TO_RAD)),s.rotation[1]&&(p=!1,e.rotateY(c,c,s.rotation[1]*e.default$11.TRANSFORM.DEG_TO_RAD)),s.rotation[2]&&(p=!1,e.rotateZ(c,c,s.rotation[2]*e.default$11.TRANSFORM.DEG_TO_RAD))):4===s.rotation.length&&e.mul(c,c,e.fromQuat([],s.rotation))),!s.scale||1===s.scale[0]&&1===s.scale[1]&&1===s.scale[2]||(e.scale(c,c,s.scale),p=!1),s.location&&(m=s.location),o.nodes[t]=Object.assign(l,{nodeInd:t,meshInd:s.mesh,mesh:s.mesh,matrix:c,location:m,identityMatrix:p,properties:{name:s.name||"",sceneName:this.sceneName,fatherName:i,flowTexture:s.flowTexture||!1},userNodeData:f,animation:u||null}),this.processMesh(s.mesh);}}},Z.prototype.processMesh=function(t){var i=this,a=this.dataContext,o=this.gltf,r=this.context,n=this.bufferData,s=this.vbuffer,l=this.ibuffer,u=o.meshes[t];if(!a.meshes[t]){var c,_={primitivesInd:[],properties:{meshName:u.name||""}};if(u.primitives&&u.primitives.length>0)for(var f=0;f<u.primitives.length;f++){var m={},p=!!(u.primitives[f].targets&&u.primitives[f].targets.length>0),h=e.default$21(o,t,f,m,p),d=u.primitives[f].indices,g=o.accessors[d],v=o.bufferViews[g.bufferView];s[v.buffer]?c=new e.default$22(r,n[v.buffer],h.members,!1,s[v.buffer]):(c=new e.default$22(r,n[v.buffer],h.members,!1),s[v.buffer]=c.getBuffer());var y=u.primitives[f].attributes.POSITION,x=o.accessors[y],b=x?[x.min.concat(1),x.max.concat(1)]:[],w=u.primitives[f].mode,A=u.primitives[f].material||0,T=void 0,E=(g.byteOffset?g.byteOffset:0)+(v.byteOffset?v.byteOffset:0),P=g.componentType,S=g.count;m.IB={offset:E,byteStride:2,count:S,type:P},l[v.buffer]?T=new e.default$23(r,n[v.buffer],void 0===w?r.gl.TRIANGLES:w,S,P,E,!1,l[v.buffer]):(T=new e.default$23(r,n[v.buffer],void 0===w?r.gl.TRIANGLES:w,S,P,E,!1),l[v.buffer]=T.getBuffer()),_.primitivesInd.push(i.primitiveInd),a.primitives[i.primitiveInd]={primitiveInd:i.primitiveInd,gltfVertexBuffer:c,gltfIndexBuffer:T,material:A,aabb:b,intersectOptions:{bufViewBufferIndex:v.buffer,bufferDataConfig:m,triangleData:[],placedTriangleData:[]},properties:{primitiveName:u.primitives[f].name||"PrimitiveID"+i.primitiveInd},isSkinModel:p,triangleData:i.needTriangle?e.readArrayToTriangleFloatArray(n[v.buffer],m):void 0},i.primitiveInd++,i.primitiveDataInd++;}a.meshes[t]=_;}var I=a.meshes[t];I&&(Array.isArray(a.nodes[this.nodeInd].primitiveStack)||(a.nodes[this.nodeInd].primitiveStack=[]),I.primitivesInd.forEach(function(e){var t={primitiveDataInd:i.primitiveDataInd++,placedTriangleData:[],primitiveInd:e};a.nodes[i.nodeInd].primitiveStack.push(t);}));},Z.prototype.processMaterial=function(t){var i=this.dataContext,a=this.gltf,o=this.context,r=(this.bufferData,this.vbuffer,this.ibuffer,o.gl);if(a.materials&&!i.materials[t]){var n=a.materials[t],s={baseColorFactor:n.pbrMetallicRoughness.baseColorFactor?n.pbrMetallicRoughness.baseColorFactor:null,baseColorTexture:{index:n.pbrMetallicRoughness.baseColorTexture?n.pbrMetallicRoughness.baseColorTexture.index:e.default$11.SOURCE.ERROR_IMG_INDEX},alphaMode:n.alphaMode||"OPAQUE",doubleSided:n.doubleSided||!1,materialParams:null,sampler:0,name:void 0};if(s.name=n.name||void 0,a.textures&&a.textures.length>0&&(s.sampler=a.textures[n.pbrMetallicRoughness.baseColorTexture?n.pbrMetallicRoughness.baseColorTexture.index:0].sampler),n.materialParams&&(s.materialParams=n.materialParams),i.materials[t]=s,a.images&&0!==a.images.length){var l=a.textures,u=n.pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.index;if(u||0===u){if(i.textures[u])return i.textures[u];if(i instanceof e.default$24){var c=a.images[l[u].source].uri,_=i.modelType===e.default$11.MODEL_TYPE.OSGB?i.modelFolder+"/"+c.substr(0,14)+"/"+c:i.modelFolder+"/"+c;c=e.default.resolveURL(_),i.textures[u]=a.images[l[u].source].uri,i.sharedTexture.addATexture(a.images[l[u].source].uri,c,o);}else{var f=a.images[l[u].source].uri;if(f.startsWith("data:image")){var m=new Image;m.onload=function(){var t=new e.default$4(o,m,r.RGBA,{useMipmap:!0});t.bind(r.LINEAR,r.CLAMP_TO_EDGE),i.textures[u]=t;},m.src=f;}else this.__totalTextureCount++,this.imgQueueProcess({source:i,index:u,context:o,gl:r,uri:f});}}}}},Z.prototype.imgQueueProcess=function(t){if(t){if(this.imageRequestQueueArray.push(t),this.requestingImageCount<e.default$11.SOURCE.MAX_IMAGE_CONCURRENCY){var i=this.imageRequestQueueArray[0];this.imageRequestQueueArray.splice(0,1),this.requestingImageCount++,this.requestImage(i);}}else if(this.requestingImageCount<e.default$11.SOURCE.MAX_IMAGE_CONCURRENCY&&this.imageRequestQueueArray.length>0){var a=this.imageRequestQueueArray[0];this.imageRequestQueueArray.splice(0,1),this.requestingImageCount++,this.requestImage(a);}this.__beenRequestedTextureCount===this.__totalTextureCount&&(this.dataContext.state="loaded");},Z.prototype.requestImage=function(t){var i=this,a=t.source.modelFolder+"/"+t.uri;if(this.textureRequestObject[a])return this.__beenRequestedTextureCount++,this.requestingImageCount--,void this.imgQueueProcess();this.textureRequestObject[a]||(this.textureRequestObject[a]=!0),e.getImage(t.source.map._transformRequest(a,e.ResourceType.Image),function(a,o){if(i.__beenRequestedTextureCount++,i.requestingImageCount--,i.imgQueueProcess(),a)t.source.fire(new e.ErrorEvent(a));else if(o){var r=new e.default$4(t.context,o,t.gl.RGBA,{useMipmap:!0});r.bind(t.gl.LINEAR,t.gl.CLAMP_TO_EDGE),t.source.textures[t.index]=r,t.source.fire(new e.Event("data",{data:"texture"}));}});};var q=function(e,t){this.max=e,this.onRemove=t,this.minLevel=0,this.reset();};q.prototype.setTileMinLevel=function(e){e&&(this.minLevel=e);},q.prototype.reset=function(){for(var e in this.data)for(var t=0,i=this.data[e];t<i.length;t+=1){var a=i[t];a.timeout&&clearTimeout(a.timeout),this.remove(e,!0);}return this.data={},this.order=[],this},q.prototype.add=function(e,t,i){var a=e;if(!this.data[a]||!this.data[a].value){var o={value:t,timeout:void 0};if(this.data[a]=o,this.order.push(a),this.order.length>this.max){var r=this.data[this.order[0]];r&&r.value.uses>0?this.max++:this.remove(this.order[0]);}return this.max++,this}},q.prototype.has=function(e){return e in this.data},q.prototype.get=function(e){if(!this.has(e))return null;var t=this.order.indexOf(e);this.order.splice(t,1),this.order.push(e);var i=this.data[e];return i?i.value:i},q.prototype.remove=function(e,t){if(!this.has(e))return null;var i=e,a=this.data[i];return a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value),this.data[i]=null,delete this.data[i],t||this.order.splice(0,1),this},q.prototype.setMaxSize=function(e,t){for(e>this.max?this.max=e:this.max=Math.ceil((this.max+e)/2);this.order.length>this.max;){var i=this.data[this.order[0]];if(i.value.uses>0){for(var a=!1,o=0;o<t.length;o++)if(this.order[0]===t[o]){a=!0;break}a?(this.max++,i.value.uses--,this.order.push(this.order[0]),this.order.splice(0,1)):this.remove(this.order[0]);}else this.remove(this.order[0]);}return this};var Q=function(t){function i(i,a,o,r){t.call(this),this.id=i,this.dispatcher=o,this.type="3d-tile",this.minzoom=15,this.maxzoom=22,this.scheme="xyz",this.reparseOverscaled=!0,this.isTileClipped=!0,this.tileUsage="sphere",this.tileJson={},this.vectorLayerIds=[],this.identityMatrix=!0,e.extend(this,e.pick(a,["url","scheme","modelFolder","location","translation","filter"])),this._options=e.extend({type:"3d-tile"},a),this.translation||(this.translation=[0,0,0]),this.flipYZ=a.flipYZ||!1,this.noQuery=!a.hasOwnProperty("noQuery")||a.noQuery,this.videoMatchOption=a.videoMatchOption,this.videoMatchEnabled=!!a.videoMatchOption&&a.videoMatchOption.enabled,this._processVideoMatch(),this.ratioRange=a.ratioRange||[[0,1],[0,1],[0,1]],this.clampBox=a.clampBox||{x:0,y:0,z:0,rotateX:0,rotateY:0,rotateZ:0,anchor:[116,39,0],inner:!0,translation:[0,0,0]},this.clampBoxMatrix=this.getClampBoxMatrix(this.clampBox,this.location),this.clampPlane=a.clampPlane||[0,0,0,0],this._clampEnabled=a.clampEnabled||!1,this.noHighlighting=a.noHighlighting,this.maxTiles=a.maxTiles||4,this._pickable=a.pickable||!1,this._collectResourceTiming=a.collectResourceTiming,this.filter&&this.setFilter(this.filter),this.setEventedParent(r);}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var a={clampEnabled:{configurable:!0}};return a.clampEnabled.set=function(e){this._clampEnabled=e;},a.clampEnabled.get=function(){return this._clampEnabled},i.prototype._processVideoMatch=function(){if(this.videoMatchOption&&this.videoMatchOption.bounds){var t=this.videoMatchOption.bounds;this.videoBounds=e.calcTDModelAreaData(t[0],t[1],t[2],t[3]);}},i.prototype.enableVideoMatch=function(){this.videoMatchOption&&(this.videoMatchEnabled=!0);},i.prototype.disableVideoMatch=function(){this.videoMatchEnabled=!1;},i.prototype.setClampRange=function(t){Array.isArray(t)&&(this.ratioRange=t,this.fire(new e.Event("data",{data:t})));},i.prototype.setClampBox=function(t){!t instanceof Object&&(console.warn("参数应为裁剪盒子对象"),t={x:1,y:1,z:1,rotateX:0,rotateY:0,rotateZ:0,anchor:this.location,inner:!0,translation:[0,0,0]}),this.clampBox=Object.assign(this.clampBox,t),this.clampBoxMatrix=this.getClampBoxMatrix(this.clampBox,this.location),this.fire(new e.Event("data",{data:this.clampBox}));},i.prototype.getClampBoxMatrix=function(t,i){var a=t.rotateX,o=t.rotateY,r=t.rotateZ,n=t.anchor,s=t.translation,l=e.createFloat64ArrayIdentityMatrix();s&&(n=e.getTranslatedLngLatPoint(n,s)),e.rotateZ(l,l,-r*e.default$11.TRANSFORM.DEG_TO_RAD),e.rotateX(l,l,-a*e.default$11.TRANSFORM.DEG_TO_RAD),e.rotateY(l,l,-o*e.default$11.TRANSFORM.DEG_TO_RAD);var u=e.calcLocalCoords(n,i,!1);return e.translate(l,l,[-u[0],-u[1],-u[2]]),l},i.prototype.setClampPlane=function(t){Array.isArray(t)&&(this.clampPlane=t,this.fire(new e.Event("data",{data:t})));},i.prototype.clearClampPlane=function(){this.clampPlane=[0,0,0,0],this.fire(new e.Event("data",{data:this.clampPlane}));},i.prototype.clearClampBox=function(){this.clampBox={x:0,y:0,z:0,rotateX:0,rotateY:0,rotateZ:0,anchor:[116,39,0],inner:!0},this.fire(new e.Event("data",{data:this.clampBox}));},i.prototype.enablePick=function(){this._pickable=!0;},i.prototype.disablePick=function(){this._pickable=!1;},i.prototype.clearPick=function(){},i.prototype.setFilter=function(t){this._featureFilter=e.default$25(t);},i.prototype.load=function(){var t=this;this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=e.getJSON(this.map._transformRequest(f(this._options.url||""),e.ResourceType.Source),function(i,a){t._tileJSONRequest=null,i?t.fire(new e.ErrorEvent(i)):a&&(t.tileJson=a,t.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})));}),this.videoMatchOption&&this.videoMatchOption.videoUrl&&e.getVideo([this.videoMatchOption.videoUrl],function(i,a){i?t.fire(new e.ErrorEvent(i)):a&&(t.video=a,t.video.loop=!0,t.video.addEventListener("playing",function(){t.map.triggerRepaint();}),t.map&&t.video.play());});},i.prototype.prepare=function(){if(this.gltfModelVAO||(this.gltfModelVAO=new e.default$17),this.video&&!(this.video.readyState<2)){var t=this.map.painter.context,i=t.gl;this.videoTexture?this.video.paused||(this.videoTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGB,i.UNSIGNED_BYTE,this.video)):(this.videoTexture=new e.default$4(t,this.video,i.RGB),this.videoTexture.bind(i.LINEAR,i.CLAMP_TO_EDGE));}},i.prototype.hasTile=function(e){return!0},i.prototype.onAdd=function(e){this.map=e,this.load();},i.prototype.onRemove=function(e){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null);},i.prototype.serialize=function(){return e.extend({},this._options)},i.prototype._getGltfFolder=function(e){return e.split("~")[0]},i.prototype.loadTile=function(t,i){var a=this.tileJson.type===e.default$11.MODEL_TYPE.OSGB?this.modelFolder+"/"+this._getGltfFolder(t.tileID)+"/"+t.childJson.url:this.modelFolder+"/"+t.childJson.url,o=f(a,this.url),r={request:this.map._transformRequest(e.default.resolveURL(o),e.ResourceType.Tile),uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,isCarto:this.tileJson.isCarto};function n(a,o){return t.aborted?i(null):a?i(a):(o&&o.resourceTiming&&(t.resourceTiming=o.resourceTiming),"unloaded"!==t.state&&(t.loadVectorData(o),this.fire(new e.Event("data",{dataType:"gltf-data-loaded"}))),i(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}r.request.collectResourceTiming=this._collectResourceTiming,void 0===t.workerID||"expired"===t.state?t.workerID=this.dispatcher.send("loadTile",r,n.bind(this)):"loading"===t.state?t.reloadCallback=i:this.dispatcher.send("reloadTile",r,n.bind(this),t.workerID);},i.prototype.abortTile=function(e,t){this.dispatcher.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);},i.prototype.unloadTile=function(e,t){e.unloadVectorData(),this.dispatcher.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0,e.workerID);},i.prototype.hasTransition=function(){return!1},i.prototype.isEarthSource=function(){return!0},Object.defineProperties(i.prototype,a),i}(e.Evented),H=function(e){this.textures={},this.requests={},this.source=e||{fire:function(){}};};H.prototype.addATexture=function(t,i,a,o){var r=this,n=a.gl;this.getATexture(t)||this.requests[t]||(this.requests[t]=e.getImage({url:i},function(i,s){if(i)throw new e.ErrorEvent(i);if(s){if(o&&o instanceof e.default$24&&"unloaded"===o.state)return r.requests[t]=null,void delete r.requests[t];var l=new e.default$4(a,s,n.RGBA,{useMipmap:!(o instanceof e.default$24)});if(l.bind(n.LINEAR,n.CLAMP_TO_EDGE),r.textures[t]=l,o&&o instanceof e.default$24&&(o.finishedImages++,o.finishedImages===o.materials.length&&(o.state="loaded",o.childJson&&o.childJson.PK&&o.childJson.PK.length>0))){var u=o.childJson.PK;o.childJson.PK="",r.source.fire(new e.Event("data-remove-pk",{dataType:"removePK",pk:u}));}r.requests[t]=null,delete r.requests[t],r.source.fire(new e.Event("data",{dataType:"gltf-data-loaded"}));}}));},H.prototype.getATexture=function(e){return this.textures[e]},H.prototype.removeATexture=function(e){this.textures[e]&&(this.requests[e]&&(this.requests[e].cancel(),this.requests[e]=null,delete this.requests[e]),this.textures[e].destroy(),this.textures[e]=null,delete this.textures[e]);},H.prototype.getCanvasData=function(e){},H.prototype.removeAllTexture=function(){for(var e in this.textures)this.removeATexture(e),this.requests[e].cancel();};var K=function(t){function i(i,a,o){var r=this;t.call(this),this.id=i,this.dispatcher=o,this.on("data",function(e){"source"===e.dataType&&"metadata"===e.sourceDataType&&(r._sourceLoaded=!0),r._sourceLoaded&&!r._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(r.reload(),r.transform&&r.update(r.transform));}),this.on("data-remove-pk",function(e){r.removeOSGBPK(e.pk);}),this.osgbRefreshCount=0,this.on("error",function(){r._sourceErrored=!0;});var n=ie(i,a,o,this);if(!(n instanceof Q))throw new Error;this._source=n,this._tiles={},this._cache=new q(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._isIdRenderable=this._isIdRenderable.bind(this),this._coveredTiles={},this._state=new e.default$26,this.sharedTexture=new H(this._source),this.savedTileForQueryFeatures={},this.idealTileIDs=[];}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.removeOSGBPK=function(e){for(var t=0;t<this.idealTileIDs.length;t++)if(e===this.idealTileIDs[t])return void this.idealTileIDs.splice(t,1)},i.prototype.onAdd=function(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(e);},i.prototype.onRemove=function(e){this._source&&this._source.onRemove&&this._source.onRemove(e);},i.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var e in this._cache.data){var t=this._cache.get(e);if(t&&"loaded"!==t.state&&"errored"!==t.state)return!1}return!0},i.prototype.getSource=function(){return this._source},i.prototype.pause=function(){this._paused=!0;},i.prototype.resume=function(){if(this._paused){var e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform);}},i.prototype._loadTile=function(e,t){return this._source.loadTile(e,t)},i.prototype._unloadTile=function(e){if(this._source.unloadTile)return this._source.unloadTile(e,function(){})},i.prototype._abortTile=function(e){if(this._source.abortTile)return this._source.abortTile(e,function(){})},i.prototype.serialize=function(){return this._source.serialize()},i.prototype.prepare=function(e){this._source.prepare&&this._source.prepare();for(var t=0,i=this.idealTileIDs;t<i.length;t+=1){var a=i[t],o=this._cache.get(a);o&&"data-down-finished"===o.state&&o.upload(e,this._source);}},i.prototype.getIds=function(){return[]},i.prototype.getGltfIds=function(){return Object.keys(this._cache.data)},i.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},i.prototype._isIdRenderable=function(e){return this._cache.has(e)&&this._cache.get(e).hasData()&&!this._coveredTiles[e]},i.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var e in this._cache.reset(),this._cache.data)this._cache.has(e)&&"errored"!==this._cache.get(e)&&this._reloadTile(e,"reloading");},i.prototype._reloadTile=function(e,t){var i=this._cache.get(e);i&&"loading"!==i.state&&(i.state=t);},i.prototype._tileLoaded=function(t,i,a,o){if(o)return t.state="errored",void(404!==o.status?this._source.fire(new e.ErrorEvent(o,{tile:t})):this.update(this.transform));t.timeAdded=e.default.now(),"expired"===a&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._source.fire(new e.Event("data",{dataType:"source",tile:t,coord:t.tileID})),this.map&&(this.map.painter.tileExtentVAO.vao=null);},i.prototype.getTile=function(e){return this.getTileByID(e)},i.prototype.getTileByID=function(e){return this._cache.get(e)},i.prototype.getZoom=function(e){return e.zoom+e.scaleZoom(e.tileSize/this._source.tileSize)},i.prototype._findLoadedChildren=function(e,t,i){return!1},i.prototype.findLoadedParentByKey=function(e,t){for(var i=t.l-this._source.tileJson.minzoom,a=i>3?3:i,o=a-1;o>=0;){var r=e.substr(0,e.length-2*(a-o)),n=this._cache.get(r);if(n&&"loaded"===n.state)return{pk:r,pt:n};o--;}return null},i.prototype.updateCacheSize=function(e){this._cache.setMaxSize(2*e,this.idealTileIDs);},i.prototype._calTileBoundsMatrix=function(){this._matrix=this._modelMatrixHelpFunc(),this._cache.setTileMinLevel(this._source.tileJson.zoomRange[0]),this.boundsMatrixCalculated=!0;},i.prototype._modelMatrixHelpFunc=function(){var t=e.createFloat64ArrayIdentityMatrix(),i=this._source.flipYZ||this._source.tileJson.type===e.default$11.MODEL_TYPE.OSGB;return e.calc3dModelTranslateMatrix(i,this._source,t),t},i.prototype.update=function(t){if(this.transform=t,this._sourceLoaded&&!this._paused){this.boundsMatrixCalculated||this._calTileBoundsMatrix(),this._coveredTiles={};var i={children:[],middle:[],far:[],index:0};if(this.used&&this.checkCamStatusChanged(t)){i=t.covering3DTiles({zoom:this._source.tileJson.minzoom,zoomRange:this._source.tileJson.zoomRange,data:this._source.tileJson,modelType:this._source.tileJson.type,matrix:this._matrix});var a=this._updateRetainedTiles(i);this.savedTileForQueryFeatures=a,this.updateCacheSize(e.default$11.SOURCE.MAX_GLTF_TILE_COUNT);}}},i.prototype.checkCamStatusChanged=function(e){return!0},i.prototype._updateRetainedTiles=function(t){var i={};if(this.idealTileIDs=[],this._source.tileJson.type===e.default$11.MODEL_TYPE.E3DCM||this._source.tileJson.type===e.default$11.MODEL_TYPE.TDMODEL){t.children=t.children.slice(0,this._source.maxTiles);for(var a=0,o=t.children;a<o.length;a+=1){var r=o[a],n=r.key,s=this._cache.get(n);s&&"loaded"===s.state?(this.idealTileIDs.push(n),s.uses++,i[n]=s):(this.idealTileIDs.push(n),i[n]=this._addTile(n,r));}}else if(this._source.tileJson.type===e.default$11.MODEL_TYPE.OSGB)for(var l=0,u=t.children;l<u.length;l+=1){var c=u[l],_=c.key,f=this._cache.get(_);if(f&&"loaded"===f.state)this.idealTileIDs.push(_),f.uses++,i[_]=f;else{var m=this.findLoadedParentByKey(_,c),p=void 0;m&&(m.pt.uses++,this.idealTileIDs.push(m.pk),p=m.pk,i[m.pk]=m.pt),f?f&&"data-down-finished"===f.state&&this.idealTileIDs.push(_):(this.idealTileIDs.push(_),c.PK=p,i[_]=this._addTile(_,c));}}return i},i.prototype.getTileJsonChildById=function(e){var t=e.split("~")[1].length-2,i=this._source.tileJson.chd[e.substr(0,e.length-t)];for(t-=2;t>0;)i=i.chd[e.substr(0,e.length-t)],t-=2;return i},i.prototype._addTile=function(t,i){var a=this._cache.get(t);if(a)return a;var o=Boolean(a);return o||(a=new e.default$24(t,i,this.map.projection,this._source.tileJson.type,this._source.modelFolder,this._source.tileJson.type,this.sharedTexture,this._source.noHighlighting),this._loadTile(a,this._tileLoaded.bind(this,a,t,a.state)),this._cache.add(t,a)),a?(a.uses++,o||this._source.fire(new e.Event("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null},i.prototype._setTileReloadTimer=function(e,t){var i=this;e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);var a=t.getExpiryTimeout();a&&(this._timers[e]=setTimeout(function(){i._reloadTile(e,"expired"),delete i._timers[e];},a));},i.prototype._removeTile=function(e){var t=this._cache.get(e);t&&(t.uses--,t.uses<=0&&this._cache.remove(e,!1),this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||t.hasData()||(t.aborted=!0,this._abortTile(t),this._unloadTile(t)));},i.prototype.clearTiles=function(){this._shouldReloadOnResume=!1,this._paused=!1,this._cache.reset();},i.prototype.tilesIn=function(e,t,i){var a=[];for(var o in this.savedTileForQueryFeatures){var r=this.savedTileForQueryFeatures[o];a.push(r);}return a},i.prototype.getVisibleCoordinates=function(){var e=this;return this.getRenderableIds().map(function(t){return e._cache.data[t].value.tileID})},i.prototype.hasTransition=function(){return!1},i.prototype.setFeatureState=function(e,t,i){e=e||"_geojsonTileLayer",this._state.updateState(e,t,i);},i.prototype.getFeatureState=function(e,t){return e=e||"_geojsonTileLayer",this._state.getState(e,t)},i}(e.Evented);K.maxOverzooming=10,K.maxUnderzooming=3;var J=function(t){function i(i,a,o,r){t.call(this),this.id=i,this.type="3d-model",this.minzoom=15,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this.dispatcher=o,this.setEventedParent(r),this.textures=[],this.nodes=[],this.meshes=[],this.primitives=[],this._data=a.data,this._options=e.extend({},a),this.location=a.location||[0,0],this.upAxis=a["up-axis"]||"Y-UP",this.materials=[],this.modelFolder=a.modelFolder,this.scale=a.scale,this.rotation=a.rotation,this.translation=a.translation||[0,0,0],this.noBox=a.noBox,this._collectResourceTiming=a.collectResourceTiming,this._resourceTiming=[],void 0!==a.maxzoom&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.filter=a.filter,this._pickable=a.pickable||!1,this.boolAABBCalculated=!1,this.noQuery=!!a.hasOwnProperty("noQuery")&&a.noQuery,this.workerOptions=e.extend({location:this.location,upAxis:this.upAxis},a.workerOptions),this.filter&&this.setFilter(this.filter),a.aabbFilter&&this.setAABBFilter(a.aabbFilter),this.ratioRange=a.ratioRange||[[0,1],[0,1],[0,1]],this.clampBox=a.clampBox||{x:0,y:0,z:0,rotateX:0,rotateY:0,rotateZ:0,anchor:[116,39,0],inner:!0,translation:[0,0,0]},this.clampBoxMatrix=this.getClampBoxMatrix(this.clampBox,this.location),this.maxClampBounds=[-1/0,-1/0,-1/0],this.minClampBounds=[1/0,1/0,1/0],this.clampPlane=a.clampPlane||[0,0,0,0],this._clampEnabled=a.clampEnabled||!1,this.uploaded=!1,this.isModeling=a.isModeling,this.respectiveTransformation=a.respectiveTransformation||!1,this.configuration=a.configuration?"string"==typeof a.configuration?JSON.parse(a.configuration):a.configuration:{},this.identityMatrix=!0,this.noHighlighting=a.noHighlighting||!1;}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var a={clampEnabled:{configurable:!0}};return a.clampEnabled.set=function(e){this._clampEnabled=e;},a.clampEnabled.get=function(){return this._clampEnabled},i.prototype.setClampRange=function(t){Array.isArray(t)&&(this.ratioRange=t,this.fire(new e.Event("data",{data:t})));},i.prototype.setClampBox=function(t){!t instanceof Object&&(console.warn("参数应为裁剪盒子对象"),t={x:1,y:1,z:1,rotateX:0,rotateY:0,rotateZ:0,anchor:this.location,inner:!0,translation:[0,0,0]}),this.clampBox=Object.assign(this.clampBox,t),this.clampBoxMatrix=this.getClampBoxMatrix(this.clampBox,this.location),this.fire(new e.Event("data",{data:this.clampBox}));},i.prototype.getClampBoxMatrix=function(t,i){var a=t.rotateX,o=t.rotateY,r=t.rotateZ,n=t.anchor,s=t.translation;s&&(n=e.getTranslatedLngLatPoint(n,s));var l=e.createFloat64ArrayIdentityMatrix();e.rotateZ(l,l,-r*e.default$11.TRANSFORM.DEG_TO_RAD),e.rotateX(l,l,-a*e.default$11.TRANSFORM.DEG_TO_RAD),e.rotateY(l,l,-o*e.default$11.TRANSFORM.DEG_TO_RAD);var u=e.calcLocalCoords(n,i);return e.translate(l,l,[-u[0],-u[1],-u[2]]),l},i.prototype.setClampPlane=function(t){Array.isArray(t)&&(this.clampPlane=t,this.fire(new e.Event("data",{data:t})));},i.prototype.clearClampPlane=function(){this.clampPlane=[0,0,0,0],this.fire(new e.Event("data",{data:this.clampPlane}));},i.prototype.clearClampBox=function(){this.clampBox={x:0,y:0,z:0,rotateX:0,rotateY:0,rotateZ:0,anchor:[116,39,0],inner:!0},this.fire(new e.Event("data",{data:this.clampBox}));},i.prototype.setFilter=function(t){this._featureFilter=e.default$25(t),this.boolAABBCalculated=!1;},i.prototype.enablePick=function(){this._pickable=!0;},i.prototype.setAABBFilter=function(t){this._aabbFilter=e.default$25(t);},i.prototype.disablePick=function(){this._pickable=!1;},i.prototype.clearPick=function(){for(var t=0;t<this.nodes.length;t++){var i=this.nodes[t];if(i.primitiveStack)for(var a=0;a<i.primitiveStack.length;a++){i.primitiveStack[a].highlight=!1;}}this.fire(new e.Event("data",{}));},i.prototype.queryRenderedFeatures=function(t,i,a,o,r,n){for(var s,l=[],u=1/0,c=[],_=0;_<this.nodes.length;_++){var f=this.nodes[_],m=this.meshes[this.nodes[_].mesh];if(f.primitiveStack)for(var p=0;p<m.primitivesInd.length;p++){for(var h=this.primitives[m.primitivesInd[p]],d=e.calcNodeBBox(this,this,f,h.aabb),g=0;g<d.length;g++){if(r.intersectTriangle.apply(r,d[g].concat([!1],[[]]))){for(var v=e.readArrayToTriangleFloatArray(this.gltfParser.bufferData[h.intersectOptions.bufViewBufferIndex],h.intersectOptions.bufferDataConfig),y=e.calcLayerOrSourceAccessorBox(this,this,f,v),x=0;x<y.length;x++){var b=r.intersectTriangle.apply(r,y[x].concat([!1],[[]]));if(b){var w=e.dist(r.origin,b);w<u&&(c=b,u=w,l[0]=f.primitiveStack[p],s=f.properties);}}y=null;}}d=null;}}return l[0]?[{_parent:this,properties:Object.assign({},s),primitiveData:l[0],intersectionPoint:c,intersectionZ:u}]:l},i.prototype.highlightMesh=function(e){if(this.clearPick(),!this.noHighlighting)for(var t=0;t<this.nodes.length;t++){var i=this.nodes[t];if(i.primitiveStack)for(var a=0;a<i.primitiveStack.length;a++){var o=i.primitiveStack[a];o.primitiveDataInd===e.primitiveData.primitiveDataInd&&(o.highlight=!0);}}},i.prototype._calAccessorBox=function(t){e.calcLayerOrSourceAccessorBox(this,this,t);},i.prototype.setGltfData=function(e){for(var t=0;t<this.nodes.length;t++){var i=this.nodes[t];if(i.primitiveStack)for(var a=0;a<i.primitiveStack.length;a++){var o=i.primitiveStack[a],r=this.primitives[o.primitiveInd];r.gltfIndexBuffer.destroy(),r.gltfVertexBuffer.destroy();}}this.nodes=[],this.meshes=[],this.primitives=[];for(var n=0;n<this.textures.length;n++)this.textures[n].destroy();this.textures=[],this.materials=[],e&&e.data&&(this._data=e.data,this.modelFolder=e.modelFolder||this.modelFolder,this.load());},i.prototype.changeGltfOption=function(e){if((e=e||{}).material){var t=e.material,i=t.name,a=t.options;this.materials.forEach(function(e){if(e.name===i&&a.hasOwnProperty("opacity")){var t=a.opacity;console.log(e,e.baseColorFactor),e.baseColorFactor&&e.baseColorFactor instanceof Array?e.baseColorFactor[3]=t:e.baseColorFactor=[1,1,1,t];}});}},i.prototype.load=function(){var t=this;this.fire(new e.Event("dataloading",{dataType:"source"})),this.state="dataloading",this._updateWorkerData(function(i){if(i)t.fire(new e.ErrorEvent(i));else{var a={dataType:"source",sourceDataType:"metadata"};t._collectResourceTiming&&t._resourceTiming&&t._resourceTiming.length>0&&(a.resourceTiming=t._resourceTiming,t._resourceTiming=[]),t.fire(new e.Event("data",a));}});},i.prototype.onAdd=function(e){this.map=e,this.load();},i.prototype.setLocation=function(t){var i=this;return this.location=t,this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(t){if(t)i.fire(new e.ErrorEvent(t));else{var a={dataType:"source",sourceDataType:"content"};i._collectResourceTiming&&i._resourceTiming&&i._resourceTiming.length>0&&(a.resourceTiming=i._resourceTiming,i._resourceTiming=[]),i.fire(new e.Event("data",a));}}),this},i.prototype.prepare=function(){this.uploaded||(this._processGLBuffers(),this.uploaded=!0);},i.prototype._updateWorkerData=function(t){var i=this,a=e.extend({},this.workerOptions);a.location=this.location,a.source=this.id;var o=this._data;"string"==typeof o?(a.request=this.map._transformRequest(e.default.resolveURL(o),e.ResourceType.Source),a.request.collectResourceTiming=this._collectResourceTiming,this.workerID=this.dispatcher.send(this.type+".loadData",a,function(e,o){i._removed||o&&o.abandoned||(i._loaded=!0,i.state="parsing",i.result=o,i._processGLBuffers(),o&&o.resourceTiming&&o.resourceTiming[i.id]&&(i._resourceTiming=o.resourceTiming[i.id].slice(0)),i.dispatcher.send(i.type+".coalesce",{source:a.source},null,i.workerID),t(e));},this.workerID)):(this.result={gltf:this._data,bufferData:this._data.buffers.map(function(e){return e.data[0]}),resourceTiming:{}},this._processGLBuffers());},i.prototype.calcBaseMatrix=function(){e.calculateLayerOrSourceBaseMatrix(this,this);},i.prototype._processGLBuffers=function(){var t=this.result;if(t){this.gltfModelVAO||(this.gltfModelVAO=new e.default$17);var i=t.gltf;e.calculateLayerOrSourceBaseMatrix(this,this);var a=this.map.painter.context;this.samplers=i.samplers||[{magFilter:9729,minFilter:9986,wrapS:a.gl.CLAMP_TO_EDGE,wrapT:10497}],this.gltfParser=new Z(i,a,t.bufferData,this,this._featureFilter,"airline"===this.configuration.renderType),this.gltfParser.processGLTF(),i.scenes[0].extras&&(this.sceneConf=i.scenes[0].extras);for(var o=0;o<i.meshes.length;o++)for(var r=0;r<i.meshes[o].primitives.length;r++)for(var n=i.meshes[o].primitives[r].attributes.POSITION,s=i.accessors[n],l=s.min,u=s.max,c=0;c<3;c++)l[c]<this.minClampBounds[c]&&(this.minClampBounds[c]=l[c]),u[c]>this.maxClampBounds[c]&&(this.maxClampBounds[c]=u[c]);}},i.prototype.loadTile=function(e,t){},i.prototype.abortTile=function(e){e.aborted=!0;},i.prototype.unloadGPUData=function(){for(var e=0;e<this.nodes.length;e++){var t=this.nodes[e];if(t.primitiveStack)for(var i=0;i<t.primitiveStack.length;i++){var a=t.primitiveStack[i],o=this.primitives[a.primitiveInd];o.gltfIndexBuffer.destroy(),o.gltfVertexBuffer.destroy();}}this.uploaded=!1,this.nodes=[],this.meshes=[],this.primitives=[];},i.prototype.unloadTile=function(e){},i.prototype.onRemove=function(){this._removed=!0,this.dispatcher.send("removeSource",{type:this.type,source:this.id},null,this.workerID);},i.prototype.serialize=function(){return e.extend({},this._options,{type:this.type,data:this._data,maxzoom:this.maxzoom,bounds:this.bounds,location:this.location,"up-axis":this.upAxis})},i.prototype.hasTransition=function(){return!1},i.prototype.isEarthSource=function(){return!0},Object.defineProperties(i.prototype,a),i}(e.Evented),ee=function(t){function i(e,i,a,o){t.call(this),this.id=e,this.dispatcher=a,this.type="panorama",this.minzoom=0,this.maxzoom=22,this.dataType=i.dataType||"equirectangular",this.setEventedParent(o),this._options=i,this._location=i.location,this._photoId=i.photoId,this._staticImgUrl=this._options.url.substring(0,this._options.url.indexOf("get-panorama"))+"static/pano/",this._strictRefresh=!0,this._eles=[],G(this);}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype._animateMapZoom=function(e,t,i,a){this._frame&&this.map._cancelRenderFrame(this._frame);var o=Date.now()-this._startTime;o<1e3?(this.map.setZoom(o/1e3*6.5),this._frame=this.map._requestRenderFrame(this._animateMapZoom.bind(this,e,t,i,a))):this.setPhotoId(e,t,i,a);},i.prototype._distanceMouseMoveCallBack=function(e){var t=this.map;if(this._panoJson&&t.panoramaMode){var i=this._panoJson.properties.angle.pitch*Math.sin(Math.abs(e.lngLat.lat/2));if(!t.panoramaMode||e.lngLat.lat-i<0||e.lngLat.lat-i>17)this._distanceNodeElementWrapper&&(this._distanceNodeElementWrapper.style.display="none");else{this._distanceNodeElementWrapper&&(this._distanceNodeElementWrapper.style.display="block"),this._distanceNodeElementWrapper||(this._distanceNodeElementWrapper=d.create("div","minemap-panorama-distance-wrapper",t.getCanvasContainer()),this._distanceNodeElement=d.create("div","minemap-panorama-distance-circle",this._distanceNodeElementWrapper),this._distanceNodeText=d.create("div","minemap-panorama-distance-text",this._distanceNodeElementWrapper),this._distanceNodeText.innerText="向前移动5米",this._distanceNodeElement.extra={distance:0,directional:"front",directionalId:"",directionalChange:0},d.addEventListener(this._distanceNodeElement,"click",this._panoControlCallBack));for(var a=this._panoJson.properties.links,o=null,r=e.lngLat.lng-180,n=0;n<a.length;n++){var s=a[n].angleRange;s.min>s.max?(r>=-180&&r<=s.max||r>=s.min&&r<=180)&&(o=a[n]):r>=s.min&&r<=s.max&&(o=a[n]);}if(!o)return this._distanceNodeElement.extra={distance:0,directional:null,directionalId:"",directionalChange:0},void(this._distanceNodeElementWrapper.style.display="none");if(this._distanceNodeElementWrapper.style.top=e.point.y-80+"px",this._distanceNodeElementWrapper.style.left=e.point.x-80+"px",this._distanceNodeElement.style["background-size"]=100-(18-e.lngLat.lat)/18*100+"% "+(100-(18-e.lngLat.lat)/18*100)+"%",this._wrapperDOM&&"block"===this._wrapperDOM.style.display)parseInt(this._wrapperDOM.style.top)-parseInt(this._distanceNodeElementWrapper.style.top)<4&&(this._distanceNodeElementWrapper.style.display="none");var l=(18-e.lngLat.lat)/18*100;this._distanceNodeText.innerText="向前移动"+l.toFixed(0)+"米",this._distanceNodeElement.extra={distance:l,directional:o.directional,directionalId:o.name,directionalChange:o.directionalChange,dir:o.dir},d.setTransform(this._distanceNodeElement,"rotateX(75deg) rotateZ(0deg)");}}},i.prototype._mouseOverCallBack=function(){this._showControlBtn();},i.prototype._panoControlCallBack=function(e){var t=e.target.extra;if(t.hasOwnProperty("distance")){if(t.distance<=2)return;this._startTime=Date.now(),this.map.transform.panoAnyWhereMoveAngle=-t.dir+this._panoAngleYaw,this._animateMapZoom(t.directionalId,t.directional,t.distance,t.directionalChange);}else{var i=t.name;this._startTime=Date.now(),this.map.transform.panoAnyWhereMoveAngle=-t.dir+this._panoAngleYaw,this._animateMapZoom(i);}},i.prototype._parseControlBtn=function(e){var t=this.map;if(this._eles&&this._eles.length>0){for(var i=0;i<this._eles.length;i++)d.removeEventListener(this._eles[i],"click",this._panoControlCallBack),d.remove(this._eles[i]);d.remove(this._wrapperDOM);}this._distanceNodeElement&&(d.removeEventListener(this._distanceNodeElement,"click",this._panoControlCallBack),this._distanceNodeElementWrapper&&d.remove(this._distanceNodeElementWrapper),this._distanceNodeElementWrapper=null),this._eles=[],this._wrapperDOM=d.create("div","minemap-panorama-wrapper",this.map.getCanvasContainer()),this._wrapperDOM.style.top=t.transform.height/2+150+"px",this._wrapperDOM.style.left=t.transform.width/2-150+"px",this._wrapperDOM.style.display="none";for(var a=0;a<e.length;a++){var o=d.create("div","minemap-panorama",this._wrapperDOM);o.innerText=e[a]&&e[a].dirName,o.style.transform="rotateZ("+(e[a].dir-this._panoAngleYaw)+"deg) translateY(-100px)",o.extra=e[a];for(var r=e[a].dir-this._panoAngleYaw-20,n=e[a].dir-this._panoAngleYaw+20;r>180;)r-=360;for(;r<-180;)r+=360;for(;n>180;)n-=360;for(;n<-180;)n+=360;e[a].angleRange={min:r,max:n},d.addEventListener(o,"click",this._panoControlCallBack),this._eles.push(o);}d.setTransform(this._wrapperDOM,"rotateX(75deg) rotateZ("+(this.map.getCenter().lng+90)+"deg)");},i.prototype._showControlBtn=function(){this._wrapperDOM&&(this._wrapperDOM.style.display="block");},i.prototype._hideControlBtn=function(){this._wrapperDOM&&(this._wrapperDOM.style.display="none");},i.prototype.load=function(){var t=this;this.fire(new e.Event("dataloading",{dataType:"source"})),this._location?this.url=this._options.url.replace("{location}",this._location).replace("{photoId}",-1).replace("{directional}",-1).replace("{distance}",0).replace("{directionalChange}",0):this._directional?this.url=this._options.url.replace("{location}",-1).replace("{photoId}",this._photoId).replace("{directional}",this._directional).replace("{distance}",this._distance).replace("{directionalChange}",this._directionalChange):this.url=this._options.url.replace("{location}",-1).replace("{photoId}",this._photoId).replace("{directional}",-1).replace("{distance}",0).replace("{directionalChange}",0),e.getJSON(this.map._transformRequest(this.url),function(i,a){i?t.fire(new e.ErrorEvent(i)):(t._panoAngleYaw=a.properties.angle.yaw,t._parseControlBtn(a.properties.links),t._panoJson=a,e.getImage(t.map._transformRequest(t._staticImgUrl+a.properties.name+a.properties.suffix,e.ResourceType.Image),function(a,o){a?t.fire(new e.ErrorEvent(i)):o&&(t.image=o),t._finishLoading();}));});},i.prototype.setLocation=function(e){e&&(this._strictRefresh=!0,this._location=e,this.load());},i.prototype.setPhotoId=function(e,t,i,a){e&&(this._strictRefresh=!0,this._photoId=e,this._directional=t,this._distance=i,this._location=null,this._directionalChange=a,this.load());},i.prototype._finishLoading=function(){this.map&&(this.sphereArray?this.prepare(!0):(this.sphereArray=new e.SphereImageArray,e.sphereGenerator(1,7,256,e.ProjectionType.LATLON,this.sphereArray),this.prepare(!0),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"}))));},i.prototype._panoUpdateArrowDirCallBack=function(){var t=this.map;this._wrapperDOM&&(t.transform._center.lat>30||t.transform._center.lat<-8||!t.panoramaMode?this._hideControlBtn():(this._showControlBtn(),d.setTransform(this._wrapperDOM,"rotateX("+(60-t.transform._center.lat)+"deg) rotateZ("+(this.map.getCenter().lng+90)+"deg)")),this.map.fire(new e.Event("panorama-change-bearing",{angle:-this._panoAngleYaw+t.getCenter().lng+90})));},i.prototype._panoUpdateArrowMoveednCallBack=function(){},i.prototype._panoDragPan=function(){var t;this.map.getCenter().lng<=0&&this.map.getCenter().lng>=-180?t=360+this.map.getCenter().lng:this.map.getCenter().lng>0&&this.map.getCenter().lng<=180&&(t=this.map.getCenter().lng),this.map.fire(new e.Event("panorama-drag",{angle:t,lng:this.map.getCenter().lng}));},i.prototype.onAdd=function(e){this.map=e,e.on("move",this._panoUpdateArrowDirCallBack),e.on("mousemove",this._distanceMouseMoveCallBack),e.on("drag",this._panoDragPan),this.load();},i.prototype.onRemove=function(){this.map.off("move",this._panoUpdateArrowDirCallBack),this.map.off("mousemove",this._distanceMouseMoveCallBack),this.map.off("drag",this._panoDragPan);for(var e=0;e<this._eles.length;e++)d.removeEventListener(this._eles[e],"click",this._panoControlCallBack),d.remove(this._eles[e]);this.map._cancelRenderFrame(this._frame),this._eles=[],this.map=null;},i.prototype.setNewDataCallback=function(e){this._newDataCallback=e;},i.prototype.prepare=function(t){var i=this.map.painter.context,a=i.gl;this._strictRefresh&&t&&this.sphereArray&&(this.sphereBuffer||(this.sphereBuffer=i.createVertexBuffer(this.sphereArray,V.members)),this.sphereVAO||(this.sphereVAO=new e.default$17),!this.texture&&this.image?(this.texture=new e.default$4(i,this.image,a.RGBA,{flipY:!0}),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),this.fire(new e.Event("data",{type:"panoram-changed"}))):(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),i.pixelStoreUnpackFlipY.set(!0),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.image),this.map._cancelRenderFrame(this._frame),this._newDataCallback&&this._newDataCallback(this._panoJson.properties.name),this.map.setCenter([-90,this.map.getCenter().lat]),this.map.fire(new e.Event("panorama-change-bearing",{angle:90-this._panoAngleYaw})),this.map.setZoom(0),this.fire(new e.Event("data",{type:"panoram-changed"}))),this._strictRefresh=!1);},i.prototype.serialize=function(){return{type:"panorama",url:this._options.url,debug:this._options.debug||!1}},i.prototype.hasTransition=function(){return!1},i.prototype.isEarthSource=function(){return!0},i}(e.Evented),te={vector:k,raster:$,geojson:U,video:W,image:X,canvas:j,"sphere-image":Y,"3d-model":J,"3d-tile":Q,panorama:ee},ie=function(t,i,a,o){var r=new te[i.type](t,i,a,o);if(r.id!==t)throw new Error("Expected Source id to be "+t+" instead of "+r.id);return e.bindAll(["load","abort","unload","serialize","prepare"],r),r};function ae(t,i){var a=e.identity([]);return e.translate(a,a,[1,1,0]),e.scale(a,a,[.5*t.width,.5*t.height,1]),e.multiply(a,a,t.calculatePosMatrix(i.toUnwrapped()))}function oe(e,t,i,a,o){var r=function(e,t,i){if(e)for(var a=0,o=e;a<o.length;a+=1){var r=t[o[a]];if(r&&r.source===i&&("extrusion"===r.type||"histogram"===r.type))return!0}else for(var n in t){var s=t[n];if(s.source===i&&("extrusion"===s.type||"histogram"===s.type))return!0}return!1}(a&&a.layers,t,e.id),n=o.maxPitchScaleFactor(),s=e.tilesIn(i,n,r);s.sort(ue);for(var l=[],u=0,c=s;u<c.length;u+=1){var _=c[u];l.push({wrappedTileID:_.tileID.wrapped().key,queryResults:_.tile.queryRenderedFeatures(t,e._state,_.queryGeometry,_.cameraQueryGeometry,_.scale,a,o,n,ae(e.transform,_.tileID))});}var f=function(e){for(var t={},i={},a=0,o=e;a<o.length;a+=1){var r=o[a],n=r.queryResults,s=r.wrappedTileID,l=i[s]=i[s]||{};for(var u in n)for(var c=n[u],_=l[u]=l[u]||{},f=t[u]=t[u]||[],m=0,p=c;m<p.length;m+=1){var h=p[m];_[h.featureIndex]||(_[h.featureIndex]=!0,h.feature.intersectionZ=h.intersectionZ,f.push(h.feature));}}return t}(l);for(var m in f)f[m].forEach(function(t){var i=e.getFeatureState(t.layer["source-layer"],t.id);t.source=t.layer.source,t.layer["source-layer"]&&(t.sourceLayer=t.layer["source-layer"]),t.state=i;});return f}function re(t,i,a,o,r,n){var s={};if(!o.layers)return{};for(var l=0;l<o.layers.length;l++){var u=o.layers[l];if("sphere-extrusion"===i[u].type){var c=[],_=1/0,f=void 0;t.tilesInOfSphereExtrusion(a,r,i[u]).map(function(t){return(t?t.featureTrangles:[]).map(function(t){for(var i=t.triangles,a=0;a<i.length;a++){var o=n.intersectTriangle.apply(n,i[a].concat([!1],[[]]));if(o){var r=e.dist(n.origin,o);r<_&&(_=r,f=t.feature);}}return null}),null}),f&&c.push({feature:f,intersectionZ:_}),s[""+u]=c;}}return s}function ne(e,t,i,a,o,r,n){var s=[],l=e.getSource(),u=!1,c="";for(var _ in t){var f=t[_];f.source===e.id&&(c=_,f.useLayerPosition&&(u=!0,f.clearPick(),s=s.concat(f.queryLayerRenderedFeatures(t,i,a,o,r,e))));}if(u||(s=l.queryRenderedFeatures(t,i,a,o,r,e)),0===s.length)return null;u&&(s.sort(function(e,t){return e.intersectionZ-t.intersectionZ}),c=s[0].layer);var m={};return n&&s[0]._parent.highlightMesh(s[0]),m[c]=s,m}function se(e,t,i,a,o,r,n){for(var s=[],l=0,u=e.tilesIn(i,0,!0);l<u.length;l+=1){var c=u[l].queryRenderedFeatures(t,i,a,o,r,e);s=s.concat(c);}for(var _=1/0,f=0,m=0;m<s.length;m++)s[m].intersectionZ<_&&(f=m,_=s[m].intersectionZ);var p="";for(var h in t)t[h].source===e.id&&(p=h);if(0===s.length)return null;var d={},g=s[f];return n?g._parent.highlightMesh(g):g._parent=null,d[p]=[g],d}function le(e,t,i,a,o,r,n,s,l){var u={},c=[];if(n&&s&&l)for(var _=0;_<i.length;_++){var f=i[_],m=s.pointLocation(f,l.z_ndc),p=s.coordinatePoint(s.locationCoordinate(m));c.push(p);}else c=i;for(var h=o.queryRenderedSymbols(c),d=[],g=0,v=Object.keys(h).map(Number);g<v.length;g+=1){var y=v[g];d.push(r[y]);}d.sort(ue);for(var x=function(){var t=w[b],i=t.featureIndex.lookupSymbolFeatures(h[t.bucketInstanceId],t.bucketIndex,t.sourceLayerIndex,a.filter,a.layers,e);for(var o in i){var r=u[o]=u[o]||[],n=i[o];n.sort(function(e,i){var a=t.featureSortOrder;if(a){var o=a.indexOf(e.featureIndex);return a.indexOf(i.featureIndex)-o}return i.featureIndex-e.featureIndex});for(var s=0,l=n;s<l.length;s+=1){var c=l[s];r.push(c.feature);}}},b=0,w=d;b<w.length;b+=1)x();var A=function(i){u[i].forEach(function(a){var o=e[i],r=t[o.source].getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=r;});};for(var T in u)A(T);return u}function ue(e,t){var i=e.tileID,a=t.tileID;return i.overscaledZ-a.overscaledZ||i.canonical.y-a.canonical.y||i.wrap-a.wrap||i.canonical.x-a.canonical.x}function ce(){return new e.default$2.Worker(to.workerUrl)}var _e=function(){this.active={};};_e.prototype.acquire=function(e){if(!this.workers){var t=_e.workerCount;for(this.workers=[];this.workers.length<t;)this.workers.push(new ce);}return this.active[e]=!0,this.workers.slice()},_e.prototype.release=function(e){delete this.active[e],0===Object.keys(this.active).length&&(this.workers.forEach(function(e){e.terminate();}),this.workers=null);};var fe,me=Math.floor(e.default.hardwareConcurrency/2);function pe(t,i){var a={};for(var o in t)"ref"!==o&&(a[o]=t[o]);return e.default$29.forEach(function(e){e in i&&(a[e]=i[e]);}),a}function he(e){e=e.slice();for(var t=Object.create(null),i=0;i<e.length;i++)t[e[i].id]=e[i];for(var a=0;a<e.length;a++)"ref"in e[a]&&(e[a]=pe(e[a],t[e[a].ref]));return e}_e.workerCount=Math.max(Math.min(me,6),1);var de={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ge(e,t,i,a){i.push({command:de.addSource,args:[e,t[e],{isOriginal:a}]});}function ve(e,t,i){t.push({command:de.removeSource,args:[e]}),i[e]=!0;}function ye(e,t,i,a,o){ve(e,i,a),ge(e,t,i,o);}function xe(t,i,a){var o;for(o in t[a])if(t[a].hasOwnProperty(o)&&"data"!==o&&!e.default$30(t[a][o],i[a][o]))return!1;for(o in i[a])if(i[a].hasOwnProperty(o)&&"data"!==o&&!e.default$30(t[a][o],i[a][o]))return!1;return!0}function be(t,i,a,o,r,n){var s;for(s in t=t||{},i=i||{},t)t.hasOwnProperty(s)&&(e.default$30(t[s],i[s])||a.push({command:n,args:[o,s,i[s],r]}));for(s in i)i.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(e.default$30(t[s],i[s])||a.push({command:n,args:[o,s,i[s],r]}));}function we(e){return e.id}function Ae(e,t){return e[t.id]=t,e}function Te(t,i,a){if(!t)return[{command:de.setStyle,args:[i]}];var o=[];try{if(!e.default$30(t.version,i.version))return[{command:de.setStyle,args:[i]}];e.default$30(t.center,i.center)||o.push({command:de.setCenter,args:[i.center]}),e.default$30(t.zoom,i.zoom)||o.push({command:de.setZoom,args:[i.zoom]}),e.default$30(t.bearing,i.bearing)||o.push({command:de.setBearing,args:[i.bearing]}),e.default$30(t.pitch,i.pitch)||o.push({command:de.setPitch,args:[i.pitch]}),e.default$30(t.sprite,i.sprite)||o.push({command:de.setSprite,args:[i.sprite]}),e.default$30(t.glyphs,i.glyphs)||o.push({command:de.setGlyphs,args:[i.glyphs]}),e.default$30(t.transition,i.transition)||o.push({command:de.setTransition,args:[i.transition]}),e.default$30(t.light,i.light)||o.push({command:de.setLight,args:[i.light]});var r={};for(var n in i.layers.forEach(function(e){e._original_style=!0;}),i.sources)i.sources[n]._original_style=!0;var s=[];!function(t,i,a,o,r){var n;for(n in t=t||{},i=i||{},t)t.hasOwnProperty(n)&&(r&&!t[n]._original_style||i.hasOwnProperty(n)||ve(n,a,o));for(n in i)i.hasOwnProperty(n)&&(t.hasOwnProperty(n)?e.default$30(t[n],i[n])||("geojson"===t[n].type&&"geojson"===i[n].type&&xe(t,i,n)?a.push({command:de.setGeoJSONSourceData,args:[n,i[n].data]}):ye(n,i,a,o,i[n]._original_style)):i[n]._original_style?ge(n,i,a,!0):ge(n,i,a,!1));}(t.sources,i.sources,s,r,a);var l=[];t.layers&&t.layers.forEach(function(e){r[e.source]?o.push({command:de.removeLayer,args:[e.id]}):l.push(e);}),o=o.concat(s),a&&l.forEach(function(e){e._original_style||i.layers.push(e);}),function(t,i,a,o){t=t||[],i=i||[];var r,n,s,l,u,c,_,f=t.map(we),m=i.map(we),p=t.reduce(Ae,{}),h=i.reduce(Ae,{}),d=f.slice(),g=Object.create(null);for(r=0,n=0;r<f.length;r++)s=f[r],o&&p.hasOwnProperty(s)&&!p[s]._original_style?n++:h.hasOwnProperty(s)?n++:(a.push({command:de.removeLayer,args:[s]}),d.splice(d.indexOf(s,n),1));for(r=0,n=0;r<m.length;r++)s=m[m.length-1-r],d[d.length-1-r]!==s&&(p.hasOwnProperty(s)?(a.push({command:de.removeLayer,args:[s]}),d.splice(d.lastIndexOf(s,d.length-n),1)):n++,c=d[d.length-r],a.push({command:de.addLayer,args:[h[s],c,{isOriginal:h[s]._original_style}]}),d.splice(d.length-r,0,s),g[s]=!0);for(r=0;r<m.length;r++)if(l=p[s=m[r]],u=h[s],!g[s]&&!e.default$30(l,u))if(e.default$30(l.source,u.source)&&e.default$30(l["source-layer"],u["source-layer"])&&e.default$30(l.type,u.type)){for(_ in be(l.layout,u.layout,a,s,null,de.setLayoutProperty),be(l.paint,u.paint,a,s,null,de.setPaintProperty),e.default$30(l.filter,u.filter)||a.push({command:de.setFilter,args:[s,u.filter]}),e.default$30(l.minzoom,u.minzoom)&&e.default$30(l.maxzoom,u.maxzoom)||a.push({command:de.setLayerZoomRange,args:[s,u.minzoom,u.maxzoom]}),l)l.hasOwnProperty(_)&&"layout"!==_&&"paint"!==_&&"filter"!==_&&"metadata"!==_&&"minzoom"!==_&&"maxzoom"!==_&&(0===_.indexOf("paint.")?be(l[_],u[_],a,s,_.slice(6),de.setPaintProperty):e.default$30(l[_],u[_])||a.push({command:de.setLayerProperty,args:[s,_,u[_]]}));for(_ in u)u.hasOwnProperty(_)&&!l.hasOwnProperty(_)&&"layout"!==_&&"paint"!==_&&"filter"!==_&&"metadata"!==_&&"minzoom"!==_&&"maxzoom"!==_&&(0===_.indexOf("paint.")?be(l[_],u[_],a,s,_.slice(6),de.setPaintProperty):e.default$30(l[_],u[_])||a.push({command:de.setLayerProperty,args:[s,_,u[_]]}));}else a.push({command:de.removeLayer,args:[s]}),c=d[d.lastIndexOf(s)+1],a.push({command:de.addLayer,args:[u,c,{isOriginal:h[s]._original_style}]});}(l,i.layers,o,a);}catch(e){o=[{command:de.setStyle,args:[i]}];}return o}var Ee=function(e,t,i){var a=this.boxCells=[],o=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(t/i);for(var r=0;r<this.xCellCount*this.yCellCount;r++)a.push([]),o.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0;};Ee.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Ee.prototype.insert=function(e,t,i,a,o){this._forEachCell(t,i,a,o,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(o);},Ee.prototype.insertCircle=function(e,t,i,a){this._forEachCell(t-a,i-a,t+a,i+a,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(i),this.circles.push(a);},Ee.prototype._insertBoxCell=function(e,t,i,a,o,r){this.boxCells[o].push(r);},Ee.prototype._insertCircleCell=function(e,t,i,a,o,r){this.circleCells[o].push(r);},Ee.prototype._query=function(e,t,i,a,o,r){if(i<0||e>this.width||a<0||t>this.height)return!o&&[];var n=[];if(e<=0&&t<=0&&this.width<=i&&this.height<=a){if(o)return!0;for(var s=0;s<this.boxKeys.length;s++)n.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var l=0;l<this.circleKeys.length;l++){var u=this.circles[3*l],c=this.circles[3*l+1],_=this.circles[3*l+2];n.push({key:this.circleKeys[l],x1:u-_,y1:c-_,x2:u+_,y2:c+_});}return r?n.filter(r):n}var f={hitTest:o,seenUids:{box:{},circle:{}}};return this._forEachCell(e,t,i,a,this._queryCell,n,f,r),o?n.length>0:n},Ee.prototype._queryCircle=function(e,t,i,a,o){var r=e-i,n=e+i,s=t-i,l=t+i;if(n<0||r>this.width||l<0||s>this.height)return!a&&[];var u=[],c={hitTest:a,circle:{x:e,y:t,radius:i},seenUids:{box:{},circle:{}}};return this._forEachCell(r,s,n,l,this._queryCellCircle,u,c,o),a?u.length>0:u},Ee.prototype.query=function(e,t,i,a,o){return this._query(e,t,i,a,!1,o)},Ee.prototype.hitTest=function(e,t,i,a,o){return this._query(e,t,i,a,!0,o)},Ee.prototype.hitTestCircle=function(e,t,i,a){return this._queryCircle(e,t,i,!0,a)},Ee.prototype._queryCell=function(e,t,i,a,o,r,n,s){var l=n.seenUids,u=this.boxCells[o];if(null!==u)for(var c=this.bboxes,_=0,f=u;_<f.length;_+=1){var m=f[_];if(!l.box[m]){l.box[m]=!0;var p=4*m;if(e<=c[p+2]&&t<=c[p+3]&&i>=c[p+0]&&a>=c[p+1]&&(!s||s(this.boxKeys[m]))){if(n.hitTest)return r.push(!0),!0;r.push({key:this.boxKeys[m],x1:c[p],y1:c[p+1],x2:c[p+2],y2:c[p+3]});}}}var h=this.circleCells[o];if(null!==h)for(var d=this.circles,g=0,v=h;g<v.length;g+=1){var y=v[g];if(!l.circle[y]){l.circle[y]=!0;var x=3*y;if(this._circleAndRectCollide(d[x],d[x+1],d[x+2],e,t,i,a)&&(!s||s(this.circleKeys[y]))){if(n.hitTest)return r.push(!0),!0;var b=d[x],w=d[x+1],A=d[x+2];r.push({key:this.circleKeys[y],x1:b-A,y1:w-A,x2:b+A,y2:w+A});}}}},Ee.prototype._queryCellCircle=function(e,t,i,a,o,r,n,s){var l=n.circle,u=n.seenUids,c=this.boxCells[o];if(null!==c)for(var _=this.bboxes,f=0,m=c;f<m.length;f+=1){var p=m[f];if(!u.box[p]){u.box[p]=!0;var h=4*p;if(this._circleAndRectCollide(l.x,l.y,l.radius,_[h+0],_[h+1],_[h+2],_[h+3])&&(!s||s(this.boxKeys[p])))return r.push(!0),!0}}var d=this.circleCells[o];if(null!==d)for(var g=this.circles,v=0,y=d;v<y.length;v+=1){var x=y[v];if(!u.circle[x]){u.circle[x]=!0;var b=3*x;if(this._circlesCollide(g[b],g[b+1],g[b+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[x])))return r.push(!0),!0}}},Ee.prototype._forEachCell=function(e,t,i,a,o,r,n,s){for(var l=this._convertToXCellCoord(e),u=this._convertToYCellCoord(t),c=this._convertToXCellCoord(i),_=this._convertToYCellCoord(a),f=l;f<=c;f++)for(var m=u;m<=_;m++){var p=this.xCellCount*m+f;if(o.call(this,e,t,i,a,p,r,n,s))return}},Ee.prototype._convertToXCellCoord=function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))},Ee.prototype._convertToYCellCoord=function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))},Ee.prototype._circlesCollide=function(e,t,i,a,o,r){var n=a-e,s=o-t,l=i+r;return l*l>n*n+s*s},Ee.prototype._circleAndRectCollide=function(e,t,i,a,o,r,n){var s=(r-a)/2,l=Math.abs(e-(a+s));if(l>s+i)return!1;var u=(n-o)/2,c=Math.abs(t-(o+u));if(c>u+i)return!1;if(l<=s||c<=u)return!0;var _=l-s,f=c-u;return _*_+f*f<=i*i};var Pe=e.default$31.layout;function Se(t,i,a,o,r){var n=e.createFloat64ArrayIdentityMatrix();return i?(e.scale(n,n,[1/r,1/r,1]),a||e.rotateZ(n,n,o.angle)):(e.scale(n,n,[o.width/2,-o.height/2,1]),e.translate(n,n,[1,-1,0]),e.multiply(n,n,t)),n}function Ie(t,i,a,o,r,n){var s=e.createFloat64ArrayIdentityMatrix();return i?(n||e.multiply(s,s,t),e.scale(s,s,[r,r,1]),a||e.rotateZ(s,s,-o.angle)):(e.scale(s,s,[1,-1,1]),e.translate(s,s,[-1,-1,0]),e.scale(s,s,[2/o.width,2/o.height,1])),s}function Me(t,i){var a=[t.x,t.y,0,1];ke(a,a,i);var o=a[3];return{point:new e.default$1(a[0]/o,a[1]/o),signedDistanceFromCamera:o}}function Re(e,t){var i=e[0]/e[3],a=e[1]/e[3];return i>=-t[0]&&i<=t[0]&&a>=-t[1]&&a<=t[1]}function Ce(t,i,a,o,r,n,s,l){var u=o?t.textSizeData:t.iconSizeData,c=e.evaluateSizeForZoom(u,a.transform.zoom,Pe&&Pe.properties&&Pe.properties[o?"text-size":"icon-size"]),_=[256/a.width*2+1,256/a.height*2+1],f=o?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;f.clear();for(var m=t.lineVertexArray,p=o?t.text.placedSymbolArray:t.icon.placedSymbolArray,h=a.transform.width/a.transform.height,d=!1,g=0;g<p.length;g++){var v=p.get(g);if(v.hidden||v.writingMode===e.WritingMode.vertical&&!d)Be(v.numGlyphs,f);else{d=!1;var y=[v.anchorX,v.anchorY,0,1];if(e.transformMat4(y,y,i),Re(y,_)){var x=.5+y[3]/a.transform.cameraToCenterDistance*.5,b=e.evaluateSizeForFeature(u,c,v),w=s?b*x:b/x,A=new e.default$1(v.anchorX,v.anchorY),T=Me(A,r).point,E={},P=Le(v,w,!1,l,i,r,n,t.glyphOffsetArray,m,f,T,A,E,h,t instanceof e.default$32?t:null);d=P.useVertical,(P.notEnoughRoom||d||P.needsFlipping&&Le(v,w,!0,l,i,r,n,t.glyphOffsetArray,m,f,T,A,E,h,t instanceof e.default$32?t:null).notEnoughRoom)&&Be(v.numGlyphs,f);}else Be(v.numGlyphs,f);}}o?t.text.dynamicLayoutVertexBuffer.updateData(f):t.icon.dynamicLayoutVertexBuffer.updateData(f);}function Oe(e,t,i,a,o,r,n,s,l,u,c,_){var f=s.glyphStartIndex+s.numGlyphs,m=s.lineStartIndex,p=s.lineStartIndex+s.lineLength,h=t.getoffsetX(s.glyphStartIndex),d=t.getoffsetX(f-1),g=ze(e*h,i,a,o,r,n,s.segment,m,p,l,u,c,_);if(!g)return null;var v=ze(e*d,i,a,o,r,n,s.segment,m,p,l,u,c,_);return v?{first:g,last:v}:null}function Fe(t,i,a,o){if(t===e.WritingMode.horizontal&&Math.abs(a.y-i.y)>Math.abs(a.x-i.x)*o)return{useVertical:!0};return(t===e.WritingMode.vertical?i.y<a.y:i.x>a.x)?{needsFlipping:!0}:null}function Le(t,i,a,o,r,n,s,l,u,c,_,f,m,p,h){var d,g=i/24,v=t.lineOffsetX*i,y=t.lineOffsetY*i;if(t.numGlyphs>1){var x=t.glyphStartIndex+t.numGlyphs,b=t.lineStartIndex,w=t.lineStartIndex+t.lineLength,A=Oe(g,l,v,y,a,_,f,t,u,n,m,!1);if(!A)return{notEnoughRoom:!0};var T=Me(A.first.point,s).point,E=Me(A.last.point,s).point;if(o&&!a){var P=Fe(t.writingMode,T,E,p);if(P)return P}d=[A.first];for(var S=t.glyphStartIndex+1;S<x-1;S++)d.push(ze(g*l.getoffsetX(S),v,y,a,_,f,t.segment,b,w,u,n,m,!1));d.push(A.last);}else{if(o&&!a){var I=Me(f,r).point,M=t.lineStartIndex+t.segment+1,R=new e.default$1(u.getx(M),u.gety(M)),C=Me(R,r),O=C.signedDistanceFromCamera>0?C.point:De(f,R,I,1,r),F=Fe(t.writingMode,I,O,p);if(F)return F}var L=ze(g*l.getoffsetX(t.glyphStartIndex),v,y,a,_,f,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,u,n,m,!1);if(!L)return{notEnoughRoom:!0};d=[L];}for(var D=0,z=d;D<z.length;D+=1){var N=z[D];h?e.addDynamicAttributes$1(c,N.point,N.angle,N.anchorPoint):e.addDynamicAttributes(c,N.point,N.angle);}return{}}function De(e,t,i,a,o){var r=Me(e.add(e.sub(t)._unit()),o).point,n=i.sub(r);return i.add(n._mult(a/n.mag()))}function ze(t,i,a,o,r,n,s,l,u,c,_,f,m){var p=o?t-i:t+i,h=p>0?1:-1,d=0;o&&(h*=-1,d=Math.PI),h<0&&(d+=Math.PI);for(var g=h>0?l+s:l+s+1,v=g,y=r,x=r,b=0,w=0,A=Math.abs(p);b+w<=A;){if((g+=h)<l||g>=u)return null;if(x=y,void 0===(y=f[g])){var T=new e.default$1(c.getx(g),c.gety(g)),E=Me(T,_);if(E.signedDistanceFromCamera>0)y=f[g]=E.point;else{var P=g-h;y=De(0===b?n:new e.default$1(c.getx(P),c.gety(P)),T,x,A-b+1,_);}}b+=w,w=x.dist(y);}var S=(A-b)/w,I=y.sub(x),M=I.mult(S)._add(x);return M._add(I._unit()._perp()._mult(a*h)),{point:M,angle:d+Math.atan2(y.y-x.y,y.x-x.x),anchorPoint:r,tileDistance:m?{prevTileDistance:g-h===v?0:c.gettileUnitDistanceFromAnchor(g-h),lastSegmentViewportDistance:A-b}:null}}var Ne=new Float64Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Be(e,t){for(var i=0;i<e;i++){var a=t.length;t.resize(a+4),t.float32.set(Ne,3*a);}}function ke(e,t,i){var a=t[0],o=t[1];return e[0]=i[0]*a+i[4]*o+i[12],e[1]=i[1]*a+i[5]*o+i[13],e[3]=i[3]*a+i[7]*o+i[15],e}var $e=function(e,t,i){void 0===t&&(t=new Ee(e.width+200,e.height+200,25)),void 0===i&&(i=new Ee(e.width+200,e.height+200,25)),this.transform=e,this.grid=t,this.ignoredGrid=i,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+100,this.screenBottomBoundary=e.height+100,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200;};function Ue(e,t,i){e[t+4]=i?1:0;}function Ve(t,i,a){return i*(e.default$12/(t.tileSize*Math.pow(2,a-t.tileID.overscaledZ)))}$e.prototype.placeCollisionBox=function(e,t,i,a,o){var r=this.projectAndGetPerspectiveRatio(a,e.anchorPointX,e.anchorPointY),n=i*r.perspectiveRatio,s=e.x1*n+r.point.x,l=e.y1*n+r.point.y,u=e.x2*n+r.point.x,c=e.y2*n+r.point.y;return!this.isInsideGrid(s,l,u,c)||!t&&this.grid.hitTest(s,l,u,c,o)?{box:[],offscreen:!1}:{box:[s,l,u,c],offscreen:this.isOffscreen(s,l,u,c)}},$e.prototype.approximateTileDistance=function(e,t,i,a,o){var r=o?1:a/this.pitchfactor,n=e.lastSegmentViewportDistance*i;return e.prevTileDistance+n+(r-1)*n*Math.abs(Math.sin(t))},$e.prototype.placeCollisionCircles=function(t,i,a,o,r,n,s,l,u,c,_,f,m,p){var h=[],d=this.projectAnchor(c,n.anchorX,n.anchorY),g=u/24,v=n.lineOffsetX*u,y=n.lineOffsetY*u,x=new e.default$1(n.anchorX,n.anchorY),b=Oe(g,l,v,y,!1,Me(x,_).point,x,n,s,_,{},!0),w=!1,A=!1,T=!0,E=d.perspectiveRatio*o,P=1/(o*a),S=0,I=0;b&&(S=this.approximateTileDistance(b.first.tileDistance,b.first.angle,P,d.cameraDistance,m),I=this.approximateTileDistance(b.last.tileDistance,b.last.angle,P,d.cameraDistance,m));for(var M=0;M<t.length;M+=5){var R=t[M],C=t[M+1],O=t[M+2],F=t[M+3];if(!b||F<-S||F>I)Ue(t,M,!1);else{var L=this.projectPoint(c,R,C),D=O*E;if(h.length>0){var z=L.x-h[h.length-4],N=L.y-h[h.length-3];if(D*D*2>z*z+N*N)if(M+8<t.length){var B=t[M+8];if(B>-S&&B<I){Ue(t,M,!1);continue}}}var k=M/5;h.push(L.x,L.y,D,k),Ue(t,M,!0);var $=L.x-D,U=L.y-D,V=L.x+D,G=L.y+D;if(T=T&&this.isOffscreen($,U,V,G),A=A||this.isInsideGrid($,U,V,G),!i&&this.grid.hitTestCircle(L.x,L.y,D,p)){if(!f)return{circles:[],offscreen:!1};w=!0;}}}return{circles:w||!A?[]:h,offscreen:T}},$e.prototype.queryRenderedSymbols=function(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var i=[],a=1/0,o=1/0,r=-1/0,n=-1/0,s=0,l=t;s<l.length;s+=1){var u=l[s],c=new e.default$1(u.x+100,u.y+100);a=Math.min(a,c.x),o=Math.min(o,c.y),r=Math.max(r,c.x),n=Math.max(n,c.y),i.push(c);}for(var _={},f={},m=0,p=this.grid.query(a,o,r,n).concat(this.ignoredGrid.query(a,o,r,n));m<p.length;m+=1){var h=p[m],d=h.key;if(void 0===_[d.bucketInstanceId]&&(_[d.bucketInstanceId]={}),!_[d.bucketInstanceId][d.featureIndex]){var g=[new e.default$1(h.x1,h.y1),new e.default$1(h.x2,h.y1),new e.default$1(h.x2,h.y2),new e.default$1(h.x1,h.y2)];e.polygonIntersectsPolygon(i,g)&&(_[d.bucketInstanceId][d.featureIndex]=!0,void 0===f[d.bucketInstanceId]&&(f[d.bucketInstanceId]=[]),f[d.bucketInstanceId].push(d.featureIndex));}}return f},$e.prototype.insertCollisionBox=function(e,t,i,a,o){var r={bucketInstanceId:i,featureIndex:a,collisionGroupID:o};(t?this.ignoredGrid:this.grid).insert(r,e[0],e[1],e[2],e[3]);},$e.prototype.insertCollisionCircles=function(e,t,i,a,o){for(var r=t?this.ignoredGrid:this.grid,n={bucketInstanceId:i,featureIndex:a,collisionGroupID:o},s=0;s<e.length;s+=4)r.insertCircle(n,e[s],e[s+1],e[s+2]);},$e.prototype.projectAnchor=function(e,t,i){var a=[t,i,0,1];return ke(a,a,e),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/a[3]*.5,cameraDistance:a[3]}},$e.prototype.projectPoint=function(t,i,a){var o=[i,a,0,1];return ke(o,o,t),new e.default$1((o[0]/o[3]+1)/2*this.transform.width+100,(-o[1]/o[3]+1)/2*this.transform.height+100)},$e.prototype.projectAndGetPerspectiveRatio=function(t,i,a){var o=[i,a,0,1];return ke(o,o,t),{point:new e.default$1((o[0]/o[3]+1)/2*this.transform.width+100,(-o[1]/o[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/o[3]*.5}},$e.prototype.isOffscreen=function(e,t,i,a){return i<100||e>=this.screenRightBoundary||a<100||t>this.screenBottomBoundary},$e.prototype.isInsideGrid=function(e,t,i,a){return i>=0&&e<this.gridRightBoundary&&a>=0&&t<this.gridBottomBoundary};var Ge=e.default$31.layout,Xe=function(e,t,i,a){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):a&&i?1:0,this.placed=i;};Xe.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var We=function(e,t,i,a,o){this.text=new Xe(e?e.text:null,t,i,o),this.icon=new Xe(e?e.icon:null,t,a,o);};We.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var je=function(e,t,i){this.text=e,this.icon=t,this.skipFade=i;},Ye=function(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={};};Ye.prototype.get=function(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){var t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:function(e){return e.collisionGroupID===t}};}return this.collisionGroups[e]};var Ze=function(e,t,i){this.transform=e,this.collisionIndex=new $e(this.transform),this.placements={},this.opacities={},this.stale=!1,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Ye(i);};function qe(e,t,i){e.emplaceBack(t?1:0,i?1:0),e.emplaceBack(t?1:0,i?1:0),e.emplaceBack(t?1:0,i?1:0),e.emplaceBack(t?1:0,i?1:0);}Ze.prototype.placeLayerTile=function(t,i,a,o){var r=i.getBucket(t),n=i.latestFeatureIndex;if(r&&n&&t.id===r.layerIds[0]){var s=i.collisionBoxArray,l=r.layers[0].layout,u=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),c=i.tileSize/e.default$12,_=this.transform.calculatePosMatrix(i.tileID.toUnwrapped()),f=Se(_,"map"===l.get("text-pitch-alignment"),"map"===l.get("text-rotation-alignment"),this.transform,Ve(i,1,this.transform.zoom)),m=Se(_,"map"===l.get("icon-pitch-alignment"),"map"===l.get("icon-rotation-alignment"),this.transform,Ve(i,1,this.transform.zoom));this.retainedQueryData[r.bucketInstanceId]=new function(e,t,i,a,o){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=i,this.bucketIndex=a,this.tileID=o;}(r.bucketInstanceId,n,r.sourceLayerIndex,r.index,i.tileID),this.placeLayerBucket(r,_,f,m,u,c,a,o,s);}},Ze.prototype.placeLayerBucket=function(t,i,a,o,r,n,s,l,u){for(var c=t.layers[0].layout,_=e.evaluateSizeForZoom(t.textSizeData,this.transform.zoom,Ge&&Ge.properties&&Ge.properties["text-size"]),f=c.get("text-optional"),m=c.get("icon-optional"),p=this.collisionGroups.get(t.sourceID),h=0,d=t.symbolInstances;h<d.length;h+=1){var g=d[h];if(!l[g.crossTileID]){var v=!1,y=!1,x=!0,b=null,w=null,A=null,T=0,E=0;g.collisionArrays||(g.collisionArrays=t.deserializeCollisionBoxes(u,g.textBoxStartIndex,g.textBoxEndIndex,g.iconBoxStartIndex,g.iconBoxEndIndex)),g.collisionArrays.textFeatureIndex&&(T=g.collisionArrays.textFeatureIndex),g.collisionArrays.textBox&&(v=(b=this.collisionIndex.placeCollisionBox(g.collisionArrays.textBox,c.get("text-allow-overlap"),n,i,p.predicate)).box.length>0,x=x&&b.offscreen);var P=g.collisionArrays.textCircles;if(P){var S=t.text.placedSymbolArray.get(g.placedTextSymbolIndices[0]),I=e.evaluateSizeForFeature(t.textSizeData,_,S);w=this.collisionIndex.placeCollisionCircles(P,c.get("text-allow-overlap"),r,n,g.key,S,t.lineVertexArray,t.glyphOffsetArray,I,i,a,s,"map"===c.get("text-pitch-alignment"),p.predicate),v=c.get("text-allow-overlap")||w.circles.length>0,x=x&&w.offscreen;}g.collisionArrays.iconFeatureIndex&&(E=g.collisionArrays.iconFeatureIndex),g.collisionArrays.iconBox&&(y=(A=this.collisionIndex.placeCollisionBox(g.collisionArrays.iconBox,c.get("icon-allow-overlap"),n,i,p.predicate)).box.length>0,x=x&&A.offscreen);var M=f||0===g.numGlyphVertices&&0===g.numVerticalGlyphVertices,R=m||0===g.numIconVertices;M||R?R?M||(y=y&&v):v=y&&v:y=v=y&&v,v&&b&&this.collisionIndex.insertCollisionBox(b.box,c.get("text-ignore-placement"),t.bucketInstanceId,T,p.ID),y&&A&&this.collisionIndex.insertCollisionBox(A.box,c.get("icon-ignore-placement"),t.bucketInstanceId,E,p.ID),v&&w&&this.collisionIndex.insertCollisionCircles(w.circles,c.get("text-ignore-placement"),t.bucketInstanceId,T,p.ID),this.placements[g.crossTileID]=new je(v,y,x||t.justReloaded),l[g.crossTileID]=!0;}}t.justReloaded=!1;},Ze.prototype.commit=function(e,t){this.commitTime=t;var i=!1,a=e&&0!==this.fadeDuration?(this.commitTime-e.commitTime)/this.fadeDuration:1,o=e?e.opacities:{};for(var r in this.placements){var n=this.placements[r],s=o[r];s?(this.opacities[r]=new We(s,a,n.text,n.icon),i=i||n.text!==s.text.placed||n.icon!==s.icon.placed):(this.opacities[r]=new We(null,a,n.text,n.icon,n.skipFade),i=i||n.text||n.icon);}for(var l in o){var u=o[l];if(!this.opacities[l]){var c=new We(u,a,!1,!1);c.isHidden()||(this.opacities[l]=c,i=i||u.text.placed||u.icon.placed);}}i?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t);},Ze.prototype.updateLayerOpacities=function(e,t){for(var i={},a=0,o=t;a<o.length;a+=1){var r=o[a],n=r.getBucket(e);n&&r.latestFeatureIndex&&e.id===n.layerIds[0]&&this.updateBucketOpacities(n,i,r.collisionBoxArray);}},Ze.prototype.updateBucketOpacities=function(e,t,i){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasCollisionBoxData()&&e.collisionBox.collisionVertexArray.clear(),e.hasCollisionCircleData()&&e.collisionCircle.collisionVertexArray.clear();for(var a=e.layers[0].layout,o=new We(null,0,!1,!1,!0),r=new We(null,0,a.get("text-allow-overlap"),a.get("icon-allow-overlap"),!0),n=0;n<e.symbolInstances.length;n++){var s=e.symbolInstances[n],l=t[s.crossTileID],u=this.opacities[s.crossTileID];l?u=o:u||(u=r,this.opacities[s.crossTileID]=u),t[s.crossTileID]=!0;var c=s.numGlyphVertices>0||s.numVerticalGlyphVertices>0,_=s.numIconVertices>0;if(c){for(var f=at(u.text),m=(s.numGlyphVertices+s.numVerticalGlyphVertices)/4,p=0;p<m;p++)e.text.opacityVertexArray.emplaceBack(f);for(var h=0,d=s.placedTextSymbolIndices;h<d.length;h+=1){var g=d[h];e.text.placedSymbolArray.get(g).hidden=u.text.isHidden();}}if(_){for(var v=at(u.icon),y=0;y<s.numIconVertices/4;y++)e.icon.opacityVertexArray.emplaceBack(v);e.icon.placedSymbolArray.get(n).hidden=u.icon.isHidden();}s.collisionArrays||(s.collisionArrays=e.deserializeCollisionBoxes(i,s.textBoxStartIndex,s.textBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex));var x=s.collisionArrays;if(x){x.textBox&&e.hasCollisionBoxData()&&qe(e.collisionBox.collisionVertexArray,u.text.placed,!1),x.iconBox&&e.hasCollisionBoxData()&&qe(e.collisionBox.collisionVertexArray,u.icon.placed,!1);var b=x.textCircles;if(b&&e.hasCollisionCircleData())for(var w=0;w<b.length;w+=5){var A=l||0===b[w+4];qe(e.collisionCircle.collisionVertexArray,u.text.placed,A);}}}e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasCollisionBoxData()&&e.collisionBox.collisionVertexBuffer&&e.collisionBox.collisionVertexBuffer.updateData(e.collisionBox.collisionVertexArray),e.hasCollisionCircleData()&&e.collisionCircle.collisionVertexBuffer&&e.collisionCircle.collisionVertexBuffer.updateData(e.collisionCircle.collisionVertexArray);},Ze.prototype.symbolFadeChange=function(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration},Ze.prototype.hasTransitions=function(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration},Ze.prototype.stillRecent=function(e){return"undefined"!==this.commitTime&&this.commitTime+this.fadeDuration>e},Ze.prototype.setStale=function(){this.stale=!0;};var Qe=Math.pow(2,25),He=Math.pow(2,24),Ke=Math.pow(2,17),Je=Math.pow(2,16),et=Math.pow(2,9),tt=Math.pow(2,8),it=Math.pow(2,1);function at(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;var t=e.placed?1:0,i=Math.floor(127*e.opacity);return i*Qe+t*He+i*Ke+t*Je+i*et+t*tt+i*it+t}var ot=function(){this._currentTileIndex=0,this._seenCrossTileIDs={};};ot.prototype.continuePlacement=function(e,t,i,a,o){for(;this._currentTileIndex<e.length;){var r=e[this._currentTileIndex];if(t.placeLayerTile(a,r,i,this._seenCrossTileIDs),this._currentTileIndex++,o())return!0}};var rt=function(e,t,i,a,o,r){this.placement=new Ze(e,o,r),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=a,this._done=!1;};rt.prototype.isDone=function(){return this._done},rt.prototype.continuePlacement=function(t,i,a){for(var o=this,r=e.default.now(),n=function(){var t=e.default.now()-r;return!o._forceFullPlacement&&t>2};this._currentPlacementIndex>=0;){var s=i[t[o._currentPlacementIndex]],l=o.placement.collisionIndex.transform.zoom;if(("symbol"===s.type||"symtracking"===s.type||"sphere-symbol"===s.type)&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){if(o._inProgressLayer||(o._inProgressLayer=new ot),o._inProgressLayer.continuePlacement(a[s.source],o.placement,o._showCollisionBoxes,s,n))return;delete o._inProgressLayer;}o._currentPlacementIndex--;}this._done=!0;},rt.prototype.commit=function(e,t){return this.placement.commit(e,t),this.placement};var nt=512/e.default$12/2,st=function(e,t,i){this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=i;for(var a=0,o=t;a<o.length;a+=1){var r=o[a],n=r.key;this.indexedSymbolInstances[n]||(this.indexedSymbolInstances[n]=[]),this.indexedSymbolInstances[n].push({crossTileID:r.crossTileID,coord:this.getScaledCoordinates(r,e)});}};st.prototype.getScaledCoordinates=function(t,i){var a=i.canonical.z-this.tileID.canonical.z,o=nt/Math.pow(2,a),r=t.anchor;return{x:Math.floor((i.canonical.x*e.default$12+r.x)*o),y:Math.floor((i.canonical.y*e.default$12+r.y)*o)}},st.prototype.findMatches=function(e,t,i){for(var a=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z),o=0,r=e;o<r.length;o+=1){var n=r[o];if(!n.crossTileID){var s=this.indexedSymbolInstances[n.key];if(s)for(var l=this.getScaledCoordinates(n,t),u=0,c=s;u<c.length;u+=1){var _=c[u];if(Math.abs(_.coord.x-l.x)<=a&&Math.abs(_.coord.y-l.y)<=a&&!i[_.crossTileID]){i[_.crossTileID]=!0,n.crossTileID=_.crossTileID;break}}}}};var lt=function(){this.maxCrossTileID=0;};lt.prototype.generate=function(){return++this.maxCrossTileID};var ut=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0;};ut.prototype.handleWrapJump=function(e){var t=Math.round((e-this.lng)/360);if(0!==t)for(var i in this.indexes){var a=this.indexes[i],o={};for(var r in a){var n=a[r];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),o[n.tileID.key]=n;}this.indexes[i]=o;}this.lng=e;},ut.prototype.addBucket=function(e,t,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key]);}for(var a=0,o=t.symbolInstances;a<o.length;a+=1){o[a].crossTileID=0;}this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});var r=this.usedCrossTileIDs[e.overscaledZ];for(var n in this.indexes){var s=this.indexes[n];if(Number(n)>e.overscaledZ)for(var l in s){var u=s[l];u.tileID.isChildOf(e)&&u.findMatches(t.symbolInstances,e,r);}else{var c=s[e.scaledTo(Number(n)).key];c&&c.findMatches(t.symbolInstances,e,r);}}for(var _=0,f=t.symbolInstances;_<f.length;_+=1){var m=f[_];m.crossTileID||(m.crossTileID=i.generate(),r[m.crossTileID]=!0);}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new st(e,t.symbolInstances,t.bucketInstanceId),!0},ut.prototype.removeBucketCrossTileIDs=function(e,t){for(var i in t.indexedSymbolInstances)for(var a=0,o=t.indexedSymbolInstances[i];a<o.length;a+=1){var r=o[a];delete this.usedCrossTileIDs[e][r.crossTileID];}},ut.prototype.removeStaleBuckets=function(e){var t=!1;for(var i in this.indexes){var a=this.indexes[i];for(var o in a)e[a[o].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,a[o]),delete a[o],t=!0);}return t};var ct=function(){this.layerIndexes={},this.crossTileIDs=new lt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={};};ct.prototype.addLayer=function(e,t,i){var a=this.layerIndexes[e.id];void 0===a&&(a=this.layerIndexes[e.id]=new ut);var o=!1,r={};a.handleWrapJump(i);for(var n=0,s=t;n<s.length;n+=1){var l=s[n],u=l.getBucket(e);u&&e.id===u.layerIds[0]&&(u.bucketInstanceId||(u.bucketInstanceId=++this.maxBucketInstanceId),a.addBucket(l.tileID,u,this.crossTileIDs)&&(o=!0),r[u.bucketInstanceId]=!0);}return a.removeStaleBuckets(r)&&(o=!0),o},ct.prototype.pruneUnusedLayers=function(e){var t={};for(var i in e.forEach(function(e){t[e]=!0;}),this.layerIndexes)t[i]||delete this.layerIndexes[i];};var _t=function(e,t){this.max=e,this.onRemove=t,this.reset();};_t.prototype.reset=function(){for(var e in this.data)for(var t=0,i=this.data[e];t<i.length;t+=1){var a=i[t];a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);}return this.data={},this.order=[],this},_t.prototype.add=function(e,t,i){var a=this,o=e.wrapped().key;void 0===this.data[o]&&(this.data[o]=[]);var r={value:t,timeout:void 0};if(void 0!==i&&(r.timeout=setTimeout(function(){a.remove(e,r);},i)),this.data[o].push(r),this.order.push(o),this.order.length>this.max){var n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n);}return this},_t.prototype.has=function(e){return e.wrapped().key in this.data},_t.prototype.getAndRemove=function(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null},_t.prototype._getAndRemoveByKey=function(e){var t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value},_t.prototype.get=function(e){return this.has(e)?this.data[e.wrapped().key][0].value:null},_t.prototype.remove=function(e,t){if(!this.has(e))return this;var i=e.wrapped().key,a=void 0===t?0:this.data[i].indexOf(t),o=this.data[i][a];return this.data[i].splice(a,1),o.timeout&&clearTimeout(o.timeout),0===this.data[i].length&&delete this.data[i],this.onRemove(o.value),this.order.splice(this.order.indexOf(i),1),this},_t.prototype.setMaxSize=function(e){for(this.max=e;this.order.length>this.max;){var t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t);}return this};var ft=function(t){function i(i,a,o,r){var n=this;t.call(this),this.id=i,this.dispatcher=o,this.on("data",function(e){"source"===e.dataType&&"metadata"===e.sourceDataType&&(n._sourceLoaded=!0),n._sourceLoaded&&!n._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(n.reload(),n.transform&&n.update(n.transform));}),this.on("error",function(){n._sourceErrored=!0;});var s=ie(i,a,o,this);if(s instanceof Q)throw new Error;this._source=s,this._source instanceof $&&(this._source.setSharedTerrainTileCache(r),this.sttc=r),this._tiles={},this._cache=new _t(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._isIdRenderable=this._isIdRenderable.bind(this),this._coveredTiles={},this._state=new e.default$26;}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.onAdd=function(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(e);},i.prototype.onRemove=function(e){this._source&&this._source.onRemove&&this._source.onRemove(e);},i.prototype.clearSTTCInUseStatus=function(){this.sttc&&this.sttc.clearInUseStatus();},i.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var e in this._tiles){var t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0},i.prototype.getSource=function(){return this._source},i.prototype.pause=function(){this._paused=!0;},i.prototype.resume=function(){if(this._paused){var e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform);}},i.prototype._loadTile=function(e,t){return this._source.loadTile(e,t)},i.prototype._unloadTile=function(e){if(this._source.unloadTile)return this._source.unloadTile(e,function(){})},i.prototype._abortTile=function(e){if(this._source.abortTile)return this._source.abortTile(e,function(){})},i.prototype.serialize=function(){return this._source.serialize()},i.prototype.prepare=function(e){for(var t in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles)this._tiles[t].upload(e);},i.prototype.getIds=function(){var e=this;return Object.keys(this._tiles).map(String).sort(function(t,i){var a=e._tiles[t].tileID,o=e._tiles[i].tileID;return a.overscaledZ-o.overscaledZ})},i.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},i.prototype.hasRenderableParent=function(e){var t=this.findLoadedParent(e,0,{});return!!t&&this._isIdRenderable(t.tileID.key)},i.prototype._isIdRenderable=function(e){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]},i.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var e in this._cache.reset(),this._source instanceof J&&(this._source.unloadGPUData(),this._source.prepare()),this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(e,"reloading");},i.prototype._reloadTile=function(e,t){var i=this._tiles[e];i&&("loading"!==i.state&&(i.state=t),this._loadTile(i,this._tileLoaded.bind(this,i,e,t)));},i.prototype._tileLoaded=function(t,i,a,o){if(o)return t.state="errored",void(404!==o.status?this._source.fire(new e.ErrorEvent(o,{tile:t})):this.update(this.transform));t.timeAdded=e.default.now(),"expired"===a&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new e.Event("data",{dataType:"source",tile:t,coord:t.tileID})),this.map&&(this.map.painter.tileExtentVAO.vao=null);},i.prototype.getTile=function(e){return this.getTileByID(e.key)},i.prototype.getTileByID=function(e){return this._tiles[e]},i.prototype.getZoom=function(e){return e.zoom+e.scaleZoom(e.tileSize/this._source.tileSize)},i.prototype._findLoadedChildren=function(e,t,i){var a=!1;for(var o in this._tiles){var r=this._tiles[o];if(!(i[o]||!r.hasData()||r.tileID.overscaledZ<=e.overscaledZ||r.tileID.overscaledZ>t)){var n=Math.pow(2,r.tileID.canonical.z-e.canonical.z);if(Math.floor(r.tileID.canonical.x/n)===e.canonical.x&&Math.floor(r.tileID.canonical.y/n)===e.canonical.y)for(i[o]=r.tileID,a=!0;r&&r.tileID.overscaledZ-1>e.overscaledZ;){var s=r.tileID.scaledTo(r.tileID.overscaledZ-1);if(!s)break;(r=this._tiles[s.key])&&r.hasData()&&(delete i[o],i[s.key]=s);}}}return a},i.prototype.findLoadedParent=function(e,t,i){for(var a=e.overscaledZ-1;a>=t;a--){var o=e.scaledTo(a);if(!o)return;var r=String(o.key),n=this._tiles[r];if(n&&n.hasData())return i[r]=o,n;if(this._cache.has(o))return i[r]=o,this._cache.get(o)}},i.prototype.updateCacheSize=function(e){var t=(Math.ceil(e.width/this._source.tileSize)+1)*(Math.ceil(e.height/this._source.tileSize)+1),i=Math.floor(5*t),a="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,i):i;this._cache.setMaxSize(a);},i.prototype.update=function(t){var a=this;if(this.transform=t,this._sourceLoaded&&!this._paused){var o;this.updateCacheSize(t),this._coveredTiles={},this.used?this._source.tileID?o=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(t){return new e.OverscaledTileID(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)}):(o=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,isVector:-1===this._source.type.indexOf("raster"),renderWithTerrain:this._source.renderWithTerrain,noBox:!!this._source.noBox,noLowLevelCover:!!this._source.noLowLevelCover}),this._source.hasTile&&(o=o.filter(function(e){return a._source.hasTile(e)}))):o=[];var r,n=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(t)),s=Math.max(n-i.maxOverzooming,this._source.minzoom),l=Math.max(n+i.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(o,n),c={};if(pt(this._source.type))for(var _=Object.keys(u),f=0;f<_.length;f++){var m=_[f],p=u[m],h=a._tiles[m];if(h&&(void 0===h.fadeEndTime||h.fadeEndTime>=e.default.now())){a._findLoadedChildren(p,l,u)&&(u[m]=p);var d=a.findLoadedParent(p,s,c);d&&a._addTile(d.tileID);}}for(r in c)u[r]||(a._coveredTiles[r]=!0);for(r in c)u[r]=c[r];for(var g=e.keysDifference(this._tiles,u),v=0;v<g.length;v++)a._removeTile(g[v]);}},i.prototype._updateRetainedTiles=function(e,t){for(var a={},o={},r=Math.max(t-i.maxOverzooming,this._source.minzoom),n=Math.max(t+i.maxUnderzooming,this._source.minzoom),s=0;s<e.length;s++){var l=e[s],u=this._addTile(l),c=!1;if(u.hasData())a[l.key]=l;else{c=u.wasRequested(),a[l.key]=l;var _=!0;if(t+1>this._source.maxzoom){var f=l.children(this._source.maxzoom)[0],m=this.getTile(f);m&&m.hasData()?a[f.key]=f:_=!1;}else{this._findLoadedChildren(l,n,a);for(var p=l.children(this._source.maxzoom),h=0;h<p.length;h++)if(!a[p[h].key]){_=!1;break}}if(!_)for(var d=l.overscaledZ-1;d>=r;--d){var g=l.scaledTo(d);if(o[g.key])break;if(o[g.key]=!0,!(u=this.getTile(g))&&c&&(u=this._addTile(g)),u&&(a[g.key]=g,c=u.wasRequested(),u.hasData()))break}}}return a},i.prototype._addTile=function(t){var i=this._tiles[t.key];if(i)return i;(i=this._cache.getAndRemove(t))&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));var a=Boolean(i);return a||(i=new e.default$33(t,this._source.tileSize*t.overscaleFactor(),this.map.projection,"raster"===this._source.type,this.map.sphereRender),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))),i?(i.uses++,this._tiles[t.key]=i,a||this._source.fire(new e.Event("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null},i.prototype._setTileReloadTimer=function(e,t){var i=this;e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);var a=t.getExpiryTimeout();a&&(this._timers[e]=setTimeout(function(){i._reloadTile(e,"expired"),delete i._timers[e];},a));},i.prototype._removeTile=function(e){var t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))));},i.prototype.clearTiles=function(){for(var e in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(e);this._cache.reset();},i.prototype.tilesInOfSphereExtrusion=function(e,t,i){var a=this;return t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,isVector:-1===this._source.type.indexOf("raster"),renderWithTerrain:this._source.renderWithTerrain,noBox:!!this._source.noBox,noLowLevelCover:!!this._source.noLowLevelCover}).map(function(e){return a.getTile(e).getBucket(i)})},i.prototype.tilesIn=function(t,i,a){var o=this,r=[],n=this.transform;if(!n)return r;for(var s=a?n.getCameraQueryGeometry(t):t,l=t.map(function(e){return n.pointCoordinate(e)}),u=s.map(function(e){return n.pointCoordinate(e)}),c=this.getIds(),_=1/0,f=1/0,m=-1/0,p=-1/0,h=l[0].zoom,d=0,g=u;d<g.length;d+=1){var v=g[d];_=Math.min(_,v.column),f=Math.min(f,v.row),m=Math.max(m,v.column),p=Math.max(p,v.row);}for(var y=function(t){var a=o._tiles[c[t]],s=a.tileID,d=Math.pow(2,n.zoom-a.tileID.overscaledZ),g=i*a.queryPadding*e.default$12/a.tileSize/d,v=[mt(s,new e.default$27(_,f,h)),mt(s,new e.default$27(m,p,h))];if(v[0].x-g<e.default$12&&v[0].y-g<e.default$12&&v[1].x+g>=0&&v[1].y+g>=0){var y=l.map(function(t){var i=t.zoomTo(s.canonical.z);return s.getTilePoint(new e.default$1(i.column,i.row))}),x=u.map(function(t){var i=t.zoomTo(s.canonical.z);return s.getTilePoint(new e.default$1(i.column,i.row))});r.push({tile:a,tileID:s,queryGeometry:y,cameraQueryGeometry:x,scale:d});}},x=0;x<c.length;x++)y(x);return r},i.prototype.getVisibleCoordinates=function(){for(var e=this,t=this.getRenderableIds().map(function(t){return e._tiles[t].tileID}),i=0,a=t;i<a.length;i+=1){var o=a[i];o.posMatrix=e.transform.calculatePosMatrix(o.toUnwrapped());}return t},i.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(pt(this._source.type))for(var t in this._tiles){var i=this._tiles[t];if(void 0!==i.fadeEndTime&&i.fadeEndTime>=e.default.now())return!0}return!1},i.prototype.setFeatureState=function(e,t,i){e=e||"_geojsonTileLayer",this._state.updateState(e,t,i);},i.prototype.getFeatureState=function(e,t){return e=e||"_geojsonTileLayer",this._state.getState(e,t)},i}(e.Evented);function mt(t,i){var a=i.zoomTo(t.canonical.z);return new e.default$1((a.column-(t.canonical.x+t.wrap*Math.pow(2,t.canonical.z)))*e.default$12,(a.row-t.canonical.y)*e.default$12)}function pt(e){return"raster"===e||"image"===e||"video"===e}ft.maxOverzooming=10,ft.maxUnderzooming=3;var ht=function(t,i){return e.emitValidationErrors(t,i&&i.filter(function(e){return"source.canvas"!==e.identifier}))},dt=e.pick(de,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),gt=e.pick(de,["setCenter","setZoom","setBearing","setPitch"]),vt=function(t){function i(a,o){var r=this;void 0===o&&(o={}),t.call(this),this.map=a,this.dispatcher=new e.default$35((fe||(fe=new _e),fe),this),this.imageManager=new P,this.glyphManager=new O(a._transformRequest,o.localIdeographFontFamily),this.lineAtlas=new z(256,512),this.crossTileSymbolIndex=new ct,this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new e.default$36,this._loaded=!1,this.sttc=new e.default$10(this.dispatcher,1e3),this.shouldUpdateSource=!0,this._resetUpdates();var n=this;this._rtlTextPluginCallback=i.registerForPluginAvailability(function(e){for(var t in n.dispatcher.broadcast("loadRTLTextPlugin",e.pluginURL,e.completionCallback),n.sourceCaches)n.sourceCaches[t].reload();}),this.changWorkerProjection(o.projection||e.ProjectionType.MERCATOR),this.on("data",function(e){if("source"===e.dataType&&"metadata"===e.sourceDataType){var t=r.sourceCaches[e.sourceId];if(t){var i=t.getSource();if(i&&i.vectorLayerIds)for(var a in r._layers){var o=r._layers[a];o.source===i.id&&r._validateLayer(o);}}}});}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.changWorkerProjection=function(e){this.dispatcher.broadcast("setProjection",{projection:e},function(e){});},i.prototype.loadURL=function(t,i){var a=this;void 0===i&&(i={}),this.fire(new e.Event("dataloading",{dataType:"style"}));var o="boolean"==typeof i.validate?i.validate:!n(t);t=s(t,i.appKey);var r=this.map._transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(r,function(t,i){a._request=null,t?a.fire(new e.ErrorEvent(t)):i&&a._load(i,o);});},i.prototype.loadJSON=function(t,i){var a=this;void 0===i&&(i={}),this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.default.frame(function(){a._request=null,a._load(t,!1!==i.validate);});},i.prototype.markOriginalStyle=function(e){for(var t in e.sourceCaches)e.sourceCaches[t]._original_style=!0;for(var i in e._layers)e._layers[i]._original_style=!0;},i.prototype._load=function(t,i){var a=this;if(!i||!ht(this,e.validateStyle(t))){for(var o in this._loaded=!0,this.stylesheet=t,t.sources)a.addSource(o,t.sources[o],{validate:!1});t.sprite?this._spriteRequest=function(t,i,a){var o,r,n,s=e.default.devicePixelRatio>1?"@2x":"",l=e.getJSON(i(c(t,s,".json"),e.ResourceType.SpriteJSON),function(e,t){l=null,n||(n=e,o=t,_());}),u=e.getImage(i(c(t,s,".png"),e.ResourceType.SpriteImage),function(e,t){u=null,n||(n=e,r=t,_());});function _(){if(n)a(n);else if(o&&r){var t=e.default.getImageData(r),i={};for(var s in o){var l=o[s],u=l.width,c=l.height,_=l.x,f=l.y,m=l.sdf,p=l.pixelRatio,h=new e.RGBAImage({width:u,height:c});e.RGBAImage.copy(t,h,{x:_,y:f},{x:0,y:0},{width:u,height:c}),i[s]={data:h,pixelRatio:p,sdf:m};}a(null,i);}}return{cancel:function(){l&&(l.cancel(),l=null),u&&(u.cancel(),u=null);}}}(t.sprite,this.map._transformRequest,function(t,i){if(a._spriteRequest=null,t)a.fire(new e.ErrorEvent(t));else if(i)for(var o in i)a.imageManager.addImage(o,i[o]);a.imageManager.setLoaded(!0),a.fire(new e.Event("data",{dataType:"style"}));}):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);var r,n,s=he(this.stylesheet.layers);this._order=s.map(function(e){return e.id}),this._layers={};for(var l=0,u=s;l<u.length;l+=1){var _=u[l];(_=e.default$34(_)).setEventedParent(a,{layer:{id:_.id}}),a._layers[_.id]=_;}for(var f in this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.markOriginalStyle(this),this.light=new D(this.stylesheet.light),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load")),a._layers){var m=a._layers[f];"Worldwaterface"===m.source&&"Worldwaterface"===m.sourceLayer&&(n=m.getPaintProperty("fill-color")),"Worldcountries"===m.source&&"Worldcountries"===m.sourceLayer&&(r=m.getPaintProperty("fill-color"));}for(var p in a._layers){var h=a._layers[p];"sphere-background"===h.type&&(h.northVectorColor=n,h.sourthVectorColor=r);}}},i.prototype._validateLayer=function(t){var i=this.sourceCaches[t.source];if(i){var a=t.sourceLayer;if(a){var o=i.getSource();("geojson"===o.type||o.vectorLayerIds&&-1===o.vectorLayerIds.indexOf(a))&&this.fire(new e.ErrorEvent(new Error('Source layer "'+a+'" does not exist on source "'+o.id+'" as specified by style layer "'+t.id+'"')));}}},i.prototype.enableSunLight=function(){this._sunLightFlag=!0;},i.prototype.disableSunLight=function(){this._sunLightFlag=!1;},i.prototype.getSharedTerrainTileCache=function(){return this.sttc},i.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()},i.prototype._serializeLayers=function(e){for(var t=[],i=0,a=e;i<a.length;i+=1){var o=a[i],r=this._layers[o];"custom"!==r.type&&t.push(r.serialize());}return t},i.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(var t in this._layers)if(this._layers[t].hasTransition())return!0;return!1},i.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},i.prototype.update=function(t){if(this._loaded){if(this._changed){var i=Object.keys(this._updatedLayers),a=Object.keys(this._removedLayers);for(var o in(i.length||a.length)&&this._updateWorkerLayers(i,a),this._updatedSources){var r=this._updatedSources[o];"reload"===r?this._reloadSource(o):"clear"===r&&this._clearSource(o);}for(var n in this._updatedPaintProps)this._layers[n].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates(),this.fire(new e.Event("data",{dataType:"style"}));}for(var s in this.sourceCaches)this.sourceCaches[s].used=!1;for(var l=0,u=this._order;l<u.length;l+=1){var c=u[l],_=this._layers[c];_.recalculate(t),!_.isHidden(t.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0);}this.light.recalculate(t),this.z=t.zoom;}},i.prototype._updateWorkerLayers=function(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t});},i.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={};},i.prototype.setState=function(t,i){var a=this;if(this._checkLoaded(),ht(this,e.validateStyle(t)))return!1;(t=e.clone$1(t)).layers=he(t.layers);var o=Te(this.roughSerialize(),t,i).filter(function(e){return!(e.command in gt)});if(0===o.length)return!1;var r,n,s=o.filter(function(e){return!(e.command in dt)});if(s.length>0)throw new Error("Unimplemented: "+s.map(function(e){return e.command}).join(", ")+".");for(var l in o.forEach(function(e){"setTransition"!==e.command&&a[e.command].apply(a,e.args);}),this.stylesheet=t,a._layers){var u=a._layers[l];"Worldwaterface"===u.source&&"Worldwaterface"===u.sourceLayer&&(n=u.getPaintProperty("fill-color")),"Worldcountries"===u.source&&"Worldcountries"===u.sourceLayer&&(r=u.getPaintProperty("fill-color"));}for(var c in a._layers){var _=a._layers[c];"sphere-background"===_.type&&(_.northVectorColor=n,_.sourthVectorColor=r);}return!0},i.prototype.addImage=function(t,i){if(this.getImage(t))return this.fire(new e.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,i),this.fire(new e.Event("data",{dataType:"style"}));},i.prototype.getImage=function(e){return this.imageManager.getImage(e)},i.prototype.removeImage=function(t){if(!this.getImage(t))return this.fire(new e.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this.fire(new e.Event("data",{dataType:"style"}));},i.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},i.prototype.addSource=function(e,t,i){var a=this;if(this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!t.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(t).join(", ")+".");this.map&&this.map._collectResourceTiming&&(t.collectResourceTiming=!0);var o=this.sourceCaches[e]=function(e,t,i,a){return"3d-tile"===t.type?new K(e,t,i):new ft(e,t,i,a)}(e,t,this.dispatcher,this.sttc);i&&i.isOriginal&&(this.sourceCaches[e]._original_style=!0),o.style=this,o.setEventedParent(this,function(){return{isSourceLoaded:a.loaded(),source:o.serialize(),sourceId:e}}),o.onAdd(this.map),this._changed=!0;},i.prototype.removeSource=function(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");for(var i in this._layers)if(this._layers[i].source===t)return this.fire(new e.ErrorEvent(new Error('Source "'+t+'" cannot be removed while layer "'+i+'" is using it.')));var a=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],a.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.clearTiles(),a.onRemove&&a.onRemove(this.map),this._changed=!0;},i.prototype.setGeoJSONSourceData=function(e,t){this._checkLoaded(),this.sourceCaches[e].getSource().setData(t),this._changed=!0;},i.prototype.getSource=function(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()},i.prototype.addLayer=function(t,i,a){this._checkLoaded();var o=t.id;if(this.getLayer(o))this.fire(new e.ErrorEvent(new Error('Layer with id "'+o+'" already exists on this map')));else{var r;if("custom"===t.type)r=e.default$34(t);else{if("object"==typeof t.source&&(this.addSource(o,t.source),t=e.clone$1(t),t=e.extend(t,{source:o})),this._validate(e.validateStyle.layer,"layers."+o,t,{arrayIndex:-1},a))return;r=e.default$34(t),this._validateLayer(r),r.setEventedParent(this,{layer:{id:o}});}var n=i?this._order.indexOf(i):this._order.length;if(i&&-1===n)this.fire(new e.ErrorEvent(new Error('Layer with id "'+i+'" does not exist on this map.')));else{if(this._order.splice(n,0,o),this._layerOrderChanged=!0,this._layers[o]=r,a&&a.isOriginal&&(this._layers[o]._original_style=!0),this._removedLayers[o]&&r.source&&"custom"!==r.type){var s=this._removedLayers[o];delete this._removedLayers[o],s.type!==r.type?this._updatedSources[r.source]="clear":(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause());}this._updateLayer(r),r.onAdd&&r.onAdd(this.map);}}},i.prototype.moveLayer=function(t,i){if(this._checkLoaded(),this._changed=!0,this._layers[t]){if(t!==i){var a=this._order.indexOf(t);this._order.splice(a,1);var o=i?this._order.indexOf(i):this._order.length;i&&-1===o?this.fire(new e.ErrorEvent(new Error('Layer with id "'+i+'" does not exist on this map.'))):(this._order.splice(o,0,t),this._layerOrderChanged=!0);}}else this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be moved.")));},i.prototype.removeLayer=function(t){this._checkLoaded();var i=this._layers[t];if(i){i.setEventedParent(null);var a=this._order.indexOf(t);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=i,delete this._layers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],i.onRemove&&i.onRemove(this.map);}else this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be removed.")));},i.prototype.getLayer=function(e){return this._layers[e]},i.prototype.setLayerZoomRange=function(t,i,a){this._checkLoaded();var o=this.getLayer(t);o?o.minzoom===i&&o.maxzoom===a||(null!=i&&(o.minzoom=i),null!=a&&(o.maxzoom=a),this._updateLayer(o)):this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot have zoom extent.")));},i.prototype.setSourceFilter=function(e,t){var i=this.getSource(e);i&&(i.setFilter(t),this._reloadSource(e));},i.prototype.setFilter=function(t,i){this._checkLoaded();var a=this.getLayer(t);if(a){if(!e.default$30(a.filter,i))return null===i||void 0===i?(a.filter=void 0,void this._updateLayer(a)):void(this._validate(e.validateStyle.filter,"layers."+a.id+".filter",i)||(a.filter=e.clone$1(i),this._updateLayer(a)))}else this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be filtered.")));},i.prototype.getFilter=function(t){return e.clone$1(this.getLayer(t).filter)},i.prototype.setLayoutProperty=function(t,i,a){this._checkLoaded();var o=this.getLayer(t);o?e.default$30(o.getLayoutProperty(i),a)||(o.setLayoutProperty(i,a),this._updateLayer(o)):this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")));},i.prototype.getLayoutProperty=function(e,t){return this.getLayer(e).getLayoutProperty(t)},i.prototype.setPaintProperty=function(t,i,a){this._checkLoaded();var o=this.getLayer(t);o?e.default$30(o.getPaintProperty(i),a)||(o.setPaintProperty(i,a)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new e.ErrorEvent(new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")));},i.prototype.getPaintProperty=function(e,t){return this.getLayer(e).getPaintProperty(t)},i.prototype.setFeatureState=function(t,i){this._checkLoaded();var a=t.source,o=t.sourceLayer,r=this.sourceCaches[a];void 0!==r?"vector"!==r.getSource().type||o?r.setFeatureState(o,t.id,i):this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types."))):this.fire(new e.ErrorEvent(new Error("The source '"+a+"' does not exist in the map's style.")));},i.prototype.getFeatureState=function(t){this._checkLoaded();var i=t.source,a=t.sourceLayer,o=this.sourceCaches[i];if(void 0!==o){if("vector"!==o.getSource().type||a)return o.getFeatureState(a,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));}else this.fire(new e.ErrorEvent(new Error("The source '"+i+"' does not exist in the map's style.")));},i.prototype.getTransition=function(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},i.prototype.serialize=function(){return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:e.mapObject(this.sourceCaches,function(e){return e.serialize()}),layers:this._serializeLayers(this._order)},function(e){return void 0!==e})},i.prototype.roughSerialize=function(){return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:this.sourceCaches,layers:this._serializeLayers(this._order)},function(e){return void 0!==e})},i.prototype._updateLayer=function(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._changed=!0;},i.prototype._flattenRenderedFeatures=function(e){for(var t=[],i=[],a=this._order.length-1;a>=0;a--)for(var o=this._order[a],r=0,n=e;r<n.length;r+=1){var s=n[r][o];if(s)if("extrusion"===this._layers[o].type||"histogram"===this._layers[o].type||"3d-tile"===this._layers[o].type||"3d-model"===this._layers[o].type)for(var l=0,u=s;l<u.length;l+=1){var c=u[l];i.push(c);}else for(var _=0,f=s;_<f.length;_+=1){var m=f[_];t.push(m);}}i.sort(function(e,t){return e.intersectionZ-t.intersectionZ});for(var p=0,h=i;p<h.length;p+=1){var d=h[p];t.push(d);}return t},i.prototype.queryRenderedFeatures=function(t,i,a){i&&i.filter&&this._validate(e.validateStyle.filter,"queryRenderedFeatures.filter",i.filter);var o={};if(i&&i.layers){if(!Array.isArray(i.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var r=0,n=i.layers;r<n.length;r+=1){var s=n[r],l=this._layers[s];if(!l)return this.fire(new e.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];o[l.source]=!0;}}var u=[];if(this.map.sphereRender){for(var c in this.ray=this.map.painter.getPickRay(t[0]),this.fire(new e.Event("data",{})),this.sourceCaches)if(!i.layers||o[c]){var _=this.sourceCaches[c].getSource().type;if("3d-tile"===_){var f=se(this.sourceCaches[c],this._layers,t,i,a,this.ray,!!i.modelHighlight);f&&u.push(f);}else if("3d-model"===_){var m=ne(this.sourceCaches[c],this._layers,t,i,a,this.ray,!!i.modelHighlight);m&&u.push(m);}else u.push(re(this.sourceCaches[c],this._layers,t,i,a,this.ray)),i.modelHighlight||(u.push(oe(this.sourceCaches[c],this._layers,t,i,a)),this.placement&&u.push(le(this._layers,this.sourceCaches,t,i,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.sphereRender,a,this.ray)));}}else{for(var p in this.sourceCaches)i.layers&&!o[p]||u.push(oe(this.sourceCaches[p],this._layers,t,i,a));this.placement&&u.push(le(this._layers,this.sourceCaches,t,i,this.placement.collisionIndex,this.placement.retainedQueryData));}return this._flattenRenderedFeatures(u)},i.prototype.querySourceFeatures=function(t,i){i&&i.filter&&this._validate(e.validateStyle.filter,"querySourceFeatures.filter",i.filter);var a=this.sourceCaches[t];return a?function(e,t){for(var i=e.getRenderableIds().map(function(t){return e.getTileByID(t)}),a=[],o={},r=0;r<i.length;r++){var n=i[r],s=n.tileID.canonical.key;o[s]||(o[s]=!0,n.querySourceFeatures(a,t));}return a}(a,i):[]},i.prototype.querySpherePosition=function(e,t){return this.ray=this.map.painter.getPickRay(e.point),this.sttc.queryTileIntersectPoint(this.map.transform,t,e,this.ray)},i.prototype.addSourceType=function(e,t,a){return i.getSourceType(e)?a(new Error('A source type called "'+e+'" already exists.')):(i.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},a):a(null,null))},i.prototype.getTerrainAltitude=function(){if(!this.map.sphereRender)return!1;for(var t in this.sourceCaches){var i=this.sourceCaches[t]._source;if(i instanceof $&&i.renderWithTerrain&&i.terrainTiles&&i.terrainTiles.length>0)return this.sttc.queryOneTileIntersectPoint(this.map.transform)}return e.default$11.TRANSFORM.ERR_TERRAIN_ALT},i.prototype.getLight=function(){return this.light.getLight()},i.prototype.setLight=function(t){this._checkLoaded();var i=this.light.getLight(),a=!1;for(var o in t)if(!e.default$30(t[o],i[o])){a=!0;break}if(a){var r={now:e.default.now(),transition:e.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t),this.light.updateTransitions(r);}},i.prototype._validate=function(t,i,a,o,r){return(!r||!1!==r.validate)&&ht(this,t.call(e.validateStyle,e.extend({key:i,style:this.serialize(),value:a,styleSpec:e.default$7},o)))},i.prototype._remove=function(){for(var t in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginAvailable",this._rtlTextPluginCallback),this.sourceCaches)this.sourceCaches[t].clearTiles();this.dispatcher.remove();},i.prototype._clearSource=function(e){this.sourceCaches[e].clearTiles();},i.prototype._reloadSource=function(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload();},i.prototype._updateSources=function(e){for(var t in this.sourceCaches)(this.map.sphereRender&&this.sourceCaches[t]._source.isEarthSource()||!this.map.sphereRender&&(!this.sourceCaches[t]._source.isEarthSource()||"all"===this.sourceCaches[t]._source.tileUsage))&&(this.shouldUpdateSource||Math.round(e.zoom)%2==0)&&(this.map.panoramaMode||this.sourceCaches[t].update(e));},i.prototype._generateCollisionBoxes=function(){for(var e in this.sourceCaches)this._reloadSource(e);},i.prototype._updatePlacement=function(t,i,a,o){for(var r=!1,n=!1,s={},l=0,u=this._order;l<u.length;l+=1){var c=u[l],_=this._layers[c];if("symbol"===_.type||"symtracking"===_.type||"sphere-symbol"===_.type){if(!s[_.source]){var f=this.sourceCaches[_.source];s[_.source]=f.getRenderableIds().map(function(e){return f.getTileByID(e)}).sort(function(e,t){return("string"!=typeof e.tileID&&"string"!=typeof t.tileID?t.tileID.overscaledZ-e.tileID.overscaledZ:0)||("string"!=typeof e.tileID&&"string"!=typeof t.tileID&&e.tileID.isLessThan(t.tileID)?-1:1)});}var m=this.crossTileSymbolIndex.addLayer(_,s[_.source],t.center.lng);r=r||m;}}this.crossTileSymbolIndex.pruneUnusedLayers(this._order);var p=this._layerOrderChanged;if((p||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.default.now()))&&(this.pauseablePlacement=new rt(t,this._order,p,i,a,o),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,s),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(this.placement,e.default.now()),n=!0),r&&this.pauseablePlacement.placement.setStale()),n||r)for(var h=0,d=this._order;h<d.length;h+=1){var g=d[h],v=this._layers[g];"symbol"!==v.type&&"symtracking"!==v.type&&"sphere-symbol"!==v.type||this.placement.updateLayerOpacities(v,s[v.source]);}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.default.now())},i.prototype.getImages=function(e,t,i){this.imageManager.getImages(t.icons,i);},i.prototype.getGlyphs=function(e,t,i){this.glyphManager.getGlyphs(t.stacks,i);},i}(e.Evented);vt.getSourceType=function(e){return te[e]},vt.setSourceType=function(e,t){te[e]=t;},vt.registerForPluginAvailability=e.registerForPluginAvailability;var yt=e.createLayout([{name:"a_pos",type:"Int16",components:2}]);function xt(e){return e}var bt={prelude:{fragmentSource:xt("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\n#define VIEWSHED_COUNT 1\n#define RADIATION_REGIONS_COUNT 5\nfloat czm_unpackDepth(vec4 packedDepth){return dot(packedDepth,vec4(1.0,1.0/255.0,1.0/65025.0,1.0/16581375.0));}\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX 8.0\n#endif\nvec4 fxaa(sampler2D tex,vec2 fragCoord,vec2 resolution,vec2 v_rgbNW,vec2 v_rgbNE,vec2 v_rgbSW,vec2 v_rgbSE,vec2 v_rgbM){vec4 color;mediump vec2 inverseVP=vec2(1.0/resolution.x,1.0/resolution.y);vec3 rgbNW=texture2D(tex,v_rgbNW).xyz;vec3 rgbNE=texture2D(tex,v_rgbNE).xyz;vec3 rgbSW=texture2D(tex,v_rgbSW).xyz;vec3 rgbSE=texture2D(tex,v_rgbSE).xyz;vec4 texColor=texture2D(tex,v_rgbM);vec3 rgbM=texColor.xyz;vec3 luma=vec3(0.299,0.587,0.114);float lumaNW=dot(rgbNW,luma);float lumaNE=dot(rgbNE,luma);float lumaSW=dot(rgbSW,luma);float lumaSE=dot(rgbSE,luma);float lumaM=dot(rgbM,luma);float lumaMin=min(lumaM,min(min(lumaNW,lumaNE),min(lumaSW,lumaSE)));float lumaMax=max(lumaM,max(max(lumaNW,lumaNE),max(lumaSW,lumaSE)));mediump vec2 dir;dir.x=-((lumaNW+lumaNE)-(lumaSW+lumaSE));dir.y=((lumaNW+lumaSW)-(lumaNE+lumaSE));float dirReduce=max((lumaNW+lumaNE+lumaSW+lumaSE)*(0.25*FXAA_REDUCE_MUL),FXAA_REDUCE_MIN);float rcpDirMin=1.0/(min(abs(dir.x),abs(dir.y))+dirReduce);dir=min(vec2(FXAA_SPAN_MAX,FXAA_SPAN_MAX),max(vec2(-FXAA_SPAN_MAX,-FXAA_SPAN_MAX),dir*rcpDirMin))*inverseVP;vec3 rgbA=0.5*(texture2D(tex,fragCoord*inverseVP+dir*(1.0/3.0-0.5)).xyz+texture2D(tex,fragCoord*inverseVP+dir*(2.0/3.0-0.5)).xyz);vec3 rgbB=rgbA*0.5+0.25*(texture2D(tex,fragCoord*inverseVP+dir*-0.5).xyz+texture2D(tex,fragCoord*inverseVP+dir*0.5).xyz);float lumaB=dot(rgbB,luma);if((lumaB<lumaMin)||(lumaB>lumaMax)){color=vec4(rgbA,texColor.a);}else{color=vec4(rgbB,texColor.a);}return color;}void texcoords(vec2 fragCoord,vec2 resolution,out vec2 v_rgbNW,out vec2 v_rgbNE,out vec2 v_rgbSW,out vec2 v_rgbSE,out vec2 v_rgbM){vec2 inverseVP=1.0/resolution.xy;v_rgbNW=(fragCoord+vec2(-1.0,-1.0))*inverseVP;v_rgbNE=(fragCoord+vec2(1.0,-1.0))*inverseVP;v_rgbSW=(fragCoord+vec2(-1.0,1.0))*inverseVP;v_rgbSE=(fragCoord+vec2(1.0,1.0))*inverseVP;v_rgbM=vec2(fragCoord*inverseVP);}vec4 encodeFloat(float depth){vec4 enc=vec4(1.0,255.0,65025.0,16581375.0)*depth;enc=fract(enc);enc-=enc.yzww*vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);return enc;}float decodeFloat(vec4 color){return dot(color,vec4(1.0,1./255.0,1./65025.0,1./16581375.0));}float AMBIENT_STRENGTH=0.6;vec3 L_AMBBIENT=vec3(0.19225);vec3 L_DIFFUSE=vec3(0.50754);vec3 L_SPECULAR=vec3(0.508273);float L_SHINESS=0.4;vec3 ProcessNormalLight(vec3 ilight,vec4 t_color,vec3 cam_pos,vec3 frag_pos,vec3 inormal){vec3 ambient=L_AMBBIENT*t_color.rgb;vec3 normal=normalize(inormal);vec3 light=normalize(ilight);float nDotL=max(dot(light,normal),0.0);vec3 diffuse=L_DIFFUSE*t_color.rgb*nDotL;return(ambient+diffuse);}/***@license*Copyright(c)2014-2015,NVIDIA CORPORATION. All rights reserved.**Redistribution and use in source and binary forms,with or without*modification,are permitted provided that the following conditions*are met:**Redistributions of source code must retain the above copyright*notice,this list of conditions and the following disclaimer.**Redistributions in binary form must reproduce the above copyright*notice,this list of conditions and the following disclaimer in the*documentation and/or other materials provided with the distribution.**Neither the name of NVIDIA CORPORATION nor the names of its*contributors may be used to endorse or promote products derived*from this software without specific prior written permission.**THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY*EXPRESS OR IMPLIED WARRANTIES,INCLUDING,BUT NOT LIMITED TO,THE*IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR*PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR*CONTRIBUTORS BE LIABLE FOR ANY DIRECT,INDIRECT,INCIDENTAL,SPECIAL,*EXEMPLARY,OR CONSEQUENTIAL DAMAGES(INCLUDING,BUT NOT LIMITED TO,*PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;LOSS OF USE,DATA,OR*PROFITS;OR BUSINESS INTERRUPTION)HOWEVER CAUSED AND ON ANY THEORY*OF LIABILITY,WHETHER IN CONTRACT,STRICT LIABILITY,OR TORT*(INCLUDING NEGLIGENCE OR OTHERWISE)ARISING IN ANY WAY OUT OF THE USE*OF THIS SOFTWARE,EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.*/\n#if (FXAA_QUALITY_PRESET == 10)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 3.0\n#define FXAA_QUALITY_P2 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 11)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 3.0\n#define FXAA_QUALITY_P3 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 12)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 4.0\n#define FXAA_QUALITY_P4 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 13)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 4.0\n#define FXAA_QUALITY_P5 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 14)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 4.0\n#define FXAA_QUALITY_P6 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 15)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 12.0\n#endif\n#if (FXAA_QUALITY_PRESET == 20)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 2.0\n#define FXAA_QUALITY_P2 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 21)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 22)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 23)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 24)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 3.0\n#define FXAA_QUALITY_P6 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 25)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 26)\n#define FXAA_QUALITY_PS 9\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 4.0\n#define FXAA_QUALITY_P8 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 27)\n#define FXAA_QUALITY_PS 10\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 4.0\n#define FXAA_QUALITY_P9 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 28)\n#define FXAA_QUALITY_PS 11\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 4.0\n#define FXAA_QUALITY_P10 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 29)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#if (FXAA_QUALITY_PRESET == 39)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.0\n#define FXAA_QUALITY_P2 1.0\n#define FXAA_QUALITY_P3 1.0\n#define FXAA_QUALITY_P4 1.0\n#define FXAA_QUALITY_P5 1.5\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#define FxaaBool bool\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 vec2\n#define FxaaTex sampler2D\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTexTop(t, p) texture2D(t, p)\n#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\nFxaaFloat FxaaLuma(FxaaFloat4 rgba){return rgba.y;}FxaaFloat4 FxaaPixelShader(FxaaFloat2 pos,FxaaTex tex,FxaaFloat2 fxaaQualityRcpFrame,FxaaFloat fxaaQualitySubpix,FxaaFloat fxaaQualityEdgeThreshold,FxaaFloat fxaaQualityEdgeThresholdMin){FxaaFloat2 posM;posM.x=pos.x;posM.y=pos.y;FxaaFloat4 rgbyM=FxaaTexTop(tex,posM);\n#define lumaM rgbyM.y\nFxaaFloat lumaS=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(0,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,0),fxaaQualityRcpFrame.xy));FxaaFloat lumaN=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(0,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,0),fxaaQualityRcpFrame.xy));FxaaFloat maxSM=max(lumaS,lumaM);FxaaFloat minSM=min(lumaS,lumaM);FxaaFloat maxESM=max(lumaE,maxSM);FxaaFloat minESM=min(lumaE,minSM);FxaaFloat maxWN=max(lumaN,lumaW);FxaaFloat minWN=min(lumaN,lumaW);FxaaFloat rangeMax=max(maxWN,maxESM);FxaaFloat rangeMin=min(minWN,minESM);FxaaFloat rangeMaxScaled=rangeMax*fxaaQualityEdgeThreshold;FxaaFloat range=rangeMax-rangeMin;FxaaFloat rangeMaxClamped=max(fxaaQualityEdgeThresholdMin,rangeMaxScaled);FxaaBool earlyExit=range<rangeMaxClamped;if(earlyExit)return rgbyM;FxaaFloat lumaNW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaSE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaNE=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(1,-1),fxaaQualityRcpFrame.xy));FxaaFloat lumaSW=FxaaLuma(FxaaTexOff(tex,posM,FxaaInt2(-1,1),fxaaQualityRcpFrame.xy));FxaaFloat lumaNS=lumaN+lumaS;FxaaFloat lumaWE=lumaW+lumaE;FxaaFloat subpixRcpRange=1.0/range;FxaaFloat subpixNSWE=lumaNS+lumaWE;FxaaFloat edgeHorz1=(-2.0*lumaM)+lumaNS;FxaaFloat edgeVert1=(-2.0*lumaM)+lumaWE;FxaaFloat lumaNESE=lumaNE+lumaSE;FxaaFloat lumaNWNE=lumaNW+lumaNE;FxaaFloat edgeHorz2=(-2.0*lumaE)+lumaNESE;FxaaFloat edgeVert2=(-2.0*lumaN)+lumaNWNE;FxaaFloat lumaNWSW=lumaNW+lumaSW;FxaaFloat lumaSWSE=lumaSW+lumaSE;FxaaFloat edgeHorz4=(abs(edgeHorz1)*2.0)+abs(edgeHorz2);FxaaFloat edgeVert4=(abs(edgeVert1)*2.0)+abs(edgeVert2);FxaaFloat edgeHorz3=(-2.0*lumaW)+lumaNWSW;FxaaFloat edgeVert3=(-2.0*lumaS)+lumaSWSE;FxaaFloat edgeHorz=abs(edgeHorz3)+edgeHorz4;FxaaFloat edgeVert=abs(edgeVert3)+edgeVert4;FxaaFloat subpixNWSWNESE=lumaNWSW+lumaNESE;FxaaFloat lengthSign=fxaaQualityRcpFrame.x;FxaaBool horzSpan=edgeHorz>=edgeVert;FxaaFloat subpixA=subpixNSWE*2.0+subpixNWSWNESE;if(!horzSpan)lumaN=lumaW;if(!horzSpan)lumaS=lumaE;if(horzSpan)lengthSign=fxaaQualityRcpFrame.y;FxaaFloat subpixB=(subpixA*(1.0/12.0))-lumaM;FxaaFloat gradientN=lumaN-lumaM;FxaaFloat gradientS=lumaS-lumaM;FxaaFloat lumaNN=lumaN+lumaM;FxaaFloat lumaSS=lumaS+lumaM;FxaaBool pairN=abs(gradientN)>=abs(gradientS);FxaaFloat gradient=max(abs(gradientN),abs(gradientS));if(pairN)lengthSign=-lengthSign;FxaaFloat subpixC=FxaaSat(abs(subpixB)*subpixRcpRange);FxaaFloat2 posB;posB.x=posM.x;posB.y=posM.y;FxaaFloat2 offNP;offNP.x=(!horzSpan)? 0.0 : fxaaQualityRcpFrame.x;offNP.y=(horzSpan)? 0.0 : fxaaQualityRcpFrame.y;if(!horzSpan)posB.x+=lengthSign*0.5;if(horzSpan)posB.y+=lengthSign*0.5;FxaaFloat2 posN;posN.x=posB.x-offNP.x*FXAA_QUALITY_P0;posN.y=posB.y-offNP.y*FXAA_QUALITY_P0;FxaaFloat2 posP;posP.x=posB.x+offNP.x*FXAA_QUALITY_P0;posP.y=posB.y+offNP.y*FXAA_QUALITY_P0;FxaaFloat subpixD=((-2.0)*subpixC)+3.0;FxaaFloat lumaEndN=FxaaLuma(FxaaTexTop(tex,posN));FxaaFloat subpixE=subpixC*subpixC;FxaaFloat lumaEndP=FxaaLuma(FxaaTexTop(tex,posP));if(!pairN)lumaNN=lumaSS;FxaaFloat gradientScaled=gradient*1.0/4.0;FxaaFloat lumaMM=lumaM-lumaNN*0.5;FxaaFloat subpixF=subpixD*subpixE;FxaaBool lumaMLTZero=lumaMM<0.0;lumaEndN-=lumaNN*0.5;lumaEndP-=lumaNN*0.5;FxaaBool doneN=abs(lumaEndN)>=gradientScaled;FxaaBool doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P1;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P1;FxaaBool doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P1;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P1;if(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P2;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P2;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P2;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P2;\n#if (FXAA_QUALITY_PS > 3)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P3;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P3;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P3;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P3;\n#if (FXAA_QUALITY_PS > 4)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P4;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P4;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P4;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P4;\n#if (FXAA_QUALITY_PS > 5)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P5;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P5;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P5;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P5;\n#if (FXAA_QUALITY_PS > 6)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P6;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P6;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P6;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P6;\n#if (FXAA_QUALITY_PS > 7)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P7;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P7;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P7;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P7;\n#if (FXAA_QUALITY_PS > 8)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P8;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P8;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P8;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P8;\n#if (FXAA_QUALITY_PS > 9)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P9;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P9;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P9;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P9;\n#if (FXAA_QUALITY_PS > 10)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P10;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P10;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P10;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P10;\n#if (FXAA_QUALITY_PS > 11)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P11;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P11;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P11;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P11;\n#if (FXAA_QUALITY_PS > 12)\nif(doneNP){if(!doneN)lumaEndN=FxaaLuma(FxaaTexTop(tex,posN.xy));if(!doneP)lumaEndP=FxaaLuma(FxaaTexTop(tex,posP.xy));if(!doneN)lumaEndN=lumaEndN-lumaNN*0.5;if(!doneP)lumaEndP=lumaEndP-lumaNN*0.5;doneN=abs(lumaEndN)>=gradientScaled;doneP=abs(lumaEndP)>=gradientScaled;if(!doneN)posN.x-=offNP.x*FXAA_QUALITY_P12;if(!doneN)posN.y-=offNP.y*FXAA_QUALITY_P12;doneNP=(!doneN)||(!doneP);if(!doneP)posP.x+=offNP.x*FXAA_QUALITY_P12;if(!doneP)posP.y+=offNP.y*FXAA_QUALITY_P12;}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}FxaaFloat dstN=posM.x-posN.x;FxaaFloat dstP=posP.x-posM.x;if(!horzSpan)dstN=posM.y-posN.y;if(!horzSpan)dstP=posP.y-posM.y;FxaaBool goodSpanN=(lumaEndN<0.0)!=lumaMLTZero;FxaaFloat spanLength=(dstP+dstN);FxaaBool goodSpanP=(lumaEndP<0.0)!=lumaMLTZero;FxaaFloat spanLengthRcp=1.0/spanLength;FxaaBool directionN=dstN<dstP;FxaaFloat dst=min(dstN,dstP);FxaaBool goodSpan=directionN ? goodSpanN : goodSpanP;FxaaFloat subpixG=subpixF*subpixF;FxaaFloat pixelOffset=(dst*(-spanLengthRcp))+0.5;FxaaFloat subpixH=subpixG*fxaaQualitySubpix;FxaaFloat pixelOffsetGood=goodSpan ? pixelOffset : 0.0;FxaaFloat pixelOffsetSubpix=max(pixelOffsetGood,subpixH);if(!horzSpan)posM.x+=pixelOffsetSubpix*lengthSign;if(horzSpan)posM.y+=pixelOffsetSubpix*lengthSign;return FxaaFloat4(FxaaTexTop(tex,posM).xyz,lumaM);}"),vertexSource:xt("#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue){int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity){int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor){return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0);}float unpack_mix_vec2(const vec2 packedValue,const float t){return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_vec4(const vec4 packedColors,const float t){vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos){vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return(tile_units_to_pixels*pos+offset)/pattern_size;}vec3 get_interp_color(const vec3 in_color,const vec3 out_color,const float percent){return mix(in_color,out_color,percent)/255.0;}void texcoords(vec2 fragCoord,vec2 resolution,out vec2 v_rgbNW,out vec2 v_rgbNE,out vec2 v_rgbSW,out vec2 v_rgbSE,out vec2 v_rgbM){vec2 inverseVP=1.0/resolution.xy;v_rgbNW=(fragCoord+vec2(-1.0,-1.0))*inverseVP;v_rgbNE=(fragCoord+vec2(1.0,-1.0))*inverseVP;v_rgbSW=(fragCoord+vec2(-1.0,1.0))*inverseVP;v_rgbSE=(fragCoord+vec2(1.0,1.0))*inverseVP;v_rgbM=vec2(fragCoord*inverseVP);}\n#define VIEWSHED_COUNT 1\n#define RADIATION_REGIONS_COUNT 5\nbool isBackOfEarth(vec3 spacePos,vec3 camPos,float tangentAngle){float val=dot(normalize(spacePos),normalize(camPos));float angle=acos(val);return angle>tangentAngle;}\n#define DISCARD_VARYING_NUMBER 100.0\nfloat atan2(float dx,float dy){float ax=abs(dx),ay=abs(dy);float a=min(ax,ay)/(max(ax,ay)+0.00000001);float s=a*a;float r=((-0.0464964749*s+0.15931422)*s-0.327622764)*s*a+a;if(ay>ax)r=1.57079637-r;if(dx<0.)r=3.14159274-r;if(dy<0.)r=-r;return r;}")},background:{fragmentSource:xt("uniform vec4 u_color;uniform float u_opacity;void main(){gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("attribute vec2 a_pos;uniform mat4 u_matrix;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);}")},backgroundPattern:{fragmentSource:xt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main(){vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}")},sphereBackground:{fragmentSource:xt("uniform vec4 u_color;uniform float u_opacity;void main(){gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;attribute vec3 a_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1.);}")},sphereBackgroundPattern:{fragmentSource:xt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;void main(){vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec3 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;attribute vec2 a_texture_pos;varying vec2 v_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1.0);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_texture_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_texture_pos);}")},circle:{fragmentSource:xt("#pragma minemap: define highp vec4 color\n#pragma minemap: define mediump float radius\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 stroke_color\n#pragma minemap: define mediump float stroke_width\n#pragma minemap: define lowp float stroke_opacity\nvarying vec3 v_data;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize mediump float radius\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize highp vec4 stroke_color\n#pragma minemap: initialize mediump float stroke_width\n#pragma minemap: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width<0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define mediump float radius\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 stroke_color\n#pragma minemap: define mediump float stroke_width\n#pragma minemap: define lowp float stroke_opacity\nvarying vec3 v_data;void main(void){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize mediump float radius\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize highp vec4 stroke_color\n#pragma minemap: initialize mediump float stroke_width\n#pragma minemap: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if(u_pitch_with_map){vec2 corner_position=circle_center;if(u_scale_with_map){corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;}else{vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);}else{gl_Position=u_matrix*vec4(circle_center,0,1);if(u_scale_with_map){gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;}else{gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/DEVICE_PIXEL_RATIO/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}")},clippingMask:{fragmentSource:xt("void main(){gl_FragColor=vec4(1.0);}"),vertexSource:xt("attribute vec2 a_pos;uniform mat4 u_matrix;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);}")},heatmap:{fragmentSource:xt("#pragma minemap: define highp float weight\nuniform highp float u_intensity;varying vec2 v_extrude;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(){\n#pragma minemap: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("#pragma minemap: define highp float weight\n#pragma minemap: define mediump float radius\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;const highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void){\n#pragma minemap: initialize highp float weight\n#pragma minemap: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}")},heatmapTexture:{fragmentSource:xt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main(){float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}")},collisionBox:{fragmentSource:xt("varying float v_placed;varying float v_notUsed;void main(){float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if(v_placed>0.5){gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if(v_notUsed>0.5){gl_FragColor*=.1;}}"),vertexSource:xt("attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main(){vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=a_extrude*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}")},collisionCircle:{fragmentSource:xt("uniform float u_overscale_factor;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main(){float alpha=0.5;vec4 color=vec4(1.0,0.0,0.0,1.0)*alpha;if(v_placed>0.5){color=vec4(0.0,0.0,1.0,0.5)*alpha;}if(v_notUsed>0.5){color*=.2;}float extrude_scale_length=length(v_extrude_scale);float extrude_length=length(v_extrude)*extrude_scale_length;float stroke_width=15.0*extrude_scale_length/u_overscale_factor;float radius=v_radius*extrude_scale_length;float distance_to_edge=abs(extrude_length-radius);float opacity_t=smoothstep(-stroke_width,0.0,-distance_to_edge);gl_FragColor=opacity_t*color;}"),vertexSource:xt("attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main(){vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);highp float padding_factor=1.2;gl_Position.xy+=a_extrude*u_extrude_scale*padding_factor*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;v_radius=abs(a_extrude.y);v_extrude=a_extrude*padding_factor;v_extrude_scale=u_extrude_scale*u_camera_to_center_distance*collision_perspective_ratio;}")},debug:{fragmentSource:xt("uniform highp vec4 u_color;void main(){gl_FragColor=u_color;}"),vertexSource:xt("attribute vec2 a_pos;uniform mat4 u_matrix;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);}")},fill:{fragmentSource:xt("#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}")},fillOutline:{fragmentSource:xt("#pragma minemap: define highp vec4 outline_color\n#pragma minemap: define lowp float opacity\nvarying vec2 v_pos;void main(){\n#pragma minemap: initialize highp vec4 outline_color\n#pragma minemap: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma minemap: define highp vec4 outline_color\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize highp vec4 outline_color\n#pragma minemap: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}")},fillOutlinePattern:{fragmentSource:xt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float opacity\nvec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_mix)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}")},fillPattern:{fragmentSource:xt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float opacity\nvec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;uniform float u_zoom_factor;attribute vec3 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos.xy,a_pos.z/10.0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos.xy)*u_zoom_factor;v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos.xy)*u_zoom_factor;}")},fillExtrusion:{fragmentSource:xt("varying vec4 v_color;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\ngl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec3 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos.xy,t>0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if(normal.y!=0.0){directional*=clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0);}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);}")},fillExtrusionPattern:{fragmentSource:xt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;varying float v_is_top;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\nvec2 imagecoord_b=mod(v_pos_b,1.0);if(v_is_top>=100.0){imagecoord_b=vec2(0.0,0.0);}vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);if(v_is_top>=100.0){gl_FragColor=vec4(color2.rgb,1.)*v_lighting;}else{gl_FragColor=color2*v_lighting;}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;uniform float u_height_factor;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;varying float v_directional;varying float v_is_top;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\nvec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t>0.0 ? height : base;v_is_top=t>0.0 ? 100.0 :-100.0;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0&&normal.y==0.0&&normal.z==16384.0? a_pos: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if(normal.y!=0.0){directional*=clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0);}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));}")},extrusionTexture:{fragmentSource:xt("uniform sampler2D u_image;uniform float u_opacity;varying vec2 v_pos;void main(){gl_FragColor=texture2D(u_image,v_pos)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}")},line:{fragmentSource:xt("#ifdef MINEMAP_EXT_DEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 bordercolor\n#pragma minemap: define mediump float borderwidth\n#pragma minemap: define lowp float borderopacity\nuniform mediump float u_hasBorder;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize highp vec4 bordercolor\n#pragma minemap: initialize mediump float borderwidth\n#pragma minemap: initialize lowp float borderopacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef MINEMAP_EXT_DEPTH\ngl_FragDepthEXT=gl_FragCoord.z;\n#endif\nif(u_hasBorder!=1.0){gl_FragColor=color*(alpha*opacity);}else{gl_FragColor=bordercolor*(alpha*borderopacity);\n#ifdef MINEMAP_EXT_DEPTH\ngl_FragDepthEXT=clamp(gl_FragCoord.z+0.001,0.,1.);\n#endif\n}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;uniform lowp float u_half_render;uniform lowp float normaldirection;uniform mediump float u_hasBorder;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n#pragma minemap: define highp vec4 bordercolor\n#pragma minemap: define mediump float borderwidth\n#pragma minemap: define lowp float borderopacity\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize highp vec4 bordercolor\n#pragma minemap: initialize mediump float borderwidth\n#pragma minemap: initialize lowp float borderopacity\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_hasBorder==1.0)?(borderwidth*2.0+width)/2.0 : width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;if(u_half_render==1.){if(normaldirection==1.){outset=gapwidth+(normal.y>0.?halfwidth:0.)*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;}else{outset=gapwidth+(normal.y<0.?halfwidth:0.)*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;}}mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},lineGradient:{fragmentSource:xt("\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\nuniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp float v_lineprogress;void main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,vec2(v_lineprogress,0.5));gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("\n#define MAX_LINE_DISTANCE 32767.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\nvoid main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_lineprogress=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0/MAX_LINE_DISTANCE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},linePattern:{fragmentSource:xt("uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/u_pattern_size_a.x,1.0);float x_b=mod(v_linesofar/u_pattern_size_b.x,1.0);float y_a=0.5+(v_normal.y*clamp(v_width2.s,0.0,(u_pattern_size_a.y+2.0)/2.0)/u_pattern_size_a.y);float y_b=0.5+(v_normal.y*clamp(v_width2.s,0.0,(u_pattern_size_b.y+2.0)/2.0)/u_pattern_size_b.y);vec2 pos_a=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,vec2(x_a,y_a));vec2 pos_b=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,vec2(x_b,y_b));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define mediump float width\nvoid main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);}")},lineSDF:{fragmentSource:xt("uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float width\n#pragma minemap: define lowp float floorwidth\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\nattribute vec4 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n#pragma minemap: define lowp float floorwidth\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize lowp float floorwidth\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}")},raster:{fragmentSource:xt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main(){vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if(color0.a>0.0){color0.rgb=color0.rgb/color0.a;}if(color1.a>0.0){color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main(){gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale)+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}")},symbolIcon:{fragmentSource:xt("uniform sampler2D u_texture;\n#pragma minemap: define lowp float opacity\nvarying vec2 v_tex;varying float v_fade_opacity;void main(){\n#pragma minemap: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;attribute float a_height;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mediump float u_height_offset;\n#pragma minemap: define lowp float opacity\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;void main(){\n#pragma minemap: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?camera_to_anchor_distance/u_camera_to_center_distance :u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if(u_rotate_symbol){vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),projected_pos.z/projected_pos.w,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}")},symbolSDF:{fragmentSource:xt("#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\nuniform bool u_is_halo;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;void main(){\n#pragma minemap: initialize highp vec4 fill_color\n#pragma minemap: initialize highp vec4 halo_color\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float halo_width\n#pragma minemap: initialize lowp float halo_blur\nvec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if(u_is_halo){color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;attribute float a_height;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform mediump float u_height_offset;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;void main(){\n#pragma minemap: initialize highp vec4 fill_color\n#pragma minemap: initialize highp vec4 halo_color\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float halo_width\n#pragma minemap: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?camera_to_anchor_distance/u_camera_to_center_distance :u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if(u_rotate_symbol){vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),projected_pos.z/projected_pos.w,1.0);float gamma_scale=gl_Position.w;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=vec2(tex.x,tex.y);v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}")},tracking:{fragmentSource:xt("#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\nuniform float u_start;uniform float u_end;uniform float u_segments;uniform float u_reverse;uniform float u_reserve;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying float v_seq;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\nmediump float drive_opacity=1.0;if(u_reserve==1.0){if(v_seq>u_end){discard;}}else{if(v_seq<u_start||v_seq>u_end){discard;}drive_opacity=(v_seq-u_start)/u_segments;if(u_reverse==1.0){drive_opacity=1.0-drive_opacity;}}float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 tmpColor=vec4(color.xyz,0.25);gl_FragColor=tmpColor*(alpha*opacity)*drive_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;attribute float a_seq;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying float v_seq;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\nv_seq=a_seq;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},sphere:{fragmentSource:xt("uniform sampler2D u_image0;uniform sampler2D u_image1;uniform bool u_with_light;uniform vec3 u_lightcolor;uniform vec3 u_light;uniform vec3 u_cam;uniform sampler2D u_image2;uniform bool u_with_nighttexture;uniform highp float u_fog_distance;uniform highp float u_fog_length;uniform mediump float u_atm_c_percent;uniform bool u_fog_render;uniform highp float u_daytex_percent;uniform bool u_with_daytexture;varying vec2 v_pos;varying vec3 v_normal;varying float v_fog_len;varying vec3 v_fragPos;varying vec4 v_Color;void main(){vec4 calColor=texture2D(u_image0,v_pos);vec4 nightColor=vec4(1.0);vec4 dayColor=vec4(1.0);if(u_with_daytexture){dayColor=texture2D(u_image1,v_pos);calColor=mix(calColor,dayColor,u_daytex_percent);}if(u_with_light){vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_lightcolor*v_Color.rgb*nDotL;nightColor=texture2D(u_image2,v_pos);if(u_with_nighttexture){if(diffuse.x>0.25){calColor=calColor;}else if(diffuse.x<0.02){calColor=nightColor;}else{float t=(diffuse.x-0.02)/0.23;calColor=t*calColor+(1.0-t)*nightColor;}}else{diffuse=u_lightcolor*calColor.rgb*nDotL;vec3 ambient=vec3(0.4,0.4,0.4)*calColor.rgb;calColor=vec4(diffuse+ambient,calColor.a);}}if(u_fog_render){float rate=clamp((v_fog_len-u_fog_distance)/u_fog_length,0.0,1.0);gl_FragColor=mix(calColor,vec4(1.,1.,1.,1.0),rate*u_atm_c_percent);}else{gl_FragColor=calColor;}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec3 u_cam_pos;uniform bool u_fog_render;attribute vec3 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;varying vec3 v_normal;varying highp float v_fog_len;varying vec3 v_fragPos;varying vec4 v_Color;void main(){gl_Position=u_matrix*vec4(a_pos,1);v_pos=a_texture_pos;v_normal=a_pos;v_fragPos=a_pos;vec4 color=vec4(1.0,1.0,1.0,1.0);v_Color=color;if(u_fog_render){v_fog_len=distance(u_cam_pos,a_pos);}}")},sphereAtmosphere:{fragmentSource:xt("void main(){gl_FragColor=vec4(0.9725,0.9725,1.0,0.5);}"),vertexSource:xt("uniform mat4 u_matrix;attribute vec3 a_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);}")},sphereRaster:{fragmentSource:xt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;varying highp float v_fog_len;varying highp vec4 v_pos_from_light;uniform float u_brightness_low;uniform float u_brightness_high;uniform bool u_isPole;uniform bool u_isNorth;uniform bool u_draw_to_shadow_fb;uniform vec2 u_resolution;uniform highp float u_shadow_off;uniform highp float u_fog_distance;uniform highp float u_fog_length;uniform bool u_fog_render;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform bool u_terrain;uniform bool u_edgediscard;uniform float u_tile_zoom;uniform bool u_with_shadow;uniform sampler2D u_shadow_sampler;uniform int u_is_image;varying vec3 v_normal;varying vec4 v_Color;uniform bool u_with_light;uniform vec3 u_lightcolor;uniform vec3 u_light;uniform vec3 u_cam;void main(){float minVal=0.;float maxVal=1.;if(u_tile_zoom<=14.){if(u_terrain&&u_edgediscard&&(v_pos0.s<minVal||v_pos1.s<minVal||v_pos0.s>maxVal||v_pos0.t>maxVal||v_pos1.s>maxVal||v_pos1.t>maxVal)){discard;}}else{if(u_terrain&&u_edgediscard&&(v_pos0.s<minVal||v_pos0.t<minVal||v_pos1.s<minVal||v_pos1.t<minVal||v_pos0.s>maxVal||v_pos0.t>maxVal||v_pos1.s>maxVal||v_pos1.t>maxVal)){discard;}}vec4 color0,color1;if(u_isPole){if(u_isNorth){color0=texture2D(u_image0,vec2(v_pos0.x,0.0));color1=texture2D(u_image1,vec2(v_pos1.x,0.0));}else{color0=texture2D(u_image0,vec2(v_pos0.x,1.0));color1=texture2D(u_image1,vec2(v_pos1.x,1.0));}}else{color0=texture2D(u_image0,v_pos0);color1=texture2D(u_image1,v_pos1);}if(color0.a>0.0){color0.rgb=color0.rgb/color0.a;}if(color1.a>0.0){color1.rgb=color1.rgb/color1.a;}vec4 color=u_terrain ? color0 : mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec4 out_color=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);if(u_draw_to_shadow_fb){gl_FragColor=encodeFloat(gl_FragCoord.z);}else if(u_is_image==1){gl_FragColor=vec4(out_color.xyz,out_color.w*u_opacity);}else{float drawnInShadow=0.;vec3 shadowCoord=(v_pos_from_light.xyz/v_pos_from_light.w)/2.0+0.5;if(u_with_shadow){vec4 rgbaDepth=texture2D(u_shadow_sampler,shadowCoord.xy);float depth=decodeFloat(rgbaDepth);if(shadowCoord.z-u_shadow_off>depth){drawnInShadow+=1.0;}}if(u_with_light){vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_lightcolor*v_Color.rgb*nDotL;if(diffuse.x>0.0){vec3 diffuse=u_lightcolor*out_color.rgb*nDotL;vec3 ambient=vec3(0.2,0.2,0.2)*out_color.rgb;out_color=vec4(diffuse+ambient,out_color.a);}else{vec3 ambient=vec3(0.2,0.2,0.2)*out_color.rgb;out_color=vec4(ambient,out_color.a);}}if(u_fog_render){float rate=clamp((v_fog_len-u_fog_distance)/u_fog_length,0.0,1.0);out_color=mix(out_color,vec4(1.,1.,1.,1.0),rate);}gl_FragColor=vec4(out_color.xyz*(1.-0.5*drawnInShadow),out_color.w*u_opacity);}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform mat4 u_model_matrix;uniform mat4 u_sun_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform bool u_fog_render;uniform bool u_draw_to_shadow_fb;uniform vec3 u_cam_pos;attribute vec3 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;varying float v_fog_len;varying highp vec4 v_pos_from_light;varying vec3 v_normal;varying vec4 v_Color;uniform mat4 u_sunlight_matrix;void main(){gl_Position=u_matrix*vec4(a_pos,1);if(u_fog_render){vec4 geographic=u_model_matrix*vec4(a_pos,1.);v_fog_len=distance(u_cam_pos,geographic.xyz);}if(u_draw_to_shadow_fb){v_pos_from_light=u_sun_matrix*vec4(a_pos,1.);}vec4 color=vec4(1.0,1.0,1.0,1.0);v_Color=color;v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale)+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;vec4 sunlight_position=u_model_matrix*vec4(a_pos,1.);v_normal=sunlight_position.xyz;}")},sphereTexture:{fragmentSource:xt("uniform sampler2D u_image;varying vec2 v_pos;void main(){gl_FragColor=texture2D(u_image,v_pos);}"),vertexSource:xt("uniform mat4 u_matrix;uniform float u_deta_zoom;attribute vec3 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);v_pos=a_texture_pos/8192.0*(1.0+u_deta_zoom)/2.0;}")},sphereSymbolIcon:{fragmentSource:xt("uniform sampler2D u_texture;\n#pragma minemap: define lowp float opacity\nvarying vec2 v_tex;varying float v_fade_opacity;varying float v_front_of_earth;void main(){\n#pragma minemap: initialize lowp float opacity\nif(v_front_of_earth<0.){discard;}lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("const float PI=3.141592653589793;attribute vec3 a_pos;attribute vec2 a_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform vec2 u_gl_units_to_pixels;uniform highp float u_bearing;uniform bool u_along_line;\n#pragma minemap: define lowp float opacity\nuniform mat4 u_matrix;uniform mat4 u_modelMatrix;uniform mat4 u_symbol_mvp_matrix;uniform mat2 u_pitch_matrix;uniform mat2 u_rot_matrix;uniform vec3 u_camPos;uniform float u_tangentAngle;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;varying float v_front_of_earth;void main(){\n#pragma minemap: initialize lowp float opacity\nvec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=DISCARD_VARYING_NUMBER;}vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?camera_to_anchor_distance/u_camera_to_center_distance :u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=1.0;float fontScale=u_is_text ? size/24.0 : size;highp float angle_sin=0.;highp float angle_cos=0.;highp float angle_sin_mv=0.;highp float angle_cos_mv=0.;float lineRotAngle=0.;if(u_rotate_symbol){angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}else{if(u_along_line){vec2 pN=projectedPoint.xy/projectedPoint.w;vec4 p1=u_symbol_mvp_matrix*vec4(pN,0.,1.);vec4 p2=u_symbol_mvp_matrix*vec4(pN+vec2(0,0.1),0.,1.);lineRotAngle=atan2(p2.x/p2.w-p1.x/p1.w,p2.y/p2.w-p1.y/p1.w)+1.57079637;if(u_pitch_with_map){angle_sin=sin(segment_angle+u_bearing);angle_cos=cos(segment_angle+u_bearing);}else{angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}}else{angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}}mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position/=gl_Position.w;if(u_pitch_with_map){if(u_along_line){vec2 moveDist=u_pitch_matrix*u_rot_matrix*a_projected_pos.xy;vec4 added=vec4(u_pitch_matrix*rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels+u_pitch_matrix*u_rot_matrix*vec2(a_projected_pos.x,a_projected_pos.y)/u_gl_units_to_pixels+vec2(moveDist.y*sin(lineRotAngle),0.)/u_gl_units_to_pixels,0.0,1.0);gl_Position.xyz+=added.xyz/added.w;}else{gl_Position.xy+=u_pitch_matrix*u_rot_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}}else{if(u_along_line){gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels+a_projected_pos.xy/u_gl_units_to_pixels;}else if(u_rotate_symbol){gl_Position.xy+=u_pitch_matrix*u_rot_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}else{gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}}v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}")},sphereSymbolSDF:{fragmentSource:xt("#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\nuniform bool u_is_halo;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;varying float v_front_of_earth;void main(){\n#pragma minemap: initialize highp vec4 fill_color\n#pragma minemap: initialize highp vec4 halo_color\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float halo_width\n#pragma minemap: initialize lowp float halo_blur\nif(v_front_of_earth<0.0){discard;}vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if(u_is_halo){color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("const float PI=3.141592653589793;attribute vec3 a_pos;attribute vec2 a_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform vec2 u_gl_units_to_pixels;uniform highp float u_bearing;uniform bool u_along_line;uniform highp float u_zoom_factor;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\nuniform mat4 u_matrix;uniform mat4 u_modelMatrix;uniform mat4 u_symbol_mvp_matrix;uniform mat2 u_pitch_matrix;uniform mat2 u_pitch_rot_matrix;uniform mat2 u_rot_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec3 u_camPos;uniform float u_tangentAngle;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;varying float v_front_of_earth;void main(){\n#pragma minemap: initialize highp vec4 fill_color\n#pragma minemap: initialize highp vec4 halo_color\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float halo_width\n#pragma minemap: initialize lowp float halo_blur\nvec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=DISCARD_VARYING_NUMBER;}vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?camera_to_anchor_distance/u_camera_to_center_distance :u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);float fontScale=u_is_text ? size/24.0 : size;highp float angle_sin=0.;highp float angle_cos=0.;highp float angle_sin_mv=0.;highp float angle_cos_mv=0.;float lineRotAngle=0.;if(u_rotate_symbol){angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}else{if(u_along_line){vec2 pN=projectedPoint.xy/projectedPoint.w;vec4 p1=u_symbol_mvp_matrix*vec4(pN,0.,1.);vec4 p2=u_symbol_mvp_matrix*vec4(pN+vec2(0,0.1),0.,1.);lineRotAngle=atan2(p2.x/p2.w-p1.x/p1.w,p2.y/p2.w-p1.y/p1.w)+1.57079637;if(u_pitch_with_map){angle_sin=sin(segment_angle+u_bearing);angle_cos=cos(segment_angle+u_bearing);}else{angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}}else{angle_sin=sin(segment_angle);angle_cos=cos(segment_angle);}}mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position/=gl_Position.w;if(u_pitch_with_map){if(u_along_line){vec2 moveDist=u_pitch_rot_matrix*a_projected_pos.xy;vec2 added=u_pitch_matrix*rotation_matrix*a_offset/32.0*fontScale+u_pitch_rot_matrix*a_projected_pos.xy+vec2(moveDist.y*sin(lineRotAngle));added-=fract(added);gl_Position.xy+=added/u_gl_units_to_pixels;}else{gl_Position.xy+=u_pitch_rot_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}}else{if(u_along_line){gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels+a_projected_pos.xy/u_gl_units_to_pixels;}else if(u_rotate_symbol){gl_Position.xy+=u_pitch_rot_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}else{gl_Position.xy+=rotation_matrix*a_offset/32.0*fontScale/u_gl_units_to_pixels;}}gl_Position.z=0.0;float gamma_scale=gl_Position.w*u_zoom_factor;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=vec2(tex.x,tex.y);v_data1=vec3(1.,size,interpolated_fade_opacity);}")},sphereFill:{fragmentSource:xt("#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float opacity\nvarying float v_front_of_earth;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float opacity\nif(v_front_of_earth<0.0){discard;}gl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("attribute vec3 a_pos;uniform mat4 u_matrix;uniform mat4 u_modelMatrix;uniform vec3 u_camPos;uniform float u_tangentAngle;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float opacity\nvarying float v_front_of_earth;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float opacity\nvec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=DISCARD_VARYING_NUMBER;}gl_Position=u_matrix*vec4(a_pos,1);}")},sphereFillPattern:{fragmentSource:xt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma minemap: define lowp float opacity\nvarying float v_front_of_earth;void main(){\n#pragma minemap: initialize lowp float opacity\nif(v_front_of_earth<0.0){discard;}vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;uniform float u_zoom_factor;uniform mat4 u_modelMatrix;uniform vec3 u_camPos;uniform float u_tangentAngle;attribute vec3 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma minemap: define lowp float opacity\nvarying float v_front_of_earth;void main(){\n#pragma minemap: initialize lowp float opacity\nvec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=DISCARD_VARYING_NUMBER;}gl_Position=u_matrix*vec4(a_pos,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos.xy)*u_zoom_factor;v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos.xy)*u_zoom_factor;}")},sphereFillOutline:{fragmentSource:xt("#pragma minemap: define highp vec4 outline_color\n#pragma minemap: define lowp float opacity\nvarying vec2 v_pos;void main(){\n#pragma minemap: initialize highp vec4 outline_color\n#pragma minemap: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("attribute vec3 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma minemap: define highp vec4 outline_color\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize highp vec4 outline_color\n#pragma minemap: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}")},sphereFillOutlinePattern:{fragmentSource:xt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float opacity\nvec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_mix)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec3 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}")},sphereLine:{fragmentSource:xt("#ifdef MINEMAP_EXT_DEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 bordercolor\n#pragma minemap: define mediump float borderwidth\n#pragma minemap: define lowp float borderopacity\nuniform mediump float u_hasBorder;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize highp vec4 bordercolor\n#pragma minemap: initialize mediump float borderwidth\n#pragma minemap: initialize lowp float borderopacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef MINEMAP_EXT_DEPTH\ngl_FragDepthEXT=gl_FragCoord.z;\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec3 a_pos;attribute vec2 a_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mat2 u_pixel_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;uniform lowp float u_half_render;uniform lowp float normaldirection;uniform mediump float u_hasBorder;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n#pragma minemap: define highp vec4 bordercolor\n#pragma minemap: define mediump float borderwidth\n#pragma minemap: define lowp float borderopacity\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize highp vec4 bordercolor\n#pragma minemap: initialize mediump float borderwidth\n#pragma minemap: initialize lowp float borderopacity\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal=a_normal;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_hasBorder==1.0)?(borderwidth*2.0+width)/2.0 : width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;if(u_half_render==1.){if(normaldirection==1.){outset=gapwidth+(normal.y>0.?halfwidth:0.)*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;}else{outset=gapwidth+(normal.y<0.?halfwidth:0.)*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;}}mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},sphereLineSDF:{fragmentSource:xt("uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float width\n#pragma minemap: define lowp float floorwidth\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\nattribute vec3 a_pos;attribute vec2 a_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mat2 u_pixel_matrix;uniform mediump float u_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n#pragma minemap: define lowp float floorwidth\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize lowp float floorwidth\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;mediump vec2 normal=a_normal;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}")},sphereLinePattern:{fragmentSource:xt("uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\nvoid main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/u_pattern_size_a.x,1.0);float x_b=mod(v_linesofar/u_pattern_size_b.x,1.0);float y_a=0.5+(v_normal.y*clamp(v_width2.s,0.0,(u_pattern_size_a.y+2.0)/2.0)/u_pattern_size_a.y);float y_b=0.5+(v_normal.y*clamp(v_width2.s,0.0,(u_pattern_size_b.y+2.0)/2.0)/u_pattern_size_b.y);vec2 pos_a=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,vec2(x_a,y_a));vec2 pos_b=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,vec2(x_b,y_b));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\nattribute vec3 a_pos;attribute vec2 a_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mat2 u_pixel_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define mediump float width\nvoid main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;mediump vec2 normal=a_normal;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);}")},sphereLineGradient:{fragmentSource:xt("\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\nuniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp float v_lineprogress;void main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,vec2(v_lineprogress,0.5));gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("\n#define MAX_LINE_DISTANCE 32767.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec3 a_pos;attribute vec2 a_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mat2 u_pixel_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\nvoid main(){\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\nvec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_lineprogress=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0/MAX_LINE_DISTANCE;mediump vec2 normal=a_normal;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},sphereHeatmap:{fragmentSource:xt("#pragma minemap: define highp float weight\nuniform highp float u_intensity;varying vec2 v_extrude;varying float v_value;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(){\n#pragma minemap: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);if(v_value>0.0){gl_FragColor=vec4(val,1.0,0.0,1.0);}else{gl_FragColor=vec4(0.0,0.0,1.0,1.0);}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("#pragma minemap: define highp float weight\n#pragma minemap: define mediump float radius\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform float u_deviceWidth;uniform float u_deviceHeight;uniform vec3 u_camera_pos;attribute vec3 a_pos;attribute vec2 a_extrude;varying vec2 v_extrude;varying float v_value;const highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void){\n#pragma minemap: initialize highp float weight\n#pragma minemap: initialize mediump float radius\nfloat S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*a_extrude;v_value=dot(a_pos,u_camera_pos);vec4 temppos=vec4(a_pos,1);vec4 trans_pos=u_matrix*temppos;vec2 screen_pos=vec2(trans_pos.x/trans_pos.w*u_deviceHeight/2.0+v_extrude.x*radius*u_deviceHeight/u_deviceWidth,trans_pos.y/trans_pos.w*u_deviceHeight/2.0+v_extrude.y*radius);gl_Position=vec4(screen_pos*trans_pos.w*2.0/u_deviceHeight,trans_pos.z,trans_pos.w);}")},sphereCircle:{fragmentSource:xt("#pragma minemap: define highp vec4 color\n#pragma minemap: define mediump float radius\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 stroke_color\n#pragma minemap: define mediump float stroke_width\n#pragma minemap: define lowp float stroke_opacity\nvarying vec3 v_data;varying float v_front_of_earth;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize mediump float radius\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize highp vec4 stroke_color\n#pragma minemap: initialize mediump float stroke_width\n#pragma minemap: initialize lowp float stroke_opacity\nif(v_front_of_earth<0.){discard;}vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width<0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("#define scale 0.015873016\nuniform mat4 u_matrix;uniform mat4 u_modelMatrix;uniform mat2 u_pixel_matrix;uniform vec2 u_gl_units_to_pixels;uniform vec3 u_camPos;uniform float u_tangentAngle;attribute vec3 a_pos;attribute vec2 a_extra;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define mediump float radius\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 stroke_color\n#pragma minemap: define mediump float stroke_width\n#pragma minemap: define lowp float stroke_opacity\nvarying vec3 v_data;varying float v_front_of_earth;void main(void){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize mediump float radius\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize highp vec4 stroke_color\n#pragma minemap: initialize mediump float stroke_width\n#pragma minemap: initialize lowp float stroke_opacity\nvec4 spacePos=u_modelMatrix*vec4(a_pos,1.0);if(isBackOfEarth(spacePos.xyz,u_camPos,u_tangentAngle)){gl_Position=vec4(-10.,-10.,0,1.);v_front_of_earth=-DISCARD_VARYING_NUMBER;return;}else{v_front_of_earth=DISCARD_VARYING_NUMBER;}vec2 extrude=a_extra;mediump vec2 dist=u_pixel_matrix*(radius+stroke_width)*extrude;gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;lowp float antialiasblur=1.0/DEVICE_PIXEL_RATIO/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}")},sphereExtrusion:{fragmentSource:xt("struct Region{bool use;highp vec4 pos;highp vec3 north;highp vec3 cross;bool scan;highp float percent;};varying vec3 v_normal;varying vec3 v_pos_region;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_light;uniform Region u_regions[RADIATION_REGIONS_COUNT];\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nbool oppositeSigns(float x,float y){return(x<=0.&&y>=0.)||(x>=0.&&y<=0.);}void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nvec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_lightcolor*color.rgb*nDotL;vec3 ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*color.rgb;float inRegion=0.0;for(int i=0;i<RADIATION_REGIONS_COUNT;i++){Region r=u_regions[i];if(r.use){if(r.scan){float dist=distance(r.pos.xyz,v_pos_region);if(dist<r.pos.w){if((dist>0.09*r.pos.w&&dist<0.1*r.pos.w)||(dist>0.29*r.pos.w&&dist<0.3*r.pos.w)||(dist>0.49*r.pos.w&&dist<0.5*r.pos.w)||(dist>0.69*r.pos.w&&dist<0.7*r.pos.w)||(dist>0.99*r.pos.w&&dist<1.*r.pos.w)){inRegion=0.5;}else{vec3 p_vector=normalize(v_pos_region-r.pos.xyz);vec3 r_vector=normalize(r.north-r.pos.xyz);vec3 cc=cross(p_vector,r_vector);float angle=0.;if(oppositeSigns(cc.x,r.cross.x)||oppositeSigns(cc.y,r.cross.y)||oppositeSigns(cc.z,r.cross.z)){angle=degrees(acos(dot(p_vector,r_vector)))+180.0;}else{angle=-degrees(acos(dot(p_vector,r_vector)))+180.0;}if((angle>r.percent*360.&&angle<(r.percent+0.15)*360.)||(angle>(r.percent-1.0)*360.&&angle<(r.percent-0.85)*360.)){inRegion=0.5;}else{inRegion=0.8;}}}}else{float dist=distance(r.pos.xyz,v_pos_region);if(dist<r.percent*r.pos.w){inRegion=dist/(r.percent*r.pos.w);break;}}}else{break;}}inRegion=inRegion*10.;gl_FragColor=vec4(inRegion>0.0 ?(diffuse+ambient)*(1.0+inRegion):(diffuse+ambient),u_opacity-inRegion*0.1);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("struct Region{bool use;highp vec4 pos;highp vec3 north;highp vec3 cross;bool scan;highp float percent;};uniform mat4 u_matrix;uniform mat4 u_normal;uniform mat4 u_model;uniform Region u_regions[RADIATION_REGIONS_COUNT];attribute vec3 a_pos;attribute vec4 a_normal_ed;attribute vec3 a_st;varying vec3 v_normal;varying vec3 v_pos_region;varying highp float v_is_top;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\ngl_Position=u_matrix*vec4(a_pos,1);v_normal=vec3(u_normal*vec4(a_normal_ed));if(u_regions[0].use){v_pos_region=vec3(u_model*vec4(a_pos,1));}}")},sphereExtrusionPattern:{fragmentSource:xt("struct Region{bool use;highp vec4 pos;highp vec3 north;highp vec3 cross;bool scan;highp float percent;};uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform sampler2D u_image;uniform sampler2D u_image_top;varying vec2 v_pos;varying highp float v_is_top;varying vec3 v_pos_region;varying vec3 v_normal;uniform lowp float u_opacity;uniform bool u_top_tex_rend;uniform vec3 u_lightcolor;uniform lowp vec3 u_light;uniform Region u_regions[RADIATION_REGIONS_COUNT];\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nbool oppositeSigns(float x,float y){return(x<=0.&&y>=0.)||(x>=0.&&y<=0.);}void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nvec2 imagecoord_b=mod(v_pos,1.0);vec2 pos=vec2(1.0);vec4 t_color=vec4(1.0);if(v_is_top==0.){pos=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);t_color=texture2D(u_image,pos);}else{if(u_top_tex_rend){t_color=texture2D(u_image_top,imagecoord_b);}else{t_color=color;}}float t_opacity=1.0;if(t_color.a==0.){t_color=vec4(1.0);t_opacity=0.7;}vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_lightcolor*t_color.rgb*nDotL;vec3 ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*t_color.rgb;float inRegion=0.0;for(int i=0;i<RADIATION_REGIONS_COUNT;i++){Region r=u_regions[i];if(r.use){if(r.scan){float dist=distance(r.pos.xyz,v_pos_region);if(dist<r.pos.w){if((dist>0.09*r.pos.w&&dist<0.1*r.pos.w)||(dist>0.29*r.pos.w&&dist<0.3*r.pos.w)||(dist>0.49*r.pos.w&&dist<0.5*r.pos.w)||(dist>0.69*r.pos.w&&dist<0.7*r.pos.w)||(dist>0.99*r.pos.w&&dist<1.*r.pos.w)){inRegion=0.5;}else{vec3 p_vector=normalize(v_pos_region-r.pos.xyz);vec3 r_vector=normalize(r.north-r.pos.xyz);vec3 cc=cross(p_vector,r_vector);float angle=0.;if(oppositeSigns(cc.x,r.cross.x)||oppositeSigns(cc.y,r.cross.y)||oppositeSigns(cc.z,r.cross.z)){angle=degrees(acos(dot(p_vector,r_vector)))+180.0;}else{angle=-degrees(acos(dot(p_vector,r_vector)))+180.0;}if((angle>r.percent*360.&&angle<(r.percent+0.15)*360.)||(angle>(r.percent-1.0)*360.&&angle<(r.percent-0.85)*360.)){inRegion=0.5;}else{inRegion=0.8;}}}}else{float dist=distance(r.pos.xyz,v_pos_region);if(dist<r.percent*r.pos.w){inRegion=dist/(r.percent*r.pos.w);break;}}}else{break;}}inRegion=inRegion*10.;gl_FragColor=vec4(inRegion>0.0 ?(diffuse+ambient)*(1.0+inRegion):(diffuse+ambient),u_opacity*t_opacity-inRegion*0.1);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("struct Region{bool use;highp vec4 pos;highp vec3 north;highp vec3 cross;bool scan;highp float percent;};uniform mat4 u_matrix;uniform mat4 u_normal;uniform mat4 u_model;uniform Region u_regions[RADIATION_REGIONS_COUNT];attribute vec3 a_pos;attribute vec4 a_normal_ed;attribute vec3 a_st;varying vec3 v_normal;varying vec2 v_pos;varying vec3 v_pos_region;varying highp float v_is_top;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\ngl_Position=u_matrix*vec4(a_pos,1);v_normal=vec3(u_normal*vec4(a_normal_ed));v_pos=a_st.xy;v_pos_region=vec3(u_model*vec4(a_pos,1));v_is_top=a_st.z;if(u_regions[0].use){v_pos_region=vec3(u_model*vec4(a_pos,1));}}")},sphereExtrusionShadow:{fragmentSource:xt("void main(){gl_FragColor=encodeFloat(gl_FragCoord.z);}"),vertexSource:xt("uniform mat4 u_matrix;attribute vec3 a_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);}")},sphereExtrusionPatternShadow:{fragmentSource:xt("void main(){gl_FragColor=encodeFloat(gl_FragCoord.z);}"),vertexSource:xt("uniform mat4 u_matrix;attribute vec3 a_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);}")},sphereExtrusionCameraView:{fragmentSource:xt("struct Region{bool use;vec4 pos;};varying vec3 v_normal;varying vec3 v_pos_region;varying vec4 v_viewshed_pos;varying vec4 v_view_spacepos;varying vec4 v_pos_from_light;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_light;uniform Region u_regions[RADIATION_REGIONS_COUNT];uniform highp float u_region_percent;uniform lowp float u_viewshed_count;uniform sampler2D u_viewshed_samp0;uniform highp float u_viewshed_dist0;uniform bool u_viewshed_used0;uniform vec3 u_viewshed_eye0;uniform bool u_with_shadow;uniform sampler2D u_shadow_sampler;uniform highp float u_shadow_off;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nfloat getAmountInLight(sampler2D sampler,vec3 shadowCoord){float amountInLight=0.0;vec4 rgbaDepth=texture2D(sampler,shadowCoord.xy);float depth=decodeFloat(rgbaDepth);if(shadowCoord.z-u_shadow_off>depth){amountInLight=1.0;}return amountInLight;}vec3 getViewshedColor(){vec3 viewshed_color=vec3(0.0);if(u_viewshed_used0){vec3 my_eye=u_viewshed_eye0;float my_dist=u_viewshed_dist0;vec4 my_pos=v_viewshed_pos;vec4 my_spacepos=v_view_spacepos;if(distance(my_spacepos.xyz,my_eye)<=my_dist){vec3 shadowCoord=(my_pos.xyz/my_pos.w)/2.0+0.5;if(!(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.||shadowCoord.z>1.)){float ail=getAmountInLight(u_viewshed_samp0,shadowCoord);if(ail==0.0){viewshed_color=vec3(0.,0.3,0.);}else{viewshed_color=vec3(0.3,0.,0.);}}}}return viewshed_color;}void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nvec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_lightcolor*color.rgb*nDotL;vec3 ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*color.rgb;float inRegion=0.0;for(int i=0;i<RADIATION_REGIONS_COUNT;i++){Region r=u_regions[i];if(r.use){float dist=distance(r.pos.xyz,v_pos_region);if(dist<u_region_percent*r.pos.w){inRegion=dist/(u_region_percent*r.pos.w);break;}}else{break;}}vec3 viewshed_color=vec3(0.0);if(u_viewshed_count>0.){viewshed_color=getViewshedColor();}if(u_with_shadow){vec3 shadowCoord=(v_pos_from_light.xyz/v_pos_from_light.w)/2.0+0.5;vec4 c=vec4(inRegion>0.0 ?(diffuse+ambient)*(1.0+inRegion)+viewshed_color:(diffuse+ambient+viewshed_color),u_opacity-inRegion*0.1);if(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.){gl_FragColor=c;}else{float amountInLight=getAmountInLight(u_shadow_sampler,shadowCoord);gl_FragColor=vec4(c.rgb*(1.-amountInLight*0.5),c.a);}}else{gl_FragColor=vec4(inRegion>0.0 ?(diffuse+ambient)*(1.0+inRegion)+viewshed_color:(diffuse+ambient+viewshed_color),u_opacity-inRegion*0.1);}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform mat4 u_normal;uniform mat4 u_model;uniform mat4 u_sun_matrix;uniform mat4 u_viewshed_mat0;uniform mat4 u_view_modelmat0;uniform bool u_viewshed_used0;uniform bool u_with_shadow;attribute vec3 a_pos;attribute vec4 a_normal_ed;attribute vec3 a_st;varying vec3 v_normal;varying vec3 v_pos_region;varying highp float v_is_top;varying vec4 v_viewshed_pos;varying vec4 v_view_spacepos;varying vec4 v_pos_from_light;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\ngl_Position=u_matrix*vec4(a_pos,1);v_normal=vec3(u_normal*vec4(a_normal_ed));v_pos_region=vec3(u_model*vec4(a_pos,1));if(u_with_shadow){v_pos_from_light=u_sun_matrix*vec4(a_pos,1.);}if(u_viewshed_used0){v_viewshed_pos=u_viewshed_mat0*vec4(a_pos,1.);v_view_spacepos=u_model*vec4(a_pos,1.);}}")},sphereExtrusionPatternCameraView:{fragmentSource:xt("struct Region{bool use;vec4 pos;};uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform sampler2D u_image;uniform sampler2D u_image_top;uniform lowp float u_viewshed_count;uniform highp float u_shadow_off;varying vec2 v_pos;varying highp float v_is_top;varying vec3 v_pos_region;varying vec4 v_viewshed_pos;varying vec4 v_view_spacepos;uniform sampler2D u_viewshed_samp0;uniform highp float u_viewshed_dist0;uniform bool u_viewshed_used0;uniform vec3 u_viewshed_eye0;varying vec3 v_normal;uniform lowp float u_opacity;uniform lowp float u_top_tex_rend;uniform vec3 u_lightcolor;uniform lowp vec3 u_light;uniform Region u_regions[RADIATION_REGIONS_COUNT];uniform highp float u_region_percent;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nfloat getAmountInLightSimple(sampler2D sampler,vec3 shadowCoord){float amountInLight=0.0;vec4 rgbaDepth=texture2D(sampler,shadowCoord.xy);float depth=decodeFloat(rgbaDepth);if(shadowCoord.z-u_shadow_off>depth){amountInLight=1.0;}return amountInLight;}vec3 getViewshedColor(){vec3 viewshed_color=vec3(0.0);if(u_viewshed_used0){vec3 my_eye=vec3(0.);float my_dist=0.0;vec4 my_pos=vec4(1.0);vec4 my_spacepos=vec4(1.0);my_eye=u_viewshed_eye0;my_dist=u_viewshed_dist0;my_pos=v_viewshed_pos;my_spacepos=v_view_spacepos;if(distance(my_spacepos.xyz,my_eye)<=my_dist){vec3 shadowCoord=(my_pos.xyz/my_pos.w)/2.0+0.5;if(!(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.||shadowCoord.z>1.)){float ail=getAmountInLightSimple(u_viewshed_samp0,shadowCoord);if(ail==0.0){viewshed_color=vec3(0.,0.3,0.);}else{viewshed_color=vec3(0.3,0.,0.);}}}}return viewshed_color;}void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nvec2 imagecoord_b=mod(v_pos,1.0);vec2 pos=vec2(1.0);vec4 t_color=vec4(1.0);if(v_is_top==0.){pos=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);t_color=texture2D(u_image,pos);}else{if(u_top_tex_rend==1.0){t_color=texture2D(u_image_top,imagecoord_b);}else{t_color=color;}}float t_opacity=1.0;if(t_color.a==0.){t_color=vec4(1.0);t_opacity=0.7;}vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_lightcolor*t_color.rgb*nDotL;vec3 ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*t_color.rgb;float inRegion=0.0;for(int i=0;i<RADIATION_REGIONS_COUNT;i++){Region r=u_regions[i];if(r.use){float dist=distance(r.pos.xyz,v_pos_region);if(dist<u_region_percent*r.pos.w){inRegion=dist/(u_region_percent*r.pos.w);break;}}else{break;}}vec3 viewshed_color=vec3(0.0);if(u_viewshed_count>0.){viewshed_color=getViewshedColor();}gl_FragColor=vec4(inRegion>0.0 ?(diffuse+ambient)*(1.0+inRegion)+viewshed_color : diffuse+ambient+viewshed_color,u_opacity*t_opacity-inRegion*0.1);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform mat4 u_normal;uniform mat4 u_model;uniform mat4 u_viewshed_mat0;uniform mat4 u_view_modelmat0;uniform bool u_viewshed_used0;attribute vec3 a_pos;attribute vec4 a_normal_ed;attribute vec3 a_st;varying vec3 v_normal;varying vec2 v_pos;varying vec3 v_pos_region;varying highp float v_is_top;varying vec4 v_viewshed_pos;varying vec4 v_view_spacepos;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\ngl_Position=u_matrix*vec4(a_pos,1);v_normal=vec3(u_normal*vec4(a_normal_ed));v_pos=a_st.xy;v_pos_region=vec3(u_model*vec4(a_pos,1));v_is_top=a_st.z;for(int i=0;i<VIEWSHED_COUNT;i++){if(u_viewshed_used0){v_viewshed_pos=u_viewshed_mat0*vec4(a_pos,1.);v_view_spacepos=u_view_modelmat0*vec4(a_pos,1.);}}}")},sphereTracking:{fragmentSource:xt("#ifdef MINEMAP_EXT_DEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define highp vec4 bordercolor\n#pragma minemap: define mediump float borderwidth\n#pragma minemap: define lowp float borderopacity\nuniform float u_start;uniform float u_end;uniform float u_segments;uniform bool u_reverse;uniform bool u_reserve;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying float v_seq;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize highp vec4 bordercolor\n#pragma minemap: initialize mediump float borderwidth\n#pragma minemap: initialize lowp float borderopacity\nmediump float drive_opacity=1.0;if(u_reserve){if(v_seq>u_end){discard;}}else{if(v_seq<u_start||v_seq>u_end){discard;}drive_opacity=(v_seq-u_start)/u_segments;if(u_reverse){drive_opacity=1.0-drive_opacity;}}float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef MINEMAP_EXT_DEPTH\ngl_FragDepthEXT=gl_FragCoord.z;\n#endif\nvec4 tmpColor=vec4(color.xyz,0.25);gl_FragColor=tmpColor*(alpha*opacity)*drive_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec3 a_pos;attribute vec2 a_normal;attribute vec4 a_data;attribute float a_seq;uniform mat4 u_matrix;uniform mat2 u_pixel_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying float v_seq;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\n#pragma minemap: define highp vec4 bordercolor\n#pragma minemap: define mediump float borderwidth\n#pragma minemap: define lowp float borderopacity\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\n#pragma minemap: initialize highp vec4 bordercolor\n#pragma minemap: initialize mediump float borderwidth\n#pragma minemap: initialize lowp float borderopacity\nv_seq=a_seq;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal=a_normal;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},sphereSprite:{fragmentSource:xt("#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\nvarying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying float v_opacity;varying float v_discard;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\nif(v_discard<0.0){discard;}float opacity_m=v_opacity;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity)*opacity_m;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec3 a_pos;attribute vec2 a_normal;attribute vec4 a_data;attribute vec3 a_extra_m;uniform mat4 u_matrix;uniform mat2 u_pixel_matrix;uniform vec2 u_gl_units_to_pixels;uniform float u_count;uniform float u_speed_factor;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying float v_opacity;varying float v_discard;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\nvec3 f_extra_m=vec3(a_extra_m[0]*3.0/255.0,a_extra_m[1],a_extra_m[2]);float status=f_extra_m[2];float link_seq=f_extra_m[1];v_opacity=f_extra_m[0];int speed1;int speed2;int speed3;int speed4;if(u_speed_factor==1.0){speed1=int(u_count)-(int(u_count)/20)*20;}else if(u_speed_factor==2.0){speed2=int(u_count)-(int(u_count)/80)*80;}else if(u_speed_factor==3.0){speed3=int(u_count)-(int(u_count)/150)*150;}else{speed4=int(u_count)-(int(u_count)/240)*240;}speed1=speed1/2;speed2=speed2/8;speed3=speed3/15;speed4=speed4/24;if(status==1.0){if(link_seq!=float(speed1)){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==2.0){if(link_seq!=float(speed2)){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==3.0){if(link_seq!=float(speed3)){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==4.0){if(link_seq!=float(speed4)){v_discard=-100.0;}else{v_discard=100.0;}}vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;mediump vec2 normal=a_normal;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;mediump vec2 origin_dist=outset*a_extrude*scale;mediump vec2 dist=u_pixel_matrix*outset*a_extrude*scale;gl_Position=u_matrix*vec4(a_pos.xyz,1.0);gl_Position.xy+=dist/u_gl_units_to_pixels*gl_Position.w;float extrude_length_without_perspective=length(origin_dist);float extrude_length_with_perspective=length(dist);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},sprite:{fragmentSource:xt("#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\nvarying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying float v_opacity;varying float v_discard;void main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\nif(v_discard<0.0){discard;}float opacity_m=v_opacity;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/DEVICE_PIXEL_RATIO)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity)*opacity_m;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define scale 0.015873016\nattribute vec4 a_pos_normal;attribute vec4 a_data;attribute vec3 a_extra_m;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_gl_units_to_pixels;uniform vec4 u_speed_mat;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying float v_opacity;varying float v_discard;\n#pragma minemap: define highp vec4 color\n#pragma minemap: define lowp float blur\n#pragma minemap: define lowp float opacity\n#pragma minemap: define mediump float gapwidth\n#pragma minemap: define lowp float offset\n#pragma minemap: define mediump float width\nvoid main(){\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize lowp float blur\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize mediump float gapwidth\n#pragma minemap: initialize lowp float offset\n#pragma minemap: initialize mediump float width\nvec3 f_extra_m=vec3(a_extra_m[0]*3.0/255.0,a_extra_m[1],a_extra_m[2]);float status=f_extra_m[2];float link_seq=f_extra_m[1];v_opacity=f_extra_m[0];float speed1=u_speed_mat[0];float speed2=u_speed_mat[1];float speed3=u_speed_mat[2];float speed4=u_speed_mat[3];if(status==1.0){if(link_seq!=speed1){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==2.0){if(link_seq!=speed2){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==3.0){if(link_seq!=speed3){v_discard=-100.0;}else{v_discard=100.0;}}else if(status==4.0){if(link_seq!=speed4){v_discard=-100.0;}else{v_discard=100.0;}}vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=a_pos_normal.xy;mediump vec2 normal=a_pos_normal.zw;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth>0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth>0.0 ? 2.0 : 1.0)+ANTIALIASING;mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_gl_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}")},symtrackingIcon:{fragmentSource:xt("uniform sampler2D u_texture;\n#pragma minemap: define lowp float opacity\nvarying vec2 v_tex;varying float v_fade_opacity;varying float v_seq;void main(){\n#pragma minemap: initialize lowp float opacity\nif(v_seq<0.0){discard;}lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute vec2 a_extra;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mediump float u_height_offset;\n#pragma minemap: define lowp float opacity\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform float u_seq;varying vec2 v_tex;varying float v_fade_opacity;varying float v_seq;void main(){\n#pragma minemap: initialize lowp float opacity\nfloat a_seq=a_extra[0];if(a_seq!=u_seq){v_seq=-100.0;}else{v_seq=100.0;}vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?camera_to_anchor_distance/u_camera_to_center_distance :u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if(u_rotate_symbol){vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,a_extra[1]/10.0+u_height_offset/10.0,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),projected_pos.z/projected_pos.w,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}")},symtrackingSDF:{fragmentSource:xt("#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\nuniform bool u_is_halo;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\nuniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;varying float v_seq;void main(){\n#pragma minemap: initialize highp vec4 fill_color\n#pragma minemap: initialize highp vec4 halo_color\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float halo_width\n#pragma minemap: initialize lowp float halo_blur\nif(v_seq<0.0){discard;}vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if(u_is_halo){color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;attribute vec2 a_extra;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mediump float u_height_offset;\n#pragma minemap: define highp vec4 fill_color\n#pragma minemap: define highp vec4 halo_color\n#pragma minemap: define lowp float opacity\n#pragma minemap: define lowp float halo_width\n#pragma minemap: define lowp float halo_blur\nuniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_gl_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform float u_seq;varying vec2 v_data0;varying vec3 v_data1;varying float v_seq;void main(){\n#pragma minemap: initialize highp vec4 fill_color\n#pragma minemap: initialize highp vec4 halo_color\n#pragma minemap: initialize lowp float opacity\n#pragma minemap: initialize lowp float halo_width\n#pragma minemap: initialize lowp float halo_blur\nfloat a_seq=a_extra[0];if(a_seq!=u_seq){v_seq=-100.0;}else{v_seq=100.0;}vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if(!u_is_size_zoom_constant&&!u_is_size_feature_constant){size=mix(a_size[0],a_size[1],u_size_t)/10.0;}else if(u_is_size_zoom_constant&&!u_is_size_feature_constant){size=a_size[0]/10.0;}else if(!u_is_size_zoom_constant&&u_is_size_feature_constant){size=u_size;}else{size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?camera_to_anchor_distance/u_camera_to_center_distance :u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if(u_rotate_symbol){vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,a_extra[1]/10.0+u_height_offset/10.0,1.0);gl_Position=u_gl_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),projected_pos.z/projected_pos.w,1.0);float gamma_scale=gl_Position.w;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1]>0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=vec2(tex.x,tex.y);v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}")},histogram:{fragmentSource:xt("varying vec4 v_color;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvarying float v_opacity;void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\ngl_FragColor=v_color*v_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_is_max_length;uniform float u_fluorescent;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvarying float v_opacity;void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t>0.0 ?(u_is_max_length==1.0 ? height*100.0 : height): base*100.0,1);if(t>0.0){v_opacity=1.2;}else{v_opacity=0.1;}float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if(normal.y!=0.0){directional*=clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0);}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);}")},histogramColor:{fragmentSource:xt("uniform vec4 u_color_a;uniform vec4 u_color_b;uniform vec4 u_color_c;uniform vec4 u_color_d;uniform vec4 u_color_e;uniform float u_max_height;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvarying float v_opacity;varying float v_height;varying float v_directional;void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nif(v_height<0.25*u_max_height){vec4 tmp=u_color_b-u_color_a;vec4 real=tmp*((v_height)/0.25/u_max_height)+u_color_a;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.5*u_max_height){vec4 tmp=u_color_c-u_color_b;vec4 real=tmp*((v_height-0.25*u_max_height)/0.25/u_max_height)+u_color_b;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.75*u_max_height){vec4 tmp=u_color_d-u_color_c;vec4 real=tmp*((v_height-0.5*u_max_height)/0.25/u_max_height)+u_color_c;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.8*u_max_height){vec4 tmp=u_color_e-u_color_d;vec4 real=tmp*((v_height-0.75*u_max_height)/0.25/u_max_height)+u_color_d;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else{gl_FragColor=vec4(u_color_e.rgb*v_directional,1.0);}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_is_max_length;uniform float u_fluorescent;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvarying float v_opacity;varying float v_height;varying float v_directional;void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t>0.0 ?(u_is_max_length==1.0 ? height*100.0 : height): base*100.0,1);if(t>0.0){v_opacity=1.2;v_height=height*3.0;}else{v_opacity=0.1;v_height=0.0;}float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if(normal.y!=0.0){directional*=clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0);}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);if(u_fluorescent<=0.0){v_directional=directional;}else{v_directional=1.0;}}")},histogramDynamic:{fragmentSource:xt("varying vec4 v_color;uniform vec4 u_color_a;uniform vec4 u_color_b;uniform vec4 u_color_c;uniform vec4 u_color_d;uniform vec4 u_color_e;uniform float u_max_height;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\nvarying float v_opacity;varying float v_height;varying float v_directional;void main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\nif(v_height<0.2*u_max_height){vec4 tmp=u_color_b-u_color_a;vec4 real=tmp*((v_height)/0.2/u_max_height)+u_color_a;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.4*u_max_height){vec4 tmp=u_color_c-u_color_b;vec4 real=tmp*((v_height-0.2*u_max_height)/0.2/u_max_height)+u_color_b;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.6*u_max_height){vec4 tmp=u_color_d-u_color_c;vec4 real=tmp*((v_height-0.4*u_max_height)/0.2/u_max_height)+u_color_c;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else if(v_height<0.8*u_max_height){vec4 tmp=u_color_e-u_color_d;vec4 real=tmp*((v_height-0.6*u_max_height)/0.2/u_max_height)+u_color_d;gl_FragColor=vec4(real.rgb*v_directional,1.0);}else{gl_FragColor=vec4(u_color_e.rgb*v_directional,1.0);}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform lowp float u_dyn_count;uniform float u_fluorescent;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;varying float v_opacity;varying float v_height;varying float v_directional;\n#pragma minemap: define lowp float base\n#pragma minemap: define lowp float height\n#pragma minemap: define highp vec4 color\n#pragma minemap: define highp vec4 heightArr1\n#pragma minemap: define highp vec4 heightArr2\n#pragma minemap: define highp vec4 heightArr3\nvoid main(){\n#pragma minemap: initialize lowp float base\n#pragma minemap: initialize lowp float height\n#pragma minemap: initialize highp vec4 color\n#pragma minemap: initialize highp vec4 heightArr1\n#pragma minemap: initialize highp vec4 heightArr2\n#pragma minemap: initialize highp vec4 heightArr3\nfloat _height=0.0;float _num=0.0;float _height1=0.0;float _height2=0.0;_num=abs(u_dyn_count)/500.0;if(_num<1.0){_height1=abs(height);_height2=abs(heightArr1[0])*255.0;}else if(_num<2.0){_height1=abs(heightArr1[0])*255.0;_height2=abs(heightArr1[1])*255.0;}else if(_num<3.0){_height1=abs(heightArr1[1])*255.0;_height2=abs(heightArr1[2])*255.0;}else if(_num<4.0){_height1=abs(heightArr1[2])*255.0;_height2=abs(heightArr1[3])*255.0;}else if(_num<5.0){_height1=abs(heightArr1[3])*255.0;_height2=abs(heightArr2[0])*255.0;}else if(_num<6.0){_height1=abs(heightArr2[0])*255.0;_height2=abs(heightArr2[1])*255.0;}else if(_num<7.0){_height1=abs(heightArr2[1])*255.0;_height2=abs(heightArr2[2])*255.0;}else if(_num<8.0){_height1=abs(heightArr2[2])*255.0;_height2=abs(heightArr2[3])*255.0;}else if(_num<9.0){_height1=abs(heightArr2[3])*255.0;_height2=abs(heightArr3[0])*255.0;}else if(_num<10.0){_height1=abs(heightArr3[0])*255.0;_height2=abs(heightArr3[1])*255.0;}else if(_num<11.0){_height1=abs(heightArr3[1])*255.0;_height2=abs(heightArr3[2])*255.0;}else if(_num<12.0){_height1=abs(heightArr3[2])*255.0;_height2=abs(heightArr3[3])*255.0;}_height=20.0+(_height1+(_height2-_height1)/500.0*mod(abs(u_dyn_count),500.0))*1.0;vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t>0.0 ? _height : base,1);if(t>0.0){v_opacity=1.2;v_height=_height*3.0;}else{v_opacity=0.1;v_height=0.0;}float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if(normal.y!=0.0){directional*=clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0);}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_directional=directional;}")},gltfModel:{fragmentSource:xt("struct Light{vec4 color;};varying vec3 var_color;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;varying vec3 v_clamp_show;varying highp float v_heatmap_cl;varying vec3 v_pos;uniform bool u_r_heatmap;uniform lowp float u_h_heatmap;uniform bool u_bgr2rgb;uniform highp vec2 u_x_clamp_range;uniform highp vec2 u_y_clamp_range;uniform highp vec2 u_z_clamp_range;uniform highp vec4 u_clamp_plane;uniform highp vec3 u_clamp_box;uniform float u_clamp_box_inner;uniform mat4 u_clamp_matrix;uniform sampler2D u_BaseColorSampler;uniform bool u_use_text;uniform vec4 u_fill_color;uniform bool u_hightlight;uniform lowp float u_clamp_ratio;uniform bool u_flow_text;uniform highp float u_flow_text_off;uniform bool u_with_light;uniform vec3 u_lightcolor;uniform vec3 u_light;uniform Light u_specialcolor[10];uniform int u_specialindex;float isDiscard(vec3 pos,vec4 plane){float n=0.0;if((plane.x*pos.x+plane.y*pos.y+plane.z*pos.z+plane.w)<0.0){n=1.0;}else{n=0.0;}return n;}vec4 highligh_color=vec4(1.0,0.2,0.1,1.0);vec4 color1=vec4(0.5294117647058824,0.807843137254902,0.9215686274509803,0.8);vec4 color2=vec4(0.,1.,0.4980392156862745,0.8);vec4 color3=vec4(1.,1.,0.,0.8);vec4 color4=vec4(1.,0.1,0.,0.8);void main(){if(u_clamp_ratio==1.0){if(isDiscard(v_pos,u_clamp_plane)==1.0){discard;};vec4 invertBoxPos=u_clamp_matrix*vec4(v_pos,1);if(u_clamp_box_inner==1.0){if((invertBoxPos.x<u_clamp_box.x/2.0&&invertBoxPos.x>-u_clamp_box.x/2.0)&&(invertBoxPos.y<u_clamp_box.y/2.0&&invertBoxPos.y>-u_clamp_box.y/2.0)&&(invertBoxPos.z<u_clamp_box.z/2.0&&invertBoxPos.z>-u_clamp_box.z/2.0)){discard;}}else{if(invertBoxPos.x<-u_clamp_box.x/2.0||invertBoxPos.x>u_clamp_box.x/2.0||invertBoxPos.y<-u_clamp_box.y/2.0||invertBoxPos.y>u_clamp_box.y/2.0||invertBoxPos.z<-u_clamp_box.z/2.0||invertBoxPos.z>u_clamp_box.z/2.0){discard;}}if(v_clamp_show.x<u_x_clamp_range.x||v_clamp_show.x>u_x_clamp_range.y||v_clamp_show.y<u_y_clamp_range.x||v_clamp_show.y>u_y_clamp_range.y||v_clamp_show.z<u_z_clamp_range.x||v_clamp_show.z>u_z_clamp_range.y){discard;}}float out_opacity=0.;vec4 t_color=vec4(1.);if(u_use_text){if(u_flow_text){t_color=texture2D(u_BaseColorSampler,v_coord+vec2(u_flow_text_off,0.));}else{t_color=texture2D(u_BaseColorSampler,v_coord);}out_opacity=u_fill_color.a*t_color.a;if(out_opacity==0.){discard;}}else{t_color=u_fill_color;out_opacity=u_fill_color.a;}if(u_hightlight){for(int i=0;i<10;i++){if(i==u_specialindex){t_color=mix(t_color,u_specialcolor[i].color,0.4);}}}if(u_r_heatmap){if(v_heatmap_cl<u_h_heatmap/3.0){gl_FragColor=mix(color1,color2,clamp((v_heatmap_cl)/u_h_heatmap*3.0,0.,1.0));}else if(v_heatmap_cl<u_h_heatmap/3.0*2.0){gl_FragColor=mix(color2,color3,(v_heatmap_cl-u_h_heatmap/3.0)/u_h_heatmap*3.0);}else{gl_FragColor=mix(color3,color4,(v_heatmap_cl-u_h_heatmap/3.0*2.0)/u_h_heatmap*3.0);}}else{if(u_with_light){vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);if(u_use_text){vec3 h_color=vec3(t_color.r*u_fill_color.r,t_color.g*u_fill_color.g,t_color.b*u_fill_color.b);vec3 diffuse=u_lightcolor*h_color.rgb*nDotL;vec3 ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*h_color.rgb;gl_FragColor=vec4((diffuse+ambient),out_opacity);}else{vec3 diffuse=u_lightcolor*t_color.rgb*nDotL;vec3 ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*t_color.rgb;gl_FragColor=vec4((diffuse+ambient),out_opacity);}}else{if(u_use_text){if(u_bgr2rgb){gl_FragColor=vec4(t_color.b*u_fill_color.r,t_color.g*u_fill_color.g,t_color.r*u_fill_color.b,out_opacity);}else{gl_FragColor=vec4(t_color.r*u_fill_color.r,t_color.g*u_fill_color.g,t_color.b*u_fill_color.b,out_opacity);}}else{gl_FragColor=t_color;}}}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform mat4 u_model_matrix;uniform mat4 u_clamp_model_matrix;uniform mat4 u_normal;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;attribute vec4 a_TANGENT;uniform bool u_morph_weight;uniform lowp float u_target_length;attribute vec3 a_POSITION_1;attribute vec3 a_POSITION_2;attribute vec3 a_POSITION_3;attribute vec3 a_POSITION_4;attribute vec3 a_POSITION_5;attribute vec3 a_POSITION_6;attribute vec3 a_POSITION_7;attribute vec3 a_POSITION_8;uniform lowp float u_weight0;uniform lowp float u_weight1;uniform lowp float u_weight2;uniform lowp float u_weight3;uniform lowp float u_weight4;uniform lowp float u_weight5;uniform lowp float u_weight6;uniform lowp float u_weight7;uniform lowp float u_clamp_ratio;uniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;uniform bool u_r_heatmap;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;varying vec3 v_clamp_show;varying vec3 v_pos;varying highp float v_heatmap_cl;void main(){if(u_morph_weight){vec3 pos=a_POSITION+a_POSITION_1*u_weight0+a_POSITION_2*u_weight1+a_POSITION_3*u_weight2+a_POSITION_4*u_weight3+a_POSITION_5*u_weight4+a_POSITION_6*u_weight5+a_POSITION_7*u_weight6+a_POSITION_8*u_weight7;gl_Position=u_matrix*vec4(pos,1);v_normal=normalize(vec3(u_normal*a_NORMAL));if(u_r_heatmap){v_heatmap_cl=pos[1];}}else{gl_Position=u_matrix*vec4(a_POSITION,1);v_normal=normalize(vec3(u_normal*a_NORMAL));}vec4 pos=u_clamp_model_matrix*vec4(a_POSITION,1);v_pos=pos.xyz;v_coord=a_TEXCOORD_0;if(u_clamp_ratio==1.0){v_clamp_show=vec3((a_POSITION.x-u_min_clamp_bounds.x)/(u_max_clamp_bounds.x-u_min_clamp_bounds.x),(a_POSITION.y-u_min_clamp_bounds.y)/(u_max_clamp_bounds.y-u_min_clamp_bounds.y),(a_POSITION.z-u_min_clamp_bounds.z)/(u_max_clamp_bounds.z-u_min_clamp_bounds.z));}}")},gltfTile:{fragmentSource:xt("struct VideoStruct{bool use;highp vec3 planeP1P2;highp vec3 planeP2P3;highp vec3 planeP3P4;highp vec3 planeP4P1;highp vec3 p1;highp vec3 p2;highp vec3 p3;highp vec3 p4;highp vec2 d1Sqrt;highp vec2 d2Sqrt;highp vec2 d3Sqrt;highp vec2 d4Sqrt;lowp vec4 offset;};varying vec3 var_color;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;varying vec3 v_clamp_show;varying highp float v_heatmap_cl;varying vec3 v_pos;uniform bool u_bgr2rgb;uniform VideoStruct u_vs;uniform sampler2D u_video_sampler;uniform vec3 u_lightcolor;uniform vec3 u_light;uniform highp vec2 u_x_clamp_range;uniform highp vec2 u_y_clamp_range;uniform highp vec2 u_z_clamp_range;uniform highp vec4 u_clamp_plane;uniform highp vec3 u_clamp_box;uniform float u_clamp_box_inner;uniform mat4 u_clamp_matrix;uniform sampler2D u_BaseColorSampler;uniform bool u_use_text;uniform vec4 u_fill_color;uniform bool u_hightlight;uniform lowp float u_clamp_ratio;varying highp vec2 v_uv_for_video;float isDiscard(vec3 pos,vec4 plane){float n=0.0;if((plane.x*pos.x+plane.y*pos.y+plane.z*pos.z+plane.w)<0.0){n=1.0;}else{n=0.0;}return n;}vec4 highligh_color=vec4(1.0,0.2,0.1,1.0);void main(){if(u_clamp_ratio==1.0){if(isDiscard(v_pos,u_clamp_plane)==1.0){discard;};vec4 invertBoxPos=u_clamp_matrix*vec4(v_pos,1);if(u_clamp_box_inner==1.0){if((invertBoxPos.x<u_clamp_box.x/2.0&&invertBoxPos.x>-u_clamp_box.x/2.0)&&(invertBoxPos.y<u_clamp_box.y/2.0&&invertBoxPos.y>-u_clamp_box.y/2.0)&&(invertBoxPos.z<u_clamp_box.z/2.0&&invertBoxPos.z>-u_clamp_box.z/2.0)){discard;}}else{if(invertBoxPos.x<-u_clamp_box.x/2.0||invertBoxPos.x>u_clamp_box.x/2.0||invertBoxPos.y<-u_clamp_box.y/2.0||invertBoxPos.y>u_clamp_box.y/2.0||invertBoxPos.z<-u_clamp_box.z/2.0||invertBoxPos.z>u_clamp_box.z/2.0){discard;}}if(v_clamp_show.x<u_x_clamp_range.x||v_clamp_show.x>u_x_clamp_range.y||v_clamp_show.y<u_y_clamp_range.x||v_clamp_show.y>u_y_clamp_range.y||v_clamp_show.z<u_z_clamp_range.x||v_clamp_show.z>u_z_clamp_range.y){discard;}}float out_opacity=1.;vec4 t_color=vec4(1.);if(u_use_text){bool use_video=false;if(v_uv_for_video.s>u_vs.offset.w&&v_uv_for_video.s<(1.-u_vs.offset.y)&&v_uv_for_video.t>u_vs.offset.x&&v_uv_for_video.t<(1.-u_vs.offset.z)){use_video=true;}if(use_video){t_color=texture2D(u_video_sampler,v_uv_for_video);}else{t_color=texture2D(u_BaseColorSampler,v_coord);}out_opacity=u_fill_color.a*t_color.a;}else{t_color=u_fill_color;out_opacity=u_fill_color.a;}if(u_hightlight){t_color=mix(t_color,highligh_color,0.4);}if(u_use_text){if(u_bgr2rgb){gl_FragColor=vec4(t_color.b*u_fill_color.r,t_color.g*u_fill_color.g,t_color.r*u_fill_color.b,out_opacity);}else{gl_FragColor=vec4(t_color.r*u_fill_color.r,t_color.g*u_fill_color.g,t_color.b*u_fill_color.b,out_opacity);}}else{vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=u_lightcolor*t_color.rgb*nDotL;vec3 ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*t_color.rgb;gl_FragColor=vec4((diffuse+ambient),out_opacity);}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("struct VideoStruct{bool use;highp vec3 planeP1P2;highp vec3 planeP2P3;highp vec3 planeP3P4;highp vec3 planeP4P1;highp vec3 p1;highp vec3 p2;highp vec3 p3;highp vec3 p4;highp vec2 d1Sqrt;highp vec2 d2Sqrt;highp vec2 d3Sqrt;highp vec2 d4Sqrt;lowp vec4 offset;};uniform mat4 u_matrix;uniform mat4 u_model_matrix;uniform mat4 u_clamp_model_matrix;uniform mat4 u_normal;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;attribute vec4 a_TANGENT;attribute vec3 a_POSITION_1;attribute vec4 a_NORMAL_1;attribute vec4 a_TANGENT_1;attribute vec3 a_POSITION_2;attribute vec4 a_NORMAL_2;attribute vec4 a_TANGENT_2;uniform lowp float u_clamp_ratio;uniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;uniform VideoStruct u_vs;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;varying vec3 v_clamp_show;varying vec3 v_pos;varying highp float v_heatmap_cl;varying highp vec2 v_uv_for_video;highp vec2 getVideoST(highp vec3 p){highp vec2 st=vec2(0.);highp float lp1p2=abs(u_vs.planeP1P2.x*p.x+u_vs.planeP1P2.y*p.y+u_vs.planeP1P2.z*p.z+u_vs.d1Sqrt.x)/u_vs.d1Sqrt.y;highp float lp2p3=abs(u_vs.planeP2P3.x*p.x+u_vs.planeP2P3.y*p.y+u_vs.planeP2P3.z*p.z+u_vs.d2Sqrt.x)/u_vs.d2Sqrt.y;highp float lp3p4=abs(u_vs.planeP3P4.x*p.x+u_vs.planeP3P4.y*p.y+u_vs.planeP3P4.z*p.z+u_vs.d3Sqrt.x)/u_vs.d3Sqrt.y;highp float lp4p1=abs(u_vs.planeP4P1.x*p.x+u_vs.planeP4P1.y*p.y+u_vs.planeP4P1.z*p.z+u_vs.d4Sqrt.x)/u_vs.d4Sqrt.y;highp float theta1=dot(vec3(p.x-u_vs.p1.x,p.y-u_vs.p1.y,p.z-u_vs.p1.z),u_vs.planeP1P2);highp float theta2=dot(vec3(p.x-u_vs.p2.x,p.y-u_vs.p2.y,p.z-u_vs.p2.z),u_vs.planeP2P3);highp float theta3=dot(vec3(p.x-u_vs.p3.x,p.y-u_vs.p3.y,p.z-u_vs.p3.z),u_vs.planeP3P4);highp float theta4=dot(vec3(p.x-u_vs.p4.x,p.y-u_vs.p4.y,p.z-u_vs.p4.z),u_vs.planeP4P1);if(theta1<0.0){lp1p2=-lp1p2;}if(theta2<0.0){lp2p3=-lp2p3;}if(theta3<0.0){lp3p4=-lp3p4;}if(theta4<0.0){lp4p1=-lp4p1;}highp vec2 result=vec2(lp4p1/(lp4p1+lp2p3),lp1p2/(lp1p2+lp3p4));return result;}void main(){if(u_vs.use){highp vec4 spacePos=u_model_matrix*vec4(a_POSITION,1);v_uv_for_video=getVideoST(spacePos.xyz);}gl_Position=u_matrix*vec4(a_POSITION,1);v_normal=normalize(vec3(u_normal*a_NORMAL));vec4 pos=u_clamp_model_matrix*vec4(a_POSITION,1);v_pos=pos.xyz;v_coord=a_TEXCOORD_0;if(u_clamp_ratio==1.0){v_clamp_show=vec3((a_POSITION.x-u_min_clamp_bounds.x)/(u_max_clamp_bounds.x-u_min_clamp_bounds.x),(a_POSITION.y-u_min_clamp_bounds.y)/(u_max_clamp_bounds.y-u_min_clamp_bounds.y),(a_POSITION.z-u_min_clamp_bounds.z)/(u_max_clamp_bounds.z-u_min_clamp_bounds.z));}}")},gltfModelCameraView:{fragmentSource:xt("varying vec3 var_color;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;varying vec3 v_clamp_show;varying vec4 v_viewshed_pos[VIEWSHED_COUNT];varying vec4 v_view_spacepos[VIEWSHED_COUNT];varying vec3 v_pos;uniform highp vec2 u_x_clamp_range;uniform highp vec2 u_y_clamp_range;uniform highp vec2 u_z_clamp_range;uniform highp vec4 u_clamp_plane;uniform highp vec3 u_clamp_box;uniform float u_clamp_box_inner;uniform mat4 u_clamp_matrix;uniform sampler2D u_BaseColorSampler;uniform bool u_use_text;uniform vec4 u_fill_color;uniform bool u_hightlight;uniform lowp float u_clamp_ratio;uniform bool u_with_light;uniform vec3 u_lightcolor;uniform vec3 u_light;uniform bool u_with_shadow;uniform sampler2D u_shadow_sampler;uniform lowp float u_viewshed_count;uniform sampler2D u_viewshed_samp0;uniform highp float u_viewshed_dist0;uniform bool u_viewshed_used0;uniform vec3 u_viewshed_eye0;uniform highp float u_shadow_off;uniform bool u_bgr2rgb;float isDiscard(vec3 pos,vec4 plane){float n=0.0;if((plane.x*pos.x+plane.y*pos.y+plane.z*pos.z+plane.w)<0.0){n=1.0;}else{n=0.0;}return n;}vec4 highligh_color=vec4(1.0,0.2,0.1,1.0);float getAmountInLight(sampler2D sampler,vec3 shadowCoord){float amountInLight=0.0;vec4 rgbaDepth=texture2D(sampler,shadowCoord.xy);float depth=decodeFloat(rgbaDepth);if(shadowCoord.z-u_shadow_off>depth){amountInLight=1.0;}return amountInLight;}vec3 getViewshedColor(){vec3 viewshed_color=vec3(0.0);if(u_viewshed_used0){vec3 my_eye=vec3(0.);float my_dist=0.0;vec4 my_pos=vec4(1.0);vec4 my_spacepos=vec4(1.0);my_eye=u_viewshed_eye0;my_dist=u_viewshed_dist0;my_pos=v_viewshed_pos[0];my_spacepos=v_view_spacepos[0];if(distance(my_spacepos.xyz,my_eye)<=my_dist){vec3 shadowCoord=(my_pos.xyz/my_pos.w)/2.0+0.5;if(!(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.||shadowCoord.z>1.)){float ail=getAmountInLight(u_viewshed_samp0,shadowCoord);if(ail==0.0){viewshed_color=vec3(0.,0.3,0.);}else{viewshed_color=vec3(0.3,0.,0.);}}}}return viewshed_color;}void main(){float amountInLight=0.;if(u_clamp_ratio==1.0){if(isDiscard(v_pos,u_clamp_plane)==1.0){discard;};vec4 invertBoxPos=u_clamp_matrix*vec4(v_pos,1);if(u_clamp_box_inner==1.0){if((invertBoxPos.x<u_clamp_box.x/2.0&&invertBoxPos.x>-u_clamp_box.x/2.0)&&(invertBoxPos.y<u_clamp_box.y/2.0&&invertBoxPos.y>-u_clamp_box.y/2.0)&&(invertBoxPos.z<u_clamp_box.z/2.0&&invertBoxPos.z>-u_clamp_box.z/2.0)){discard;}}else{if(invertBoxPos.x<-u_clamp_box.x/2.0||invertBoxPos.x>u_clamp_box.x/2.0||invertBoxPos.y<-u_clamp_box.y/2.0||invertBoxPos.y>u_clamp_box.y/2.0||invertBoxPos.z<-u_clamp_box.z/2.0||invertBoxPos.z>u_clamp_box.z/2.0){discard;}}if(v_clamp_show.x<u_x_clamp_range.x||v_clamp_show.x>u_x_clamp_range.y||v_clamp_show.y<u_y_clamp_range.x||v_clamp_show.y>u_y_clamp_range.y||v_clamp_show.z<u_z_clamp_range.x||v_clamp_show.z>u_z_clamp_range.y){discard;}}float out_opacity=1.;vec4 t_color=vec4(1.);if(u_use_text){t_color=texture2D(u_BaseColorSampler,v_coord);out_opacity=t_color.a;if(out_opacity==0.){discard;}}else{t_color=u_fill_color;out_opacity=u_fill_color.a;}if(u_hightlight){t_color=mix(t_color,highligh_color,0.4);}vec3 viewshed_color=vec3(0.0);if(u_viewshed_count>0.){viewshed_color=getViewshedColor();}if(u_with_light){vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);vec3 diffuse=vec3(0.0);vec3 ambient=vec3(0.0);if(u_use_text){vec3 h_color=vec3(t_color.r*u_fill_color.r,t_color.g*u_fill_color.g,t_color.b*u_fill_color.b);diffuse=u_lightcolor*h_color.rgb*nDotL;ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*h_color.rgb;}else{diffuse=u_lightcolor*u_fill_color.rgb*nDotL;ambient=vec3(AMBIENT_STRENGTH,AMBIENT_STRENGTH,AMBIENT_STRENGTH)*u_fill_color.rgb;}if(u_with_shadow){vec3 shadowCoord=(v_pos_from_light.xyz/v_pos_from_light.w)/2.0+0.5;if(shadowCoord.x<=0.||shadowCoord.y<=0.||shadowCoord.x>=1.||shadowCoord.y>=1.){gl_FragColor=vec4(diffuse+ambient+viewshed_color,out_opacity);}else{amountInLight=getAmountInLight(u_shadow_sampler,shadowCoord);gl_FragColor=vec4((diffuse+ambient)*(1.-amountInLight*0.5)+viewshed_color,out_opacity);}}else{gl_FragColor=vec4(diffuse+ambient+viewshed_color,out_opacity);}}else{if(u_use_text){if(u_bgr2rgb){gl_FragColor=vec4(vec3(t_color.b*u_fill_color.r,t_color.g*u_fill_color.g,t_color.r*u_fill_color.b)+viewshed_color,out_opacity);}else{gl_FragColor=vec4(vec3(t_color.r*u_fill_color.r,t_color.g*u_fill_color.g,t_color.b*u_fill_color.b)+viewshed_color,out_opacity);}}else{gl_FragColor=vec4(t_color.rgb+viewshed_color,t_color.a);}}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform mat4 u_sun_matrix;uniform mat4 u_viewshed_mat0;uniform mat4 u_clamp_model_matrix;uniform mat4 u_model_matrix;uniform bool u_viewshed_used0;uniform bool u_with_shadow;uniform mat4 u_normal;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;attribute vec4 a_TANGENT;uniform bool u_morph_weight;uniform lowp float u_target_length;uniform vec2 u_weight;attribute vec3 a_POSITION_1;attribute vec4 a_NORMAL_1;attribute vec4 a_TANGENT_1;attribute vec3 a_POSITION_2;attribute vec4 a_NORMAL_2;attribute vec4 a_TANGENT_2;uniform lowp float u_clamp_ratio;uniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;varying vec3 v_clamp_show;varying vec3 v_pos;varying vec4 v_viewshed_pos[VIEWSHED_COUNT];varying vec4 v_view_spacepos[VIEWSHED_COUNT];void main(){if(u_morph_weight){if(u_target_length==1.0){gl_Position=u_matrix*vec4(a_POSITION+a_POSITION_1*u_weight[0],1);v_normal=normalize(vec3(u_normal*(a_NORMAL+a_NORMAL_1*u_weight[0])));}else if(u_target_length==2.0){gl_Position=u_matrix*vec4(a_POSITION+a_POSITION_1*u_weight[0]+a_POSITION_2*u_weight[1],1);v_normal=normalize(vec3(u_normal*(a_NORMAL+a_NORMAL_1*u_weight[0]+a_NORMAL_2*u_weight[1])));}}else{gl_Position=u_matrix*vec4(a_POSITION,1);v_normal=normalize(vec3(u_normal*a_NORMAL));}v_coord=a_TEXCOORD_0;if(u_with_shadow){v_pos_from_light=u_sun_matrix*vec4(a_POSITION,1.);}if(u_viewshed_used0){v_viewshed_pos[0]=u_viewshed_mat0*vec4(a_POSITION,1.);v_view_spacepos[0]=u_model_matrix*vec4(a_POSITION,1.);}vec4 pos=u_clamp_model_matrix*vec4(a_POSITION,1);v_pos=pos.xyz;if(u_clamp_ratio==1.0){v_clamp_show=vec3((a_POSITION.x-u_min_clamp_bounds.x)/(u_max_clamp_bounds.x-u_min_clamp_bounds.x),(a_POSITION.y-u_min_clamp_bounds.y)/(u_max_clamp_bounds.y-u_min_clamp_bounds.y),(a_POSITION.z-u_min_clamp_bounds.z)/(u_max_clamp_bounds.z-u_min_clamp_bounds.z));}}")},gltfSkin:{fragmentSource:xt("varying vec3 v_normal;varying vec2 v_coord;uniform vec4 u_ambient;uniform vec4 u_diffuse;uniform vec4 u_emission;uniform sampler2D u_texture;void main(void){vec3 normal=normalize(v_normal);if(gl_FrontFacing==false)normal=-normal;vec4 color=texture2D(u_texture,v_coord);vec4 diffuse=vec4(0.,0.,0.,1.);vec4 emission;vec4 ambient;ambient=u_ambient;diffuse=u_diffuse;emission=u_emission;diffuse.xyz*=max(dot(normal,vec3(0.,0.,1.)),0.);color.xyz+=diffuse.xyz;color.xyz+=emission.xyz;color=vec4(color.rgb*diffuse.a,diffuse.a);gl_FragColor=color;}"),vertexSource:xt("attribute vec3 a_position;attribute vec3 a_normal;varying vec3 v_normal;attribute vec4 a_joint;attribute vec4 a_weight;uniform mat4 u_jointMat[16];uniform mat3 u_normal;uniform mat4 u_matrix;void main(void){mat4 skinMat=a_weight.x*u_jointMat[int(a_joint.x)];skinMat+=a_weight.y*u_jointMat[int(a_joint.y)];skinMat+=a_weight.z*u_jointMat[int(a_joint.z)];skinMat+=a_weight.w*u_jointMat[int(a_joint.w)];v_normal=u_normal*mat3(skinMat)*a_normal;gl_Position=u_matrix*skinMat*vec4(a_position,1.0);}")},gltfShadowEncode:{fragmentSource:xt("varying vec3 v_pos;varying vec2 v_coord;varying vec3 v_clamp_show;uniform highp vec2 u_x_clamp_range;uniform highp vec2 u_y_clamp_range;uniform highp vec2 u_z_clamp_range;uniform highp vec4 u_clamp_plane;uniform highp vec3 u_clamp_box;uniform float u_clamp_box_inner;uniform mat4 u_clamp_matrix;uniform sampler2D u_BaseColorSampler;uniform lowp float u_clamp_ratio;uniform float u_depth_range_max;float isDiscard(vec3 pos,vec4 plane){float n=0.0;if((plane.x*pos.x+plane.y*pos.y+plane.z*pos.z+plane.w)<0.0){n=1.0;}else{n=0.0;}return n;}void main(){if(u_clamp_ratio==1.0){if(isDiscard(v_pos,u_clamp_plane)==1.0){discard;};vec4 invertBoxPos=u_clamp_matrix*vec4(v_pos,1);if(u_clamp_box_inner==1.0){if((invertBoxPos.x<u_clamp_box.x/2.0&&invertBoxPos.x>-u_clamp_box.x/2.0)&&(invertBoxPos.y<u_clamp_box.y/2.0&&invertBoxPos.y>-u_clamp_box.y/2.0)&&(invertBoxPos.z<u_clamp_box.z/2.0&&invertBoxPos.z>-u_clamp_box.z/2.0)){discard;}}else{if(invertBoxPos.x<-u_clamp_box.x/2.0||invertBoxPos.x>u_clamp_box.x/2.0||invertBoxPos.y<-u_clamp_box.y/2.0||invertBoxPos.y>u_clamp_box.y/2.0||invertBoxPos.z<-u_clamp_box.z/2.0||invertBoxPos.z>u_clamp_box.z/2.0){discard;}}if(v_clamp_show.x<u_x_clamp_range.x||v_clamp_show.x>u_x_clamp_range.y||v_clamp_show.y<u_y_clamp_range.x||v_clamp_show.y>u_y_clamp_range.y||v_clamp_show.z<u_z_clamp_range.x||v_clamp_show.z>u_z_clamp_range.y){discard;}}vec4 t_color=texture2D(u_BaseColorSampler,v_coord);if(t_color.a==0.){discard;}gl_FragColor=encodeFloat(gl_FragCoord.z);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform mat4 u_normal;uniform mat4 u_clamp_model_matrix;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;attribute vec4 a_TANGENT;uniform lowp float u_clamp_ratio;uniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;uniform lowp float u_target_length;uniform vec2 u_weight;uniform bool u_morph_weight;attribute vec3 a_POSITION_1;attribute vec4 a_NORMAL_1;attribute vec4 a_TANGENT_1;attribute vec3 a_POSITION_2;attribute vec4 a_NORMAL_2;attribute vec4 a_TANGENT_2;varying vec2 v_coord;varying vec3 v_clamp_show;varying vec3 v_pos;void main(){if(u_morph_weight){if(u_target_length==1.0){gl_Position=u_matrix*vec4(a_POSITION+a_POSITION_1*u_weight[0],1);}else if(u_target_length==2.0){gl_Position=u_matrix*vec4(a_POSITION+a_POSITION_1*u_weight[0]+a_POSITION_2*u_weight[1],1);}}else{gl_Position=u_matrix*vec4(a_POSITION,1);}v_coord=a_TEXCOORD_0;vec4 pos=u_clamp_model_matrix*vec4(a_POSITION,1);v_pos=pos.xyz;if(u_clamp_ratio==1.0){v_clamp_show=vec3((a_POSITION.x-u_min_clamp_bounds.x)/(u_max_clamp_bounds.x-u_min_clamp_bounds.x),(a_POSITION.y-u_min_clamp_bounds.y)/(u_max_clamp_bounds.y-u_min_clamp_bounds.y),(a_POSITION.z-u_min_clamp_bounds.z)/(u_max_clamp_bounds.z-u_min_clamp_bounds.z));}}")},gltfSkinShadowEncode:{fragmentSource:xt("varying vec3 v_pos;varying vec2 v_coord;varying vec3 v_clamp_show;uniform highp vec2 u_x_clamp_range;uniform highp vec2 u_y_clamp_range;uniform highp vec2 u_z_clamp_range;uniform highp vec4 u_clamp_plane;uniform highp vec3 u_clamp_box;uniform float u_clamp_box_inner;uniform mat4 u_clamp_matrix;uniform sampler2D u_BaseColorSampler;uniform lowp float u_clamp_ratio;uniform float u_depth_range_max;float isDiscard(vec3 pos,vec4 plane){float n=0.0;if((plane.x*pos.x+plane.y*pos.y+plane.z*pos.z+plane.w)<0.0){n=1.0;}else{n=0.0;}return n;}void main(){if(u_clamp_ratio==1.0){if(isDiscard(v_pos,u_clamp_plane)==1.0){discard;};vec4 invertBoxPos=u_clamp_matrix*vec4(v_pos,1);if(u_clamp_box_inner==1.0){if((invertBoxPos.x<u_clamp_box.x/2.0&&invertBoxPos.x>-u_clamp_box.x/2.0)&&(invertBoxPos.y<u_clamp_box.y/2.0&&invertBoxPos.y>-u_clamp_box.y/2.0)&&(invertBoxPos.z<u_clamp_box.z/2.0&&invertBoxPos.z>-u_clamp_box.z/2.0)){discard;}}else{if(invertBoxPos.x<-u_clamp_box.x/2.0||invertBoxPos.x>u_clamp_box.x/2.0||invertBoxPos.y<-u_clamp_box.y/2.0||invertBoxPos.y>u_clamp_box.y/2.0||invertBoxPos.z<-u_clamp_box.z/2.0||invertBoxPos.z>u_clamp_box.z/2.0){discard;}}if(v_clamp_show.x<u_x_clamp_range.x||v_clamp_show.x>u_x_clamp_range.y||v_clamp_show.y<u_y_clamp_range.x||v_clamp_show.y>u_y_clamp_range.y||v_clamp_show.z<u_z_clamp_range.x||v_clamp_show.z>u_z_clamp_range.y){discard;}}vec4 t_color=texture2D(u_BaseColorSampler,v_coord);if(t_color.a==0.){discard;}gl_FragColor=encodeFloat(gl_FragCoord.z);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform mat4 u_normal;uniform mat4 u_clamp_model_matrix;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;attribute vec4 a_TANGENT;uniform lowp float u_clamp_ratio;uniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;varying vec2 v_coord;varying vec3 v_clamp_show;varying vec3 v_pos;void main(){gl_Position=u_matrix*vec4(a_POSITION,1);v_coord=a_TEXCOORD_0;vec4 pos=u_clamp_model_matrix*vec4(a_POSITION,1);v_pos=pos.xyz;if(u_clamp_ratio==1.0){v_clamp_show=vec3((a_POSITION.x-u_min_clamp_bounds.x)/(u_max_clamp_bounds.x-u_min_clamp_bounds.x),(a_POSITION.y-u_min_clamp_bounds.y)/(u_max_clamp_bounds.y-u_min_clamp_bounds.y),(a_POSITION.z-u_min_clamp_bounds.z)/(u_max_clamp_bounds.z-u_min_clamp_bounds.z));}}")},gltfLineModel:{fragmentSource:xt("precision mediump float;uniform sampler2D u_alphaMap;uniform bool u_useMap;uniform bool u_useAlphaMap;uniform bool u_useDash;uniform float u_dashArray;uniform float u_dashOffset;uniform float u_dashRatio;uniform float u_visibility;uniform float u_alphaTest;uniform vec2 u_repeat;varying vec4 v_Color;varying float v_Counters;varying vec3 var_color;varying vec2 v_coord;varying vec3 v_normal;uniform sampler2D u_BaseColorSampler;uniform bool u_use_text;uniform vec4 u_fill_color;uniform bool u_hightlight;uniform bool u_with_light;uniform vec3 u_lightcolor;uniform vec3 u_light;void main(){vec4 tempColor=v_Color;if(u_with_light){vec3 normal=normalize(v_normal);vec3 lightDirection=normalize(u_light);float nDotL=max(dot(lightDirection,normal),0.0);if(u_use_text){vec4 t_color=texture2D(u_BaseColorSampler,v_coord);if(t_color.a==0.){discard;}if(u_hightlight){t_color=mix(t_color,vec4(1.0,0.2,0.1,1.0),0.4);}vec3 h_color=vec3(t_color.r*u_fill_color.r,t_color.g*u_fill_color.g,t_color.b*u_fill_color.b);vec3 diffuse=u_lightcolor*h_color.rgb*nDotL;vec3 ambient=vec3(0.2,0.2,0.2)*h_color.rgb;gl_FragColor=vec4(diffuse+ambient,t_color.a);}else{gl_FragColor=u_fill_color;vec3 diffuse=u_lightcolor*u_fill_color.rgb*nDotL;vec3 ambient=vec3(0.2,0.2,0.2)*u_fill_color.rgb;gl_FragColor=vec4(diffuse+ambient,u_fill_color.a);}}else{if(u_use_text&&u_useMap){tempColor*=texture2D(u_BaseColorSampler,v_coord*u_repeat);}if(u_useAlphaMap){tempColor.a*=texture2D(u_alphaMap,v_coord*u_repeat).a;}if(tempColor.a<u_alphaTest)discard;if(u_hightlight){tempColor=mix(tempColor,vec4(1.0,0.2,0.1,1.0),0.4);}if(u_useDash){if((mod(v_Counters+u_dashOffset,u_dashArray)-(u_dashArray*u_dashRatio))>=0.0){discard;}}gl_FragColor=tempColor;if(u_visibility<1.&&step(v_Counters,u_visibility)==1.0){discard;}}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("precision highp float;uniform mat4 u_proj_matrix;uniform vec2 u_resolution;uniform float u_lineWidth;uniform vec3 u_color;uniform float u_opacity;uniform float u_sizeAttenuation;attribute vec3 a_PREVIOUS;attribute vec3 a_NEXT;attribute float a_SIDE;attribute float a_WIDTH;attribute float a_COUNTERS;varying vec4 v_Color;varying float v_Counters;uniform mat4 u_matrix;uniform mat4 u_normal;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;varying vec2 v_coord;varying vec3 v_normal;vec2 fix(vec4 i,float aspect){v_Counters=a_COUNTERS;vec2 res=i.xy/i.w;res.x*=aspect;return res;}void main(){float aspect=u_resolution.x/u_resolution.y;float pixelWidthRatio=1./(u_resolution.x*u_proj_matrix[0][0]);v_Color=vec4(u_color,u_opacity);mat4 m=u_matrix;vec4 finalPosition=m*vec4(a_POSITION,1.0);vec4 prevPos=m*vec4(a_PREVIOUS,1.0);vec4 nextPos=m*vec4(a_NEXT,1.0);vec2 currentP=fix(finalPosition,aspect);vec2 prevP=fix(prevPos,aspect);vec2 nextP=fix(nextPos,aspect);float pixelWidth=finalPosition.w*pixelWidthRatio;float w=1.8*pixelWidth*u_lineWidth*a_WIDTH;if(u_sizeAttenuation==1.){w=1.8*u_lineWidth*a_WIDTH;}vec2 dir;if(nextP==currentP)dir=normalize(currentP-prevP);else if(prevP==currentP)dir=normalize(nextP-currentP);else{vec2 dir1=normalize(currentP-prevP);vec2 dir2=normalize(nextP-currentP);dir=normalize(dir1+dir2);vec2 perp=vec2(-dir1.y,dir1.x);vec2 miter=vec2(-dir.y,dir.x);}vec2 normal=vec2(-dir.y,dir.x);normal.x/=aspect;normal*=.5*w;vec4 offset=vec4(normal*a_SIDE,0.0,1.0);finalPosition.xy+=offset.xy;gl_Position=finalPosition;v_coord=a_TEXCOORD_0;v_normal=normalize(vec3(u_normal*a_NORMAL));}")},gltfParticleModel:{fragmentSource:xt("precision mediump float;uniform vec4 uColor;uniform highp float uTime;varying float vLifetime;varying vec2 vTextureCoords;uniform sampler2D u_BaseColorSampler;void main(void){float time=mod(uTime,vLifetime);float percentOfLife=time/vLifetime;percentOfLife=clamp(percentOfLife,0.0,1.0);float offset=floor(16.0*percentOfLife);float offsetX=floor(mod(offset,4.0))/4.0;float offsetY=0.75-floor(offset/4.0)/4.0;vec4 texColor=texture2D(u_BaseColorSampler,vec2((vTextureCoords.x/4.0)+offsetX,(vTextureCoords.y/4.0)+offsetY));gl_FragColor=uColor*texColor;gl_FragColor.a*=vLifetime;}"),vertexSource:xt("uniform float uTime;uniform vec3 uFirePos;attribute float a_LIFETIMES;attribute vec2 a_TEXCOORDS;attribute vec2 a_TRICORNERS;attribute vec3 a_CENTEROFFSETS;attribute vec3 a_VELOCITIES;uniform mat4 u_matrix;uniform mat4 uViewMatrix;uniform bool uUseBillboarding;varying float vLifetime;varying vec2 vTextureCoords;void main(void){float time=mod(uTime,a_LIFETIMES);vec4 position=vec4(uFirePos+a_CENTEROFFSETS+(time*a_VELOCITIES),1.0);vLifetime=1.3-(time/a_LIFETIMES);vLifetime=clamp(vLifetime,0.0,1.0);float size=(vLifetime*vLifetime)*0.05;if(uUseBillboarding){vec3 cameraRight=vec3(uViewMatrix[0].x,uViewMatrix[1].x,uViewMatrix[2].x);vec3 cameraUp=vec3(uViewMatrix[0].y,uViewMatrix[1].y,uViewMatrix[2].y);position.xyz+=(cameraRight*a_TRICORNERS.x*size)+(cameraUp*a_TRICORNERS.y*size);}else{position.xy+=a_TRICORNERS.xy*size;}gl_Position=u_matrix*position;vTextureCoords=a_TEXCOORDS;vLifetime=a_LIFETIMES;}")},pointCloud:{fragmentSource:xt("varying vec4 col;varying vec3 fpos;void main(){gl_FragColor=col;}"),vertexSource:xt("attribute vec3 a_POSITION;attribute vec3 a_COLOR_0;attribute float a_INTENSITY;attribute float a_CLASSIFICATION;uniform mat4 u_matrix;uniform int u_mode;uniform float u_pointSize;uniform float u_opacity;uniform vec2 u_class_range;uniform vec2 u_z_range;uniform vec2 u_intensity_range;varying vec4 col;varying vec3 fpos;void main(){gl_Position=u_matrix*vec4(a_POSITION.x,a_POSITION.y,a_POSITION.z,1);vec3 color;if(u_mode==0){color=a_COLOR_0;}else if(u_mode==2){float i_height=(a_POSITION.z-u_z_range.x)/(u_z_range.y-u_z_range.x);color=vec3(i_height,i_height,i_height);}else if(u_mode==3){float i_class=(a_CLASSIFICATION-u_class_range.x)/(u_class_range.y-u_class_range.x);color=vec3(i_class,i_class,i_class);}else{float i_intensity=(a_INTENSITY-u_intensity_range.x)/(u_intensity_range.y-u_intensity_range.x);color=vec3(i_intensity,i_intensity,i_intensity);}gl_PointSize=u_pointSize;col=vec4(color,u_opacity);}")},airLine:{fragmentSource:xt("uniform sampler2D u_BaseColorSampler;uniform bool u_use_text;uniform bool u_hightlight;uniform sampler2D u_alphaMap;uniform bool u_useMap;uniform bool u_useAlphaMap;uniform bool u_useDash;uniform float u_dashArray;uniform float u_dashOffset;uniform float u_dashRatio;uniform float u_visibility;uniform float u_alphaTest;uniform vec2 u_repeat;uniform float u_count;uniform float u_segments;varying vec4 vColor;varying float vSeq;varying float vSide;varying float v_Counters;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;void main(){vec4 tempColor=vColor;if(u_use_text&&u_useMap){tempColor*=texture2D(u_BaseColorSampler,v_coord*u_repeat);}if(u_useAlphaMap){tempColor.a*=texture2D(u_alphaMap,v_coord*u_repeat).a;}if(tempColor.a<u_alphaTest)discard;if(u_hightlight){tempColor=mix(tempColor,vec4(1.0,0.2,0.1,1.0),0.4);}if(u_useDash){if((mod(v_Counters+u_dashOffset,u_dashArray)-(u_dashArray*u_dashRatio))>=0.0){discard;}}if(u_visibility<1.&&step(v_Counters,u_visibility)==1.0){discard;}float startSeq=u_count-u_segments;float endSeq=u_count;if(vSeq<startSeq||vSeq>endSeq){discard;}float drive_opacity=1.0;drive_opacity=(vSeq-startSeq)/u_segments;vec3 color1=tempColor.rgb+(1.0-abs(vSide))*vec3(0.2,0.2,0.2);gl_FragColor=vec4(color1.rgb,(1.0-abs(vSide))*drive_opacity)*tempColor.a;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("precision highp float;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;attribute vec3 a_PREVIOUS;attribute vec3 a_NEXT;attribute float a_SIDE;attribute float a_WIDTH;attribute float a_COUNTERS;attribute float a_SEQ;uniform mat4 u_proj_matrix;uniform vec2 u_resolution;uniform float u_lineWidth;uniform vec3 u_color;uniform float u_opacity;uniform float u_sizeAttenuation;uniform mat4 u_matrix;uniform mat4 u_cam_matrix;uniform mat4 u_normal;varying vec4 vColor;varying float v_Counters;varying float vSeq;varying float vSide;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;vec2 fix(vec4 i,float aspect){v_Counters=a_COUNTERS;vec2 res=i.xy/i.w;res.x*=aspect;return res;}void main(){float aspect=u_resolution.x/u_resolution.y;float pixelWidthRatio=1.0/(u_resolution.x*u_proj_matrix[0][0]);vColor=vec4(u_color,u_opacity);vSeq=a_SEQ;mat4 m=u_matrix;vec4 finalPosition=m*vec4(a_POSITION,1.0);vec4 prevPos=m*vec4(a_PREVIOUS,1.0);vec4 nextPos=m*vec4(a_NEXT,1.0);vec2 currentP=fix(finalPosition,aspect);vec2 prevP=fix(prevPos,aspect);vec2 nextP=fix(nextPos,aspect);float pixelWidth=finalPosition.w*pixelWidthRatio;float w=1.8*pixelWidth*u_lineWidth*a_WIDTH;if(u_sizeAttenuation==1.){w=1.8*u_lineWidth*a_WIDTH;}vec2 dir;if(nextP==currentP)dir=normalize(currentP-prevP);else if(prevP==currentP)dir=normalize(nextP-currentP);else{vec2 dir1=normalize(currentP-prevP);vec2 dir2=normalize(nextP-currentP);dir=normalize(dir1+dir2);vec2 perp=vec2(-dir1.y,dir1.x);vec2 miter=vec2(-dir.y,dir.x);}vec2 normal=vec2(-dir.y,dir.x);normal.x/=aspect;normal*=.5*w;vec4 offset=vec4(normal*a_SIDE,0.0,1.0);finalPosition.xy+=offset.xy;vSide=a_SIDE;gl_Position=finalPosition;v_coord=a_TEXCOORD_0;v_normal=normalize(vec3(u_normal*a_NORMAL));v_pos_from_light=u_cam_matrix*vec4(a_POSITION,1.);}")},fxaaFlsify:{fragmentSource:xt("uniform highp vec2 u_resolution;uniform sampler2D u_image;const float fxaaQualitySubpix=0.5;const float fxaaQualityEdgeThreshold=0.125;const float fxaaQualityEdgeThresholdMin=0.0833;varying vec2 v_coord;void main(){vec2 fxaaQualityRcpFrame=vec2(1.0)/u_resolution;vec4 color=FxaaPixelShader(v_coord,u_image,fxaaQualityRcpFrame,fxaaQualitySubpix,fxaaQualityEdgeThreshold,fxaaQualityEdgeThresholdMin);float alpha=texture2D(u_image,v_coord).a;gl_FragColor=vec4(color.rgb,alpha);}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;uniform highp vec2 u_resolution;varying vec2 v_coord;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_coord.x=a_pos.x;v_coord.y=1.0-a_pos.y;}")},bloomBrightFilter:{fragmentSource:xt("precision highp float;varying highp vec2 v_coord;uniform sampler2D u_image;void main(){vec4 c=texture2D(u_image,v_coord);float bright=(c.r*0.2126)+(c.g*0.7152)+(c.b*0.0722);gl_FragColor=(bright>0.5)? c : vec4(.0);}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_coord;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_coord.x=a_pos.x;v_coord.y=1.0-a_pos.y;}")},bloomBlur:{fragmentSource:xt("precision highp float;varying highp vec2 v_coord;uniform sampler2D u_image;uniform vec2 u_dir;uniform float u_kernel[12];uniform int u_kernelLen;uniform vec2 u_resolution;uniform float u_extent;vec4 FungiBlurx(sampler2D tex,vec2 uv,vec2 dir){vec2 pxSize=u_resolution*dir;vec4 c=vec4(0.0);c+=texture2D(tex,uv-pxSize*u_extent*4.)*0.000229;c+=texture2D(tex,uv-pxSize*u_extent*3.)*0.005977;c+=texture2D(tex,uv-pxSize*u_extent*2.)*0.060598;c+=texture2D(tex,uv-pxSize*u_extent*1.)*0.241732;c+=texture2D(tex,uv)*0.382928;c+=texture2D(tex,uv+pxSize*u_extent*1.)*0.241732;c+=texture2D(tex,uv+pxSize*u_extent*2.)*0.060598;c+=texture2D(tex,uv+pxSize*u_extent*3.)*0.005977;c+=texture2D(tex,uv+pxSize*u_extent*4.)*0.000229;return c;}void main(){gl_FragColor=FungiBlurx(u_image,v_coord,u_dir);}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_coord;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_coord.x=a_pos.x;v_coord.y=1.0-a_pos.y;}")},bloomBlend:{fragmentSource:xt("precision highp float;varying highp vec2 v_coord;uniform sampler2D u_base;uniform sampler2D u_over;const float u_overStrength=0.99;void main(){vec3 cBase=texture2D(u_base,v_coord).rgb;vec3 cOver=texture2D(u_over,v_coord).rgb;gl_FragColor=vec4(cBase+cOver*u_overStrength,1.0);/*https:float exposure=1.0;float gamma=2.2;vec3 blend=cBase+cOver*1.0;blend=vec3(1.0)-exp(-blend*exposure);blend=pow(blend,vec3(1.0/gamma));oFragColor=vec4(blend,1.0);*/}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_coord;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_coord.x=a_pos.x;v_coord.y=1.0-a_pos.y;}")},screen:{fragmentSource:xt("precision highp float;varying highp vec2 v_coord;uniform sampler2D u_image;void main(){gl_FragColor=texture2D(u_image,v_coord);}"),vertexSource:xt("uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_coord;void main(){gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_coord.x=a_pos.x;v_coord.y=1.0-a_pos.y;}")},specialLight:{fragmentSource:xt("struct Light{bool use;vec3 position;vec3 direction;float cutOff;float outerCutOff;vec3 ambient;vec3 diffuse;vec3 specular;float constant;float linear;float quadratic;float shininess;};uniform highp vec2 u_x_clamp_range;uniform highp vec2 u_y_clamp_range;uniform highp vec2 u_z_clamp_range;uniform highp vec4 u_clamp_plane;uniform highp vec3 u_clamp_box;uniform float u_clamp_box_inner;uniform mat4 u_clamp_matrix;uniform sampler2D u_BaseColorSampler;uniform bool u_use_text;uniform vec4 u_fill_color;uniform bool u_hightlight;uniform lowp float u_clamp_ratio;uniform bool u_with_light;uniform highp float u_shadow_off;uniform vec2 u_resolution;uniform Light u_light[50];uniform vec3 u_camera_pos;varying vec2 v_coord;varying vec3 v_normal;varying vec3 v_clamp_show;varying vec3 v_fragPos;varying vec3 v_pos;float isDiscard(vec3 pos,vec4 plane){float n=0.0;if((plane.x*pos.x+plane.y*pos.y+plane.z*pos.z+plane.w)<0.0){n=1.0;}else{n=0.0;}return n;}vec4 highligh_color=vec4(1.0,0.2,0.1,1.0);vec3 CalcPointLight(Light light,vec4 t_color){vec3 ambient=light.ambient*t_color.rgb;vec3 normal=normalize(v_normal);vec3 lightDir=normalize(light.position-v_fragPos);float nDotL=max(dot(lightDir,normal),0.0);vec3 diffuse=light.diffuse*t_color.rgb*nDotL;vec3 viewDir=normalize(u_camera_pos-v_fragPos);vec3 reflectDir=reflect(-lightDir,normal);float spec=pow(max(dot(viewDir,reflectDir),0.0),light.shininess);vec3 specular=light.specular*spec*t_color.rgb;float theta=dot(lightDir,normalize(light.direction));float epsilon=(light.cutOff-light.outerCutOff);float intensity=clamp((theta-light.outerCutOff)/epsilon,0.0,1.0);diffuse*=intensity;specular*=intensity;float distance=length(light.position-v_fragPos);float attenuation=1.0/(light.constant+light.linear*distance+light.quadratic*(distance*distance));ambient*=attenuation;diffuse*=attenuation;specular*=attenuation;return(ambient+diffuse+specular);}void main(){if(u_clamp_ratio==1.0){if(isDiscard(v_pos,u_clamp_plane)==1.0){discard;};vec4 invertBoxPos=u_clamp_matrix*vec4(v_pos,1);if(u_clamp_box_inner==1.0){if((invertBoxPos.x<u_clamp_box.x/2.0&&invertBoxPos.x>-u_clamp_box.x/2.0)&&(invertBoxPos.y<u_clamp_box.y/2.0&&invertBoxPos.y>-u_clamp_box.y/2.0)&&(invertBoxPos.z<u_clamp_box.z/2.0&&invertBoxPos.z>-u_clamp_box.z/2.0)){discard;}}else{if(invertBoxPos.x<-u_clamp_box.x/2.0||invertBoxPos.x>u_clamp_box.x/2.0||invertBoxPos.y<-u_clamp_box.y/2.0||invertBoxPos.y>u_clamp_box.y/2.0||invertBoxPos.z<-u_clamp_box.z/2.0||invertBoxPos.z>u_clamp_box.z/2.0){discard;}}if(v_clamp_show.x<u_x_clamp_range.x||v_clamp_show.x>u_x_clamp_range.y||v_clamp_show.y<u_y_clamp_range.x||v_clamp_show.y>u_y_clamp_range.y||v_clamp_show.z<u_z_clamp_range.x||v_clamp_show.z>u_z_clamp_range.y){discard;}}float out_opacity=1.;vec4 t_color=vec4(1.);if(u_use_text){t_color=texture2D(u_BaseColorSampler,v_coord)*u_fill_color;out_opacity=t_color.a;if(out_opacity==0.){discard;}}else{t_color=u_fill_color;out_opacity=u_fill_color.a;}if(u_hightlight){t_color=mix(t_color,highligh_color,0.4);}if(u_with_light){vec3 result=vec3(0.0,0.0,0.0);for(int i=0;i<100;i++){if(!u_light[i].use)break;result+=CalcPointLight(u_light[i],t_color);}gl_FragColor=vec4(result,out_opacity);}else{gl_FragColor=t_color;}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform mat4 u_normal;uniform mat4 u_clamp_model_matrix;attribute vec3 a_POSITION;attribute vec2 a_TEXCOORD_0;attribute vec4 a_NORMAL;attribute vec4 a_TANGENT;uniform bool u_morph_weight;uniform lowp float u_target_length;uniform vec2 u_weight;attribute vec3 a_POSITION_1;attribute vec4 a_NORMAL_1;attribute vec4 a_TANGENT_1;attribute vec3 a_POSITION_2;attribute vec4 a_NORMAL_2;attribute vec4 a_TANGENT_2;uniform lowp float u_clamp_ratio;uniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;uniform mat4 u_model_matrix;varying vec2 v_coord;varying vec3 v_normal;varying vec4 v_pos_from_light;varying vec3 v_clamp_show;varying vec3 v_fragPos;varying vec3 v_pos;void main(){if(u_morph_weight){if(u_target_length==1.0){gl_Position=u_matrix*vec4(a_POSITION+a_POSITION_1*u_weight[0],1);v_normal=normalize(vec3(u_normal*(a_NORMAL+a_NORMAL_1*u_weight[0])));}else if(u_target_length==2.0){gl_Position=u_matrix*vec4(a_POSITION+a_POSITION_1*u_weight[0]+a_POSITION_2*u_weight[1],1);v_normal=normalize(vec3(u_normal*(a_NORMAL+a_NORMAL_1*u_weight[0]+a_NORMAL_2*u_weight[1])));}}else{gl_Position=u_matrix*vec4(a_POSITION,1);v_normal=normalize(vec3(u_normal*a_NORMAL));}v_coord=a_TEXCOORD_0;v_fragPos=vec3(u_model_matrix*vec4(a_POSITION,1.0));vec4 pos=u_clamp_model_matrix*vec4(a_POSITION,1);v_pos=pos.xyz;if(u_clamp_ratio==1.0){v_clamp_show=vec3((a_POSITION.x-u_min_clamp_bounds.x)/(u_max_clamp_bounds.x-u_min_clamp_bounds.x),(a_POSITION.y-u_min_clamp_bounds.y)/(u_max_clamp_bounds.y-u_min_clamp_bounds.y),(a_POSITION.z-u_min_clamp_bounds.z)/(u_max_clamp_bounds.z-u_min_clamp_bounds.z));}}")},tdModelHeatmap:{fragmentSource:xt("varying highp float v_heatmap_cl;uniform lowp float u_h_heatmap;uniform sampler2D u_BaseColorSampler;uniform vec4 u_fill_color;vec4 highligh_color=vec4(1.0,0.2,0.1,1.0);vec4 u_color1=vec4(0.5294117647058824,0.807843137254902,0.9215686274509803,0.8);vec4 u_color2=vec4(0.,1.,0.4980392156862745,0.8);vec4 u_color3=vec4(1.,1.,0.,0.8);vec4 u_color4=vec4(1.,0.1,0.,0.8);void main(){if(v_heatmap_cl<=u_h_heatmap/3.0){vec4 c=mix(u_color1,u_color2,clamp((v_heatmap_cl)/u_h_heatmap*3.0,0.,1.0));gl_FragColor=vec4(c.xyz,c.z*v_heatmap_cl/(u_h_heatmap/3.0));}else if(v_heatmap_cl<=u_h_heatmap/3.0*2.0){gl_FragColor=mix(u_color2,u_color3,(v_heatmap_cl-u_h_heatmap/3.0)/u_h_heatmap*3.0);}else{gl_FragColor=mix(u_color3,u_color4,(v_heatmap_cl-u_h_heatmap/3.0*2.0)/u_h_heatmap*3.0);}\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;uniform mat4 u_model_matrix;uniform mat4 u_clamp_model_matrix;uniform mat4 u_normal;attribute vec3 a_POSITION;uniform highp float u_animate_pos;uniform highp float u_animate_seg_percent;uniform highp float u_height_scale;attribute vec3 a_POSITION_1;attribute vec3 a_POSITION_2;attribute vec3 a_POSITION_3;attribute vec3 a_POSITION_4;attribute vec3 a_POSITION_5;attribute vec3 a_POSITION_6;attribute vec3 a_POSITION_7;attribute vec3 a_POSITION_8;attribute vec3 a_POSITION_9;attribute vec3 a_POSITION_10;attribute vec3 a_POSITION_11;attribute vec3 a_POSITION_12;attribute vec3 a_POSITION_13;attribute vec3 a_POSITION_14;attribute vec3 a_POSITION_15;attribute vec3 a_POSITION_16;attribute vec3 a_POSITION_17;attribute vec3 a_POSITION_18;attribute vec3 a_POSITION_19;attribute vec3 a_POSITION_20;attribute vec3 a_POSITION_21;attribute vec3 a_POSITION_22;attribute vec3 a_POSITION_23;uniform lowp float u_clamp_ratio;uniform vec3 u_min_clamp_bounds;uniform vec3 u_max_clamp_bounds;varying highp float v_heatmap_cl;void main(){vec3 pos=vec3(1.0);if(u_animate_pos==0.0){pos=vec3(a_POSITION.x,a_POSITION.y*(1.-u_animate_seg_percent)+a_POSITION_1.y*u_animate_seg_percent,a_POSITION.z);}else if(u_animate_pos==1.0){pos=vec3(a_POSITION_1.x,a_POSITION_1.y*(1.-u_animate_seg_percent)+a_POSITION_2.y*u_animate_seg_percent,a_POSITION_1.z);}else if(u_animate_pos==2.0){pos=vec3(a_POSITION_2.x,a_POSITION_2.y*(1.-u_animate_seg_percent)+a_POSITION_3.y*u_animate_seg_percent,a_POSITION_2.z);}else if(u_animate_pos==3.0){pos=vec3(a_POSITION_3.x,a_POSITION_3.y*(1.-u_animate_seg_percent)+a_POSITION_4.y*u_animate_seg_percent,a_POSITION_3.z);}else if(u_animate_pos==4.0){pos=vec3(a_POSITION_4.x,a_POSITION_4.y*(1.-u_animate_seg_percent)+a_POSITION_5.y*u_animate_seg_percent,a_POSITION_4.z);}else if(u_animate_pos==5.0){pos=vec3(a_POSITION_5.x,a_POSITION_5.y*(1.-u_animate_seg_percent)+a_POSITION_6.y*u_animate_seg_percent,a_POSITION_5.z);}else if(u_animate_pos==6.0){pos=vec3(a_POSITION_6.x,a_POSITION_6.y*(1.-u_animate_seg_percent)+a_POSITION_7.y*u_animate_seg_percent,a_POSITION_6.z);}else if(u_animate_pos==7.0){pos=vec3(a_POSITION_7.x,a_POSITION_7.y*(1.-u_animate_seg_percent)+a_POSITION_8.y*u_animate_seg_percent,a_POSITION_7.z);}else if(u_animate_pos==8.0){pos=vec3(a_POSITION_8.x,a_POSITION_8.y*(1.-u_animate_seg_percent)+a_POSITION_9.y*u_animate_seg_percent,a_POSITION_8.z);}else if(u_animate_pos==9.0){pos=vec3(a_POSITION_9.x,a_POSITION_9.y*(1.-u_animate_seg_percent)+a_POSITION_10.y*u_animate_seg_percent,a_POSITION_9.z);}else if(u_animate_pos==10.0){pos=vec3(a_POSITION_10.x,a_POSITION_10.y*(1.-u_animate_seg_percent)+a_POSITION_11.y*u_animate_seg_percent,a_POSITION_10.z);}else if(u_animate_pos==11.0){pos=vec3(a_POSITION_11.x,a_POSITION_11.y*(1.-u_animate_seg_percent)+a_POSITION_12.y*u_animate_seg_percent,a_POSITION_11.z);}pos.y=pos.y*u_height_scale;gl_Position=u_matrix*vec4(pos,1);v_heatmap_cl=pos.y;}")},panorama:{fragmentSource:xt("uniform sampler2D u_normal_resolution;uniform sampler2D u_low_resolution;varying vec2 v_pos;void main(){vec4 calColor=texture2D(u_normal_resolution,vec2(1.0-v_pos.x,v_pos.y));gl_FragColor=calColor;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}"),vertexSource:xt("uniform mat4 u_matrix;attribute vec3 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main(){gl_Position=u_matrix*vec4(a_pos,1);v_pos=a_texture_pos;}")}},wt=/#pragma minemap: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,At=function(e){var t=bt[e],i={};t.fragmentSource=t.fragmentSource.replace(wt,function(e,t,a,o,r){return i[r]=!0,"define"===t?"\n#ifndef HAS_UNIFORM_u_"+r+"\nvarying "+a+" "+o+" "+r+";\n#else\nuniform "+a+" "+o+" u_"+r+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+r+"\n    "+a+" "+o+" "+r+" = u_"+r+";\n#endif\n"}),t.vertexSource=t.vertexSource.replace(wt,function(e,t,a,o,r){var n="float"===o?"vec2":"vec4";return i[r]?"define"===t?"\n#ifndef HAS_UNIFORM_u_"+r+"\nuniform lowp float a_"+r+"_t;\nattribute "+a+" "+n+" a_"+r+";\nvarying "+a+" "+o+" "+r+";\n#else\nuniform "+a+" "+o+" u_"+r+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+r+" = unpack_mix_"+n+"(a_"+r+", a_"+r+"_t);\n#else\n    "+a+" "+o+" "+r+" = u_"+r+";\n#endif\n":"define"===t?"\n#ifndef HAS_UNIFORM_u_"+r+"\nuniform lowp float a_"+r+"_t;\nattribute "+a+" "+n+" a_"+r+";\n#else\nuniform "+a+" "+o+" u_"+r+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+r+"\n    "+a+" "+o+" "+r+" = unpack_mix_"+n+"(a_"+r+", a_"+r+"_t);\n#else\n    "+a+" "+o+" "+r+" = u_"+r+";\n#endif\n"});};for(var Tt in bt)At(Tt);var Et=function(t,i,a,o){var r=t.gl;this.program=r.createProgram();var n=a.defines().concat("#define DEVICE_PIXEL_RATIO "+e.default.devicePixelRatio.toFixed(1)+" \r\n #define FXAA_QUALITY_PRESET 13");o&&n.push("#define OVERDRAW_INSPECTOR;");var s=n.concat(bt.prelude.fragmentSource,i.fragmentSource).join("\n"),l=n.concat(bt.prelude.vertexSource,i.vertexSource).join("\n"),u=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(u,s),r.compileShader(u),r.attachShader(this.program,u);var c=r.createShader(r.VERTEX_SHADER);r.shaderSource(c,l),r.compileShader(c),r.attachShader(this.program,c);for(var _=a.layoutAttributes||[],f=0;f<_.length;f++)r.bindAttribLocation(this.program,f,_[f].name);r.linkProgram(this.program),this.numAttributes=r.getProgramParameter(this.program,r.ACTIVE_ATTRIBUTES),this.attributes={},this.uniforms={};for(var m=0;m<this.numAttributes;m++){var p=r.getActiveAttrib(this.program,m);p&&(this.attributes[p.name]=r.getAttribLocation(this.program,p.name));}for(var h=r.getProgramParameter(this.program,r.ACTIVE_UNIFORMS),d=0;d<h;d++){var g=r.getActiveUniform(this.program,d);g&&(this.uniforms[g.name]=r.getUniformLocation(this.program,g.name));}};function Pt(t,i,a,o,r){for(var n=0;n<a.length;n++){var s=a[n];if(o.isLessThan(s.tileID))break;if(i.key===s.tileID.key)return;if(s.tileID.isChildOf(i)){for(var l=i.children(1/0),u=0;u<l.length;u++){Pt(t,l[u],a.slice(n),o,r);}return}}var c=i.overscaledZ-t.overscaledZ,_=new e.CanonicalTileID(c,i.canonical.x-(t.canonical.x<<c),i.canonical.y-(t.canonical.y<<c));r[_.key]=r[_.key]||_;}function St(t,i,a,o,r){var n=t.context,s=n.gl,l=r?t.useProgram("collisionCircle"):t.useProgram("collisionBox");n.setDepthMode(e.default$38.disabled),n.setStencilMode(e.default$39.disabled),n.setColorMode(t.colorModeForRenderPass());for(var u=0;u<o.length;u++){var c=o[u],_=i.getTile(c),f=_.getBucket(a);if(f){var m=r?f.collisionCircle:f.collisionBox;if(m){s.uniformMatrix4fv(l.uniforms.u_matrix,!1,c.posMatrix),s.uniform1f(l.uniforms.u_camera_to_center_distance,t.transform.cameraToCenterDistance);var p=Ve(_,1,t.transform.zoom),h=Math.pow(2,t.transform.zoom-_.tileID.overscaledZ);s.uniform1f(l.uniforms.u_pixels_to_tile_units,p),s.uniform2f(l.uniforms.u_extrude_scale,t.transform.pixelsToGLUnits[0]/(p*h),t.transform.pixelsToGLUnits[1]/(p*h)),s.uniform1f(l.uniforms.u_overscale_factor,_.tileID.overscaleFactor()),l.draw(n,r?s.TRIANGLES:s.LINES,a.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,null,m.collisionVertexBuffer,null);}}}}function It(e,t,i,a){St(e,t,i,a,!1),St(e,t,i,a,!0);}Et.prototype.draw=function(t,i,a,o,r,n,s,l,u){for(var c,_=t.gl,f=(c={},c[_.LINES]=2,c[_.TRIANGLES]=3,c)[i],m=0,p=n.get();m<p.length;m+=1){var h=p[m],d=h.vaos||(h.vaos={});(d[a]||(d[a]=new e.default$17)).bind(t,this,o,s?s.getPaintVertexBuffers():[],r,h.vertexOffset,l,u),_.drawElements(i,h.primitiveLength*f,_.UNSIGNED_SHORT,h.primitiveOffset*f*2);}};var Mt=e.identity(new Float32Array(16)),Rt=e.default$31.layout;function Ct(t,i,a,o,r,n,s,l,u,c){var _,f=t.context,m=f.gl,p=t.transform,h="map"===l,d="map"===u,g=h&&"point"!==a.layout.get("symbol-placement"),v=h&&!d&&!g;if(a.paint.get("render-3d"))m.enable(m.DEPTH_TEST);else{var y=d;f.setDepthMode(y?t.depthModeForSublayer(0,e.default$38.ReadOnly):e.default$38.disabled);}for(var x=0,b=o;x<b.length;x+=1){var w=b[x],A=i.getTile(w),T=A.getBucket(a);if(T){var E=r?T.text:T.icon;if(E&&E.segments.get().length){var P=E.programConfigurations.get(a.id),S=r||T.sdfIcons,I=r?T.textSizeData:T.iconSizeData;if(_||(_=t.useProgram(S?"symbolSDF":"symbolIcon",P),P.setUniforms(t.context,_,a.paint,{zoom:t.transform.zoom}),Ot(_,t,a,r,v,d,I)),f.activeTexture.set(m.TEXTURE0),m.uniform1i(_.uniforms.u_texture,0),r)A.glyphAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.uniform2fv(_.uniforms.u_texsize,A.glyphAtlasTexture.size);else{var M=1!==a.layout.get("icon-size").constantOr(0)||T.iconsNeedLinear,R=d||0!==p.pitch;A.iconAtlasTexture.bind(S||t.options.rotating||t.options.zooming||M||R?m.LINEAR:m.NEAREST,m.CLAMP_TO_EDGE),m.uniform2fv(_.uniforms.u_texsize,A.iconAtlasTexture.size);}m.uniformMatrix4fv(_.uniforms.u_matrix,!1,new Float32Array(t.translatePosMatrix(w.posMatrix,A,n,s)));var C=Ve(A,1,t.transform.zoom),O=Se(w.posMatrix,d,h,t.transform,C),F=Ie(w.posMatrix,d,h,t.transform,C);m.uniformMatrix4fv(_.uniforms.u_gl_coord_matrix,!1,new Float32Array(t.translatePosMatrix(F,A,n,s,!0))),g?(m.uniformMatrix4fv(_.uniforms.u_label_plane_matrix,!1,Mt),Ce(T,w.posMatrix,t,r,O,F,d,c)):m.uniformMatrix4fv(_.uniforms.u_label_plane_matrix,!1,O),m.uniform1f(_.uniforms.u_fade_change,t.options.fadeDuration?t.symbolFadeChange:1),m.uniform1f(_.uniforms.u_height_offset,Number(a.paint.get("symbol-height-offset"))),Ft(_,P,t,a,A,E,r,S,d);}}}}function Ot(t,i,a,o,r,n,s){var l=i.context.gl,u=i.transform;l.uniform1i(t.uniforms.u_pitch_with_map,n?1:0),l.uniform1f(t.uniforms.u_is_text,o?1:0),l.uniform1f(t.uniforms.u_pitch,u.pitch/360*2*Math.PI);var c="constant"===s.functionType||"source"===s.functionType,_="constant"===s.functionType||"camera"===s.functionType;l.uniform1i(t.uniforms.u_is_size_zoom_constant,c?1:0),l.uniform1i(t.uniforms.u_is_size_feature_constant,_?1:0),l.uniform1f(t.uniforms.u_camera_to_center_distance,u.cameraToCenterDistance);var f=e.evaluateSizeForZoom(s,u.zoom,Rt.properties[o?"text-size":"icon-size"]);void 0!==f.uSizeT&&l.uniform1f(t.uniforms.u_size_t,f.uSizeT),void 0!==f.uSize&&l.uniform1f(t.uniforms.u_size,f.uSize),l.uniform1f(t.uniforms.u_aspect_ratio,u.width/u.height),l.uniform1i(t.uniforms.u_rotate_symbol,r?1:0);}function Ft(e,t,i,a,o,r,n,s,l){var u=i.context,c=u.gl,_=i.transform;if(s){var f=0!==a.paint.get(n?"text-halo-width":"icon-halo-width").constantOr(1),m=l?Math.cos(_._pitch)*_.cameraToCenterDistance:1;c.uniform1f(e.uniforms.u_gamma_scale,m),f&&(c.uniform1f(e.uniforms.u_is_halo,1),Lt(r,a,u,e)),c.uniform1f(e.uniforms.u_is_halo,0);}Lt(r,a,u,e);}function Lt(e,t,i,a){a.draw(i,i.gl.TRIANGLES,t.id,e.layoutVertexBuffer,e.indexBuffer,e.segments,e.programConfigurations.get(t.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer);}function Dt(e,t,i,a,o,r){for(var n,s=!0,l=0,u=a;l<u.length;l+=1){var c=u[l],_=t.getTile(c),f=_.getBucket(i);if(f){var m=f.programConfigurations.get(i.id),p=e.context.program.get(),h=e.useProgram(o,m),d=s||h.program!==p,g=n!==_.tileID.overscaledZ;d&&m.setUniforms(e.context,h,i.paint,{zoom:e.transform.zoom}),zt(h,e,_,f,i,c,m,d,g,r),n=_.tileID.overscaledZ,s=!1;}}}function zt(t,i,a,o,r,n,s,l,u,c){var _,f,m,p,h=i.context,d=h.gl,g=r.paint.get("line-dasharray"),v=r.paint.get("line-pattern");if(l||u){var y=1/Ve(a,1,i.transform.tileZoom);if(g){_=i.lineAtlas.getDash(g.from,"round"===r.layout.get("line-cap")),f=i.lineAtlas.getDash(g.to,"round"===r.layout.get("line-cap"));var x=_.width*g.fromScale,b=f.width*g.toScale;d.uniform2f(t.uniforms.u_patternscale_a,y/x,-_.height/2),d.uniform2f(t.uniforms.u_patternscale_b,y/b,-f.height/2),d.uniform1f(t.uniforms.u_sdfgamma,i.lineAtlas.width/(256*Math.min(x,b)*e.default.devicePixelRatio)/2);}else if(v){if(m=i.imageManager.getPattern(v.from),p=i.imageManager.getPattern(v.to),!m||!p)return;d.uniform2f(t.uniforms.u_pattern_size_a,m.displaySize[0]*v.fromScale/y,m.displaySize[1]),d.uniform2f(t.uniforms.u_pattern_size_b,p.displaySize[0]*v.toScale/y,p.displaySize[1]);var w=i.imageManager.getPixelSize(),A=w.width,T=w.height;d.uniform2fv(t.uniforms.u_texsize,[A,T]);}d.uniform2f(t.uniforms.u_gl_units_to_pixels,1/i.transform.pixelsToGLUnits[0],1/i.transform.pixelsToGLUnits[1]);}l&&(g?(d.uniform1i(t.uniforms.u_image,0),h.activeTexture.set(d.TEXTURE0),i.lineAtlas.bind(h),d.uniform1f(t.uniforms.u_tex_y_a,_.y),d.uniform1f(t.uniforms.u_tex_y_b,f.y),d.uniform1f(t.uniforms.u_mix,g.t)):v&&(d.uniform1i(t.uniforms.u_image,0),h.activeTexture.set(d.TEXTURE0),i.imageManager.bind(h),d.uniform2fv(t.uniforms.u_pattern_tl_a,m.tl),d.uniform2fv(t.uniforms.u_pattern_br_a,m.br),d.uniform2fv(t.uniforms.u_pattern_tl_b,p.tl),d.uniform2fv(t.uniforms.u_pattern_br_b,p.br),d.uniform1f(t.uniforms.u_fade,v.t))),h.setStencilMode(i.stencilModeForClipping(n));var E=i.translatePosMatrix(n.posMatrix,a,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"));if(d.uniformMatrix4fv(t.uniforms.u_matrix,!1,new Float32Array(E)),d.uniform1f(t.uniforms.u_ratio,1/Ve(a,1,i.transform.zoom)),r.paint.get("line-gradient")){h.activeTexture.set(d.TEXTURE0);var P=r.gradientTexture;if(!r.gradient)return;P||(P=r.gradientTexture=new e.default$4(h,r.gradient,d.RGBA)),P.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.uniform1i(t.uniforms.u_image,0);}c?(d.uniform1f(t.uniforms.u_hasBorder,1),t.draw(h,d.TRIANGLES,r.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,s)):"visible"===r.layout.get("border-visibility")&&i.context.extFragDepth?(d.uniform1f(t.uniforms.u_hasBorder,1),t.draw(h,d.TRIANGLES,r.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,s),d.uniform1f(t.uniforms.u_hasBorder,0),t.draw(h,d.TRIANGLES,r.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,s)):(d.uniform1f(t.uniforms.u_hasBorder,0),t.draw(h,d.TRIANGLES,r.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,s));}var Nt=function(e,t){if(!e)return!1;var i=t.imageManager.getPattern(e.from),a=t.imageManager.getPattern(e.to);return!i||!a},Bt=function(e,t,i){var a=t.context,o=a.gl,r=t.imageManager.getPattern(e.from),n=t.imageManager.getPattern(e.to);o.uniform1i(i.uniforms.u_image,0),o.uniform2fv(i.uniforms.u_pattern_tl_a,r.tl),o.uniform2fv(i.uniforms.u_pattern_br_a,r.br),o.uniform2fv(i.uniforms.u_pattern_tl_b,n.tl),o.uniform2fv(i.uniforms.u_pattern_br_b,n.br);var s=t.imageManager.getPixelSize(),l=s.width,u=s.height;o.uniform2fv(i.uniforms.u_texsize,[l,u]),o.uniform1f(i.uniforms.u_mix,e.t),o.uniform2fv(i.uniforms.u_pattern_size_a,r.displaySize),o.uniform2fv(i.uniforms.u_pattern_size_b,n.displaySize),o.uniform1f(i.uniforms.u_scale_a,e.fromScale),o.uniform1f(i.uniforms.u_scale_b,e.toScale),a.activeTexture.set(o.TEXTURE0),t.imageManager.bind(t.context);},kt=function(e,t,i){var a=t.context.gl;a.uniform1f(i.uniforms.u_tile_units_to_pixels,1/Ve(e,1,t.transform.tileZoom));var o=Math.pow(2,e.tileID.overscaledZ),r=e.tileSize*Math.pow(2,t.transform.tileZoom)/o,n=r*(e.tileID.canonical.x+e.tileID.wrap*o),s=r*e.tileID.canonical.y;a.uniform2f(i.uniforms.u_pixel_coord_upper,n>>16,s>>16),a.uniform2f(i.uniforms.u_pixel_coord_lower,65535&n,65535&s);};function $t(e,t,i,a,o){if(!Nt(i.paint.get("fill-pattern"),e))for(var r=!0,n=0,s=a;n<s.length;n+=1){var l=s[n],u=t.getTile(l),c=u.getBucket(i);c&&(e.context.setStencilMode(e.stencilModeForClipping(l)),o(e,t,i,u,l,c,r),r=!1);}}function Ut(t,i,a,o,r,n,s){var l=t.context.gl,u=n.programConfigurations.get(a.id),c=Gt("fill",a.paint.get("fill-pattern"),t,u,a,o,r,s);a.paint.get("render-3d")&&function(t,i){var a=i.context.gl,o=i.style.light,r=o.properties.get("position"),n=[r.x,r.y,r.z],s=e.create$3();"viewport"===o.properties.get("anchor")&&e.fromRotation$1(s,-i.transform.angle);e.transformMat3(n,n,s);var l=o.properties.get("color");a.uniform3fv(t.uniforms.u_lightpos,n),a.uniform1f(t.uniforms.u_lightintensity,o.properties.get("intensity")),a.uniform3f(t.uniforms.u_lightcolor,l.r,l.g,l.b);}(c,t),c.draw(t.context,l.TRIANGLES,a.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,u);}function Vt(e,t,i,a,o,r,n){var s=e.context.gl,l=r.programConfigurations.get(i.id),u=Gt("fillOutline",i.getPaintProperty("fill-outline-color")?null:i.paint.get("fill-pattern"),e,l,i,a,o,n);s.uniform2f(u.uniforms.u_world,s.drawingBufferWidth,s.drawingBufferHeight),u.draw(e.context,s.LINES,i.id,r.layoutVertexBuffer,r.indexBuffer2,r.segments2,l);}function Gt(e,t,i,a,o,r,n,s){var l,u=i.context.program.get();return t?(l=i.useProgram(e+"Pattern",a),(s||l.program!==u)&&(a.setUniforms(i.context,l,o.paint,{zoom:i.transform.zoom}),Bt(t,i,l),i.context.gl.uniform1f(l.uniforms.u_zoom_factor,Math.pow(2,20-Math.floor(i.transform.zoom)))),kt(r,i,l)):(l=i.useProgram(o.paint.get("render-3d")?"fill3d":e,a),(s||l.program!==u)&&a.setUniforms(i.context,l,o.paint,{zoom:i.transform.zoom})),i.context.gl.uniformMatrix4fv(l.uniforms.u_matrix,!1,new Float32Array(i.translatePosMatrix(n.posMatrix,r,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")))),l}function Xt(t,i){var a=t.context,o=a.gl,r=i.viewportFrame;if(t.depthRboNeedsClear&&t.setupOffscreenDepthRenderbuffer(),!r){var n=new e.default$4(a,{width:t.width,height:t.height,data:null},o.RGBA);n.bind(o.LINEAR,o.CLAMP_TO_EDGE),(r=i.viewportFrame=a.createFramebuffer(t.width,t.height)).colorAttachment.set(n.texture);}a.bindFramebuffer.set(r.framebuffer),r.depthAttachment.set(t.depthRbo),t.depthRboNeedsClear&&(a.clear({depth:1}),t.depthRboNeedsClear=!1),a.clear({color:e.default$8.transparent}),a.setStencilMode(e.default$39.disabled),a.setDepthMode(new e.default$38(o.LEQUAL,e.default$38.ReadWrite,[0,1])),a.setColorMode(t.colorModeForRenderPass());}function Wt(t,i){var a=i.viewportFrame;if(a){var o=t.context,r=o.gl,n=t.useProgram("extrusionTexture");o.setStencilMode(e.default$39.disabled),o.setDepthMode(e.default$38.disabled),o.setColorMode(t.colorModeForRenderPass()),o.activeTexture.set(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,a.colorAttachment.get()),"custom"!==i.type&&"object"==typeof i.paint.get(i.type+"-opacity")?r.uniform1f(n.uniforms.u_opacity,i.paint.get(i.type+"-opacity").value.value):"custom"!==i.type?r.uniform1f(n.uniforms.u_opacity,i.paint.get(i.type+"-opacity")):r.uniform1f(n.uniforms.u_opacity,1),r.uniform1i(n.uniforms.u_image,0);var s=e.create();e.ortho(s,0,t.width,t.height,0,0,1),r.uniformMatrix4fv(n.uniforms.u_matrix,!1,s),r.uniform2f(n.uniforms.u_world,r.drawingBufferWidth,r.drawingBufferHeight),t.viewportVAO.bind(o,n,t.viewportBuffer,[]),r.drawArrays(r.TRIANGLE_STRIP,0,4);}}function jt(t,i,a,o,r,n,s){var l=t.context,u=l.gl,c=a.paint.get("extrusion-pattern"),_=t.context.program.get(),f=n.programConfigurations.get(a.id),m=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",f);if((s||m.program!==_)&&f.setUniforms(l,m,a.paint,{zoom:t.transform.zoom}),c){if(Nt(c,t))return;Bt(c,t,m),kt(o,t,m),u.uniform1f(m.uniforms.u_height_factor,-Math.pow(2,r.overscaledZ)/o.tileSize/8);}t.context.gl.uniformMatrix4fv(m.uniforms.u_matrix,!1,new Float32Array(t.translatePosMatrix(r.posMatrix,o,a.paint.get("extrusion-translate"),a.paint.get("extrusion-translate-anchor")))),function(t,i){var a=i.context.gl,o=i.style.light,r=o.properties.get("position"),n=[r.x,r.y,r.z],s=e.create$3();"viewport"===o.properties.get("anchor")&&e.fromRotation$1(s,-i.transform.angle);e.transformMat3(n,n,s);var l=o.properties.get("color");a.uniform3fv(t.uniforms.u_lightpos,n),a.uniform1f(t.uniforms.u_lightintensity,o.properties.get("intensity")),a.uniform3f(t.uniforms.u_lightcolor,l.r,l.g,l.b);}(m,t),m.draw(l,u.TRIANGLES,a.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,f);}function Yt(t,i,a,o,r){var n=o.paint.get("raster-fade-duration");if(n>0){var s=e.default.now(),l=(s-t.timeAdded)/n,u=i?(s-i.timeAdded)/n:-1,c=a.getSource(),_=r.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),f=!i||Math.abs(i.tileID.overscaledZ-_)>Math.abs(t.tileID.overscaledZ-_),m=f&&t.refreshedUponExpiration?1:e.clamp(f?l:1-u,0,1);return t.refreshedUponExpiration&&l>=1&&(t.refreshedUponExpiration=!1),i?{opacity:1,mix:1-m}:{opacity:m,mix:0}}return{opacity:1,mix:0}}function Zt(t,i,a){var o=t.context,r=o.gl,n=a.posMatrix,s=t.useProgram("debug");o.setDepthMode(e.default$38.disabled),o.setStencilMode(e.default$39.disabled),o.setColorMode(t.colorModeForRenderPass()),r.uniformMatrix4fv(s.uniforms.u_matrix,!1,n),r.uniform4f(s.uniforms.u_color,1,0,0,1),t.debugVAO.bind(o,s,t.debugBuffer,[]),r.drawArrays(r.LINE_STRIP,0,t.debugBuffer.length);for(var l=function(e,t,i,a){a=a||1;var o,r,n,s,l,u,c,_,f=[];for(o=0,r=e.length;o<r;o++)if(l=qt[e[o]]){for(_=null,n=0,s=l[1].length;n<s;n+=2)-1===l[1][n]&&-1===l[1][n+1]?_=null:(u=t+l[1][n]*a,c=i-l[1][n+1]*a,_&&f.push(_.x,_.y,u,c),_={x:u,y:c});t+=l[0]*a;}return f}(a.toString(),50,200,5),u=new e.PosArray,c=0;c<l.length;c+=2)u.emplaceBack(l[c],l[c+1]);var _=o.createVertexBuffer(u,yt.members);(new e.default$17).bind(o,s,_,[]),r.uniform4f(s.uniforms.u_color,1,1,1,1);for(var f=i.getTile(a).tileSize,m=e.default$12/(Math.pow(2,t.transform.zoom-a.overscaledZ)*f),p=[[-1,-1],[-1,1],[1,-1],[1,1]],h=0;h<p.length;h++){var d=p[h];r.uniformMatrix4fv(s.uniforms.u_matrix,!1,e.translate([],n,[m*d[0],m*d[1],0])),r.drawArrays(r.LINES,0,_.length);}r.uniform4f(s.uniforms.u_color,0,0,0,1),r.uniformMatrix4fv(s.uniforms.u_matrix,!1,n),r.drawArrays(r.LINES,0,_.length);}var qt={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};function Qt(e,t,i,a,o,r,n,s,l,u,c,_,f){var m=t.context,p=m.gl;(s||l)&&p.uniform2f(e.uniforms.u_gl_units_to_pixels,1/t.transform.pixelsToGLUnits[0],1/t.transform.pixelsToGLUnits[1]),m.setStencilMode(t.stencilModeForClipping(r));var h=t.translatePosMatrix(r.posMatrix,i,o.paint.get("tracking-translate"),o.paint.get("tracking-translate-anchor"));p.uniformMatrix4fv(e.uniforms.u_matrix,!1,new Float32Array(h)),p.uniform1f(e.uniforms.u_ratio,1/Ve(i,1,t.transform.zoom)),p.uniform1f(e.uniforms.u_start,u-f),p.uniform1f(e.uniforms.u_end,u),p.uniform1f(e.uniforms.u_segments,f),p.uniform1f(e.uniforms.u_reverse,c?1:0),p.uniform1f(e.uniforms.u_reserve,_?1:0),e.draw(m,p.TRIANGLES,o.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,n);}var Ht={speedExt1:2,speedExt2:4,speedExt3:5,speedExt4:6,getCalculatedSpeed:function(e,t){return parseInt(t.speeds["speed"+e]/e/this["speedExt"+e])}};function Kt(e,t,i,a,o,r,n,s,l){var u=t.context,c=u.gl;(s||l)&&c.uniform2f(e.uniforms.u_gl_units_to_pixels,1/t.transform.pixelsToGLUnits[0],1/t.transform.pixelsToGLUnits[1]),c.uniform1f(e.uniforms.u_interpolate,Number(o.paint.get("sprite-interpolate"))),c.uniform1f(e.uniforms.u_height_offset,o.paint.get("sprite-height-offset")),u.setStencilMode(t.stencilModeForClipping(r)),c.uniform4f(e.uniforms.u_speed_mat,Ht.getCalculatedSpeed(1,o),Ht.getCalculatedSpeed(2,o),Ht.getCalculatedSpeed(3,o),Ht.getCalculatedSpeed(4,o));var _=t.translatePosMatrix(r.posMatrix,i,o.paint.get("sprite-translate"),o.paint.get("sprite-translate-anchor"));c.uniformMatrix4fv(e.uniforms.u_matrix,!1,new Float32Array(_)),c.uniform1f(e.uniforms.u_ratio,1/Ve(i,1,t.transform.zoom)),e.draw(u,c.TRIANGLES,o.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,n);}e.identity(new Float32Array(16));var Jt=e.default$41.layout,ei=0,ti=10;function ii(t,i,a,o,r,n,s,l,u,c,_){var f,m=t.context,p=m.gl,h=t.transform,d="map"===l,g="map"===u,v=d&&!g&&!0,y=g;m.setDepthMode(y?t.depthModeForSublayer(0,e.default$38.ReadOnly):e.default$38.disabled);for(var x=0,b=o;x<b.length;x+=1){var w=b[x],A=i.getTile(w),T=A.getBucket(a);if(T){var E=r?T.text:T.icon;if(E&&E.segments.get().length){var P=E.programConfigurations.get(a.id),S=r||T.sdfIcons,I=r?T.textSizeData:T.iconSizeData;if(f||(f=t.useProgram(S?"symtrackingSDF":"symtrackingIcon",P),P.setUniforms(t.context,f,a.paint,{zoom:t.transform.zoom}),ai(f,t,a,r,v,g,I,_)),m.activeTexture.set(p.TEXTURE0),p.uniform1i(f.uniforms.u_texture,0),r)A.glyphAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),p.uniform2fv(f.uniforms.u_texsize,A.glyphAtlasTexture.size);else{var M=1!==a.layout.get("icon-size").constantOr(0)||T.iconsNeedLinear,R=g||0!==h.pitch;A.iconAtlasTexture.bind(S||t.options.rotating||t.options.zooming||M||R?p.LINEAR:p.NEAREST,p.CLAMP_TO_EDGE),p.uniform2fv(f.uniforms.u_texsize,A.iconAtlasTexture.size);}p.uniformMatrix4fv(f.uniforms.u_matrix,!1,new Float32Array(t.translatePosMatrix(w.posMatrix,A,n,s)));var C=Ve(A,1,t.transform.zoom),O=Se(w.posMatrix,g,d,t.transform,C),F=Ie(w.posMatrix,g,d,t.transform,C);p.uniformMatrix4fv(f.uniforms.u_gl_coord_matrix,!1,new Float32Array(t.translatePosMatrix(F,A,n,s,!0))),p.uniformMatrix4fv(f.uniforms.u_label_plane_matrix,!1,O),p.uniform1f(f.uniforms.u_fade_change,t.options.fadeDuration?t.symbolFadeChange:1),oi(f,P,t,a,A,E,r,S,g);}}}}function ai(t,i,a,o,r,n,s,l){var u=i.context.gl,c=i.transform;u.uniform1i(t.uniforms.u_pitch_with_map,n?1:0),u.uniform1f(t.uniforms.u_is_text,o?1:0),u.uniform1f(t.uniforms.u_pitch,c.pitch/360*2*Math.PI);var _="constant"===s.functionType||"source"===s.functionType,f="constant"===s.functionType||"camera"===s.functionType;u.uniform1i(t.uniforms.u_is_size_zoom_constant,_?1:0),u.uniform1i(t.uniforms.u_is_size_feature_constant,f?1:0),u.uniform1f(t.uniforms.u_camera_to_center_distance,c.cameraToCenterDistance);var m=e.evaluateSizeForZoom(s,c.zoom,Jt.properties[o?"text-size":"icon-size"]);void 0!==m.uSizeT&&u.uniform1f(t.uniforms.u_size_t,m.uSizeT),void 0!==m.uSize&&u.uniform1f(t.uniforms.u_size,m.uSize),u.uniform1f(t.uniforms.u_aspect_ratio,c.width/c.height),u.uniform1i(t.uniforms.u_rotate_symbol,r?1:0),u.uniform1f(t.uniforms.u_seq,l);}function oi(e,t,i,a,o,r,n,s,l){var u=i.context,c=u.gl,_=i.transform;if(s){var f=0!==a.paint.get(n?"text-halo-width":"icon-halo-width").constantOr(1),m=l?Math.cos(_._pitch)*_.cameraToCenterDistance:1;c.uniform1f(e.uniforms.u_gamma_scale,m),f&&(c.uniform1f(e.uniforms.u_is_halo,1),ri(r,a,u,e)),c.uniform1f(e.uniforms.u_is_halo,0);}ri(r,a,u,e);}function ri(e,t,i,a){a.draw(i,i.gl.TRIANGLES,t.id,e.layoutVertexBuffer,e.indexBuffer,e.segments,e.programConfigurations.get(t.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer);}function ni(t,i,a,o,r,n,s){var l=t.context,u=l.gl;if(n){var c=a.paint.get("histogram-dynamic"),_=a.layout.get("histogram-color-render"),f=null,m=t.context.program.get(),p=n.programConfigurations.get(a.id);if(f=c?t.useProgram("histogramDynamic",p):t.useProgram(_?"histogramColor":"histogram",p),u.uniform1f(f.uniforms.u_fluorescent,Number(a.paint.get("histogram-fluorescent"))),(s||f.program!==m)&&p.setUniforms(l,f,a.paint,{zoom:t.transform.zoom}),_){for(var h=a.paint.get("histogram-colors"),d=a.paint.get("histogram-max-height"),g=[],v=0;v<h.length;v++){var y=e.default$42.parseCSSColor(h[v]);y[0]/=255,y[1]/=255,y[2]/=255,g.push(y);}u.uniform1f(f.uniforms.u_max_height,3*d),u.uniform4fv(f.uniforms.u_color_a,g[0]),u.uniform4fv(f.uniforms.u_color_b,g[1]),u.uniform4fv(f.uniforms.u_color_c,g[2]),u.uniform4fv(f.uniforms.u_color_d,g[3]),u.uniform4fv(f.uniforms.u_color_e,g[4]);}c&&u.uniform1f(f.uniforms.u_dyn_count,a._count),t.context.gl.uniformMatrix4fv(f.uniforms.u_matrix,!1,new Float32Array(t.translatePosMatrix(r.posMatrix,o,a.paint.get("histogram-translate"),a.paint.get("histogram-translate-anchor")))),u.uniform1f(f.uniforms.u_is_max_length,Number(a.layout.get("histogram-max-height-render"))),function(t,i){var a=i.context.gl,o=i.style.light,r=o.properties.get("position"),n=[r.x,r.y,r.z],s=e.create$3();"viewport"===o.properties.get("anchor")&&e.fromRotation$1(s,-i.transform.angle);e.transformMat3(n,n,s);var l=o.properties.get("color");a.uniform3fv(t.uniforms.u_lightpos,n),a.uniform1f(t.uniforms.u_lightintensity,o.properties.get("intensity")),a.uniform3f(t.uniforms.u_lightcolor,l.r,l.g,l.b);}(f,t),f.draw(l,u.TRIANGLES,a.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,p);}}function si(t,i,a,o,r,n,s){!function(t,i,a,o,r,n,s){var l=t.context.gl,u=function(e,t,i,a,o,r,n,s){var l,u=i.context.program.get();t?(l=i.useProgram(e+"Pattern",a),(s||l.program!==u)&&(a.setUniforms(i.context,l,o.paint,{zoom:i.transform.zoom}),Bt(t,i,l),i.context.gl.uniform1f(l.uniforms.u_zoom_factor,Math.pow(2,20-Math.floor(i.transform.zoom)))),kt(r,i,l)):(l=i.useProgram(e,a),(s||l.program!==u)&&a.setUniforms(i.context,l,o.paint,{zoom:i.transform.zoom}));return l}("sphereFill",i.paint.get("fill-pattern"),t,s,i,a,0,n);l.uniform2f(u.uniforms.u_gl_units_to_pixels,t.transform.width/2,-t.transform.height/2);var c=e.create$4();e.scale$2(c,c,[1,Math.cos(t.transform._pitch)]),e.rotate(c,c,t.transform.angle),l.uniformMatrix2fv(u.uniforms.u_pixel_matrix,!1,c),l.uniform3fv(u.uniforms.u_camPos,t.transform.getCameraPos()),l.uniform1f(u.uniforms.u_tangentAngle,t.transform.current_zoom_tangent_angle+Math.PI/18),l.uniformMatrix4fv(u.uniforms.u_matrix,!1,new Float32Array(e.mul([],t.transform.calculateVPMatrix(),r.tilePlane.matrix))),l.uniformMatrix4fv(u.uniforms.u_modelMatrix,!1,new Float32Array(r.tilePlane.matrix)),u.draw(t.context,l.TRIANGLES,i.id,r.layoutVertexBuffer,r.indexBuffer,r.segments,s);}(t,a,o,0,n,s,n.programConfigurations.get(a.id));}function li(e,t,i,a,o,r){for(var n,s=!0,l=0,u=a;l<u.length;l+=1){var c=u[l],_=t.getTile(c),f=_.getBucket(i);if(f){var m=f.programConfigurations.get(i.id),p=e.context.program.get(),h=e.useProgram(o,m);ui(h,e,_,f,i,c,m,s||h.program!==p,n!==_.tileID.overscaledZ,r),n=_.tileID.overscaledZ,s=!1;}}}function ui(t,i,a,o,r,n,s,l,u,c){var _,f,m,p,h=i.context,d=h.gl,g=r.paint.get("line-dasharray"),v=r.paint.get("line-pattern");if(l||u){var y=1/Ve(a,1,i.transform.tileZoom);if(s.setUniforms(i.context,t,r.paint,{zoom:i.transform.zoom}),g){_=i.lineAtlas.getDash(g.from,"round"===r.layout.get("line-cap")),f=i.lineAtlas.getDash(g.to,"round"===r.layout.get("line-cap"));var x=_.width*g.fromScale,b=f.width*g.toScale;d.uniform2f(t.uniforms.u_patternscale_a,y/x,-_.height/2),d.uniform2f(t.uniforms.u_patternscale_b,y/b,-f.height/2),d.uniform1f(t.uniforms.u_sdfgamma,i.lineAtlas.width/(256*Math.min(x,b)*e.default.devicePixelRatio)/2);}else if(v){if(m=i.imageManager.getPattern(v.from),p=i.imageManager.getPattern(v.to),!m||!p)return;d.uniform2f(t.uniforms.u_pattern_size_a,m.displaySize[0]*v.fromScale/y,m.displaySize[1]),d.uniform2f(t.uniforms.u_pattern_size_b,p.displaySize[0]*v.toScale/y,p.displaySize[1]);var w=i.imageManager.getPixelSize(),A=w.width,T=w.height;d.uniform2fv(t.uniforms.u_texsize,[A,T]);}d.uniform2f(t.uniforms.u_gl_units_to_pixels,i.transform.width/2,-i.transform.height/2);}if(l&&(g?(d.uniform1i(t.uniforms.u_image,0),h.activeTexture.set(d.TEXTURE0),i.lineAtlas.bind(h),d.uniform1f(t.uniforms.u_tex_y_a,_.y),d.uniform1f(t.uniforms.u_tex_y_b,f.y),d.uniform1f(t.uniforms.u_mix,g.t)):v&&(d.uniform1i(t.uniforms.u_image,0),h.activeTexture.set(d.TEXTURE0),i.imageManager.bind(h),d.uniform2fv(t.uniforms.u_pattern_tl_a,m.tl),d.uniform2fv(t.uniforms.u_pattern_br_a,m.br),d.uniform2fv(t.uniforms.u_pattern_tl_b,p.tl),d.uniform2fv(t.uniforms.u_pattern_br_b,p.br),d.uniform1f(t.uniforms.u_fade,v.t))),d.uniform1f(t.uniforms.u_ratio,1/Ve(a,1,i.transform.zoom)),r.paint.get("line-gradient")){h.activeTexture.set(d.TEXTURE0);var E=r.gradientTexture;if(!r.gradient)return;E||(E=r.gradientTexture=new e.default$4(h,r.gradient,d.RGBA)),E.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.uniform1i(t.uniforms.u_image,0);}var P=e.create$4();e.scale$2(P,P,[1,Math.cos(i.transform._pitch)]),e.rotate(P,P,i.transform.angle),d.uniformMatrix2fv(t.uniforms.u_pixel_matrix,!1,P),d.uniformMatrix4fv(t.uniforms.u_matrix,!1,new Float32Array(e.mul([],i.transform.calculateVPMatrix(),o.tilePlane.matrix))),t.draw(h,d.TRIANGLES,r.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,s);}var ci=e.default$31.layout;function _i(t,i,a,o,r,n,s,l,u,c){var _,f=t.context,m=f.gl,p=t.transform,h="map"===l,d="map"===u,g=h&&"point"!==a.layout.get("symbol-placement"),v=h&&!d&&!g;f.setDepthMode(e.default$38.disabled),f.setColorMode(e.default$40.alphaBlended);for(var y=!1,x=0,b=o;x<b.length;x+=1){var w=b[x],A=i.getTile(w),T=A.getBucket(a);if(T){var E=r?T.text:T.icon;if(E&&E.segments.get().length){var P=E.programConfigurations.get(a.id),S=r||T.sdfIcons,I=r?T.textSizeData:T.iconSizeData;if(_||(_=t.useProgram(S?"sphereSymbolSDF":"sphereSymbolIcon",P),P.setUniforms(t.context,_,a.paint,{zoom:t.transform.zoom}),m.uniform2f(_.uniforms.u_gl_units_to_pixels,t.transform.width/2,-t.transform.height/2),m.uniform1f(_.uniforms.u_zoom_factor,Math.pow(2,t.transform.zoom-18)),fi(_,t,a,r,v,d,I)),f.activeTexture.set(m.TEXTURE5),m.uniform1i(_.uniforms.u_texture,5),r)A.glyphAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),m.uniform2fv(_.uniforms.u_texsize,A.glyphAtlasTexture.size);else{var M=1!==a.layout.get("icon-size").constantOr(0)||T.iconsNeedLinear,R=d||0!==p.pitch;A.iconAtlasTexture.bind(S||t.options.rotating||t.options.zooming||M||R?m.LINEAR:m.NEAREST,m.CLAMP_TO_EDGE),m.uniform2fv(_.uniforms.u_texsize,A.iconAtlasTexture.size);}var C=Ve(A,1,t.transform.zoom),O=Se(w.posMatrix,d,h,t.transform,C),F=Ie(w.posMatrix,d,h,t.transform,C);if(m.uniformMatrix4fv(_.uniforms.u_gl_coord_matrix,!1,new Float32Array(t.translatePosMatrix(F,A,n,s,!0))),g?(m.uniform1i(_.uniforms.u_along_line,!0),Ce(T,w.posMatrix,t,r,O,F,d,c)):m.uniform1i(_.uniforms.u_along_line,!1),m.uniform1f(_.uniforms.u_fade_change,t.options.fadeDuration?t.symbolFadeChange:1),!y){var L=e.create$4();e.scale$2(L,L,[1,Math.cos(t.transform._pitch)]),m.uniformMatrix2fv(_.uniforms.u_pitch_matrix,!1,L),m.uniformMatrix2fv(_.uniforms.u_rot_matrix,!1,e.rotate([],e.create$4(),t.transform.angle)),m.uniformMatrix2fv(_.uniforms.u_pitch_rot_matrix,!1,e.mul$1([],L,e.rotate([],e.create$4(),t.transform.angle))),m.uniform1f(_.uniforms.u_bearing,-t.transform.angle),m.uniform3fv(_.uniforms.u_camPos,t.transform.getCameraPos()),m.uniform1f(_.uniforms.u_tangentAngle,t.transform.current_zoom_tangent_angle),m.uniformMatrix4fv(_.uniforms.u_symbol_mvp_matrix,!1,t.transform.td_symbolMVPMatrix),y=!0;}m.uniformMatrix4fv(_.uniforms.u_matrix,!1,new Float32Array(e.mul([],t.transform.calculateVPMatrix(),T.tilePlane.matrix))),m.uniformMatrix4fv(_.uniforms.u_modelMatrix,!1,new Float32Array(T.tilePlane.matrix)),mi(_,P,t,a,A,E,r,S,d);}}}}function fi(t,i,a,o,r,n,s){var l=i.context.gl,u=i.transform;l.uniform1i(t.uniforms.u_pitch_with_map,n),l.uniform1i(t.uniforms.u_is_text,o),l.uniform1f(t.uniforms.u_pitch,u.pitch/360*2*Math.PI);var c="constant"===s.functionType||"source"===s.functionType,_="constant"===s.functionType||"camera"===s.functionType;l.uniform1i(t.uniforms.u_is_size_zoom_constant,c?1:0),l.uniform1i(t.uniforms.u_is_size_feature_constant,_?1:0),l.uniform1f(t.uniforms.u_camera_to_center_distance,u.alt);var f=e.evaluateSizeForZoom(s,u.zoom,ci.properties[o?"text-size":"icon-size"]);void 0!==f.uSizeT&&l.uniform1f(t.uniforms.u_size_t,f.uSizeT),void 0!==f.uSize&&l.uniform1f(t.uniforms.u_size,f.uSize),l.uniform1f(t.uniforms.u_aspect_ratio,u.width/u.height),l.uniform1i(t.uniforms.u_rotate_symbol,r?1:0);}function mi(e,t,i,a,o,r,n,s,l){var u=i.context,c=u.gl,_=i.transform;if(s){var f=0!==a.paint.get(n?"text-halo-width":"icon-halo-width").constantOr(1),m=l?Math.cos(_._pitch)*_.cameraToCenterDistance:1;c.uniform1f(e.uniforms.u_gamma_scale,m),f&&(c.uniform1i(e.uniforms.u_is_halo,!0),pi(r,a,u,e)),c.uniform1i(e.uniforms.u_is_halo,!1);}pi(r,a,u,e);}function pi(e,t,i,a){a.draw(i,i.gl.TRIANGLES,t.id,e.layoutVertexBuffer,e.indexBuffer,e.segments,e.programConfigurations.get(t.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer);}var hi=new H(null),di=["sphereExtrusionPattern","sphereExtrusion","sphereExtrusionPatternShadow","sphereExtrusionShadow","sphereExtrusionPatternCameraView","sphereExtrusionCameraView"];function gi(t,i,a,o,r,n,s,l,u){var c=t.context,_=c.gl,f=t.context.program.get(),m=n.programConfigurations.get(a.id),p=t.useProgram(l,m);(s||p.program!==f)&&m.setUniforms(c,p,a.paint,{zoom:t.transform.zoom});for(var h=a.radiationRegions,d=0;d<1;d++){var g=h[d];g?(_.uniform1i(p.uniforms["u_regions["+d+"].use"],!0),_.uniform4fv(p.uniforms["u_regions["+d+"].pos"],g.geo),_.uniform1i(p.uniforms["u_regions["+d+"].scan"],!1),_.uniform1i(p.uniforms["u_regions["+d+"].line"],!1),_.uniform1f(p.uniforms["u_regions["+d+"].percent"],t._map.timer.counter/g.speed%1),g.scan?(_.uniform1i(p.uniforms["u_regions["+d+"].scan"],!0),_.uniform3fv(p.uniforms["u_regions["+d+"].north"],g.north),_.uniform3fv(p.uniforms["u_regions["+d+"].cross"],g.cross)):g.line&&(_.uniform1i(p.uniforms["u_regions["+d+"].line"],!0),_.uniform3fv(p.uniforms["u_regions["+d+"].loc"],g.location),_.uniform1i(p.uniforms["u_regions["+d+"].vdir"],g.dirV))):_.uniform1i(p.uniforms["u_regions["+d+"].use"],!1);}if(u){if(Nt(u,t))return;Bt(u,t,p),kt(o,t,p);var v=a.paint.get("extrusion-top-pattern");v?!function(e,t,i){var a=t.gl,o=hi.getATexture(e.to);if(o){t.activeTexture.set(a.TEXTURE9);var r=o.isSizePowerOfTwoNoneSquare(),n=a.CLAMP_TO_EDGE;return o.bind(a.LINEAR,n,r?a.LINEAR_MIPMAP_NEAREST:a.LINEAR),a.uniform1i(i.uniforms.u_image_top,9),!0}return hi.addATexture(e.to,e.to,t),!1}(v,c,p)?_.uniform1i(p.uniforms.u_top_tex_rend,!1):_.uniform1i(p.uniforms.u_top_tex_rend,!0):_.uniform1i(p.uniforms.u_top_tex_rend,!1);}var y,x=t.transform,b=t.cameraDrawMode,w=t.activeCameras,A=e.createFloat64ArrayFromAMatrix(n.matrix);if(_.uniform1f(p.uniforms.u_viewshed_count,0),b===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||b===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_ALL){var T=t.fbManager.shadowFramebuffer;T&&(c.activeTexture.set(_.TEXTURE10),_.bindTexture(_.TEXTURE_2D,T.colorAttachment.get()),_.uniform1i(p.uniforms.u_shadow_sampler,10)),_.uniform1f(p.uniforms.u_shadow_off,t.shadowOff);}if(a.viewshedRender&&(b===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||b===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_ALL)){var E=w.viewshed[0].fb;E&&(c.activeTexture.set(_.TEXTURE11),_.bindTexture(_.TEXTURE_2D,E.colorAttachment.get()),_.uniform1i(p.uniforms.u_viewshed_samp0,11)),_.uniform1f(p.uniforms.u_shadow_off,t.shadowOff),_.uniform1f(p.uniforms.u_viewshed_count,1);}var P,S,I=e.createFloat64ArrayIdentityMatrix();if(b!==e.default$11.CAMERA.DRAW_MODE.OFFSCREEN&&b!==e.default$11.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||(P=x._center.toArray(),S=t._map.sunLight._shadowSunPosition({target:P,distance:x.alt*e.default$11.TRANSFORM.R_ZOOM})),!t.depthPick)if(b===e.default$11.CAMERA.DRAW_MODE.OFFSCREEN)"night"!==t._map.sunLight._shadow.type&&(y||(e.mul(A,x.calculateVPMatrix(S),A),y=new Float32Array(e.createFloat64ArrayFromAMatrix(A)),_.uniformMatrix4fv(p.uniforms.u_matrix,!1,y)));else if(b===e.default$11.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED)y||(e.mul(A,x.calculateVPMatrix(w.viewshed[0]),A),y=new Float32Array(e.createFloat64ArrayFromAMatrix(A)),_.uniformMatrix4fv(p.uniforms.u_matrix,!1,y));else if(b===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_SHADOW)"night"!==t._map.sunLight._shadow.type?(_.uniform1i(p.uniforms.u_with_shadow,!0),e.mul(I,x.calculateVPMatrix(S),A)):_.uniform1i(p.uniforms.u_with_shadow,!1),_.uniformMatrix4fv(p.uniforms.u_sun_matrix,!1,new Float32Array(I));else if(b===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED){var M=e.createFloat64ArrayIdentityMatrix();e.mul(M,x.calculateVPMatrix(w.viewshed[0]),A),_.uniformMatrix4fv(p.uniforms.u_viewshed_mat0,!1,new Float32Array(M)),_.uniform3fv(p.uniforms.u_viewshed_eye0,x._lastSunLightStatus.geographic),_.uniform1f(p.uniforms.u_viewshed_dist0,w.viewshed[0]&&w.viewshed[0].farDistance||0),_.uniform1i(p.uniforms.u_viewshed_used0,!0);}else if(b===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_ALL){"night"!==t._map.sunLight._shadow.type?(_.uniform1i(p.uniforms.u_with_shadow,!0),e.mul(I,x.calculateVPMatrix(S),A)):_.uniform1i(p.uniforms.u_with_shadow,!1),_.uniformMatrix4fv(p.uniforms.u_sun_matrix,!1,new Float32Array(I));var R=e.createFloat64ArrayIdentityMatrix();e.mul(R,x.calculateVPMatrix(w.viewshed[0]),A),_.uniformMatrix4fv(p.uniforms.u_viewshed_mat0,!1,new Float32Array(R)),_.uniform3fv(p.uniforms.u_viewshed_eye0,x._lastSunLightStatus.geographic),_.uniform1f(p.uniforms.u_viewshed_dist0,w.viewshed[0]&&w.viewshed[0].farDistance||0),_.uniform1i(p.uniforms.u_viewshed_used0,!0);}y||(e.mul(A,x.calculateVPMatrix(),A),y=new Float32Array(A),_.uniformMatrix4fv(p.uniforms.u_matrix,!1,y),n.normalMatrix||(n.normalMatrix=new Float32Array(e.transpose([],e.invert([],n.matrix)))),_.uniformMatrix4fv(p.uniforms.u_normal,!1,n.normalMatrix),_.uniformMatrix4fv(p.uniforms.u_model,!1,new Float32Array(n.matrix))),_.uniform1f(p.uniforms.u_opacity,a.paint.get("extrusion-opacity")),function(e,t){var i=t.context.gl;i.uniform3fv(e.uniforms.u_light,t._map.sunLight.getSunLightPos()),i.uniform3fv(e.uniforms.u_lightcolor,[1,1,1]);}(p,t),p.draw(c,_.TRIANGLES,a.id,n.layoutVertexBuffer,n.indexBuffer,n.segments,m);}function vi(t,i,a,o,r,n,s,l,u,c,_,f,m){var p=i.context,h=p.gl;(l||u)&&(s.setUniforms(i.context,t,r.paint,{zoom:i.transform.zoom}),h.uniform2f(t.uniforms.u_gl_units_to_pixels,i.transform.width/2,-i.transform.height/2)),h.uniform1f(t.uniforms.u_ratio,1/Ve(a,1,i.transform.zoom));var d=e.create$4();e.scale$2(d,d,[1,Math.cos(i.transform._pitch)]),e.rotate(d,d,i.transform.angle),h.uniformMatrix2fv(t.uniforms.u_pixel_matrix,!1,d),h.uniformMatrix4fv(t.uniforms.u_matrix,!1,new Float32Array(e.mul([],i.transform.calculateVPMatrix(),o.tilePlane.matrix))),h.uniform1f(t.uniforms.u_start,c-m),h.uniform1f(t.uniforms.u_end,c),h.uniform1f(t.uniforms.u_segments,m),h.uniform1i(t.uniforms.u_reverse,_),h.uniform1i(t.uniforms.u_reserve,f),t.draw(p,h.TRIANGLES,r.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,s);}function yi(t,i,a,o,r,n,s,l){var u=t.context,c=u.gl,_=t.context.program.get(),f=t.useProgram("sphereSprite",s),m=n||f.program!==_,p=l!==i.tileID.overscaledZ;m&&s.setUniforms(t.context,f,o.paint,{zoom:t.transform.zoom}),(m||p)&&c.uniform2f(f.uniforms.u_gl_units_to_pixels,t.transform.width/2,-t.transform.height/2);var h=e.create$4();e.scale$2(h,h,[1,Math.cos(t.transform._pitch)]),e.rotate(h,h,t.transform.angle),c.uniformMatrix2fv(f.uniforms.u_pixel_matrix,!1,h),c.uniform1f(f.uniforms.u_count,o.count),c.uniform1f(f.uniforms.u_speed_factor,o.paint.get("sprite-speed-factor")),c.uniformMatrix4fv(f.uniforms.u_matrix,!1,new Float32Array(e.mul([],t.transform.calculateVPMatrix(),a.tilePlane.matrix))),c.uniform1f(f.uniforms.u_ratio,1/Ve(i,1,t.transform.zoom)),f.draw(u,c.TRIANGLES,o.id,a.layoutVertexBuffer,a.indexBuffer,a.segments,s);}var xi=!0;var bi=e.default$8.parse("#ffffff"),wi=e.default$8.parse("#333333"),Ai=function(){this._cameraContainer={},this._sunLightCamera=this.addCameraView(e.default$11.CAMERA.SUNLIGHT_CAMERA_ID,{});};Ai.prototype.addCameraView=function(t,i){if(this._cameraContainer[t])throw Error("你已经添加过相同id的相机视图了");var a=i.farDistance||100;a*=e.default$11.TRANSFORM.R_SCALE;var o={pitch:i.pitch||30,bearing:i.bearing||0,active:i.active||!1,farDistance:a,hFov:i.hFov||60,wFov:i.wFov||60,location:i.location,altitude:i.altitude||0,color:i.color||[bi.r,bi.g,bi.b],shadowColor:i.shadowColor||[wi.r,wi.g,wi.b],id:t,fb:null,viewshedWithLine:!!i.viewshedWithLine};return this._cameraContainer[t]=o,o},Ai.createACameraView=function(t){var i=t.farDistance||100;return i*=e.default$11.TRANSFORM.R_SCALE,{pitch:t.pitch||30,bearing:t.bearing||0,active:t.active||!1,farDistance:i,hFov:t.hFov||60,wFov:t.wFov||60,location:t.location,altitude:t.altitude||0,color:t.color||[bi.r,bi.g,bi.b],shadowColor:t.shadowColor||[wi.r,wi.g,wi.b],id:t.id,fb:null}},Ai.prototype.deleteCameraView=function(e){this._cameraContainer[e]=null,delete this._cameraContainer[e];},Ai.prototype.getCameraView=function(e){return this._cameraContainer[e]},Ai.prototype.openCameraView=function(e){return!!this._cameraContainer[e]&&(this._cameraContainer[e].active=!0,!0)},Ai.prototype.closeCameraView=function(e){return!!this._cameraContainer[e]&&(this._cameraContainer[e].active=!1,!0)},Ai.prototype.getAllCameraViews=function(){return this._cameraContainer},Ai.prototype.getAllActiveCameraViews=function(){var t={shadow:null,viewshed:[]};for(var i in this._cameraContainer)this._cameraContainer[i]&&this._cameraContainer[i].active&&(i===e.default$11.CAMERA.SUNLIGHT_CAMERA_ID?t.shadow=this._cameraContainer[i]:t.viewshed.push(this._cameraContainer[i]));return t},Ai.prototype.modifyCameraViewById=function(t,i){if(this._cameraContainer[t])for(var a in i)if(i[a]||0===i[a])if("color"===a||"shadowColor"===a){if("string"==typeof i[a]){var o=e.default$8.parse(i[a]);o&&this._cameraContainer[t]&&(this._cameraContainer[t][a]=[o.r,o.g,o.b]);}}else"farDistance"===a?"number"==typeof i[a]&&(this._cameraContainer[t][a]=i[a]*e.default$11.TRANSFORM.R_SCALE):this._cameraContainer[t][a]=i[a];},Ai.prototype.modifyCameraViewGroup=function(e){for(var t in e)this.modifyCameraViewById(t,e[t]);};var Ti=["sphere","sphereAtmosphere","bloomBlur","screen"];function Ei(t,i,a,o,r,n,s,l){n.bindFramebuffer.set(a||null),n.activeTexture.set(s.TEXTURE2),s.bindTexture(s.TEXTURE_2D,i.colorAttachment.get()),s.uniform1i(r.uniforms.u_image,2);var u=e.createFloat64ArrayIdentityMatrix();e.ortho(u,0,t.width,t.height,0,0,1),s.uniformMatrix4fv(r.uniforms.u_matrix,!1,new Float32Array(u)),s.uniform2fv(r.uniforms.u_dir,o),s.uniform1f(r.uniforms.u_extent,l||2),s.uniform2fv(r.uniforms.u_resolution,[1/t.width,1/t.height]),s.uniform2f(r.uniforms.u_world,t.width,t.height),t.viewportVAO.bind(n,r,t.viewportBuffer,[]),s.drawArrays(s.TRIANGLE_STRIP,0,4);}function Pi(t,i){if(t._map.panoramaMode){var a=t.context,o=a.gl,r=i.getSource();if(r instanceof ee){if(a.setStencilMode(e.default$39.disabled),r.texture){var n=t.useProgram("panorama");o.uniformMatrix4fv(n.uniforms.u_matrix,!1,new Float32Array(t.transform.td_vpMatrix)),a.setColorMode(e.default$40.unblended),a.setCullFace(e.default$43.disabled),a.setDepthMode(new e.default$38(a.gl.LEQUAL,e.default$38.ReadWrite,[0,1])),a.activeTexture.set(o.TEXTURE0),o.uniform1i(n.uniforms.u_normal_resolution,0),r.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE);var s=r.sphereBuffer;r.sphereVAO.bind(a,n,s,[]),o.drawArrays(r._options.debug?o.LINE_STRIP:o.TRIANGLE_STRIP,0,s.length);}a.setDepthMode(new e.default$38(a.gl.LEQUAL,e.default$38.ReadWrite,[0,1]));}}}function Si(e,t,i,a){var o=Math.floor((i+a)/2),r=e[o];return i>a?o:r>t?Si(e,t,i,o-1):r<t?Si(e,t,o+1,a):o}var Ii=null;function Mi(e,t,i,a,o,r,n,s,l){if(!Ii)for(var u in Ii=[],t.nodeList)Ii.push(t.nodeList[u]);if(-1!==Ii.indexOf(i)){var c=parseInt(e%60),_=t.nodeList,f=null,m=null;switch(i){case _.nl:f=Ri(c,t.materialConf,"nl");break;case _.ns:f=Ri(c,t.materialConf,"ns");break;case _.sl:f=Ri(c,t.materialConf,"sl");break;case _.ss:f=Ri(c,t.materialConf,"ss");break;case _.wl:f=Ri(c,t.materialConf,"wl");break;case _.ws:f=Ri(c,t.materialConf,"ws");break;case _.el:f=Ri(c,t.materialConf,"el");break;case _.es:f=Ri(c,t.materialConf,"es");break;case _.nlR:m=Ci(c,"nl").r;break;case _.nlG:m=Ci(c,"nl").g;break;case _.nlY:m=Ci(c,"nl").y;break;case _.nsR:m=Ci(c,"ns").r;break;case _.nsG:m=Ci(c,"ns").g;break;case _.nsY:m=Ci(c,"ns").y;break;case _.slR:m=Ci(c,"sl").r;break;case _.slG:m=Ci(c,"sl").g;break;case _.slY:m=Ci(c,"sl").y;break;case _.ssR:m=Ci(c,"ss").r;break;case _.ssG:m=Ci(c,"ss").g;break;case _.ssY:m=Ci(c,"ss").y;break;case _.wlR:m=Ci(c,"wl").r;break;case _.wlG:m=Ci(c,"wl").g;break;case _.wlY:m=Ci(c,"wl").y;break;case _.wsR:m=Ci(c,"ws").r;break;case _.wsG:m=Ci(c,"ws").g;break;case _.wsY:m=Ci(c,"ws").y;break;case _.elR:m=Ci(c,"el").r;break;case _.elG:m=Ci(c,"el").g;break;case _.elY:m=Ci(c,"el").y;break;case _.esR:m=Ci(c,"es").r;break;case _.esG:m=Ci(c,"es").g;break;case _.esY:m=Ci(c,"es").y;}var p=o[f];if(p)if(r[p&&p.baseColorTexture.index||0]){s.uniform1i(l.uniforms.u_use_text,!0),s.uniform4fv(l.uniforms.u_fill_color,p.baseColorFactor||[1,1,1,1]);var h=r[p.baseColorTexture.index].isSizePowerOfTwoNoneSquare(),d=h&&n[p.sampler].wrapS||s.CLAMP_TO_EDGE;r[p.baseColorTexture.index].bind(s.LINEAR,d,h?s.LINEAR_MIPMAP_NEAREST:s.LINEAR);}else s.uniform1i(l.uniforms.u_use_text,!1),s.uniform4fv(l.uniforms.u_fill_color,p&&p.baseColorFactor||[.6,.6,.6,1]);else s.uniform1i(l.uniforms.u_use_text,!1),s.uniform4fv(l.uniforms.u_fill_color,m);}else if(r[a&&a.baseColorTexture.index||0]){s.uniform1i(l.uniforms.u_use_text,!0),s.uniform4fv(l.uniforms.u_fill_color,a.baseColorFactor||[1,1,1,1]);var g=r[a.baseColorTexture.index].isSizePowerOfTwoNoneSquare(),v=g&&n[a.sampler].wrapS||s.CLAMP_TO_EDGE;r[a.baseColorTexture.index].bind(s.LINEAR,v,g?s.LINEAR_MIPMAP_NEAREST:s.LINEAR);}else s.uniform1i(l.uniforms.u_use_text,!1),s.uniform4fv(l.uniforms.u_fill_color,a&&a.baseColorFactor||[.6,.6,.6,1]);}function Ri(e,t,i){var a=null;switch(i){case"ns":case"ss":a=10-e>=0?t["g"+(10-e)]:14-e>=0?t["y"+(14-e)]:t["r"+(59-e)];break;case"nl":case"sl":a=14-e>=0?t["r"+(14-e)]:25-e>=0?t["g"+(25-e)]:29-e>=0?t["y"+(29-e)]:t["r"+(74-e)];break;case"ws":case"es":a=29-e>=0?t["r"+(29-e)]:40-e>=0?t["g"+(40-e)]:44-e>=0?t["y"+(44-e)]:t["r"+(89-e)];break;case"wl":case"el":a=44-e>=0?t["r"+(44-e)]:55-e>=0?t["g"+(55-e)]:t["y"+(59-e)];}return a}function Ci(e,t){var i={};switch(t){case"ns":case"ss":10-e>=0?(i.r=[.1,0,0,1],i.g=[0,.8,0,1],i.y=[.1,.1,0,1]):14-e>=0?(i.r=[.1,0,0,1],i.g=[0,.1,0,1],i.y=[.8,.8,0,1]):(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]);break;case"nl":case"sl":14-e>=0?(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]):25-e>=0?(i.r=[.1,0,0,1],i.g=[0,.8,0,1],i.y=[.1,.1,0,1]):29-e>=0?(i.r=[.1,0,0,1],i.g=[0,.1,0,1],i.y=[.8,.8,0,1]):(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]);break;case"ws":case"es":29-e>=0?(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]):40-e>=0?(i.r=[.1,0,0,1],i.g=[0,.8,0,1],i.y=[.1,.1,0,1]):44-e>=0?(i.r=[.1,0,0,1],i.g=[0,.1,0,1],i.y=[.8,.8,0,1]):(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]);break;case"wl":case"el":44-e>=0?(i.r=[.8,0,0,1],i.g=[0,.1,0,1],i.y=[.1,.1,0,1]):55-e>=0?(i.r=[.1,0,0,1],i.g=[0,.8,0,1],i.y=[.1,.1,0,1]):(i.r=[.1,0,0,1],i.g=[0,.1,0,1],i.y=[.8,.8,0,1]);}return i}var Oi=["gltfModel","gltfShadowEncode","gltfModelCameraView"];function Fi(t,i,a,o,r,n,s){var l=i.animations[n.ani].channels[n.cha],u=l.path,c=l.count,_=l.input,f=l.output;e.mul(t,t,i.nodes[a].matrix);for(var m=r._map.timer.counter%_[c-1],p=0,h=0,d=0,g=0;g<c-1;g++)if(m>=_[g]&&m<=_[g+1]){p=g,h=g+1,d=(m-_[g])/(_[g+1]-_[g]);break}if("translation"===u)e.translate(t,t,e.lerp$1([],f[p].slice(0),f[h].slice(0),d));else if("rotation"===u)e.mul(t,t,e.fromQuat([],e.lerp$2([],f[p].slice(0),f[h].slice(0),d)));else if("scale"===u)e.scale(t,t,e.lerp$1([],f[p].slice(0),f[h].slice(0),d));else if("weights"===u)for(var v=f.length/_.length,y=[],x=0;x<v;x++)y.push(f[p*v+x]*(1-d)+f[h*v+x]*d),s.uniform1f(o.uniforms["u_weight"+x],f[p*v+x]*(1-d)+f[h*v+x]*d);}var Li=["gltfTile","gltfShadowEncode","gltfModelCameraView"];function Di(t,i,a,o,r,n,s,l,u,c,_,f,m,p){s.uniform1i(o.uniforms.u_use_text,a.textures.length>0),n.setDepthMode(new e.default$38(s.LESS,e.default$38.ReadWrite,[0,1])),n.activeTexture.set(s.TEXTURE2),s.uniform1i(o.uniforms.u_BaseColorSampler,2);for(var h=e.createFloat64ArrayFromAMatrix(_),d=i._clampEnabled?e.createFloat64ArrayFromAMatrix(f):null,g=!1,v=0;v<a.meshes.length;v++){var y=a.materials[a.meshes[v].material];if(s.uniform1i(o.uniforms.u_hightlight,!!a.meshes[v].highlight),s.uniform1i(o.uniforms.u_morph_weight,!1),void 0!==y&&l.getATexture(a.textures[y.baseColorTexture.index])){s.uniform1i(o.uniforms.u_use_text,!0),s.uniform4fv(o.uniforms.u_fill_color,y.baseColorFactor||[1,1,1,1]);var x=l.getATexture(a.textures[a.materials[a.meshes[v].material].baseColorTexture.index]);s.bindTexture(s.TEXTURE_2D,x.texture);}else s.uniform1i(o.uniforms.u_use_text,!1),s.uniform4fv(o.uniforms.u_fill_color,y.baseColorFactor||[1,1,1,1]),s.uniform3fv(o.uniforms.u_light,t._map.sunLight.getSunLightPos()),s.uniform3fv(o.uniforms.u_lightcolor,[1,1,1]);if(u||a.meshes[v].identityMatrix||(e.mul(h,h,a.meshes[v].matrix),d&&e.mul(d,d,a.meshes[v].matrix)),u||a.identityMatrix||(e.mul(h,h,a.matrix),d&&e.mul(d,d,a.matrix)),d&&(u&&e.rotateX(d,d,-90*e.default$11.TRANSFORM.DEG_TO_RAD),s.uniformMatrix4fv(o.uniforms.u_clamp_model_matrix,!1,new Float32Array(d))),i.videoMatchEnabled&&s.uniformMatrix4fv(o.uniforms.u_model_matrix,!1,new Float32Array(h)),!t.depthPick)if(m===e.default$11.CAMERA.DRAW_MODE.OFFSCREEN)e.mul(h,r.calculateVPMatrix(t._currentCameraView),h);else if(m===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED)for(var b=0;b<p.viewshed.length&&c.viewshedRender;b++){var w=p.viewshed[b],A=e.createFloat64ArrayIdentityMatrix();e.mul(A,r.calculateVPMatrix(w),h),s.uniformMatrix4fv(o.uniforms["u_viewshed_mat"+b],!1,new Float32Array(A)),s.uniformMatrix4fv(o.uniforms["u_view_modelmat"+b],!1,new Float32Array(h)),s.uniform3fv(o.uniforms["u_viewshed_eye"+b],r._lastSunLightStatus.geographic),s.uniform1f(o.uniforms["u_viewshed_dist"+b],p.viewshed[b]&&p.viewshed[b].farDistance||0),s.uniform1f(o.uniforms["u_viewshed_used"+b],1);}else if(m===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_ALL)for(var T=0;T<p.viewshed.length&&c.viewshedRender;T++){var E=p.viewshed[T],P=e.createFloat64ArrayIdentityMatrix();e.mul(P,r.calculateVPMatrix(E),h),s.uniformMatrix4fv(o.uniforms["u_viewshed_mat"+T],!1,new Float32Array(P)),s.uniformMatrix4fv(o.uniforms["u_view_modelmat"+T],!1,new Float32Array(h)),s.uniform3fv(o.uniforms["u_viewshed_eye"+T],r._lastSunLightStatus.geographic),s.uniform1f(o.uniforms["u_viewshed_dist"+T],p.viewshed[T]&&p.viewshed[T].farDistance||0),s.uniform1f(o.uniforms["u_viewshed_used"+T],1);}g||(e.mul(h,r.calculateVPMatrix(),h),s.uniformMatrix4fv(o.uniforms.u_matrix,!1,new Float32Array(h)),g=!0);var S=a.meshes[v].gltfVertexBuffer,I=a.meshes[v].gltfIndexBuffer;a.vao.bind(n,o,S,[],I),I.buffer&&S.buffer&&s.drawElements(I.mode,I.count,I.type,I.offset);}}var zi=function(t,i,a){this.order=[],this.orderOfPole=[],this.orderOfVectorPole=[],this.max=t,i&&(this.onRemove=i),this._projection=a||e.ProjectionType.MERCATOR,this.reset();},Ni={projection:{configurable:!0}};zi.prototype.reset=function(){if(this.onRemove)for(var e in this.data)this.onRemove(e);return this.data={},this.poleData={},this.poleVectorData={},this.order=[],this.orderOfPole=[],this.orderOfVectorPole=[],this},Ni.projection.get=function(){return this._projection},Ni.projection.set=function(e){this._projection!==e&&(this._projection=e,this.reset());},zi.prototype.has=function(e){return e.wrapped().key in this.data},zi.prototype.hasPole=function(e){return!!this.poleData[e]},zi.prototype.hasVectorPole=function(e){return!!this.poleVectorData[e]},zi.prototype._addATerrainTile=function(t,i){var a=new e.default$15,o=new e.SphereImageArray,r=new e.TriangleIndexArray;a.prepareSegment(0,o,r);var n=e.default$11.TILE.EXTENT,s=t.canonical.x,l=t.canonical.y,u=2;(u=256/Math.pow(2,t.overscaledZ))<e.default$11.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES&&(u=e.default$11.TILE_GRIDSAMPLES_SPLIT.THE_MIN_SAMPLES);for(var c=[],_=n/u,f=t.overscaledZ,m=[],p=[],h=0;h<u;h++){var d=a.prepareSegment(4*(u+1),o,r);this._xyToGeographic(c,0,h*_,f,s,l),0===m.length&&(m=c.slice(0),p=this._xyToLngLat(0,h*_,f,s,l)),o.emplaceBack(c[0]-m[0],c[1]-m[1],c[2]-m[2],0,h*_),this._xyToGeographic(c,0,(h+1)*_,f,s,l),o.emplaceBack(c[0]-m[0],c[1]-m[1],c[2]-m[2],0,(h+1)*_),d.vertexLength+=2;for(var g=1;g<=u;g++){this._xyToGeographic(c,g*_,h*_,f,s,l),o.emplaceBack(c[0]-m[0],c[1]-m[1],c[2]-m[2],g*_,h*_),this._xyToGeographic(c,g*_,(h+1)*_,f,s,l),o.emplaceBack(c[0]-m[0],c[1]-m[1],c[2]-m[2],g*_,(h+1)*_);var v=d.vertexLength;r.emplaceBack(v-2,v-1,v),r.emplaceBack(v,v-1,v+1),d.vertexLength+=2,d.primitiveLength+=2;}}return this.data[t.wrapped().key]={rtc:m,sphereSegments:a,sphereMaskedBoundsBuffer:i.createVertexBuffer(o,e.default$48.members),sphereMaskedIndexBuffer:i.createIndexBuffer(r),matrix:e.calc3dVectorTileTranslateMatrix(p,m,!1)},this.data[t.wrapped().key]},zi.prototype._addARasterPoleTerrainTile=function(t,i,a){var o=new e.default$15,r=new e.SphereImageArray,n=new e.TriangleIndexArray;o.prepareSegment(0,r,n);for(var s=e.default$11.TILE.EXTENT,l=a.canonical.x,u=a.canonical.y,c=[85.05112877980659,-85.05112877980659],_=[],f=s/128,m=i?(90-c[0])/1:-(90-c[0])/1,p=a.overscaledZ,h=360/Math.pow(2,p),d=h*(a.canonical.x+1)-180,g=h*a.canonical.x-180,v=Math.abs(d-g)/128,y=[],x=[],b=0;b<1;b++){var w=i?c[0]+(b+1)*m:c[1]+b*m,A=i?c[0]+b*m:c[1]+(b+1)*m,T=o.prepareSegment(516,r,n);this._xyToGeographic(_,0,i?0:s,p,l,u),0===y.length&&(y=_.slice(0),x=this._xyToLngLat(0,i?0:s,p,l,u)),e.transformECEFToGeographic(_,[g,w],e.default$11.TRANSFORM.R),r.emplaceBack(_[0]-y[0],_[1]-y[1],_[2]-y[2],0,b*f),e.transformECEFToGeographic(_,[g,A],e.default$11.TRANSFORM.R),r.emplaceBack(_[0]-y[0],_[1]-y[1],_[2]-y[2],0,(b+1)*f),T.vertexLength+=2;for(var E=1;E<=128;E++){e.transformECEFToGeographic(_,[g+E*v,w],e.default$11.TRANSFORM.R),r.emplaceBack(_[0]-y[0],_[1]-y[1],_[2]-y[2],E*f,b*f),e.transformECEFToGeographic(_,[g+E*v,A],e.default$11.TRANSFORM.R),r.emplaceBack(_[0]-y[0],_[1]-y[1],_[2]-y[2],E*f,(b+1)*f);var P=T.vertexLength;n.emplaceBack(P-2,P-1,P),n.emplaceBack(P,P-1,P+1),T.vertexLength+=2,T.primitiveLength+=2;}}return this.poleData[a.wrapped().key]={rtc:y,sphereSegments:o,sphereMaskedBoundsBuffer:t.createVertexBuffer(r,e.default$48.members),sphereMaskedIndexBuffer:t.createIndexBuffer(n),matrix:e.calc3dVectorTileTranslateMatrix(x,y,!1)},this.poleData[a.wrapped().key]},zi.prototype._addAPoleTerrainTile=function(t,i,a){var o=String(t.overscaledZ)+(a?"1":"0"),r=t.overscaledZ,n=new e.default$15,s=new e.SphereImageArray,l=new e.TriangleIndexArray;n.prepareSegment(0,s,l);for(var u=e.default$11.TILE.EXTENT,c=[85.04112877980658,-85.04112877980658],_=[],f=u/128,m=a?(90-c[0])/1:-(90-c[0])/1,p=r,h=Math.abs(360)/128,d=[],g=[],v=0;v<1;v++){var y=a?c[0]+(v+1)*m:c[1]+v*m,x=a?c[0]+v*m:c[1]+(v+1)*m,b=n.prepareSegment(516,s,l);this._xyToGeographic(_,0,a?0:u,p,1,0),0===d.length&&(d=_.slice(0),g=this._xyToLngLat(0,a?0:u,p,1,0)),e.transformECEFToGeographic(_,[-180,y],e.default$11.TRANSFORM.R),s.emplaceBack(_[0]-d[0],_[1]-d[1],_[2]-d[2],0,v*f),e.transformECEFToGeographic(_,[-180,x],e.default$11.TRANSFORM.R),s.emplaceBack(_[0]-d[0],_[1]-d[1],_[2]-d[2],0,(v+1)*f),b.vertexLength+=2;for(var w=1;w<=128;w++){e.transformECEFToGeographic(_,[w*h-180,y],e.default$11.TRANSFORM.R),s.emplaceBack(_[0]-d[0],_[1]-d[1],_[2]-d[2],w*f,v*f),e.transformECEFToGeographic(_,[w*h-180,x],e.default$11.TRANSFORM.R),s.emplaceBack(_[0]-d[0],_[1]-d[1],_[2]-d[2],w*f,(v+1)*f);var A=b.vertexLength;l.emplaceBack(A-2,A-1,A),l.emplaceBack(A,A-1,A+1),b.vertexLength+=2,b.primitiveLength+=2;}}return this.poleVectorData[o]={rtc:d,sphereSegments:n,sphereMaskedBoundsBuffer:i.createVertexBuffer(s,e.default$48.members),sphereMaskedIndexBuffer:i.createIndexBuffer(l),matrix:e.calc3dVectorTileTranslateMatrix(g,d,!1)},this.poleVectorData[o]},zi.prototype._xyToGeographic=function(t,i,a,o,r,n){var s=e.getSpherePos(i,a,0,r,n,o,this.projection);t[0]=s[0],t[1]=s[1],t[2]=s[2];},zi.prototype._xyToLngLat=function(t,i,a,o,r){return e.xyToLngLat(t,i,0,o,r,a,this.projection)},zi.prototype.get=function(e,t){return this.has(e)?(this.order.splice(this.order.indexOf(e.wrapped().key),1),this.order.push(e.wrapped().key),this.data[e.wrapped().key]):(this.order.push(e.wrapped().key),this._addATerrainTile(e,t))},zi.prototype.getVectorPole=function(e,t,i){var a=String(e.overscaledZ)+(i?"1":"0");return this.hasVectorPole(a)?(this.orderOfVectorPole.splice(this.orderOfVectorPole.indexOf(a),1),this.orderOfVectorPole.push(a),this.poleVectorData[a]):(this.orderOfVectorPole.push(a),this._addAPoleTerrainTile(e,t,i))},zi.prototype.getPole=function(e,t,i){var a=i.wrapped().key;return this.hasPole(a)?(this.orderOfPole.splice(this.orderOfPole.indexOf(a),1),this.orderOfPole.push(a),this.poleData[a]):(this.orderOfPole.push(a),this._addARasterPoleTerrainTile(e,t,i))},zi.prototype.remove=function(e){return this.data[e]?(this.onRemove&&this.onRemove(this.data[e]),delete this.data[e],this.order.splice(this.order.indexOf(e),1),this):this},zi.prototype.setMaxSize=function(e){for(this.max=e;this.order.length>this.max;)this.remove(this.order[0]);return this},zi.prototype.updateCacheSize=function(e){var t=(Math.ceil(e.width/256)+1)*(Math.ceil(e.height/256)+1),i=2*Math.floor(5*t);for(this.max=i;this.order.length>this.max;)this.remove(this.order[0]);return this},Object.defineProperties(zi.prototype,Ni);var Bi={color:0,intensity:1,height:2,classification:3};var ki=1;function $i(t,i,a){var o=i;if(o){t.context.bindFramebuffer.set(a?a.framebuffer:null);var r=t.context,n=r.gl,s=t.useProgram("fxaaFlsify");r.setDepthMode(e.default$38.disabled),r.activeTexture.set(n.TEXTURE2),n.bindTexture(n.TEXTURE_2D,o.colorAttachment.get()),n.uniform1i(s.uniforms.u_image,2);var l=e.createFloat64ArrayIdentityMatrix();e.ortho(l,0,t.width,t.height,0,0,1),n.uniformMatrix4fv(s.uniforms.u_matrix,!1,new Float32Array(l)),n.uniform2fv(s.uniforms.u_resolution,[t.width,t.height]),n.uniform2f(s.uniforms.u_world,t.width,t.height),t.viewportVAO.bind(r,s,t.viewportBuffer,[]),n.drawArrays(n.TRIANGLE_STRIP,0,4);}}var Ui=["bloomBrightFilter","bloomBlur","bloomBlend","screen"];function Vi(t,i,a,o,r,n){var s=i;if(s){t.context.bindFramebuffer.set(a?a.framebuffer:null);var l=t.context,u=l.gl,c=t.useProgram(o);Ui[2]===o?(l.activeTexture.set(u.TEXTURE6),u.bindTexture(u.TEXTURE_2D,n.colorAttachment.get()),u.uniform1i(c.uniforms.u_base,6),l.activeTexture.set(u.TEXTURE5),u.bindTexture(u.TEXTURE_2D,s.colorAttachment.get()),u.uniform1i(c.uniforms.u_over,5)):(l.activeTexture.set(u.TEXTURE6),u.bindTexture(u.TEXTURE_2D,s.colorAttachment.get()),u.uniform1i(c.uniforms.u_image,6));var _=e.createFloat64ArrayIdentityMatrix();e.ortho(_,0,t.width,t.height,0,0,1),u.uniformMatrix4fv(c.uniforms.u_matrix,!1,new Float32Array(_)),u.uniform2fv(c.uniforms.u_dir,r),u.uniform1f(c.uniforms.u_extent,t._map._bloomOptions.extent),u.uniform2fv(c.uniforms.u_resolution,[1/t.width,1/t.height]),u.uniform2f(c.uniforms.u_world,t.width,t.height),t.viewportVAO.bind(l,c,t.viewportBuffer,[]),u.drawArrays(u.TRIANGLE_STRIP,0,4);}}function Gi(t){var i=t.transform.getCameraPos(),a=(t.transform.painter,new e.default$28(i,Xi(t.canvasX,t.canvasY,.999999,t.transform)).intersectSphere({center:[0,0,0],radius:e.default$11.TRANSFORM.R+(t.alt?t.alt*e.default$11.TRANSFORM.R_SCALE:0)},[0,0,0]));return a?{lngLat:e.default$13.convert(e.transformGeographicToECEF([],a)),intersectPoint:a}:{lngLat:null,intersectPoint:null}}function Xi(t,i,a,o){var r=o.getCameraPos(),n=[2*t/o.width-1,1-2*i/o.height,a,1],s=[(n=function(t,i){var a=[];return e.transformMat4(a,t,i.td_projectionInverseMatrix),a=[a[0]/a[3],a[1]/a[3],a[2]/a[3],1],e.transformMat4(a,a,i.td_viewInverseMatrix),a}(n,o))[0]-r[0],n[1]-r[1],n[2]-r[2]];return e.normalize$1(s,s),s}var Wi=function(e,t,i){this.context=e,this.width=t,this.height=i,this.framebufferPool={},this.createFramebuffers(),this.createFramebufferOfPool(),this.poolSize=6;};Wi.prototype.createFramebufferOfPool=function(){for(var e=0;e<this.poolSize;e++)this.framebufferPool["key"+e]={fobj:this.createAFrameBuffer(),inUse:!1};},Wi.prototype.createFramebuffers=function(){this.pickFramebuffer=this.createAFrameBuffer(),this.shadowFramebuffer=this.createAFrameBuffer(),this.fxaaFramebuffer=this.createAFrameBuffer(),this.fxaaExcFramebuffer=this.createAFrameBuffer(),this.bloomBaseColorFramebuffer=this.createAFrameBuffer(),this.bloomFramebuffer=this.createAFrameBuffer(),this.bloomExcFramebuffer=this.createAFrameBuffer(),this.globalAtmosphereFramebuffer=this.createAFrameBuffer(),this.globalExcAtmosphereFramebuffer=this.createAFrameBuffer();},Wi.prototype.createAFrameBuffer=function(t){void 0===t&&(t=1);var i=this.context.createFramebuffer(this.width*t,this.height*t,!1),a=new e.default$4(this.context,{width:this.width*t,height:this.height*t,data:null},this.context.gl.RGBA);a.bind(this.context.gl.LINEAR,this.context.gl.CLAMP_TO_EDGE),i.colorAttachment.set(a.texture);var o=this.context.createRenderbuffer(this.context.gl.DEPTH_COMPONENT16,this.width*t,this.height*t);return i.depthAttachment.set(o),i},Wi.prototype.destoryAFramebuffer=function(e){e&&(e.destroy(),e=null);},Wi.prototype.resize=function(e,t){for(var i in this.width=e,this.height=t,this.destoryAFramebuffer(this.pickFramebuffer),this.pickFramebuffer=null,this.destoryAFramebuffer(this.shadowFramebuffer),this.shadowFramebuffer=null,this.destoryAFramebuffer(this.fxaaFramebuffer),this.fxaaFramebuffer=null,this.destoryAFramebuffer(this.fxaaExcFramebuffer),this.fxaaExcFramebuffer=null,this.destoryAFramebuffer(this.bloomBaseColorFramebuffer),this.bloomBaseColorFramebuffer=null,this.destoryAFramebuffer(this.bloomFramebuffer),this.bloomFramebuffer=null,this.destoryAFramebuffer(this.bloomExcFramebuffer),this.bloomExcFramebuffer=null,this.destoryAFramebuffer(this.globalAtmosphereFramebuffer),this.globalAtmosphereFramebuffer=null,this.destoryAFramebuffer(this.globalExcAtmosphereFramebuffer),this.globalExcAtmosphereFramebuffer=null,this.framebufferPool){var a=this.framebufferPool[i].fobj;this.destoryAFramebuffer(a),this.framebufferPool[i].fobj=null,this.framebufferPool[i]=null;}this.createFramebufferOfPool(),this.createFramebuffers();},Wi.prototype.getAFramebufferFromPool=function(){var e=null;for(var t in this.framebufferPool)this.framebufferPool[t].inUse||(e=this.framebufferPool[t].fobj,this.framebufferPool[t].inUse=!0);return e||(e=this.createAFrameBuffer(),this.framebufferPool["key"+this.poolSize]={fobj:e,inUse:!0},this.poolSize+=1),e},Wi.prototype.releaseAFramebufferOfPool=function(e){for(var t in this.framebufferPool)this.framebufferPool[t].fobj===e&&(this.framebufferPool[t].inUse=!1);};var ji={symbol:function(t,i,a,o){var r=a.paint.get("render-3d");if("translucent"===t.renderPass||r){var n=t.context;n.setStencilMode(e.default$39.disabled),n.setColorMode(t.colorModeForRenderPass()),r?"offscreen"===t.renderPass?(e.drawToExtrusionFramebuffer(t,a),0!==a.paint.get("icon-opacity").constantOr(1)&&Ct(t,i,a,o,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright")),0!==a.paint.get("text-opacity").constantOr(1)&&Ct(t,i,a,o,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright")),i.map.showCollisionBoxes&&It(t,i,a,o)):"translucent"===t.renderPass&&e.drawExtrusionTexture(t,a):(0!==a.paint.get("icon-opacity").constantOr(1)&&Ct(t,i,a,o,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright")),0!==a.paint.get("text-opacity").constantOr(1)&&Ct(t,i,a,o,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright")),i.map.showCollisionBoxes&&It(t,i,a,o));}},circle:function(t,i,a,o){if("translucent"===t.renderPass){var r=a.paint.get("circle-opacity"),n=a.paint.get("circle-stroke-width"),s=a.paint.get("circle-stroke-opacity");if(0!==r.constantOr(1)||0!==n.constantOr(1)&&0!==s.constantOr(1)){var l=t.context,u=l.gl;l.setDepthMode(t.depthModeForSublayer(0,e.default$38.ReadOnly)),l.setStencilMode(e.default$39.disabled),l.setColorMode(t.colorModeForRenderPass());for(var c=!0,_=0;_<o.length;_++){var f=o[_],m=i.getTile(f),p=m.getBucket(a);if(p){var h=t.context.program.get(),d=p.programConfigurations.get(a.id),g=t.useProgram("circle",d);if((c||g.program!==h)&&(d.setUniforms(l,g,a.paint,{zoom:t.transform.zoom}),c=!1),u.uniform1f(g.uniforms.u_camera_to_center_distance,t.transform.cameraToCenterDistance),u.uniform1i(g.uniforms.u_scale_with_map,"map"===a.paint.get("circle-pitch-scale")?1:0),"map"===a.paint.get("circle-pitch-alignment")){u.uniform1i(g.uniforms.u_pitch_with_map,1);var v=Ve(m,1,t.transform.zoom);u.uniform2f(g.uniforms.u_extrude_scale,v,v);}else u.uniform1i(g.uniforms.u_pitch_with_map,0),u.uniform2fv(g.uniforms.u_extrude_scale,t.transform.pixelsToGLUnits);u.uniformMatrix4fv(g.uniforms.u_matrix,!1,new Float32Array(t.translatePosMatrix(f.posMatrix,m,a.paint.get("circle-translate"),a.paint.get("circle-translate-anchor")))),g.draw(l,u.TRIANGLES,a.id,p.layoutVertexBuffer,p.indexBuffer,p.segments,d);}}}}},heatmap:function(t,i,a,o){if(0!==a.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){var r=t.context,n=r.gl;r.setDepthMode(t.depthModeForSublayer(0,e.default$38.ReadOnly)),r.setStencilMode(e.default$39.disabled),function(e,t,i){var a=e.gl;e.activeTexture.set(a.TEXTURE1),e.viewport.set([0,0,t.width/4,t.height/4]);var o=i.heatmapFbo;if(o)a.bindTexture(a.TEXTURE_2D,o.colorAttachment.get()),e.bindFramebuffer.set(o.framebuffer);else{var r=a.createTexture();a.bindTexture(a.TEXTURE_2D,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),o=i.heatmapFbo=e.createFramebuffer(t.width/4,t.height/4),function e(t,i,a,o){var r=t.gl;r.texImage2D(r.TEXTURE_2D,0,r.RGBA,i.width/4,i.height/4,0,r.RGBA,t.extTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:r.UNSIGNED_BYTE,null),o.colorAttachment.set(a),t.extTextureHalfFloat&&r.checkFramebufferStatus(r.FRAMEBUFFER)!==r.FRAMEBUFFER_COMPLETE&&(t.extTextureHalfFloat=null,o.colorAttachment.setDirty(),e(t,i,a,o));}(e,t,r,o);}}(r,t,a),r.clear({color:e.default$8.transparent}),r.setColorMode(new e.default$40([n.ONE,n.ONE],e.default$8.transparent,[!0,!0,!0,!0]));for(var s=!0,l=0;l<o.length;l++){var u=o[l];if(!i.hasRenderableParent(u)){var c=i.getTile(u),_=c.getBucket(a);if(_){var f=t.context.program.get(),m=_.programConfigurations.get(a.id),p=t.useProgram("heatmap",m),h=t.transform.zoom;(s||p.program!==f)&&(m.setUniforms(t.context,p,a.paint,{zoom:h}),s=!1),n.uniform1f(p.uniforms.u_extrude_scale,Ve(c,1,h)),n.uniform1f(p.uniforms.u_intensity,a.paint.get("heatmap-intensity")),n.uniformMatrix4fv(p.uniforms.u_matrix,!1,u.posMatrix),p.draw(r,n.TRIANGLES,a.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,m);}}}r.viewport.set([0,0,t.width,t.height]);}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,i){var a=t.context,o=a.gl,r=i.heatmapFbo;if(r){a.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,r.colorAttachment.get()),a.activeTexture.set(o.TEXTURE1);var n=i.colorRampTexture;n||(n=i.colorRampTexture=new e.default$4(a,i.colorRamp,o.RGBA)),n.bind(o.LINEAR,o.CLAMP_TO_EDGE),a.setDepthMode(e.default$38.disabled),a.setStencilMode(e.default$39.disabled);var s=t.useProgram("heatmapTexture"),l=i.paint.get("heatmap-opacity");o.uniform1f(s.uniforms.u_opacity,l),o.uniform1i(s.uniforms.u_image,0),o.uniform1i(s.uniforms.u_color_ramp,1);var u=e.create();e.ortho(u,0,t.width,t.height,0,0,1),o.uniformMatrix4fv(s.uniforms.u_matrix,!1,u),o.uniform2f(s.uniforms.u_world,o.drawingBufferWidth,o.drawingBufferHeight),t.viewportVAO.bind(t.context,s,t.viewportBuffer,[]),o.drawArrays(o.TRIANGLE_STRIP,0,4);}}(t,a));},line:function(t,i,a,o){var r=a.paint.get("render-3d");if("translucent"===t.renderPass||r){var n=a.paint.get("line-opacity"),s=a.paint.get("line-width");if(0!==n.constantOr(1)&&0!==s.constantOr(1)){var l=t.context;if(l.setDepthMode(t.depthModeForSublayer(0,e.default$38.ReadOnly)),l.setColorMode(t.colorModeForRenderPass()),r)if("offscreen"===t.renderPass){var u=a.paint.get("line-dasharray")?"lineSDF3d":a.paint.get("line-pattern")?"linePattern3d":"line3d";e.drawToExtrusionFramebuffer(t,a),Dt(t,i,a,o,u,!1);}else"translucent"===t.renderPass&&e.drawExtrusionTexture(t,a);else{var c=a.paint.get("line-dasharray")?"lineSDF":a.paint.get("line-pattern")?"linePattern":a.paint.get("line-gradient")?"lineGradient":"line";t.context.extFragDepth||"visible"!==a.layout.get("border-visibility")||Dt(t,i,a,o,c,!0),Dt(t,i,a,o,c,!1);}}}},fill:function(t,i,a,o){var r=a.paint.get("fill-color"),n=a.paint.get("fill-opacity");if(0!==n.constantOr(1)){var s=t.context;if(s.setColorMode(t.colorModeForRenderPass()),a.paint.get("render-3d"))"offscreen"===t.renderPass?(e.drawToExtrusionFramebuffer(t,a),$t(t,i,a,o,Ut)):"translucent"===t.renderPass&&e.drawExtrusionTexture(t,a);else{var l=a.paint.get("fill-pattern")||1!==r.constantOr(e.default$8.transparent).a||1!==n.constantOr(0)?"translucent":"opaque";t.renderPass===l&&(s.setDepthMode(t.depthModeForSublayer(1,"opaque"===t.renderPass?e.default$38.ReadWrite:e.default$38.ReadOnly)),$t(t,i,a,o,Ut)),"translucent"===t.renderPass&&a.paint.get("fill-antialias")&&(s.setDepthMode(t.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,e.default$38.ReadOnly)),$t(t,i,a,o,Vt));}}},extrusion:function(e,t,i,a){if(0!==i.paint.get("extrusion-opacity"))if("offscreen"===e.renderPass){Xt(e,i);for(var o=!0,r=0,n=a;r<n.length;r+=1){var s=n[r],l=t.getTile(s),u=l.getBucket(i);u&&(jt(e,0,i,l,s,u,o),o=!1);}}else"translucent"===e.renderPass&&Wt(e,i);},raster:function(t,i,a,o){if("translucent"===t.renderPass&&0!==a.paint.get("raster-opacity")){var r,n,s=t.context,l=s.gl,u=i.getSource(),c=t.useProgram("raster");s.setStencilMode(e.default$39.disabled),s.setColorMode(t.colorModeForRenderPass()),l.uniform1f(c.uniforms.u_brightness_low,a.paint.get("raster-brightness-min")),l.uniform1f(c.uniforms.u_brightness_high,a.paint.get("raster-brightness-max")),l.uniform1f(c.uniforms.u_saturation_factor,(r=a.paint.get("raster-saturation"))>0?1-1/(1.001-r):-r),l.uniform1f(c.uniforms.u_contrast_factor,(n=a.paint.get("raster-contrast"))>0?1/(1-n):1+n),l.uniform3fv(c.uniforms.u_spin_weights,function(e){e*=Math.PI/180;var t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}(a.paint.get("raster-hue-rotate"))),l.uniform1f(c.uniforms.u_buffer_scale,1),l.uniform1i(c.uniforms.u_image0,0),l.uniform1i(c.uniforms.u_image1,1);for(var _=o.length&&o[0].overscaledZ,f=0,m=o;f<m.length;f+=1){var p=m[f];s.setDepthMode(t.depthModeForSublayer(p.overscaledZ-_,1===a.paint.get("raster-opacity")?e.default$38.ReadWrite:e.default$38.ReadOnly,l.LESS));var h=i.getTile(p),d=t.transform.calculatePosMatrix(p.toUnwrapped(),!0);h.registerFadeDuration(a.paint.get("raster-fade-duration")),l.uniformMatrix4fv(c.uniforms.u_matrix,!1,d);var g=i.findLoadedParent(p,0,{}),v=Yt(h,g,i,a,t.transform),y=void 0,x=void 0,b="nearest"===a.paint.get("raster-resampling")?l.NEAREST:l.LINEAR;if(s.activeTexture.set(l.TEXTURE0),h.texture.bind(b,l.CLAMP_TO_EDGE),s.activeTexture.set(l.TEXTURE1),g?(g.texture.bind(b,l.CLAMP_TO_EDGE),y=Math.pow(2,g.tileID.overscaledZ-h.tileID.overscaledZ),x=[h.tileID.canonical.x*y%1,h.tileID.canonical.y*y%1]):h.texture.bind(b,l.CLAMP_TO_EDGE),l.uniform2fv(c.uniforms.u_tl_parent,x||[0,0]),l.uniform1f(c.uniforms.u_scale_parent,y||1),l.uniform1f(c.uniforms.u_fade_t,v.mix),l.uniform1f(c.uniforms.u_opacity,v.opacity*a.paint.get("raster-opacity")),u instanceof X)c.draw(s,l.TRIANGLES,a.id,u.boundsBuffer,u.indexBuffer,u.segments);else if(h.maskedBoundsBuffer&&h.maskedIndexBuffer&&h.segments)c.draw(s,l.TRIANGLES,a.id,h.maskedBoundsBuffer,h.maskedIndexBuffer,h.segments);else{var w=t.rasterBoundsBuffer;t.rasterBoundsVAO.bind(s,c,w,[]),l.drawArrays(l.TRIANGLE_STRIP,0,w.length);}}}},background:function(t,i,a){var o=a.paint.get("background-color"),r=a.paint.get("background-opacity");if(0!==r){var n=t.context,s=n.gl,l=t.transform,u=l.tileSize,c=a.paint.get("background-pattern"),_=c||1!==o.a||1!==r?"translucent":"opaque";if(t.renderPass===_){var f;if(n.setStencilMode(e.default$39.disabled),n.setDepthMode(t.depthModeForSublayer(0,"opaque"===_?e.default$38.ReadWrite:e.default$38.ReadOnly)),n.setColorMode(t.colorModeForRenderPass()),c){if(Nt(c,t))return;f=t.useProgram("backgroundPattern"),Bt(c,t,f),t.tileExtentPatternVAO.bind(n,f,t.tileExtentBuffer,[]);}else f=t.useProgram("background"),s.uniform4fv(f.uniforms.u_color,[o.r,o.g,o.b,o.a]),t.tileExtentVAO.bind(n,f,t.tileExtentBuffer,[]);s.uniform1f(f.uniforms.u_opacity,r);for(var m=0,p=l.coveringTiles({tileSize:u});m<p.length;m+=1){var h=p[m];c&&kt({tileID:h,tileSize:u},t,f),s.uniformMatrix4fv(f.uniforms.u_matrix,!1,t.transform.calculatePosMatrix(h.toUnwrapped())),s.drawArrays(s.TRIANGLE_STRIP,0,t.tileExtentBuffer.length);}}}},debug:function(e,t,i){for(var a=0;a<i.length;a++)Zt(e,t,i[a]);},tracking:function(t,a,o,r){if("translucent"===t.renderPass){var n=o.paint.get("tracking-opacity"),s=o.paint.get("tracking-width");if(0!==n.constantOr(1)&&0!==s.constantOr(1)){var l=t.context;l.setDepthMode(t.depthModeForSublayer(0,e.default$38.ReadOnly)),l.setColorMode(t.colorModeForRenderPass());var u=o.paint.get("tracking-seg-group"),c=o.paint.get("tracking-delay");if("history"===o.paint.get("tracking-type"))o.histEnd=Date.now(),o.first||(o.first=!0,o.histStart=0,o.histCount=0,o.isReverse=!1,o.isReserve=!1),o.histEnd-o.histStart>=1e3/o.paint.get("tracking-speed")&&("loop"===o.layout.get("tracking-display-mode")?(o.histCount++,o.histCount%=o.paint.get("tracking-seg-count"),o.histCount=0===o.histCount?1:o.histCount):"reverse"===o.layout.get("tracking-display-mode")?(o.histCount>=o.paint.get("tracking-seg-count")+o.paint.get("tracking-seg-group")?o.isReverse=!0:o.histCount<=1&&(o.isReverse=!1),o.histCount=o.isReverse?o.histCount-1:o.histCount+1):"loop-reserve"===o.layout.get("tracking-display-mode")?(o.isReserve=!0,o.histCount++,o.histCount%=o.paint.get("tracking-seg-count"),o.histCount=0===o.histCount?1:o.histCount):"reverse-reserve"===o.layout.get("tracking-display-mode")&&(o.isReserve=!0,o.histCount>=o.paint.get("tracking-seg-count")+o.paint.get("tracking-seg-group")?o.isReverse=!0:o.histCount<=1&&(o.isReverse=!1),o.histCount=o.isReverse?o.histCount-1:o.histCount+1),i.TRW&&i.TRW.setProgress(o.histCount),o.histStart=o.histEnd);else if(o.count||(o.start=Date.now(),o.count=1),o.end=Date.now(),o.end-o.start>=1e3/o.paint.get("tracking-speed")){var _=i.TRW;o.count+=1;var f=_&&_.hasOwnProperty("replaceOffset")?_.replaceOffset:120+c;o.count%=f;var m=_&&_.hasOwnProperty("requestOffset")?_.requestOffset:90+c;o.count===m&&_&&_.request(),0===o.count&&(_&&_.replace(),o.count=c),_&&(_.currentSeq=o.count),o.start=o.end;}!function(e,t){if(t&&t.TRW&&"null"!==t.TRW){t.TRW.layerForwards||(t.TRW.layerForwards=[]);for(var i=0;i<t.TRW.layerForwards.length;i++){var a=t.TRW.layerForwards[i];if(a.id===e.id){e.count&&(e.count+=a.count),t.TRW.layerForwards.splice(i,1);break}}}}(o,i);for(var p,h=!0,d=0,g=r;d<g.length;d+=1){var v=g[d],y=a.getTile(v),x=y.getBucket(o);if(x){var b=x.programConfigurations.get(o.id),w=t.context.program.get(),A=t.useProgram("tracking",b),T=h||A.program!==w,E=p!==y.tileID.overscaledZ;T&&b.setUniforms(t.context,A,o.paint,{zoom:t.transform.zoom}),Qt(A,t,y,x,o,v,b,T,E,"history"===o.paint.get("tracking-type")?o.histCount:o.count,o.isReverse,o.isReserve,u),p=y.tileID.overscaledZ,h=!1;}}}}},sprite:function(t,i,a,o){if("translucent"===t.renderPass){var r=a.paint.get("sprite-opacity"),n=a.paint.get("sprite-width");if(0!==r.constantOr(1)&&0!==n.constantOr(1)){var s=t.context;s.setDepthMode(t.depthModeForSublayer(0,e.default$38.ReadOnly)),s.setColorMode(t.colorModeForRenderPass());var l,u=!0;a.speeds||(a.speeds={});var c=a.paint.get("sprite-speed-factor");a.speeds.hasOwnProperty("speed"+c)||(a.speeds["speed"+c]=0),a.speeds["speed"+c]+=1,a.speeds["speed"+c]%=1===c?20:2===c?80:3===c?150:240;for(var _=0,f=o;_<f.length;_+=1){var m=f[_],p=i.getTile(m),h=p.getBucket(a);if(h){var d=h.programConfigurations.get(a.id),g=t.context.program.get(),v=t.useProgram("sprite",d),y=u||v.program!==g,x=l!==p.tileID.overscaledZ;y&&d.setUniforms(t.context,v,a.paint,{zoom:t.transform.zoom}),Kt(v,t,p,h,a,m,d,y,x),l=p.tileID.overscaledZ,u=!1;}}}}},symtracking:function(t,a,o,r){if("translucent"===t.renderPass){this.start||(this.start=Date.now(),this.count=0),this.end=Date.now();var n=o.layout.get("symtracking-fps"),s=o.layout.get("symtracking-time-segment");ti=o.paint.get("symtracking-delay");var l=i.TRW;if(l&&l.hasOwnProperty("resetToStartPos")&&l.resetToStartPos&&(this.count=0,l.resetToStartPos=!1),this.end-this.start>=1e3/n){this.count+=1;var u=i.TRW&&i.TRW.hasOwnProperty("replaceOffset")?i.TRW.replaceOffset:n*(s+ti);this.count%=u;var c=i.TRW&&i.TRW.hasOwnProperty("requestOffset")?i.TRW.requestOffset:s*n;this.count===c&&i.TRW&&i.TRW.hasOwnProperty("request")&&i.TRW.request(),0===this.count&&(i.TRW&&i.TRW.hasOwnProperty("replace")&&i.TRW.replace(),this.count=ti),i.TRW&&(i.TRW.currentSeq=this.count),ei=this.count,i.TRW&&i.TRW.hasOwnProperty("setProgress")&&i.TRW.setProgress(ei),this.start=this.end;}var _=t.context;_.setStencilMode(e.default$39.disabled),_.setColorMode(t.colorModeForRenderPass()),0!==o.paint.get("icon-opacity").constantOr(1)&&ii(t,a,o,r,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),ei),0!==o.paint.get("text-opacity").constantOr(1)&&ii(t,a,o,r,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),ei),a.map.showCollisionBoxes&&It(t,a,o,r);}},histogram:function(t,a,o,r){if(0!==o.paint.get("histogram-opacity")){if(o.hasOwnProperty("_hasRendered")||(o._hasRendered=!0),o.paint.get("histogram-dynamic"))if(o.hasOwnProperty("_transform")&&o.hasOwnProperty("_count")||(o._transform=Date.now(),o._count=0),i.TRW&&!i.TRW.stayStatic){var n=Date.now()-o._transform;o._count+=n/o.paint.get("histogram-time")*500,o._count>=500*o.paint.get("histogram-count")&&(o._count=0),o._transform=Date.now();}else o._transform=Date.now();if("offscreen"===t.renderPass){e.drawToExtrusionFramebuffer(t,o);for(var s=!0,l=0,u=r;l<u.length;l+=1){var c=u[l],_=a.getTile(c),f=_.getBucket(o);f&&(ni(t,0,o,_,c,f,s),s=!1);}}else"translucent"===t.renderPass&&e.drawExtrusionTexture(t,o);}},custom:function(t,i,a){var o=t.context,r=a.implementation;if("offscreen"===t.renderPass){var n=r.prerender;n&&(t.setCustomLayerDefaults(),n.call(r,o.gl,t.transform.customLayerMatrix()),o.setDirty(),t.setBaseState()),"3d"===r.renderingMode&&(t.setCustomLayerDefaults(),Xt(t,a),r.render(o.gl,t.transform.customLayerMatrix()),o.setDirty(),t.setBaseState());}else"translucent"===t.renderPass&&("3d"===r.renderingMode?Wt(t,a):(t.setCustomLayerDefaults(),o.setStencilMode(e.default$39.disabled),o.setDepthMode(e.default$38.disabled),r.render(o.gl,t.transform.customLayerMatrix()),o.setDirty(),t.setBaseState(),o.bindFramebuffer.set(null)));},panorama:Pi},Yi={sphere:function(t,i){var a=t.cameraDrawMode;if(!t.depthPick&&a!==e.default$11.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED&&a!==e.default$11.CAMERA.DRAW_MODE.OFFSCREEN){var o=t.context,r=o.gl,n=i.getSource();if(r.enable(r.POLYGON_OFFSET_FILL),r.polygonOffset(0,4),n instanceof Y&&n.texture){i.id!==e.default$11.SOURCE.SKYBOX_SOURCE_ID&&t._map.clipGroundState&&o.setStencilMode(e.default$39.openClipGround);var s=t.transform,l=null;if(i.id===e.default$11.SOURCE.GLOBAL_SOURCE_ID){if(n.renderAtmosphere&&s.zoom<8){l=t.useProgram(Ti[1]),o.bindFramebuffer.set(t.fbManager.globalExcAtmosphereFramebuffer.framebuffer),o.clear({color:new e.default$8(1,1,1,0),depth:1}),o.bindFramebuffer.set(t.fbManager.globalAtmosphereFramebuffer.framebuffer),o.clear({color:new e.default$8(1,1,1,0),depth:1}),o.setColorMode(e.default$40.unblended),o.setDepthMode(e.default$38.disabled),o.setCullFace(e.default$43.disabled),r.uniform2fv(l.uniforms.u_resolution,[t.width,t.height]),r.uniformMatrix4fv(l.uniforms.u_matrix,!1,new Float32Array(s.calculateVPMatrix({id:e.default$11.CAMERA.ATMOSPHERE_BLEND_CAMERA_ID,pitch:s.pitch,bearing:s.bearing,altitude:0})));var u=t.sphereBuffer;t.sphereVAO.bind(o,l,u,[]),r.drawArrays(n._options.debug?r.LINE_STRIP:r.TRIANGLE_STRIP,0,u.length),l=t.useProgram(Ti[2]);for(var c=0;c<1;c++)Ei(t,t.fbManager.globalAtmosphereFramebuffer,t.fbManager.globalExcAtmosphereFramebuffer.framebuffer,[0,1],l,o,r,2),Ei(t,t.fbManager.globalExcAtmosphereFramebuffer,t.fbManager.globalAtmosphereFramebuffer.framebuffer,[1,0],l,o,r,2);o.setColorMode(new e.default$40([r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA],e.default$8.transparent,[!0,!0,!0,!0])),l=t.useProgram(Ti[3]),Ei(t,t.fbManager.globalAtmosphereFramebuffer,t.getDefaultFrameBuffer(),[1,0],l,o,r);}o.setCullFace(e.default$43.backCCW),l=t.useProgram(Ti[0]),r.uniformMatrix4fv(l.uniforms.u_matrix,!1,new Float32Array(s.calculateVPMatrix())),t.style._sunLightFlag?(r.uniform1i(l.uniforms.u_with_light,!0),r.uniform3fv(l.uniforms.u_light,t._map.sunLight.getSunLightPos()),r.uniform3fv(l.uniforms.u_lightcolor,[1,1,1]),r.uniform3fv(l.uniforms.u_cam,s.getCameraPos())):r.uniform1i(l.uniforms.u_with_light,!1);}else if(i.id===e.default$11.SOURCE.SKYBOX_SOURCE_ID){l=t.useProgram(Ti[0]);var _={id:e.default$11.CAMERA.SKYBOX_CAMERA_ID,pitch:s.pitch,bearing:-s.bearing,altitude:0};r.uniformMatrix4fv(l.uniforms.u_matrix,!1,new Float32Array(e.scale([],s.calculateVPMatrix(Ai.createACameraView(_)),[e.default$11.TRANSFORM.R_SCALE,e.default$11.TRANSFORM.R_SCALE,e.default$11.TRANSFORM.R_SCALE]))),r.uniform1i(l.uniforms.u_with_light,!1);}o.setColorMode(e.default$40.unblended),r.uniform1i(l.uniforms.u_fog_render,!1),i.id!==e.default$11.SOURCE.SKYBOX_SOURCE_ID?o.setDepthMode(new e.default$38(o.gl.LEQUAL,e.default$38.ReadWrite,[.1,1])):o.setDepthMode(e.default$38.disabled),n.nightTexture?(o.activeTexture.set(r.TEXTURE13),r.uniform1i(l.uniforms.u_image2,13),n.nightTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.uniform1i(l.uniforms.u_with_nighttexture,!0)):r.uniform1i(l.uniforms.u_with_nighttexture,!1),o.activeTexture.set(r.TEXTURE12),r.uniform1i(l.uniforms.u_image0,12),n.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),n.dayTexture?(o.activeTexture.set(r.TEXTURE1),r.uniform1i(l.uniforms.u_image1,1),n.dayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.uniform1i(l.uniforms.u_with_daytexture,!0),r.uniform1f(l.uniforms.u_daytex_percent,e.clamp((s.zoom-3)/10,0,1))):r.uniform1i(l.uniforms.u_with_daytexture,!1);var f=t.sphereBuffer;t.sphereVAO.bind(o,l,f,[]),r.drawArrays(n._options.debug?r.LINE_STRIP:r.TRIANGLE_STRIP,0,f.length),i.id!==e.default$11.SOURCE.SKYBOX_SOURCE_ID&&o.setStencilMode(e.default$39.disabled);}o.setDepthMode(new e.default$38(o.gl.LEQUAL,e.default$38.ReadWrite,[0,1])),o.setStencilMode(e.default$39.disabled),o.setCullFace(e.default$43.disabled),r.disable(r.POLYGON_OFFSET_FILL);}},"sphere-raster":function(t,i,a,o){if("translucent"===t.renderPass&&a.paint&&0!==a.paint.get("sphere-raster-opacity")){var r,n,s=t.context,l=s.gl,u=i.getSource(),c=t.useProgram("sphereRaster");t._map.clipGroundState&&s.setStencilMode(e.default$39.openClipGround),s.setColorMode(new e.default$40([l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA],e.default$8.transparent,[!0,!0,!0,!0])),!i._source.renderWithTerrain||t.transform.zoom<e.default$11.TRANSFORM.TERRAIN_FIND_ZOOM_MIN?(t.context.setDepthMode(e.default$38.disabled),t.context.setCullFace(new e.default$43(!0,l.BACK,l.CCW))):t.context.setDepthMode(new e.default$38(l.LESS,e.default$38.ReadWrite,[0,1])),l.uniform1f(c.uniforms.u_brightness_low,a.paint.get("sphere-raster-brightness-min")),l.uniform1f(c.uniforms.u_brightness_high,a.paint.get("sphere-raster-brightness-max")),l.uniform1f(c.uniforms.u_saturation_factor,(r=a.paint.get("sphere-raster-saturation"))>0?1-1/(1.001-r):-r),l.uniform1f(c.uniforms.u_contrast_factor,(n=a.paint.get("sphere-raster-contrast"))>0?1/(1-n):1+n),l.uniform3fv(c.uniforms.u_spin_weights,function(e){e*=Math.PI/180;var t=Math.sin(e),i=Math.cos(e);return[(2*i+1)/3,(-Math.sqrt(3)*t-i+1)/3,(Math.sqrt(3)*t-i+1)/3]}(a.paint.get("sphere-raster-hue-rotate"))),l.uniform1f(c.uniforms.u_buffer_scale,1),l.uniform1i(c.uniforms.u_image0,0),l.uniform1i(c.uniforms.u_image1,1),l.uniform1i(c.uniforms.u_isPole,!1),t.style._sunLightFlag?(l.uniform1i(c.uniforms.u_with_light,!0),l.uniform3fv(c.uniforms.u_light,t._map.sunLight.getSunLightPos()),l.uniform3fv(c.uniforms.u_lightcolor,[1,1,1]),l.uniform3fv(c.uniforms.u_cam,t.transform.getCameraPos())):l.uniform1i(c.uniforms.u_with_light,!1),l.uniform1i(c.uniforms.u_fog_render,!1),i._source.renderWithTerrain&&i.clearSTTCInUseStatus();for(var _=o.length>0?o[o.length-1].overscaledZ:1,f={},m=0,p=o;m<p.length;m+=1){var h=p[m];if(!f[h.key]){f[h.key]=!0;var d=i.getTile(h);t.context.setDepthMode(new e.default$38(l.LEQUAL,e.default$38.ReadWrite,[0,1])),d.terrainData&&(l.uniform1i(c.uniforms.u_edgediscard,!0),l.uniform1f(c.uniforms.u_tile_zoom,d.tileID.overscaledZ)),d.registerFadeDuration(a.paint.get("sphere-raster-fade-duration"));var g=i.findLoadedParent(h,0,{}),v=void 0,y=void 0,x="nearest"===a.paint.get("sphere-raster-resampling")?l.NEAREST:l.LINEAR;if(s.activeTexture.set(l.TEXTURE0),d.texture.bind(x,l.CLAMP_TO_EDGE),s.activeTexture.set(l.TEXTURE1),g?(g.texture.bind(x,l.CLAMP_TO_EDGE),v=Math.pow(2,g.tileID.overscaledZ-d.tileID.overscaledZ),y=[d.tileID.canonical.x*v%1,d.tileID.canonical.y*v%1]):d.texture.bind(x,l.CLAMP_TO_EDGE),l.uniform2fv(c.uniforms.u_tl_parent,y||[0,0]),l.uniform1f(c.uniforms.u_scale_parent,v||1),l.uniform1f(c.uniforms.u_opacity,a.paint.get("sphere-raster-opacity")),l.uniform1i(c.uniforms.u_terrain,!!d.terrainData),u instanceof X)l.uniformMatrix4fv(c.uniforms.u_matrix,!1,new Float32Array(e.mul([],t.transform.calculateVPMatrix(),u.matrix))),l.uniformMatrix4fv(c.uniforms.u_model_matrix,!1,new Float32Array(u.matrix)),l.uniform1i(c.uniforms.u_is_image,!0),c.draw(s,l.TRIANGLES,a.id,u.sphereBoundsBuffer,u.sphereIndexBuffer,u.sphereSegments);else if(d.terrainData)l.uniformMatrix4fv(c.uniforms.u_matrix,!1,new Float32Array(e.mul([],t.transform.calculateVPMatrix(),d.terrainData.matrix))),l.uniformMatrix4fv(c.uniforms.u_model_matrix,!1,new Float32Array(d.terrainData.matrix)),_-h.overscaledZ<=1?s.setDepthMode(new e.default$38(l.LEQUAL,e.default$38.ALWAYS,[0,1])):s.setDepthMode(new e.default$38(l.LEQUAL,e.default$38.ReadWrite,[0,1])),c.draw(s,l.TRIANGLES,a.id,d.terrainData.sphereMaskedBoundsBuffer,d.terrainData.sphereMaskedIndexBuffer,d.terrainData.sphereSegments);else{var b=t.sphereTileVerticeCache.get(d.tileID,s);l.uniformMatrix4fv(c.uniforms.u_matrix,!1,new Float32Array(e.mul([],t.transform.calculateVPMatrix(),b.matrix))),l.uniformMatrix4fv(c.uniforms.u_model_matrix,!1,new Float32Array(b.matrix)),a.depthTest?_-h.overscaledZ>0?s.setDepthMode(e.default$38.disabled):s.setDepthMode(new e.default$38(l.LEQUAL,e.default$38.ReadWrite,[0,1])):s.setDepthMode(e.default$38.disabled),c.draw(s,l.TRIANGLES,a.id,b.sphereMaskedBoundsBuffer,b.sphereMaskedIndexBuffer,b.sphereSegments);}}}t.transform.projection===e.ProjectionType.MERCATOR&&t.transform.td_lastRect.isPole&&function(t,i,a,o){var r=t.context,n=r.gl,s=i.getSource(),l=t.useProgram("sphereRaster");if(!(s instanceof X)&&o.length>0){r.setStencilMode(e.default$39.openClipGround),t.context.setCullFace(new e.default$43(!0,n.BACK,n.CCW)),t.context.setDepthMode(new e.default$38(n.LESS,e.default$38.ReadWrite,[0,1])),n.uniform1f(l.uniforms.u_buffer_scale,1),n.uniform1i(l.uniforms.u_image0,0);for(var u=o.length>0?o[o.length-1].overscaledZ:1,c=!1,_=0,f=o;_<f.length;_+=1){var m=f[_];if(0===m.canonical.y)c=!0;else{if(m.canonical.y!==Math.pow(2,m.overscaledZ)-1)continue;c=!1;}var p=i.getTile(m);if(p.terrainData)return;n.uniform1f(l.uniforms.u_edgediscard,0),t.context.setDepthMode(new e.default$38(n.LESS,e.default$38.ReadWrite,[0,1]));var h=t.transform;n.uniformMatrix4fv(l.uniforms.u_matrix,!1,new Float32Array(h.calculateVPMatrix())),p.registerFadeDuration(a.paint.get("sphere-raster-fade-duration"));var d="nearest"===a.paint.get("sphere-raster-resampling")?n.NEAREST:n.LINEAR;r.activeTexture.set(n.TEXTURE0),p.texture.bind(d,n.CLAMP_TO_EDGE),n.uniform2fv(l.uniforms.u_tl_parent,[0,0]),n.uniform1f(l.uniforms.u_scale_parent,1),n.uniform1i(l.uniforms.u_terrain,!1),n.uniform1i(l.uniforms.u_isNorth,c);var g=t.sphereTileVerticeCache.getPole(r,c,m);n.uniform1i(l.uniforms.u_isPole,!0),n.uniformMatrix4fv(l.uniforms.u_matrix,!1,new Float32Array(e.mul([],t.transform.calculateVPMatrix(),g.matrix))),a.depthTest?u-m.overscaledZ>0?r.setDepthMode(e.default$38.disabled):r.setDepthMode(new e.default$38(n.LEQUAL,e.default$38.ReadWrite,[0,1])):r.setDepthMode(e.default$38.disabled),l.draw(r,n.TRIANGLES,a.id,g.sphereMaskedBoundsBuffer,g.sphereMaskedIndexBuffer,g.sphereSegments);}r.setCullFace(e.default$43.disabled),r.setStencilMode(e.default$39.disabled);}}(t,i,a,o),s.setCullFace(e.default$43.disabled),s.setStencilMode(e.default$39.disabled),s.setDepthMode(e.default$38.disabled);}},"sphere-fill":function(t,i,a,o){if(0!==a.paint.get("fill-opacity").constantOr(1)){var r=t.context;r.setColorMode(e.default$40.alphaBlended),r.setDepthMode(e.default$38.disabled);var n=r.gl;t._map.clipGroundState&&r.setStencilMode(e.default$39.openClipGround),r.setCullFace(new e.default$43(!0,n.BACK,n.CW)),function(e,t,i,a,o){if(!Nt(i.paint.get("fill-pattern"),e))for(var r=!0,n=0,s=a;n<s.length;n+=1){var l=s[n],u=t.getTile(l),c=u.getBucket(i);c&&(o(e,t,i,u,l,c,r),r=!1);}}(t,i,a,o,si),r.setCullFace(e.default$43.disabled),r.setStencilMode(e.default$39.disabled);}},"3d-tile":function(t,i,a,o){var r,n=t.cameraDrawMode;r=n===e.default$11.CAMERA.DRAW_MODE.OFFSCREEN?t.useProgram(Li[1]):n===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||n===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||n===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_ALL?t.useProgram(Li[2]):t.useProgram(Li[0]);var s=i.getSource();t.context.setColorMode(e.default$40.unblended),t.context.setStencilMode(e.default$39.disabled),t.context.setCullFace(e.default$43.backCCW),s instanceof Q&&i.idealTileIDs&&function(t,i,a,o,r){var n=t.transform,s=t.context,l=s.gl,u=i.getSource(),c=u.tileJson.type===e.default$11.MODEL_TYPE.OSGB,_=e.createFloat64ArrayIdentityMatrix();_=e.calc3dModelTranslateMatrix(u.flipYZ||c,u,_);var f=e.createFloat64ArrayIdentityMatrix();if(u.videoMatchEnabled&&u.videoBounds){l.uniform1i(r.uniforms["u_vs.use"],1),l.uniform3fv(r.uniforms["u_vs.planeP1P2"],u.videoBounds.planeP1P2),l.uniform3fv(r.uniforms["u_vs.planeP2P3"],u.videoBounds.planeP2P3),l.uniform3fv(r.uniforms["u_vs.planeP3P4"],u.videoBounds.planeP3P4),l.uniform3fv(r.uniforms["u_vs.planeP4P1"],u.videoBounds.planeP4P1),l.uniform3fv(r.uniforms["u_vs.p1"],u.videoBounds.p1),l.uniform3fv(r.uniforms["u_vs.p2"],u.videoBounds.p2),l.uniform3fv(r.uniforms["u_vs.p3"],u.videoBounds.p3),l.uniform3fv(r.uniforms["u_vs.p4"],u.videoBounds.p4),l.uniform2fv(r.uniforms["u_vs.d1Sqrt"],u.videoBounds.d1Sqrt),l.uniform2fv(r.uniforms["u_vs.d2Sqrt"],u.videoBounds.d2Sqrt),l.uniform2fv(r.uniforms["u_vs.d3Sqrt"],u.videoBounds.d3Sqrt),l.uniform2fv(r.uniforms["u_vs.d4Sqrt"],u.videoBounds.d4Sqrt),l.uniform4fv(r.uniforms["u_vs.offset"],u.videoMatchOption.offset||[0,0,0,0]),s.activeTexture.set(l.TEXTURE11),l.uniform1i(r.uniforms.u_video_sampler,11);var m=u.videoTexture;m&&m.bind(l.LINEAR,l.CLAMP_TO_EDGE);}else l.uniform1i(r.uniforms["u_vs.use"],0);if(l.uniform1i(r.uniforms.u_bgr2rgb,!!a.cvtBGR2RGB),c?e.translate(f,f,[u.translation[0],u.translation[1],-u.translation[2]]||[0,0,0]):e.translate(f,f,u.translation||[0,0,0]),u._clampEnabled?(l.uniform1f(r.uniforms.u_clamp_ratio,1),l.uniform3fv(r.uniforms.u_min_clamp_bounds,u.minClampBounds||[0,0,0]),l.uniform3fv(r.uniforms.u_max_clamp_bounds,u.maxClampBounds||[0,0,0]),l.uniform4fv(r.uniforms.u_clamp_plane,u.clampPlane),l.uniform2fv(r.uniforms.u_x_clamp_range,u.ratioRange[0]),l.uniform2fv(r.uniforms.u_y_clamp_range,u.ratioRange[1]),l.uniform2fv(r.uniforms.u_z_clamp_range,u.ratioRange[2]),l.uniform3fv(r.uniforms.u_clamp_box,[u.clampBox.x,u.clampBox.y,u.clampBox.z]),l.uniform1f(r.uniforms.u_clamp_box_inner,u.clampBox.inner),l.uniformMatrix4fv(r.uniforms.u_clamp_matrix,!1,new Float32Array(u.clampBoxMatrix))):l.uniform1f(r.uniforms.u_clamp_ratio,0),t.style._sunLightFlag&&!c){var p=e.transpose([],e.invert([],_));l.uniformMatrix4fv(r.uniforms.u_normal,!1,new Float32Array(p)),l.uniform1i(r.uniforms.u_with_light,!0),l.uniform3fv(r.uniforms.u_light,t._map.sunLight.getSunLightPos()),l.uniform3fv(r.uniforms.u_lightcolor,[1,1,1]);}else l.uniform1i(r.uniforms.u_with_light,!1);var h=t.activeCameras,d=t.cameraDrawMode;if(l.uniform1f(r.uniforms.u_viewshed_count,0),d===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||d===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_ALL){var g=t.fbManager.shadowFramebuffer;g&&(s.activeTexture.set(l.TEXTURE10),l.bindTexture(l.TEXTURE_2D,g.colorAttachment.get()),l.uniform1i(r.uniforms.u_shadow_sampler,10)),l.uniform1f(r.uniforms.u_shadow_off,t.shadowOff);}if(a.viewshedRender&&(d===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||d===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_ALL)){var v=h.viewshed[0].fb;v&&(s.activeTexture.set(l.TEXTURE11),l.bindTexture(l.TEXTURE_2D,v.colorAttachment.get()),l.uniform1i(r.uniforms.u_viewshed_samp0,11)),l.uniform1f(r.uniforms.u_shadow_off,t.shadowOff),l.uniform1f(r.uniforms.u_viewshed_count,h.viewshed.length);}for(var y=0,x=i.idealTileIDs;y<x.length;y+=1){var b=x[y],w=i.getTile(b);w&&w.meshes.length>0&&(c?"loaded"===w.state&&Di(t,u,w,r,n,s,l,i.sharedTexture,c,a,_,f,d,h):Di(t,u,w,r,n,s,l,i.sharedTexture,c,a,_,f,d,h));}}(t,i,a,0,r),t.context.setCullFace(e.default$43.disabled),t.context.gl.uniform1i(r.uniforms.u_bgr2rgb,!1);},"sphere-line":function(t,i,a,o){var r=a.paint.get("line-opacity"),n=a.paint.get("line-width");if(0!==r.constantOr(1)&&0!==n.constantOr(1)){var s=t.context;s.setColorMode(e.default$40.alphaBlended),s.setDepthMode(new e.default$38(s.gl.LEQUAL,e.default$38.ReadOnly,[0,1]));var l=s.gl;t._map.clipGroundState&&s.setStencilMode(e.default$39.openClipGround),l.enable(l.POLYGON_OFFSET_FILL);var u=a.paint.get("line-dasharray")?"sphereLineSDF":a.paint.get("line-pattern")?"sphereLinePattern":a.paint.get("line-gradient")?"sphereLineGradient":"sphereLine";t.context.extFragDepth||"visible"!==a.layout.get("border-visibility")||li(t,i,a,o,u,!0),li(t,i,a,o,u,!1),s.setStencilMode(e.default$39.disabled),l.disable(l.POLYGON_OFFSET_FILL);}},"sphere-circle":function(t,i,a,o){var r=a.paint.get("circle-opacity"),n=a.paint.get("circle-stroke-width"),s=a.paint.get("circle-stroke-opacity");if(0!==r.constantOr(1)||0!==n.constantOr(1)&&0!==s.constantOr(1)){var l=t.context,u=l.gl;l.setColorMode(e.default$40.alphaBlended),a.depthTest?l.setDepthMode(new e.default$38(l.gl.LEQUAL,e.default$38.ReadWrite,[0,1])):l.setDepthMode(e.default$38.disabled),l.setStencilMode(e.default$39.disabled);for(var c=!0,_=0;_<o.length;_++){var f=o[_],m=i.getTile(f).getBucket(a);if(m){var p=t.context.program.get(),h=m.programConfigurations.get(a.id),d=t.useProgram("sphereCircle",h);(c||d.program!==p)&&(h.setUniforms(l,d,a.paint,{zoom:t.transform.zoom}),c=!1),u.uniform2f(d.uniforms.u_gl_units_to_pixels,t.transform.width/2,-t.transform.height/2);var g=e.create$4();e.scale$2(g,g,[1,"map"===a.paint.get("circle-pitch-alignment")?Math.cos(t.transform._pitch):1]),e.rotate(g,g,t.transform.angle),u.uniformMatrix2fv(d.uniforms.u_pixel_matrix,!1,g),u.uniformMatrix4fv(d.uniforms.u_matrix,!1,new Float32Array(e.mul([],t.transform.calculateVPMatrix(),m.tilePlane.matrix))),u.uniformMatrix4fv(d.uniforms.u_modelMatrix,!1,new Float32Array(m.tilePlane.matrix)),u.uniform3fv(d.uniforms.u_camPos,t.transform.getCameraPos()),u.uniform1f(d.uniforms.u_tangentAngle,t.transform.current_zoom_tangent_angle),d.draw(l,u.TRIANGLES,a.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,h);}}}},"sphere-heatmap":function(t,i,a,o){if(0!==a.paint.get("heatmap-opacity")){var r=t.context,n=r.gl;if("offscreen"===t.renderPass){r.setCullFace(e.default$43.disabled),function(e,t,i){var a=e.gl;e.activeTexture.set(a.TEXTURE1),e.viewport.set([0,0,t.width,t.height]);var o=i.heatmapFbo;if(o)a.bindTexture(a.TEXTURE_2D,o.colorAttachment.get()),e.bindFramebuffer.set(o.framebuffer);else{var r=a.createTexture();a.bindTexture(a.TEXTURE_2D,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),o=i.heatmapFbo=e.createFramebuffer(t.width,t.height),function e(t,i,a,o){var r=t.gl;r.texImage2D(r.TEXTURE_2D,0,r.RGBA,i.width,i.height,0,r.RGBA,t.extTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:r.UNSIGNED_BYTE,null),o.colorAttachment.set(a),t.extTextureHalfFloat&&r.checkFramebufferStatus(r.FRAMEBUFFER)!==r.FRAMEBUFFER_COMPLETE&&(t.extTextureHalfFloat=null,o.colorAttachment.setDirty(),e(t,i,a,o));}(e,t,r,o);}}(r,t,a),r.clear({color:e.default$8.transparent}),r.setColorMode(new e.default$40([n.ONE,n.ONE],e.default$8.transparent,[!0,!0,!0,!0]));for(var s=!0,l=0;l<o.length;l++){var u=o[l];if(!i.hasRenderableParent(u)){var c=i.getTile(u).getBucket(a);if(c){var _=t.context.program.get(),f=c.programConfigurations.get(a.id),m=t.useProgram("sphereHeatmap",f),p=t.transform.zoom;(s||m.program!==_)&&(f.setUniforms(t.context,m,a.paint,{zoom:p}),s=!1),n.uniform1f(m.uniforms.u_intensity,a.paint.get("heatmap-intensity")),n.uniform1f(m.uniforms.u_deviceWidth,t.width),n.uniform1f(m.uniforms.u_deviceHeight,t.height);var h=t.transform;n.uniformMatrix4fv(m.uniforms.u_matrix,!1,new Float32Array(h.calculateVPMatrix())),n.uniform3fv(m.uniforms.u_camera_pos,h.getCameraPos()),m.draw(r,n.TRIANGLES,a.id,c.layoutVertexBuffer,c.indexBuffer,c.segments,f);}}}r.viewport.set([0,0,t.width,t.height]),r.bindFramebuffer.set(null);}else if("translucent"===t.renderPass){var d=t.context;d.setColorMode(e.default$40.alphaBlended),t._map.clipGroundState&&d.setStencilMode(e.default$39.openClipGround),function(t,i){var a=t.context,o=a.gl,r=i.heatmapFbo;if(r){a.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,r.colorAttachment.get()),a.activeTexture.set(o.TEXTURE1);var n=i.colorRampTexture;n||(n=i.colorRampTexture=new e.default$4(a,i.colorRamp,o.RGBA)),n.bind(o.LINEAR,o.CLAMP_TO_EDGE),a.setDepthMode(e.default$38.disabled);var s=t.useProgram("heatmapTexture"),l=i.paint.get("heatmap-opacity");o.uniform1f(s.uniforms.u_opacity,l),o.uniform1i(s.uniforms.u_image,0),o.uniform1i(s.uniforms.u_color_ramp,1);var u=e.createFloat64ArrayIdentityMatrix();e.ortho(u,0,t.width,t.height,0,0,1),o.uniformMatrix4fv(s.uniforms.u_matrix,!1,new Float32Array(u)),o.uniform2f(s.uniforms.u_world,o.drawingBufferWidth,o.drawingBufferHeight),t.viewportVAO.bind(t.context,s,t.viewportBuffer,[]),o.drawArrays(o.TRIANGLE_STRIP,0,4);}}(t,a),d.setStencilMode(e.default$39.disabled);}}},"3d-model":function(t,i,a){if(!a||!a.visibility||"none"!==a.visibility){var o,r=t.context,n=r.gl,s=t.cameraDrawMode;o=s===e.default$11.CAMERA.DRAW_MODE.OFFSCREEN||s===e.default$11.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED?t.useProgram(Oi[1]):s===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||s===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||s===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_ALL?t.useProgram(Oi[2]):a.isSpecialLight?t.useProgram("specialLight"):t.useProgram(Oi[0]);var l=i.getSource(),u=l.configuration,c=u.renderType;if("dyn_heatmap2"===c)return function(t,i,a){if(!a||!a.visibility||"none"!==a.visibility){var o=t.context,r=o.gl,n=t.useProgram("tdModelHeatmap"),s=i.getSource(),l=s.configuration;r.uniform1i(n.uniforms.u_r_heatmap,!0),r.uniform1f(n.uniforms.u_h_heatmap,l.dynMaxHeight),r.uniform1f(n.uniforms.u_height_scale,l.heightScale);var u=l.speedFactor||6,c=t._map.timer.counter*u%(60*l.loopCount),_=Math.floor(c/60);if(r.uniform1f(n.uniforms.u_animate_pos,_),r.uniform1f(n.uniforms.u_animate_seg_percent,c/60-_),s instanceof J&&s.meshes.length>0){a.clipGround&&(r.enable(r.STENCIL_TEST),r.stencilFunc(r.ALWAYS,1,255),r.stencilOp(r.KEEP,r.KEEP,r.REPLACE),r.stencilMask(255));var f=t.transform;o.setDepthMode(new e.default$38(r.LESS,e.default$38.ReadWrite,[0,1]));var m=[];m=e.createFloat64ArrayIdentityMatrix(),m=e.calc3dModelTranslateMatrix(!1,s,m);var p=e.default$11.FRAMEBUFFER.DEPTH_IMAGE_SCALE;r.uniform2fv(n.uniforms.u_resolution,[t.width*p,t.height*p]),o.activeTexture.set(r.TEXTURE0),r.uniform1i(n.uniforms.u_BaseColorSampler,0),o.setColorMode(new e.default$40([r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA],e.default$8.transparent,[!0,!0,!0,!0]));for(var h=0;h<s.nodes.length;h++){var d=s.nodes[h];if(d.hasOwnProperty("mesh")&&d.primitiveStack)for(var g=0;g<d.primitiveStack.length;g++){var v=d.primitiveStack[g],y=s.primitives[v.primitiveInd],x=s.materials[y.material],b=void 0;if(b=s.textures[x&&x.baseColorTexture.index||0]){r.uniform1i(n.uniforms.u_use_text,!0),r.uniform4fv(n.uniforms.u_fill_color,x.baseColorFactor||[1,1,1,1]);var w=r.CLAMP_TO_EDGE;b.bind(r.LINEAR,w);}else r.uniform1i(n.uniforms.u_use_text,!1),r.uniform4fv(n.uniforms.u_fill_color,x&&x.baseColorFactor||[.6,.6,.6,1]);var A=e.createFloat64ArrayFromAMatrix(m);d.animation||d.identityMatrix||e.mul(A,A,d.matrix),s.identityMatrix||e.mul(A,A,s.matrix),r.uniformMatrix4fv(n.uniforms.u_model_matrix,!1,new Float32Array(A)),e.mul(A,f.calculateVPMatrix(),A),r.uniformMatrix4fv(n.uniforms.u_matrix,!1,new Float32Array(A)),s.gltfModelVAO.bind(o,n,y.gltfVertexBuffer,[],y.gltfIndexBuffer),r.drawElements(s._options.debug?r.LINES:y.gltfIndexBuffer.mode||0,y.gltfIndexBuffer.count,y.gltfIndexBuffer.type,y.gltfIndexBuffer.offset),o.setCullFace(e.default$43.disabled);}}a.clipGround&&(r.colorMask(!0,!0,!0,!0),r.stencilFunc(r.NOTEQUAL,1,255),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.stencilMask(0),r.disable(r.STENCIL_TEST));}}}(t,i,a);if("dyn_heatmap"===c?(n.uniform1i(o.uniforms.u_r_heatmap,!0),n.uniform1f(o.uniforms.u_h_heatmap,u.dynMaxHeight)):n.uniform1i(o.uniforms.u_r_heatmap,!1),"airline"===c)return function(t,i,a){if(!a||!a.visibility||"none"!==a.visibility){var o,r,n,s,l,u,c=t.context,_=c.gl,f=i.getSource(),m=f.configuration,p=m.lineNodeName,h=m.staticModelName,d=m.lines,g=[],v=[],y=0,x=0,b=0,w=0;if(f instanceof J&&f.meshes.length>0){c.setColorMode(new e.default$40([_.SRC_ALPHA,_.ONE_MINUS_SRC_ALPHA],e.default$8.transparent,[!0,!0,!0,!0]));var A=t.transform,T=f.gltfModelVAO;c.setDepthMode(new e.default$38(_.LESS,e.default$38.ReadWrite,[0,1]));for(var E=t.useProgram("airLine"),P=0;P<f.nodes.length;P++){var S=f.nodes[P];if(S.properties.name===p&&S.primitiveStack)for(var I=0;I<S.primitiveStack.length;I++){var M=S.primitiveStack[I],R=f.primitives[M.primitiveInd];c.activeTexture.set(_.TEXTURE0),_.uniform1i(E.uniforms.u_BaseColorSampler,0);var C=f.materials[R.material];if(C.materialParams){_.uniform1i(E.uniforms.u_hightlight,!!M.highlight),f.textures&&f.textures[C&&C.baseColorTexture.index||0]?(_.uniform1i(E.uniforms.u_use_text,!0),_.uniform4fv(E.uniforms.u_fill_color,C.baseColorFactor||[1,1,1,1]),f.textures[C.baseColorTexture.index].bind(_.LINEAR,f.meshes[I].wrap||f.samplers[C.sampler].wrapS||_.CLAMP_TO_EDGE,f.textures[C.baseColorTexture.index].isSizePowerOfTwoNoneSquare()?_.LINEAR_MIPMAP_NEAREST:_.LINEAR)):(_.uniform1i(E.uniforms.u_use_text,!1),_.uniform4fv(E.uniforms.u_fill_color,C&&C.baseColorFactor||[.6,.6,.6,1]));var O=e.createFloat64ArrayIdentityMatrix();e.scale(O,O,[e.default$11.TRANSFORM.R_SCALE,e.default$11.TRANSFORM.R_SCALE,e.default$11.TRANSFORM.R_SCALE]);var F=e.createFloat64ArrayIdentityMatrix();e.mul(O,A.calculateVPMatrix(),O),_.uniform1i(E.uniforms.u_with_shadow,!1),_.uniformMatrix4fv(E.uniforms.u_cam_matrix,!1,new Float32Array(F)),_.uniformMatrix4fv(E.uniforms.u_proj_matrix,!1,new Float32Array(A.td_projectionMatrix)),_.uniformMatrix4fv(E.uniforms.u_matrix,!1,new Float32Array(O)),_.uniform2fv(E.uniforms.u_repeat,C.materialParams.repeat),_.uniform2fv(E.uniforms.u_resolution,[t.width,t.height]),_.uniform1f(E.uniforms.u_lineWidth,C.materialParams.lineWidth),_.uniform1f(E.uniforms.u_opacity,C.materialParams.opacity),_.uniform1i(E.uniforms.u_useAlphaMap,!!C.materialParams.useAlphaMap),_.uniform1f(E.uniforms.u_sizeAttenuation,C.materialParams.sizeAttenuation),_.uniform1f(E.uniforms.u_opacity,C.materialParams.opacity),_.uniform1f(E.uniforms.u_alphaTest,C.materialParams.alphaTest),_.uniform1i(E.uniforms.u_useMap,!!C.materialParams.useMap),_.uniform1i(E.uniforms.u_useDash,!!C.materialParams.useDash),_.uniform1f(E.uniforms.u_dashArray,C.materialParams.dashArray),_.uniform1f(E.uniforms.u_dashOffset,C.materialParams.dashOffset),_.uniform1f(E.uniforms.u_dashRatio,C.materialParams.dashRatio),_.uniform1f(E.uniforms.u_alphaTest,C.materialParams.alphaTest),_.uniform1f(E.uniforms.u_visibility,C.materialParams.visibility);var L=C.materialParams.color;_.uniform3fv(E.uniforms.u_color,[L.r,L.g,L.b]),x=C.materialParams.speedFactor,b=C.materialParams.segmentCount,w=C.materialParams.segmentGroup,y=t._map.timer.counter*x%(b+w),_.uniform1f(E.uniforms.u_count,y),_.uniform1f(E.uniforms.u_segments,w);var D=R.gltfVertexBuffer,z=R.gltfIndexBuffer;T.bind(c,E,D,[],z),t.context.setCullFace(e.default$43.disabled),_.drawElements(z.mode||0,z.count,z.type,z.offset),v=R.triangleData;}}}for(var N=!1,B=0;B<d.length;B++){var k=d[B][0],$=d[B][0]+d[B][1];0===B?g.push(0):g.push(g[B-1]+d[B-1][1]),y>k&&y<$&&(N=!0);}if(!N)return;E=t.useProgram("gltfModel"),c.setDepthMode(new e.default$38(_.LESS,e.default$38.ReadWrite,[0,1]));for(var U=0;U<f.nodes.length;U++){var V=f.nodes[U];if(V.primitiveStack)for(var G=0;G<V.primitiveStack.length;G++){var X=V.primitiveStack[G],W=f.primitives[X.primitiveInd];if(V.userNodeData&&V.userNodeData.name===h){c.activeTexture.set(_.TEXTURE0),_.uniform1i(E.uniforms.u_BaseColorSampler,0);var j=f.materials[W.material];if(!j.materialParams||"MeshLineMaterial"!==j.materialParams.type&&"ParticleMaterial"!==j.materialParams.type){if("OPAQUE"!==j.alphaMode&&c.setColorMode(e.default$40.alphaBlended),_.uniform1i(E.uniforms.u_hightlight,!1),f.textures[j&&j.baseColorTexture.index||0]){_.uniform1i(E.uniforms.u_use_text,!0),_.uniform4fv(E.uniforms.u_fill_color,j.baseColorFactor||[1,1,1,1]);var Y=f.textures[j.baseColorTexture.index].isSizePowerOfTwoNoneSquare()&&f.samplers[j.sampler].wrapS||_.CLAMP_TO_EDGE;f.textures[j.baseColorTexture.index].bind(_.LINEAR,Y);}else _.uniform1i(E.uniforms.u_use_text,!1),_.uniform4fv(E.uniforms.u_fill_color,j&&j.baseColorFactor||[.6,.6,.6,1]);var Z=e.createFloat64ArrayIdentityMatrix();_.uniform1i(E.uniforms.u_with_shadow,!1),_.uniformMatrix4fv(E.uniforms.u_cam_matrix,!1,new Float32Array(Z));var q=W.gltfVertexBuffer,Q=W.gltfIndexBuffer;T.bind(c,E,q,[],Q);for(var H=parseInt(y),K=0;K<d.length;K++){var ee=e.createFloat64ArrayIdentityMatrix(),te=d[K][0],ie=d[K][0]+d[K][1];if(!(H<=te+5||H>=ie-5)){var ae=H-te+g[K];if(v[2*ae]&&v[2*(ae+1)]){var oe=v[2*ae][0],re=v[2*(ae+1)][0],ne=(o=y-H,r=oe,s=((n=re)[0]-r[0])*o+r[0],l=(n[1]-r[1])*o+r[1],u=(n[2]-r[2])*o+r[2],[s,l,u]),se=new Float64Array(3);e.subtract(se,re,oe),e.normalize$1(se,se);var le=e.create$5();e.rotationTo(le,[0,0,1],se);var ue=new Float64Array(3);e.transformQuat(ue,[1,0,0],le);var ce=new Float64Array(3);e.sub(ce,oe,[0,0,0]);var _e=new Float64Array(3);e.sub(_e,re,[0,0,0]);var fe=new Float64Array(3);e.cross(fe,ce,_e),e.normalize$1(fe,fe);var me=e.create$5();e.rotationTo(me,ue,fe);var pe=[],he=e.getAxisAngle(pe,me);if((pe[0]*se[0]<0||pe[1]*se[1]<0||pe[2]*se[2]<0)&&(he=2*Math.PI-he),e.rotateZ$1(le,le,he),e.fromRotationTranslationScale(ee,le,[ne[0]*e.default$11.TRANSFORM.R_SCALE,ne[1]*e.default$11.TRANSFORM.R_SCALE,ne[2]*e.default$11.TRANSFORM.R_SCALE],[e.default$11.TRANSFORM.R_SCALE,e.default$11.TRANSFORM.R_SCALE,e.default$11.TRANSFORM.R_SCALE]),f.identityMatrix||e.mul(ee,ee,f.matrix),t.style._sunLightFlag){var de=e.createFloat64ArrayIdentityMatrix();e.invert(de,ee),e.transpose(de,de),_.uniformMatrix4fv(E.uniforms.u_normal,!1,new Float32Array(de)),_.uniform1i(E.uniforms.u_with_light,!0),_.uniform3fv(E.uniforms.u_light,t._map.sunLight.getSunLightPos()),_.uniform3fv(E.uniforms.u_lightcolor,[1,1,1]);}else _.uniform1i(E.uniforms.u_with_light,!1);e.mul(ee,A.calculateVPMatrix(),ee),_.uniformMatrix4fv(E.uniforms.u_matrix,!1,new Float32Array(ee)),_.drawElements(Q.mode||0,Q.count,Q.type,Q.offset);}}}}}}}}}}(t,i,a);if("track"===c)return function(t,i,a){if(!a||!a.visibility||"none"!==a.visibility){var o,r,n,s,l,u,c=t.context,_=c.gl,f=i.getSource(),m=f.configuration,p=m.speedFactor,h=m.segmentCount,d=m.modelNames,g=m.trackData;if(f instanceof J&&f.meshes.length>0){c.setStencilMode(e.default$39.disabled),c.setColorMode(new e.default$40([_.SRC_ALPHA,_.ONE_MINUS_SRC_ALPHA],e.default$8.transparent,[!0,!0,!0,!0]));var v=t.transform,y=f.gltfModelVAO;c.setDepthMode(new e.default$38(_.LESS,e.default$38.ReadWrite,[0,1]));for(var x=t._map.timer.counter*p%h,b=!1,w=0;w<g.length;w++){var A=g[w],T=A.start,E=A.end;if(x>T&&x<E){b=!0;break}}if(!b)return;for(var P=0;P<f.nodes.length;P++){var S=f.nodes[P];if(S.primitiveStack)for(var I=0;I<S.primitiveStack.length;I++){var M=S.primitiveStack[I],R=f.primitives[M.primitiveInd];if(S.properties&&(-1===d.indexOf(S.properties.name)||-1===d.indexOf(S.properties.fatherName))){var C=t.useProgram("gltfModel");c.setDepthMode(new e.default$38(_.LESS,e.default$38.ReadWrite,[0,1])),c.activeTexture.set(_.TEXTURE0),_.uniform1i(C.uniforms.u_BaseColorSampler,0);var O=f.materials[R.material];if(!O.materialParams||"MeshLineMaterial"!==O.materialParams.type&&"ParticleMaterial"!==O.materialParams.type){if("OPAQUE"===O.alphaMode?c.setColorMode(e.default$40.unblended):c.setColorMode(e.default$40.alphaBlended),_.uniform1i(C.uniforms.u_hightlight,!1),f.textures[O&&O.baseColorTexture.index||0]){_.uniform1i(C.uniforms.u_use_text,!0),_.uniform4fv(C.uniforms.u_fill_color,O.baseColorFactor||[1,1,1,1]);var F=f.textures[O.baseColorTexture.index].isSizePowerOfTwoNoneSquare()&&f.samplers[O.sampler].wrapS||_.CLAMP_TO_EDGE;f.textures[O.baseColorTexture.index].bind(_.LINEAR,F);}else _.uniform1i(C.uniforms.u_use_text,!1),_.uniform4fv(C.uniforms.u_fill_color,O&&O.baseColorFactor||[.6,.6,.6,1]);var L=e.createFloat64ArrayIdentityMatrix();_.uniform1i(C.uniforms.u_with_shadow,!1),_.uniformMatrix4fv(C.uniforms.u_cam_matrix,!1,L);var D=R.gltfVertexBuffer,z=R.gltfIndexBuffer;y.bind(c,C,D,[],z);for(var N=0;N<g.length;N++){var B=g[N],k=B.start,$=B.end,U=B.model;if((U===S.properties.name||U===S.properties.fatherName)&&!(x<k||x>$)){var V=e.createFloat64ArrayIdentityMatrix(),G=Si(g[N].seqs,x,0,g[N].seqs.length-1),X=g[N].positions[G],W=g[N].nexts[G],j=null;1===X[3]?j=X:(o=(x-g[N].seqs[G])/(g[N].seqs[G+1]-g[N].seqs[G]),r=X,s=((n=W)[0]-r[0])*o+r[0],l=(n[1]-r[1])*o+r[1],u=(n[2]-r[2])*o+r[2],j=[s,l,u]);var Y=new Float64Array(3);e.subtract(Y,W,X),e.normalize$1(Y,Y);var Z=e.create$5();e.rotationTo(Z,[0,0,1],Y);var q=new Float64Array(3);e.transformQuat(q,[1,0,0],Z);var Q=new Float64Array(3);e.sub(Q,X,[0,0,0]);var H=new Float64Array(3);e.sub(H,W,[0,0,0]);var K=new Float64Array(3);e.cross(K,Q,H),e.normalize$1(K,K);var ee=e.create$5();e.rotationTo(ee,q,K);var te=[],ie=e.getAxisAngle(te,ee);if((te[0]*Y[0]<0||te[1]*Y[1]<0||te[2]*Y[2]<0)&&(ie=2*Math.PI-ie),e.rotateZ$1(Z,Z,ie),e.fromRotationTranslationScale(V,Z,[j[0]*e.default$11.TRANSFORM.R_SCALE,j[1]*e.default$11.TRANSFORM.R_SCALE,j[2]*e.default$11.TRANSFORM.R_SCALE],[e.default$11.TRANSFORM.R_SCALE,e.default$11.TRANSFORM.R_SCALE,e.default$11.TRANSFORM.R_SCALE]),f.identityMatrix||(e.mul(V,V,f.matrix),e.translate(V,V,f.translation||[0,0,0])),t.style._sunLightFlag){var ae=e.createFloat64ArrayIdentityMatrix();e.invert(ae,V),e.transpose(ae,ae),_.uniformMatrix4fv(C.uniforms.u_normal,!1,ae),_.uniform1i(C.uniforms.u_with_light,!0),_.uniform3fv(C.uniforms.u_light,t._map.sunLight.getSunLightPos()),_.uniform3fv(C.uniforms.u_lightcolor,[1,1,1]);}else _.uniform1i(C.uniforms.u_with_light,!1);e.mul(V,v.calculateVPMatrix(),V),_.uniformMatrix4fv(C.uniforms.u_matrix,!1,V),_.drawElements(z.mode||0,z.count,z.type,z.offset);}}}}}}}}}(t,i,a);if(l.primitives.length>0){var _=l.materials[l.primitives[0].material];if(_&&_.materialParams){if("MeshLineMaterial"===_.materialParams.type)return function(t,i,a){if(!a||!a.visibility||"none"!==a.visibility){var o=t.context,r=o.gl,n=t.useProgram("gltfLineModel"),s=i.getSource();if(s instanceof J&&s.meshes.length>0){var l=t.transform,u=s.gltfModelVAO;o.setDepthMode(new e.default$38(r.LESS,e.default$38.ReadWrite,[0,1]));var c=e.createFloat64ArrayIdentityMatrix();if(c=e.calc3dModelTranslateMatrix(!1,s,c),t.style._sunLightFlag){var _=e.transpose([],e.invert([],c));r.uniformMatrix4fv(n.uniforms.u_normal,!1,new Float32Array(_)),r.uniform1i(n.uniforms.u_with_light,!0),r.uniform3fv(n.uniforms.u_light,t._map.sunLight.getSunLightPos()),r.uniform3fv(n.uniforms.u_lightcolor,[1,1,1]);}else r.uniform1i(n.uniforms.u_with_light,!1);o.activeTexture.set(r.TEXTURE2),r.uniform1i(n.uniforms.u_BaseColorSampler,2);for(var f=0;f<s.nodes.length;f++){var m=s.nodes[f];if(m.primitiveStack)for(var p=0;p<m.primitiveStack.length;p++){var h=m.primitiveStack[p],d=s.primitives[h.primitiveInd],g=s.materials[d.material];if(g.materialParams){r.uniform1i(n.uniforms.u_hightlight,!!h.highlight),s.textures&&s.textures[g&&g.baseColorTexture.index||0]?(r.uniform1i(n.uniforms.u_use_text,!0),r.uniform4fv(n.uniforms.u_fill_color,g&&g.baseColorFactor||[.6,.6,.6,1]),s.textures[g.baseColorTexture.index].bind(r.LINEAR,s.meshes[p].wrap||s.samplers[g.sampler].wrapS||r.CLAMP_TO_EDGE)):(r.uniform1i(n.uniforms.u_use_text,!1),r.uniform4fv(n.uniforms.u_fill_color,g&&g.baseColorFactor||[.6,.6,.6,1]));var v=e.createFloat64ArrayFromAMatrix(c);m.identityMatrix||e.mul(v,v,m.matrix),s.identityMatrix||e.mul(v,v,s.matrix),e.mul(v,l.calculateVPMatrix(),v),r.uniformMatrix4fv(n.uniforms.u_proj_matrix,!1,new Float32Array(l.td_projectionMatrix)),r.uniformMatrix4fv(n.uniforms.u_matrix,!1,new Float32Array(v)),r.uniform2fv(n.uniforms.u_repeat,g.materialParams.repeat),r.uniform2fv(n.uniforms.u_resolution,[t.width,t.height]),r.uniform1f(n.uniforms.u_lineWidth,g.materialParams.lineWidth),r.uniform1f(n.uniforms.u_opacity,g.materialParams.opacity),r.uniform1f(n.uniforms.u_useAlphaMap,g.materialParams.useAlphaMap),r.uniform1f(n.uniforms.u_sizeAttenuation,g.materialParams.sizeAttenuation),r.uniform1f(n.uniforms.u_opacity,g.materialParams.opacity),r.uniform1f(n.uniforms.u_alphaTest,g.materialParams.alphaTest),r.uniform1i(n.uniforms.u_useMap,g.materialParams.useMap),r.uniform1i(n.uniforms.u_useDash,g.materialParams.useDash),r.uniform1f(n.uniforms.u_dashArray,g.materialParams.dashArray),r.uniform1f(n.uniforms.u_dashOffset,g.materialParams.dashOffset),r.uniform1f(n.uniforms.u_dashRatio,g.materialParams.dashRatio),r.uniform1f(n.uniforms.u_alphaTest,g.materialParams.alphaTest),r.uniform1f(n.uniforms.u_visibility,g.materialParams.visibility);var y=g.materialParams.color;r.uniform3fv(n.uniforms.u_color,[y.r,y.g,y.b]);var x=d.gltfVertexBuffer,b=d.gltfIndexBuffer;u.bind(o,n,x,[],b),r.drawElements(b.mode||0,b.count,b.type,b.offset);}}}}}}(t,i,a);if("ParticleMaterial"===_.materialParams.type)return function(t,i,a){if(!a||!a.visibility||"none"!==a.visibility){var o=t.context,r=o.gl,n=t.useProgram("gltfParticleModel"),s=i.getSource(),l=t._map.timer.counter;if(s instanceof J&&s.meshes.length>0){var u=t.transform,c=s.gltfModelVAO;o.setDepthMode(e.default$38.disabled);var _=e.createFloat64ArrayIdentityMatrix();_=e.calc3dModelTranslateMatrix(!1,s,_),r.uniform1i(n.uniforms.u_with_light,!1),o.activeTexture.set(r.TEXTURE2),r.uniform1i(n.uniforms.u_BaseColorSampler,2);for(var f=0;f<s.nodes.length;f++){var m=s.nodes[f];if(m.primitiveStack)for(var p=0;p<m.primitiveStack.length;p++){var h=m.primitiveStack[p],d=s.primitives[h.primitiveInd],g=s.materials[d.material];if(g.materialParams&&"ParticleMaterial"===g.materialParams.type){r.uniform1i(n.uniforms.u_hightlight,!!h.highlight),s.textures&&s.textures[g&&g.baseColorTexture.index||0]?(r.uniform1i(n.uniforms.u_use_text,!0),r.uniform4fv(n.uniforms.u_fill_color,g.baseColorFactor||[1,1,1,1]),s.textures[g.baseColorTexture.index].bind(r.LINEAR,s.meshes[p].wrap||s.samplers[g.sampler].wrapS||r.CLAMP_TO_EDGE)):(r.uniform1i(n.uniforms.u_use_text,!1),r.uniform4fv(n.uniforms.u_fill_color,g&&g.baseColorFactor||[.6,.6,.6,1]));var v=e.createFloat64ArrayFromAMatrix(_);m.identityMatrix||e.mul(v,v,m.matrix);var y=[];e.rotateY(y,e.createFloat64ArrayIdentityMatrix(),-u.bearing*e.default$11.TRANSFORM.DEG_TO_RAD),e.mul(v,v,y);var x=[];e.rotateX(x,e.createFloat64ArrayIdentityMatrix(),-Math.PI/2+u._pitch),e.mul(v,v,x),s.identityMatrix||e.mul(v,v,s.matrix),e.mul(v,u.calculateVPMatrix(),v),r.uniform1i(n.uniforms.u_with_shadow,!1),r.uniform4fv(n.uniforms.uColor,g.materialParams.particleColor),r.uniform3fv(n.uniforms.uFirePos,g.materialParams.position),r.uniform1f(n.uniforms.uTime,l),r.uniform1i(n.uniforms.uUseBillboarding,!1),r.uniformMatrix4fv(n.uniforms.uViewMatrix,!1,new Float32Array(u.td_viewMatrix)),r.uniformMatrix4fv(n.uniforms.u_matrix,!1,new Float32Array(v));var b=d.gltfVertexBuffer,w=d.gltfIndexBuffer;c.bind(o,n,b,[],w),r.enable(r.BLEND),r.blendFunc(r.ONE,r.ONE),r.drawElements(w.mode||0,w.count,w.type,w.offset),r.disable(r.BLEND);}}}}}}(t,i,a)}}if(l instanceof J&&l.meshes.length>0){var f=l.respectiveTransformation,m=a.useLayerPosition;f||!m||a.baseMatrixCalculated||a.calcBaseMatrix(l),r.setStencilMode(e.default$39.disabled),a.clipGround&&r.setStencilMode(e.default$39.enableClipGround);var p=t.transform;r.setDepthMode(new e.default$38(n.LESS,e.default$38.ReadWrite,[0,1]));var h=[],d=e.createFloat64ArrayIdentityMatrix();if(f||(h=e.createFloat64ArrayIdentityMatrix(),h=e.calc3dModelTranslateMatrix(!1,m?a:l,h)),n.uniform2fv(o.uniforms.u_resolution,[t.width,t.height]),t.style._sunLightFlag){if(!f){var g=e.transpose([],e.invert([],h));n.uniformMatrix4fv(o.uniforms.u_normal,!1,new Float32Array(g));}if(n.uniform1i(o.uniforms.u_with_light,!0),a.isSpecialLight){n.uniform3fv(o.uniforms.u_camera_pos,p.getCameraPos());for(var v=0;v<a.specialLights.length;v++)n.uniform1i(o.uniforms["u_light["+v+"].use"],!0),n.uniform3fv(o.uniforms["u_light["+v+"].position"],a.specialLights[v].position),n.uniform3fv(o.uniforms["u_light["+v+"].direction"],a.specialLights[v].direction),n.uniform1f(o.uniforms["u_light["+v+"].cutOff"],a.specialLights[v].cutOff),n.uniform1f(o.uniforms["u_light["+v+"].outerCutOff"],a.specialLights[v].outerCutOff),n.uniform3fv(o.uniforms["u_light["+v+"].ambient"],a.specialLights[v].ambient),n.uniform3fv(o.uniforms["u_light["+v+"].diffuse"],a.specialLights[v].diffuse),n.uniform3fv(o.uniforms["u_light["+v+"].specular"],a.specialLights[v].specular),n.uniform1f(o.uniforms["u_light["+v+"].constant"],a.specialLights[v].constant),n.uniform1f(o.uniforms["u_light["+v+"].linear"],a.specialLights[v].linear),n.uniform1f(o.uniforms["u_light["+v+"].quadratic"],a.specialLights[v].quadratic),n.uniform1f(o.uniforms["u_light["+v+"].shininess"],a.specialLights[v].shininess);}else n.uniform3fv(o.uniforms.u_light,t._map.sunLight.getSunLightPos()),n.uniform3fv(o.uniforms.u_lightcolor,[1,1,1]);}else n.uniform1i(o.uniforms.u_with_light,!1);var y,x,b,w,A=t.activeCameras;if(n.uniform1f(o.uniforms.u_viewshed_count,0),s===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||s===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_ALL){var T=t.fbManager.shadowFramebuffer;T&&(r.activeTexture.set(n.TEXTURE10),n.bindTexture(n.TEXTURE_2D,T.colorAttachment.get()),n.uniform1i(o.uniforms.u_shadow_sampler,10)),n.uniform1f(o.uniforms.u_shadow_off,t.shadowOff);}if(a.viewshedRender&&(s===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||s===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_ALL)){var E=A.viewshed[0].fb;E&&(r.activeTexture.set(n.TEXTURE11),n.bindTexture(n.TEXTURE_2D,E.colorAttachment.get()),n.uniform1i(o.uniforms.u_viewshed_samp0,11)),n.uniform1f(o.uniforms.u_shadow_off,t.shadowOff),n.uniform1f(o.uniforms.u_viewshed_count,1);}l._clampEnabled&&l.minClampBounds&&l.maxClampBounds?(e.translate(d,d,(m?a:l).translation||[0,0,0]),n.uniform1f(o.uniforms.u_clamp_ratio,1),n.uniform3fv(o.uniforms.u_min_clamp_bounds,l.minClampBounds),n.uniform3fv(o.uniforms.u_max_clamp_bounds,l.maxClampBounds),n.uniform4fv(o.uniforms.u_clamp_plane,l.clampPlane),n.uniform2fv(o.uniforms.u_x_clamp_range,l.ratioRange[0]),n.uniform2fv(o.uniforms.u_y_clamp_range,l.ratioRange[1]),n.uniform2fv(o.uniforms.u_z_clamp_range,l.ratioRange[2]),n.uniform3fv(o.uniforms.u_clamp_box,[l.clampBox.x,l.clampBox.y,l.clampBox.z]),n.uniform1f(o.uniforms.u_clamp_box_inner,l.clampBox.inner),n.uniformMatrix4fv(o.uniforms.u_clamp_matrix,!1,new Float32Array(l.clampBoxMatrix))):n.uniform1f(o.uniforms.u_clamp_ratio,0),r.activeTexture.set(n.TEXTURE0),n.uniform1i(o.uniforms.u_BaseColorSampler,0),s===e.default$11.CAMERA.DRAW_MODE.OFFSCREEN||s===e.default$11.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED?r.setColorMode(e.default$40.unblended):r.setColorMode(new e.default$40([n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA],e.default$8.transparent,[!0,!0,!0,!0])),s!==e.default$11.CAMERA.DRAW_MODE.OFFSCREEN&&s!==e.default$11.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||((y=a.shadowCenter)||(y=p._center.toArray()),x=t._map.sunLight._shadowSunPosition({target:y,distance:p.alt*e.default$11.TRANSFORM.R_ZOOM*3}));for(var P=0;P<l.nodes.length;P++){var S=l.nodes[P];if(S.hasOwnProperty("mesh")&&(S.properties.flowTexture?(n.uniform1i(o.uniforms.u_flow_text,!0),n.uniform1f(o.uniforms.u_flow_text_off,-t._map.timer.counter)):n.uniform1i(o.uniforms.u_flow_text,!1),S.primitiveStack))for(var I=0;I<S.primitiveStack.length;I++){var M=S.primitiveStack[I],R=l.primitives[M.primitiveInd],C=l.materials[R.material];if(f){h=[],h=e.createFloat64ArrayIdentityMatrix(),h=e.calc3dModelTranslateMatrix(!1,S,h),l._clampEnabled&&(d=e.createFloat64ArrayIdentityMatrix(),e.translate(d,d,S.translation||[0,0,0]));var O=e.transpose([],e.invert([],h));n.uniformMatrix4fv(o.uniforms.u_normal,!1,new Float32Array(O));}if(m&&!f?(n.uniform1i(o.uniforms.u_hightlight,!!a.nodes[P].primitiveStack[I].highlight),n.uniform1i(o.uniforms.u_morph_weight,!!R.isSkinModel)):(n.uniform1i(o.uniforms.u_hightlight,!!l.nodes[P].primitiveStack[I].highlight),n.uniform1i(o.uniforms.u_morph_weight,!!R.isSkinModel)),n.uniform1i(o.uniforms.u_specialindex,a.highLightColorsIndex),a.highLightColors)for(var F=0;F<a.highLightColors.length;F++){var L=a.highLightColors[F];n.uniform4fv(o.uniforms["u_specialcolor["+F+"].color"],L.toArray());}else n.uniform4fv(o.uniforms["u_specialcolor[0].color"],[1,.2,.1,1]);if(l.sceneConf&&l.sceneConf.trafficLightsConf)Mi(t._map.timer.counter,l.sceneConf.trafficLightsConf,S.properties.name,C,l.materials,l.textures,l.samplers,n,o);else{var D=void 0;if(D=l.textures[C&&C.baseColorTexture.index||0]){n.uniform1i(o.uniforms.u_use_text,!0),n.uniform4fv(o.uniforms.u_fill_color,C.baseColorFactor||[1,1,1,1]);var z=D.isSizePowerOfTwoNoneSquare()&&l.samplers[C.sampler].wrapS||n.CLAMP_TO_EDGE;D.bind(n.LINEAR,z);}else n.uniform1i(o.uniforms.u_use_text,!1),n.uniform4fv(o.uniforms.u_fill_color,C&&C.baseColorFactor||[.6,.6,.6,1]);}var N=e.createFloat64ArrayFromAMatrix(h),B=l._clampEnabled?e.createFloat64ArrayFromAMatrix(d):new Float32Array(16),k=S.animation;k&&(Fi(N,l,P,o,t,k,n),l._clampEnabled&&Fi(B,l,P,o,t,k,n),b=null),S.identityMatrix||(e.mul(N,N,S.matrix),l._clampEnabled&&e.mul(B,B,S.matrix),b=null),m&&!f?a.identityMatrix||(e.mul(N,N,a.matrix),l._clampEnabled&&e.mul(B,B,a.matrix)):l.identityMatrix||(e.mul(N,N,l.matrix),l._clampEnabled&&e.mul(B,B,l.matrix));var $=e.createFloat64ArrayIdentityMatrix();if(n.uniform1i(o.uniforms.u_with_shadow,!1),w||(w=new Float32Array(e.createFloat64ArrayFromAMatrix(N)),n.uniformMatrix4fv(o.uniforms.u_model_matrix,!1,w),n.uniformMatrix4fv(o.uniforms.u_clamp_model_matrix,!1,new Float32Array(B))),!t.depthPick)if(s===e.default$11.CAMERA.DRAW_MODE.OFFSCREEN)"night"!==t._map.sunLight._shadow.type&&(b||(e.mul(N,p.calculateVPMatrix(x),N),b=new Float32Array(e.createFloat64ArrayFromAMatrix(N)),n.uniformMatrix4fv(o.uniforms.u_matrix,!1,b)));else if(s===e.default$11.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED)b||(e.mul(N,p.calculateVPMatrix(A.viewshed[0]),N),b=new Float32Array(e.createFloat64ArrayFromAMatrix(N)),n.uniformMatrix4fv(o.uniforms.u_matrix,!1,b));else if(s===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_SHADOW)"night"!==t._map.sunLight._shadow.type?(n.uniform1i(o.uniforms.u_with_shadow,!0),e.mul($,p.calculateVPMatrix(x),N)):n.uniform1i(o.uniforms.u_with_shadow,!1),n.uniformMatrix4fv(o.uniforms.u_sun_matrix,!1,new Float32Array($));else if(s===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED){var U=e.createFloat64ArrayIdentityMatrix();e.mul(U,p.calculateVPMatrix(A.viewshed[0]),N),n.uniformMatrix4fv(o.uniforms.u_viewshed_mat0,!1,new Float32Array(U)),n.uniform3fv(o.uniforms.u_viewshed_eye0,p._lastSunLightStatus.geographic),n.uniform1f(o.uniforms.u_viewshed_dist0,A.viewshed[0]&&A.viewshed[0].farDistance||0),n.uniform1i(o.uniforms.u_viewshed_used0,!0);}else if(s===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_ALL){"night"!==t._map.sunLight._shadow.type?(n.uniform1i(o.uniforms.u_with_shadow,!0),e.mul($,p.calculateVPMatrix(x),N)):n.uniform1i(o.uniforms.u_with_shadow,!1),n.uniformMatrix4fv(o.uniforms.u_sun_matrix,!1,new Float32Array($));var V=e.createFloat64ArrayIdentityMatrix();e.mul(V,p.calculateVPMatrix(A.viewshed[0]),N),n.uniformMatrix4fv(o.uniforms.u_viewshed_mat0,!1,new Float32Array(V)),n.uniform3fv(o.uniforms.u_viewshed_eye0,p._lastSunLightStatus.geographic),n.uniform1f(o.uniforms.u_viewshed_dist0,A.viewshed[0]&&A.viewshed[0].farDistance||0),n.uniform1i(o.uniforms.u_viewshed_used0,!0);}b||(e.mul(N,p.calculateVPMatrix(),N),b=new Float32Array(e.createFloat64ArrayFromAMatrix(N)),n.uniformMatrix4fv(o.uniforms.u_matrix,!1,b)),!1===C.doubleSided&&r.setCullFace(e.default$43.backCCW),l.gltfModelVAO.bind(r,o,R.gltfVertexBuffer,[],R.gltfIndexBuffer),n.drawElements(l._options.debug?n.LINES:R.gltfIndexBuffer.mode||0,R.gltfIndexBuffer.count,R.gltfIndexBuffer.type,R.gltfIndexBuffer.offset),r.setCullFace(e.default$43.disabled);}}a.clipGround&&r.setStencilMode(e.default$39.disabled);}}},"sphere-symbol":function(t,i,a,o){"translucent"===t.renderPass&&(t.context.setStencilMode(e.default$39.disabled),0!==a.paint.get("icon-opacity").constantOr(1)&&_i(t,i,a,o,!1,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),a.layout.get("icon-rotation-alignment"),a.layout.get("icon-pitch-alignment"),a.layout.get("icon-keep-upright")),0!==a.paint.get("text-opacity").constantOr(1)&&_i(t,i,a,o,!0,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),a.layout.get("text-keep-upright")),i.map.showCollisionBoxes&&It(t,i,a,o));},"sphere-extrusion":function(t,i,a,o){if(a.paint&&0!==a.paint.get("extrusion-opacity")){var r,n=t.context,s=n.gl;n.setDepthMode(new e.default$38(s.LESS,e.default$38.ReadWrite,[0,1]));var l=a.paint.get("extrusion-pattern"),u=t.cameraDrawMode;r=u===e.default$11.CAMERA.DRAW_MODE.OFFSCREEN||u===e.default$11.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED?l?di[2]:di[3]:u===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_SHADOW||u===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED||u===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_ALL?l?di[4]:di[5]:l?di[0]:di[1],u===e.default$11.CAMERA.DRAW_MODE.OFFSCREEN||u===e.default$11.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED?n.setColorMode(e.default$40.unblended):n.setColorMode(new e.default$40([s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA],e.default$8.transparent,[!0,!0,!0,!0]));for(var c=!0,_=0,f=o;_<f.length;_+=1){var m=f[_],p=i.getTile(m),h=p.getBucket(a);h&&(gi(t,0,a,p,0,h,c,r,l),c=!1);}}},"sphere-sprite":function(t,i,a,o){if("translucent"===t.renderPass){var r=a.paint.get("sprite-opacity"),n=a.paint.get("sprite-width");if(0!==r.constantOr(1)&&0!==n.constantOr(1)){var s,l=t.context;l.gl,t._map.clipGroundState&&l.setStencilMode(e.default$39.openClipGround);var u=!0;a.hasOwnProperty("count")||(a.count=0),a.count=t._map.timer.counter*(a.paint.get("sprite-speed")||60),l.setColorMode(e.default$40.alphaBlended);for(var c=0,_=o;c<_.length;c+=1){var f=_[c],m=i.getTile(f),p=m.getBucket(a);p&&(yi(t,m,p,a,0,u,p.programConfigurations.get(a.id),s),s=m.tileID.overscaledZ,u=!1);}l.setStencilMode(e.default$39.disabled),l.setColorMode(e.default$40.unblended);}}},"sphere-tracking":function(t,a,o,r){var n=o.paint.get("tracking-opacity"),s=o.paint.get("tracking-width");if(0!==n.constantOr(1)&&0!==s.constantOr(1)){var l=t.context;l.setColorMode(e.default$40.alphaBlended),o.depthTest?l.setDepthMode(new e.default$38(l.gl.LEQUAL,e.default$38.ReadWrite,[0,1])):l.setDepthMode(e.default$38.disabled),t._map.clipGroundState&&l.setStencilMode(e.default$39.openClipGround);var u=o.paint.get("tracking-seg-group"),c=o.paint.get("tracking-delay");if("history"===o.paint.get("tracking-type"))o.histEnd=Date.now(),o.first||(o.first=!0,o.histStart=0,o.histCount=0,o.isReverse=!1,o.isReserve=!1),o.histEnd-o.histStart>=1e3/o.paint.get("tracking-speed")&&("loop"===o.layout.get("tracking-display-mode")?(o.histCount++,o.histCount%=o.paint.get("tracking-seg-count"),o.histCount=0===o.histCount?1:o.histCount):"reverse"===o.layout.get("tracking-display-mode")?(o.histCount>=o.paint.get("tracking-seg-count")+o.paint.get("tracking-seg-group")?o.isReverse=!0:o.histCount<=1&&(o.isReverse=!1),o.histCount=o.isReverse?o.histCount-1:o.histCount+1):"loop-reserve"===o.layout.get("tracking-display-mode")?(o.isReserve=!0,o.histCount++,o.histCount%=o.paint.get("tracking-seg-count"),o.histCount=0===o.histCount?1:o.histCount):"reverse-reserve"===o.layout.get("tracking-display-mode")&&(o.isReserve=!0,o.histCount>=o.paint.get("tracking-seg-count")+o.paint.get("tracking-seg-group")?o.isReverse=!0:o.histCount<=1&&(o.isReverse=!1),o.histCount=o.isReverse?o.histCount-1:o.histCount+1),i.TRW&&i.TRW.setProgress(o.histCount),o.histStart=o.histEnd);else if(o.count||(o.start=Date.now(),o.count=1),o.end=Date.now(),o.end-o.start>=1e3/o.paint.get("tracking-speed")){var _=i.TRW;o.count+=1;var f=_&&_.hasOwnProperty("replaceOffset")?_.replaceOffset:120+c;o.count%=f;var m=_&&_.hasOwnProperty("requestOffset")?_.requestOffset:90+c;o.count===m&&_&&_.request(),0===o.count&&(_&&_.replace(),o.count=c),_&&(_.currentSeq=o.count),o.start=o.end;}!function(e,t){if(t&&t.TRW&&"null"!==t.TRW){t.TRW.layerForwards||(t.TRW.layerForwards=[]);for(var i=0;i<t.TRW.layerForwards.length;i++){var a=t.TRW.layerForwards[i];if(a.id===e.id){e.count&&(e.count+=a.count),t.TRW.layerForwards.splice(i,1);break}}}}(o,i),!function(e,t,i,a,o,r,n,s,l){for(var u,c=!0,_=0,f=a;_<f.length;_+=1){var m=f[_],p=t.getTile(m),h=p.getBucket(i);if(h){var d=h.programConfigurations.get(i.id),g=e.context.program.get(),v=e.useProgram(o,d),y=c||v.program!==g,x=u!==p.tileID.overscaledZ;vi(v,e,p,h,i,0,d,y,x,r,n,s,l),u=p.tileID.overscaledZ,c=!1;}}}(t,a,o,r,"sphereTracking","history"===o.paint.get("tracking-type")?o.histCount:o.count,o.isReverse,o.isReserve,u),l.setStencilMode(e.default$39.disabled);}},"sphere-background":function(t,i,a){var o=a.paint.get("background-color"),r=a.paint.get("background-opacity");if(0!==r){var n,s=t.context,l=s.gl,u=a.paint.get("background-pattern");if(xi&&(t.transform._calcProjectionsMatrix(),t.transform._calcMatrices(),xi=!1),s.setDepthMode(new e.default$38(s.gl.LEQUAL,e.default$38.ReadWrite,[.1,1])),s.setColorMode(e.default$40.unblended),t._map.clipGroundState&&s.setStencilMode(e.default$39.openClipGround),u){if(Nt(u,t))return;n=t.useProgram("sphereBackgroundPattern"),Bt(u,t,n),t.tileExtentPatternVAO.bind(s,n,t.tileExtentBuffer,[]);}else n=t.useProgram("sphereBackground"),l.uniform4fv(n.uniforms.u_color,o?[o.r,o.g,o.b,o.a]:[.35,.35,.35,1]),t.tileExtentVAO.bind(s,n,t.tileExtentBuffer,[]);l.uniformMatrix4fv(n.uniforms.u_matrix,!1,new Float32Array(t.transform.calculateVPMatrix())),l.uniform1f(n.uniforms.u_opacity,r),t.context.setCullFace(e.default$43.disabled);var c=t.sphereBuffer;t.sphereVAO.bind(s,n,c,[]),l.drawArrays(l.TRIANGLE_STRIP,0,c.length),s.setStencilMode(e.default$39.disabled);}},"3d-point-cloud":function(t,i,a){if(!a||!a.visibility||"none"!==a.visibility){var o=t.context,r=o.gl,n=t.useProgram("pointCloud"),s=i.getSource();if(s instanceof J&&s.meshes.length>0){var l=t.transform,u=s.gltfModelVAO;o.setDepthMode(new e.default$38(r.LEQUAL,e.default$38.ReadWrite,[0,1]));var c=e.createFloat64ArrayIdentityMatrix();e.calc3dModelTranslateMatrix(!1,s,c);var _=e.createFloat64ArrayFromAMatrix(c);s.identityMatrix||e.mul(_,_,s.matrix),e.mul(_,l.calculateVPMatrix(),_),r.uniformMatrix4fv(n.uniforms.u_matrix,!1,new Float32Array(_)),r.uniform1i(n.uniforms.u_mode,Bi[a.paint.get("3d-point-cloud-mode")]),r.uniform1f(n.uniforms.u_opacity,a.paint.get("3d-point-cloud-opacity")),r.uniform1f(n.uniforms.u_pointSize,a.paint.get("3d-point-cloud-size")),r.uniform2f(n.uniforms.u_class_range,s.range.cMin?s.range.cMin:0,s.range.cMax?s.range.cMax:0),r.uniform2f(n.uniforms.u_z_range,s.range.zMin?s.range.zMin:0,s.range.zMax?s.range.zMax:0),r.uniform2f(n.uniforms.u_intensity_range,s.range.iMin?s.range.iMin:0,s.range.iMax?s.range.iMax:0);for(var f=0;f<s.nodes.length;f++){var m=s.nodes[f];if(m.primitiveStack)for(var p=0;p<m.primitiveStack.length;p++){var h=m.primitiveStack[p],d=s.primitives[h.primitiveInd],g=d.gltfVertexBuffer,v=d.gltfIndexBuffer;u.bind(o,n,g,[],v),r.drawElements(v.mode,v.count,v.type,v.offset);}}}}},fxaa:function(e){for(var t=0;t<ki;t++)$i(e,e.fbManager.fxaaFramebuffer,e.fbManager.fxaaExcFramebuffer),$i(e,e.fbManager.fxaaExcFramebuffer,e.fbManager.fxaaFramebuffer);$i(e,e.fbManager.fxaaFramebuffer,null);},bloom:function(t){var i,a;t.getDefaultFrameBuffer()===t.fbManager.fxaaFramebuffer.framebuffer?(i=t.fbManager.fxaaFramebuffer,a=!0):(i=t.fbManager.bloomBaseColorFramebuffer,a=!1),t.context.setColorMode(e.default$40.unblended),t.context.setDepthMode(e.default$38.disabled),Vi(t,i,t.fbManager.bloomFramebuffer,Ui[0],[0,1],null);for(var o=0;o<t._map._bloomOptions.step;o++)Vi(t,t.fbManager.bloomFramebuffer,t.fbManager.bloomExcFramebuffer,Ui[1],[0,1],null),Vi(t,t.fbManager.bloomExcFramebuffer,t.fbManager.bloomFramebuffer,Ui[1],[1,0],null);a?(Vi(t,t.fbManager.bloomFramebuffer,t.fbManager.bloomBaseColorFramebuffer,Ui[2],[0,1],i),Vi(t,t.fbManager.bloomBaseColorFramebuffer,t.fbManager.fxaaFramebuffer,Ui[3],[0,1],null)):Vi(t,t.fbManager.bloomFramebuffer,null,Ui[2],[0,1],i);},custom:function(t,i,a){var o=t.context,r=a.implementation;t.setCustomLayerDefaults(),o.setStencilMode(e.default$39.disabled),o.setDepthMode(e.default$38.disabled),o.setColorMode(e.default$40.unblended);var n=e.calcCustomLayerTranslateMatrix(r.anchor,e.createFloat64ArrayIdentityMatrix());e.multiply(n,t.transform.customLayerMatrix(),n),r.render(o.gl,n);},panorama:Pi},Zi=function(t,i,a){this.context=new e.default$19(t),this.transform=i,this._tileTextures={},this.setup(),this.numSublayers=ft.maxUnderzooming+ft.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.depthRboNeedsClear=!0,this.emptyProgramConfiguration=new e.default$37,this.crossTileSymbolIndex=new ct,this.td_firstRun=!0,this.depthPick=!1,this.shadowOff=e.default$11.EFFECTS.SHADOW_OFFSET,this.sphereTileVerticeCache=new zi(0,null,this.transform.projection),this._map=a,this.fbManager=new Wi(this.context,this.width,this.height),this._currentCameraView=null,this.activeCameras=null,this.cameraDrawMode=e.default$11.CAMERA.DRAW_MODE.NORMAL,this._currentFrameBuffer=null,this.transform.setPainter(this),this.genSphereVAO();},qi={projection:{configurable:!0}};Zi.prototype.genSphereVAO=function(){this.sphereArray=new e.SphereImageArray,e.sphereGenerator(e.default$11.TRANSFORM.R,8,256,e.ProjectionType.LATLON,this.sphereArray),this.sphereBuffer||(this.sphereBuffer=this.context.createVertexBuffer(this.sphereArray,V.members)),this.sphereVAO||(this.sphereVAO=new e.default$17);},Zi.prototype.setShadowOff=function(e,t){this.shadowOff=e,this.shadowDistance=t;},qi.projection.get=function(){return this._projection},qi.projection.set=function(t){t!==e.ProjectionType.MERCATOR&&t!==e.ProjectionType.LATLON||(this._projection=t,this.sphereTileVerticeCache.projection=t);},Zi.prototype.resize=function(t,i){var a=this.context.gl;if(this.width=t*e.default.devicePixelRatio,this.height=i*e.default.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.disableDepthPick(),this.style)for(var o=0,r=this.style._order;o<r.length;o+=1){var n=r[o];this.style._layers[n].resize();}this.depthRbo&&(a.deleteRenderbuffer(this.depthRbo),this.depthRbo=null),this.fbManager.resize(this.width,this.height);},Zi.prototype.getDefaultFrameBuffer=function(){return this._map.sphereRender?this._currentFrameBuffer:null},Zi.prototype.enableDepthPick=function(){this.depthPick=!0,this.bindPickBuffer();},Zi.prototype.bindPickBuffer=function(){this.context.bindFramebuffer.set(this.fbManager.pickFramebuffer.framebuffer),this.context.clear({color:e.default$8.transparent,depth:1});},Zi.prototype.disableDepthPick=function(){this.depthPick=!1,this.context.bindFramebuffer.set(this.getDefaultFrameBuffer());},Zi.prototype.getPickRay=function(t){var i=t,a=this.context.gl;if(!this.style)return{z_ndc:.991};if(this._checkStatusChange()){this.enableDepthPick(),this.render(this.style,this.options);var o=new Uint8Array(4);this.context.bindFramebuffer.set(this.fbManager.pickFramebuffer.framebuffer),a.readPixels(i.x*e.default$2.devicePixelRatio,i.y*e.default$2.devicePixelRatio,1,1,a.RGBA,a.UNSIGNED_BYTE,o);var r=2*(this.context.czm_unpackDepth(o)-.5);this.disableDepthPick(),this.ray=new e.default$28(this.transform.getCameraPos(),Xi(i.x,i.y,r,this.transform)),this.ray.z_ndc=r;}else{var n=new Uint8Array(4);this.context.bindFramebuffer.set(this.fbManager.pickFramebuffer.framebuffer),a.readPixels(i.x*e.default$2.devicePixelRatio,i.y*e.default$2.devicePixelRatio,1,1,a.RGBA,a.UNSIGNED_BYTE,n);var s=2*(this.context.czm_unpackDepth(n)-.5);this.disableDepthPick(),this.ray=new e.default$28(this.transform.getCameraPos(),Xi(i.x,i.y,s,this.transform)),this.ray.z_ndc=s;}return this.ray},Zi.prototype._checkStatusChange=function(){if(!this.ray)return!0;var e=this.transform;return this._rayStatus?(this._rayStatus.zoom!==e.zoom||this._rayStatus.pitch!==e.pitch||this._rayStatus.bearing!==e.bearing||this._rayStatus.center.lng!==e.center.lng||this._rayStatus.center.lat!==e.center.lat)&&(this._rayStatus={zoom:e.zoom,pitch:e.pitch,bearing:e.bearing,center:e.center},!0):(this._rayStatus={zoom:e.zoom,pitch:e.pitch,bearing:e.bearing,center:e.center},!0)},Zi.prototype.setup=function(){var t=this.context,i=new e.PosArray;i.emplaceBack(0,0),i.emplaceBack(e.default$12,0),i.emplaceBack(0,e.default$12),i.emplaceBack(e.default$12,e.default$12),this.tileExtentBuffer=t.createVertexBuffer(i,yt.members),this.tileExtentVAO=new e.default$17,this.tileExtentPatternVAO=new e.default$17;var a=new e.PosArray;a.emplaceBack(0,0),a.emplaceBack(e.default$12,0),a.emplaceBack(e.default$12,e.default$12),a.emplaceBack(0,e.default$12),a.emplaceBack(0,0),this.debugBuffer=t.createVertexBuffer(a,yt.members),this.debugVAO=new e.default$17;var o=new e.RasterBoundsArray;o.emplaceBack(0,0,0,0),o.emplaceBack(e.default$12,0,e.default$12,0),o.emplaceBack(0,e.default$12,0,e.default$12),o.emplaceBack(e.default$12,e.default$12,e.default$12,e.default$12),this.rasterBoundsBuffer=t.createVertexBuffer(o,e.default$16.members),this.rasterBoundsVAO=new e.default$17;var r=new e.PosArray;r.emplaceBack(0,0),r.emplaceBack(1,0),r.emplaceBack(0,1),r.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(r,yt.members),this.viewportVAO=new e.default$17;},Zi.prototype.clearStencil=function(){var t=this.context,i=t.gl;t.setColorMode(e.default$40.disabled),t.setDepthMode(e.default$38.disabled),t.setStencilMode(new e.default$39({func:i.ALWAYS,mask:0},0,255,i.ZERO,i.ZERO,i.ZERO));var a=e.create();e.ortho(a,0,this.width,this.height,0,0,1),e.scale(a,a,[i.drawingBufferWidth,i.drawingBufferHeight,0]);var o=this.useProgram("clippingMask");i.uniformMatrix4fv(o.uniforms.u_matrix,!1,a),this.viewportVAO.bind(t,o,this.viewportBuffer,[]),i.drawArrays(i.TRIANGLE_STRIP,0,4);},Zi.prototype._renderTileClippingMasks=function(t){var i=this.context,a=i.gl;i.setColorMode(e.default$40.disabled),i.setDepthMode(e.default$38.disabled);var o=1;this._tileClippingMaskIDs={};for(var r=0,n=t;r<n.length;r+=1){var s=n[r],l=this._tileClippingMaskIDs[s.key]=o++;i.setStencilMode(new e.default$39({func:a.ALWAYS,mask:0},l,255,a.KEEP,a.KEEP,a.REPLACE));var u=this.useProgram("clippingMask");a.uniformMatrix4fv(u.uniforms.u_matrix,!1,s.posMatrix),this.tileExtentVAO.bind(this.context,u,this.tileExtentBuffer,[]),a.drawArrays(a.TRIANGLE_STRIP,0,this.tileExtentBuffer.length);}},Zi.prototype.stencilModeForClipping=function(t){var i=this.context.gl;return new e.default$39({func:i.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,i.KEEP,i.KEEP,i.REPLACE)},Zi.prototype.colorModeForRenderPass=function(){var t=this.context.gl;if(this._showOverdrawInspector){return new e.default$40([t.CONSTANT_COLOR,t.ONE],new e.default$8(1/8,1/8,1/8,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?e.default$40.unblended:e.default$40.alphaBlended},Zi.prototype.depthModeForSublayer=function(t,i,a){var o=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon,r=o-1+this.depthRange;return new e.default$38(a||this.context.gl.LEQUAL,i,[r,o])},Zi.prototype._drawSurroundings=function(){this.style.sourceCaches[e.default$11.SOURCE.SKYBOX_SOURCE_ID]&&this.renderSphereLayer(this,this.style.sourceCaches[e.default$11.SOURCE.SKYBOX_SOURCE_ID]),this.style.sourceCaches[e.default$11.SOURCE.GLOBAL_SOURCE_ID]&&this.renderSphereLayer(this,this.style.sourceCaches[e.default$11.SOURCE.GLOBAL_SOURCE_ID]);},Zi.prototype.getCurrentCameraView=function(){return this._currentCameraView},Zi.prototype._sphereDrawLoop=function(){var t;this.renderPass="offscreen";var i=[];this.currentLayer=0;var a,o=this.style._order;if(this._map.clipGroundState)for(this.currentLayer;this.currentLayer<o.length;this.currentLayer++){var r=this.style._layers[o[this.currentLayer]];-1!==r.type.indexOf("3d-model")&&!0===r.clipGround&&(t=this.style.sourceCaches[r.source],this.renderSphereLayer(this,t,r,i));}for(this.currentLayer;this.currentLayer<o.length;this.currentLayer++){var n=this.style._layers[o[this.currentLayer]];n&&-1!==n.type.indexOf("sphere-heatmap")&&((n.source===(t&&t.id)||(i=[],(t=this.style.sourceCaches[n.source])&&(i=t.getVisibleCoordinates()),i.length))&&this.renderSphereLayer(this,t,n,i));}this.context.clear({color:e.default$8.black,depth:1}),this._drawSurroundings(),this.renderPass="translucent";var s=[];this.currentLayer=0;var l=this.style._order;for(this.currentLayer;this.currentLayer<l.length;this.currentLayer++){var u=this.style._layers[l[this.currentLayer]];-1!==u.type.indexOf("3d-model")&&!0===u.clipGround||(-1===u.type.indexOf("sphere")&&-1===u.type.indexOf("3d")&&"custom"!==u.type||(0!==u.type.indexOf("sphere-heatmap")||s.length)&&(u.source!==(a&&a.id)&&(s=[],(a=this.style.sourceCaches[u.source])&&a.getVisibleCoordinates&&(s=a.getVisibleCoordinates())),this.renderSphereLayer(this,a,u,s)));}},Zi.prototype.sphereModeRender=function(){if(this.sphereTileVerticeCache.updateCacheSize(this.transform),this._map.panoramaMode){var t=this.style._layers[e.default$11.LAYER.PANORAMA_LAYER_ID];return this.renderSphereLayer(this,this.style.sourceCaches[e.default$11.SOURCE.PANORAMA_SOURCE_ID],t,{})}if(this.depthPick)this.cameraDrawMode=e.default$11.CAMERA.DRAW_MODE.OFFSCREEN,this._currentFrameBuffer=this.fbManager.pickFramebuffer.framebuffer,this.context.bindFramebuffer.set(this.fbManager.pickFramebuffer.framebuffer),this.context.viewport.set([0,0,this.width,this.height]),this._currentCameraView=null,this.cameraDrawMode=e.default$11.CAMERA.DRAW_MODE.OFFSCREEN,this._sphereDrawLoop();else{var i=e.default$11.CAMERA.DRAW_MODE.NORMAL;this.activeCameras.shadow&&(this.cameraDrawMode=e.default$11.CAMERA.DRAW_MODE.OFFSCREEN,i=e.default$11.CAMERA.DRAW_MODE.ONSCREEN_SHADOW,this._currentFrameBuffer=this.fbManager.shadowFramebuffer.framebuffer,this.context.bindFramebuffer.set(this.fbManager.shadowFramebuffer.framebuffer),this.context.viewport.set([0,0,this.width,this.height]),this._currentCameraView=this.activeCameras.shadow,this.context.clear({color:e.default$8.black,depth:1}),this._sphereDrawLoop());var a=[];this.activeCameras.viewshed.length>0&&(i=i===e.default$11.CAMERA.DRAW_MODE.ONSCREEN_SHADOW?e.default$11.CAMERA.DRAW_MODE.ONSCREEN_ALL:e.default$11.CAMERA.DRAW_MODE.ONSCREEN_VIEWSHED);for(var o=0;o<this.activeCameras.viewshed.length&&o<1;o++){this.cameraDrawMode=e.default$11.CAMERA.DRAW_MODE.OFFSCREEN_VIEWSHED;var r=this.fbManager.getAFramebufferFromPool();a.push(r);var n=this.activeCameras.viewshed[o];n.fb=r,this._currentCameraView=n,this._currentFrameBuffer=r.framebuffer,this.context.bindFramebuffer.set(r.framebuffer),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:e.default$8.black,depth:1}),this._sphereDrawLoop();}this._map.fxaaRender?(this._currentFrameBuffer=this.fbManager.fxaaFramebuffer.framebuffer,this.context.bindFramebuffer.set(this._currentFrameBuffer)):this._map.bloomRender?(this._currentFrameBuffer=this.fbManager.bloomBaseColorFramebuffer.framebuffer,this.context.bindFramebuffer.set(this._currentFrameBuffer)):(this._currentFrameBuffer=null,this.context.bindFramebuffer.set(null)),this.context.viewport.set([0,0,this.width,this.height]),this._currentCameraView=null,this.cameraDrawMode=i,this._sphereDrawLoop();for(var s=0;s<a.length;s++)this.activeCameras.viewshed[s].fb=null,this.fbManager.releaseAFramebufferOfPool(a[s]);this._map.bloomRender&&this.renderSphereLayer(this,{},{type:"bloom",isHidden:function(e){return e<0}},{}),this._map.fxaaRender&&this.renderSphereLayer(this,{},{type:"fxaa",isHidden:function(e){return e<0}},{});}},Zi.prototype.renderSphereLayer=function(e,t,i,a){i&&i.isHidden(this.transform.zoom)||(i||a?i&&a&&Yi[i.type](e,t,i,a):Yi.sphere(e,t));},Zi.prototype.render=function(t,i){var a=this;for(var o in this.style=t,this.options=i,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.default.now()),t.sourceCaches){var r=a.style.sourceCaches[o];r.used&&r.prepare(a.context);}var n=this.style._order,s=e.filterObject(this.style.sourceCaches,function(e){return!a.transform.sphereRender&&"raster"===e.getSource().type}),l=function(t){var i=s[t];!function(t,i){for(var a=t.sort(function(e,t){return e.tileID.isLessThan(t.tileID)?-1:t.tileID.isLessThan(e.tileID)?1:0}),o=0;o<a.length;o++){var r={},n=a[o],s=a.slice(o+1);Pt(n.tileID.wrapped(),n.tileID,s,new e.OverscaledTileID(0,n.tileID.wrap+1,0,0,0),r),n.setMask(r,i);}}(i.getVisibleCoordinates().map(function(e){return i.getTile(e)}),a.context);};for(var u in s)l(u);if(this.context.bindFramebuffer.set(null),this.transform.sphereRender){var c=this.context.gl;return this.context.setStencilMode(new e.default$39({func:this.context.gl.ALWAYS,mask:0},255,255,c.KEEP,c.KEEP,c.REPLACE)),this.context.setColorMode(e.default$40.unblended),this.context.setDepthMode(new e.default$38(this.context.gl.LEQUAL,e.default$38.ReadWrite,[0,1])),this.context.setCullFace(e.default$43.disabled),this.activeCameras=this._map.getAllActiveCameraViews(),this.context.clear({color:e.default$8.black,depth:1}),this.sphereModeRender()}this.renderPass="offscreen";var _,f=[];this.depthRboNeedsClear=!0;for(var m=0;m<n.length;m++){var p=a.style._layers[n[m]];-1===p.type.indexOf("sphere")&&-1===p.type.indexOf("3d")&&(p.hasOffscreenPass()&&!p.isHidden(a.transform.zoom)&&(p.source!==(_&&_.id)&&(f=[],(_=a.style.sourceCaches[p.source])&&(f=_.getVisibleCoordinates()).reverse()),("custom"===p.type||f.length)&&a.renderLayer(a,_,p,f)));}this.context.bindFramebuffer.set(null),this.context.clear({color:i.showOverdrawInspector?e.default$8.black:e.default$8.transparent,depth:1}),this._showOverdrawInspector=i.showOverdrawInspector,this.depthRange=(t._order.length+2)*this.numSublayers*this.depthEpsilon,this.renderPass="opaque";var h,d=[];for(this.currentLayer=n.length-1,this.currentLayer;this.currentLayer>=0;this.currentLayer--){var g=a.style._layers[n[a.currentLayer]];-1===g.type.indexOf("sphere")&&-1===g.type.indexOf("3d")&&(g.source!==(h&&h.id)&&(d=[],(h=a.style.sourceCaches[g.source])&&(a.clearStencil(),d=h.getVisibleCoordinates(),h.getSource().isTileClipped&&a._renderTileClippingMasks(d))),a.renderLayer(a,h,g,d));}this.renderPass="translucent";var v,y=[];for(this.currentLayer=0,this.currentLayer;this.currentLayer<n.length;this.currentLayer++){var x=a.style._layers[n[a.currentLayer]];-1===x.type.indexOf("sphere")&&-1===x.type.indexOf("3d")&&(x.source!==(v&&v.id)&&(y=[],(v=a.style.sourceCaches[x.source])&&(y=v.getVisibleCoordinates(),v.getSource().isTileClipped&&a._renderTileClippingMasks(y)),y.reverse()),a.renderLayer(a,v,x,y));}if(this.options.showTileBoundaries){var b=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];!b||b instanceof K||ji.debug(this,b,b.getVisibleCoordinates());}this.setCustomLayerDefaults();},Zi.prototype.setupOffscreenDepthRenderbuffer=function(){var e=this.context;this.depthRbo||(this.depthRbo=e.createRenderbuffer(e.gl.DEPTH_COMPONENT16,this.width,this.height));},Zi.prototype.renderLayer=function(e,t,i,a){i.isHidden(this.transform.zoom)||("background"===i.type||"custom"===i.type||a.length)&&(this.id=i.id,ji[i.type](e,t,i,a));},Zi.prototype.translatePosMatrix=function(t,i,a,o,r){if(!a[0]&&!a[1])return t;var n=r?"map"===o?this.transform.angle:0:"viewport"===o?-this.transform.angle:0;if(n){var s=Math.sin(n),l=Math.cos(n);a=[a[0]*l-a[1]*s,a[0]*s+a[1]*l];}var u=[r?a[0]:Ve(i,a[0],this.transform.zoom),r?a[1]:Ve(i,a[1],this.transform.zoom),0],c=new Float64Array(16);return e.translate(c,t,u),c},Zi.prototype.saveTileTexture=function(e){var t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e];},Zi.prototype.getTileTexture=function(e){var t=this._tileTextures[e];return t&&t.length>0?t.pop():null},Zi.prototype._createProgramCached=function(e,t){this.cache=this.cache||{};var i=""+e+(t.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[i]||(this.cache[i]=new Et(this.context,bt[e],t,this._showOverdrawInspector)),this.cache[i]},Zi.prototype.useProgram=function(e,t){var i=this._createProgramCached(e,t||this.emptyProgramConfiguration);return this.context.program.set(i.program),i},Zi.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault();},Zi.prototype.setBaseState=function(){var e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD);},Object.defineProperties(Zi.prototype,qi);var Qi=function(){var t,i,a,o,r;e.bindAll(["_onHashChange","_updateHash"],this),this._updateHash=(t=this._updateHashUnthrottled.bind(this),i=300,a=!1,o=0,r=function(){o=0,a&&(t(),o=setTimeout(r,i),a=!1);},function(){return a=!0,o||r(),o});};Qi.prototype.addTo=function(t){return this._map=t,e.default$2.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Qi.prototype.remove=function(){return e.default$2.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Qi.prototype.getHashString=function(e){var t=this._map.getCenter(),i=Math.round(100*this._map.getZoom())/100,a=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,a),r=Math.round(t.lng*o)/o,n=Math.round(t.lat*o)/o,s=this._map.getBearing(),l=this._map.getPitch(),u="";return u+=e?"#/"+r+"/"+n+"/"+i:"#"+i+"/"+n+"/"+r,(s||l)&&(u+="/"+Math.round(10*s)/10),l&&(u+="/"+Math.round(l)),u},Qi.prototype._onHashChange=function(){var t=e.default$2.location.hash.replace("#","").split("/");return t.length>=3&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0),pitch:+(t[4]||0)}),!0)},Qi.prototype._updateHashUnthrottled=function(){var t=this.getHashString();e.default$2.history.replaceState(e.default$2.history.state,"",t);};var Hi=function(t){function i(i,a,o,r){void 0===r&&(r={});var n=d.mousePos(a.getCanvasContainer(),o),s=a.unproject(n);t.call(this,i,e.extend({point:n,lngLat:s,originalEvent:o},r)),this._defaultPrevented=!1,this.target=a;}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var a={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0;},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,a),i}(e.Event),Ki=function(t){function i(i,a,o){var r=d.touchPos(a.getCanvasContainer(),o),n=r.map(function(e){return a.unproject(e)}),s=r.reduce(function(e,t,i,a){return e.add(t.div(a.length))},new e.default$1(0,0)),l=a.unproject(s);t.call(this,i,{points:r,point:s,lngLats:n,lngLat:l,originalEvent:o}),this._defaultPrevented=!1;}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var a={defaultPrevented:{configurable:!0}};return i.prototype.preventDefault=function(){this._defaultPrevented=!0;},a.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(i.prototype,a),i}(e.Event),Ji=function(e){function t(t,i,a){e.call(this,t,{originalEvent:a}),this._defaultPrevented=!1;}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var i={defaultPrevented:{configurable:!0}};return t.prototype.preventDefault=function(){this._defaultPrevented=!0;},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(t.prototype,i),t}(e.Event),ea=function(t){this._map=t,this._el=t.getCanvasContainer(),this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,e.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this);};ea.prototype.setZoomRate=function(e){this._defaultZoomRate=e;},ea.prototype.setWheelZoomRate=function(e){this._wheelZoomRate=e;},ea.prototype.isEnabled=function(){return!!this._enabled},ea.prototype.isActive=function(){return!!this._active},ea.prototype.enable=function(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=e&&"center"===e.around);},ea.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1);},ea.prototype.onWheel=function(t){if(this.isEnabled()){var i=t.deltaMode===e.default$2.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,a=e.default.now(),o=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,0!==i&&i%4.000244140625==0?this._type="wheel":0!==i&&Math.abs(i)<4?this._type="trackpad":o>400?(this._type=null,this._lastValue=i,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(o*i)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,i+=this._lastValue)),t.shiftKey&&i&&(i/=4),this._type&&(this._lastWheelEvent=t,this._delta-=i,this.isActive()||this._start(t)),t.preventDefault();}},ea.prototype._onTimeout=function(e){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(e);},ea.prototype._start=function(t){if(this._delta){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),this._active=!0,this._map.fire(new e.Event("movestart",{originalEvent:t})),this._map.fire(new e.Event("zoomstart",{originalEvent:t})),this._finishTimeout&&clearTimeout(this._finishTimeout);var i=d.mousePos(this._el,t);this._around=e.default$13.convert(!this._map.unproject(i)||this._aroundCenter?this._map.getCenter():this._map.unproject(i)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame));}},ea.prototype._onScrollFrame=function(){var t=this;if(this._frameId=null,this.isActive()){var i=this._map.transform;if(0!==this._delta){var a="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,o=2/(1+Math.exp(-Math.abs(this._delta*a)));this._delta<0&&0!==o&&(o=1/o);var r="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(r*o))),"wheel"===this._type&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0;}var n="number"==typeof this._targetZoom?this._targetZoom:i.zoom,s=this._startZoom,l=this._easing,u=!1;if("wheel"===this._type&&s&&l){var c=Math.min((e.default.now()-this._lastWheelEventTime)/200,1),_=l(c);i.zoom=e.number(s,n,_),c<1?this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame)):u=!0;}else i.zoom=n,u=!0;i.panoramaMode||i.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire(new e.Event("move",{originalEvent:this._lastWheelEvent})),this._map.fire(new e.Event("zoom",{originalEvent:this._lastWheelEvent})),u&&(this._active=!1,this._finishTimeout=setTimeout(function(){t._map.fire(new e.Event("zoomend",{originalEvent:t._lastWheelEvent})),t._map.fire(new e.Event("moveend",{originalEvent:t._lastWheelEvent})),delete t._targetZoom;},200));}},ea.prototype._smoothOutEasing=function(t){var i=e.ease;if(this._prevEase){var a=this._prevEase,o=(e.default.now()-a.start)/a.duration,r=a.easing(o+.01)-a.easing(o),n=.27/Math.sqrt(r*r+1e-4)*.01,s=Math.sqrt(.0729-n*n);i=e.bezier(n,s,.25,1);}return this._prevEase={start:e.default.now(),duration:t,easing:i},i};var ta=function(t,i){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=i.clickTolerance||1,e.bindAll(["_onMouseMove","_onMouseUp","_onKeyDown"],this);};ta.prototype.isEnabled=function(){return!!this._enabled},ta.prototype.isActive=function(){return!!this._active},ta.prototype.enable=function(){this.isEnabled()||(this._enabled=!0);},ta.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1);},ta.prototype.onMouseDown=function(t){this.isEnabled()&&t.shiftKey&&0===t.button&&(e.default$2.document.addEventListener("mousemove",this._onMouseMove,!1),e.default$2.document.addEventListener("keydown",this._onKeyDown,!1),e.default$2.document.addEventListener("mouseup",this._onMouseUp,!1),d.disableDrag(),this._startPos=this._lastPos=d.mousePos(this._el,t),this._active=!0);},ta.prototype._onMouseMove=function(e){var t=d.mousePos(this._el,e);if(!(this._lastPos.equals(t)||!this._box&&t.dist(this._startPos)<this._clickTolerance)){var i=this._startPos;this._lastPos=t,this._box||(this._box=d.create("div","minemap-boxzoom",this._container),this._container.classList.add("minemap-crosshair"),this._fireEvent("boxzoomstart",e));var a=Math.min(i.x,t.x),o=Math.max(i.x,t.x),r=Math.min(i.y,t.y),n=Math.max(i.y,t.y);d.setTransform(this._box,"translate("+a+"px,"+r+"px)"),this._box.style.width=o-a+"px",this._box.style.height=n-r+"px";}},ta.prototype._onMouseUp=function(t){if(0===t.button){var i=this._startPos,a=d.mousePos(this._el,t),o=(new e.default$9).extend(this._map.unproject(i)).extend(this._map.unproject(a));this._finish(),d.suppressClick(),i.x===a.x&&i.y===a.y?this._fireEvent("boxzoomcancel",t):this._map.fitBounds(o,{linear:!0}).fire(new e.Event("boxzoomend",{originalEvent:t,boxZoomBounds:o}));}},ta.prototype._onKeyDown=function(e){27===e.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",e));},ta.prototype._finish=function(){this._active=!1,e.default$2.document.removeEventListener("mousemove",this._onMouseMove,!1),e.default$2.document.removeEventListener("keydown",this._onKeyDown,!1),e.default$2.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("minemap-crosshair"),this._box&&(d.remove(this._box),this._box=null),d.enableDrag(),delete this._startPos,delete this._lastPos;},ta.prototype._fireEvent=function(t,i){return this._map.fire(new e.Event(t,{originalEvent:i}))};var ia=e.bezier(0,0,.25,1),aa=function(t,i){this._map=t,this._el=i.element||t.getCanvasContainer(),this._state="disabled",this._button=i.button||"right",this._bearingSnap=i.bearingSnap||0,this._pitchWithRotate=!1!==i.pitchWithRotate,this._enabledFocusMode=!1,e.bindAll(["onMouseDown","_onMouseMove","_onMouseUp","_onBlur","_onDragFrame"],this);};aa.prototype.isEnabled=function(){return"disabled"!==this._state},aa.prototype.isActive=function(){return"active"===this._state},aa.prototype.enable=function(){this.isEnabled()||(this._state="enabled");},aa.prototype.disable=function(){if(this.isEnabled())switch(this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend"),this._pitchWithRotate&&this._fireEvent("pitchend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled";}},aa.prototype.onMouseDown=function(t){if("enabled"===this._state){if("right"===this._button){if(this._eventButton=d.mouseButton(t),this._eventButton!==(t.ctrlKey?0:2))return}else{if(t.ctrlKey||0!==d.mouseButton(t))return;this._eventButton=0;}d.disableDrag(),t.altKey&&!this._map.fPMode&&(this._enabledFocusMode=!0),e.default$2.document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),e.default$2.document.addEventListener("mouseup",this._onMouseUp),e.default$2.addEventListener("blur",this._onBlur),this._state="pending",this._inertia=[[e.default.now(),this._map.getBearing()]],this._startPos=this._lastPos=d.mousePos(this._el,t),this._focusPos=this._startPos;var i=this._map.unproject(this._focusPos);this._focusCenter=e.transformECEFToGeographic([],i?i.toArray():this._map.getCenter().toArray(),e.default$11.TRANSFORM.R),t.preventDefault();}},aa.prototype._onMouseMove=function(e){var t=d.mousePos(this._el,e);this._lastPos.equals(t)||(this._lastMoveEvent=e,this._lastPos=t,"pending"===this._state&&(this._state="active",this._fireEvent("rotatestart",e),this._fireEvent("movestart",e),this._pitchWithRotate&&this._fireEvent("pitchstart",e)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)));},aa.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t){var i=this._map.transform,a=this._startPos,o=this._lastPos,r=.8*(a.x-o.x),n=-.5*(a.y-o.y),s=i.bearing-r,l=i.pitch-n,u=this._inertia,c=u[u.length-1];if(this._drainInertiaBuffer(),u.push([e.default.now(),this._map._normalizeBearing(s,c[1])]),this._enabledFocusMode){var _=this._map,f=r*e.default$11.TRANSFORM.DEG_TO_RAD,m=e.transformECEFToGeographic([],_.transform.center.toArray(),e.default$11.TRANSFORM.R),p=e.fromRotation([],-f,this._focusCenter),h=e.transformMat4([],m.concat([1]),p);_.transform.center=e.default$13.convert(e.transformGeographicToECEF([],h).slice(0,2));}i.bearing=s,this._pitchWithRotate&&(this._fireEvent("pitch",t),i.pitch=l),this._fireEvent("rotate",t),this._fireEvent("move",t),delete this._lastMoveEvent,this._startPos=this._lastPos;}},aa.prototype._onMouseUp=function(e){if(d.mouseButton(e)===this._eventButton)switch(this._enabledFocusMode&&(this._enabledFocusMode=!1),this._state){case"active":this._state="enabled",d.suppressClick(),this._unbind(),this._deactivate(),this._inertialRotate(e);break;case"pending":this._state="enabled",this._unbind();}},aa.prototype._onBlur=function(e){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend",e),this._pitchWithRotate&&this._fireEvent("pitchend",e),this._fireEvent("moveend",e);break;case"pending":this._state="enabled",this._unbind();}},aa.prototype._unbind=function(){e.default$2.document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),e.default$2.document.removeEventListener("mouseup",this._onMouseUp),e.default$2.removeEventListener("blur",this._onBlur),d.enableDrag();},aa.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._lastPos;},aa.prototype._inertialRotate=function(t){var i=this;this._fireEvent("rotateend",t),this._drainInertiaBuffer();var a=this._map,o=a.getBearing(),r=this._inertia,n=function(){Math.abs(o)<i._bearingSnap?a.resetNorth({noMoveStart:!0},{originalEvent:t}):i._fireEvent("moveend",t),i._pitchWithRotate&&i._fireEvent("pitchend",t);};if(r.length<2)n();else{var s=r[0],l=r[r.length-1],u=r[r.length-2],c=a._normalizeBearing(o,u[1]),_=l[1]-s[1],f=_<0?-1:1,m=(l[0]-s[0])/1e3;if(0!==_&&0!==m){var p=Math.abs(_*(.25/m));p>180&&(p=180);var h=p/180;if(c+=f*p*(h/2),Math.abs(a._normalizeBearing(c,0))<this._bearingSnap&&(c=a._normalizeBearing(0,c)),this._enabledFocusMode&&!a.fPMode){var d=c-a.transform.angle,g=e.transformECEFToGeographic([],a.transform.center.toArray(),e.default$11.TRANSFORM.R),v=e.fromRotation([],-d,this._focusCenter),y=e.transformMat4([],g.concat([1]),v);a.transform.center=e.default$13.convert(e.transformGeographicToECEF([],y).slice(0,2)),a.rotateTo(c,{duration:1e3*h,easing:ia,noMoveStart:!0},{originalEvent:t});}else a.rotateTo(c,{duration:1e3*h,easing:ia,noMoveStart:!0},{originalEvent:t});}else n();}},aa.prototype._fireEvent=function(t,i){return this._map.fire(new e.Event(t,i?{originalEvent:i}:{}))},aa.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,i=e.default.now();t.length>0&&i-t[0][0]>160;)t.shift();};var oa=e.bezier(0,0,.3,1),ra=function(t,i){this._map=t,this._el=t.getCanvasContainer(),this._state="disabled",this._clickTolerance=i.clickTolerance||0,e.bindAll(["_onMove","_onMouseUp","_onTouchEnd","_onBlur","_onDragFrame"],this),G(this);};ra.prototype.isEnabled=function(){return"disabled"!==this._state},ra.prototype.isActive=function(){return"active"===this._state},ra.prototype.enable=function(){this.isEnabled()||(this._el.classList.add("minemap-touch-drag-pan"),this._state="enabled");},ra.prototype.disable=function(){if(this.isEnabled())switch(this._el.classList.remove("minemap-touch-drag-pan"),this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("dragend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled";}},ra.prototype.onMouseDown=function(t){"enabled"===this._state&&(t.ctrlKey||0!==d.mouseButton(t)||(d.addEventListener(e.default$2.document,"mousemove",this._onMove,{capture:!0}),d.addEventListener(e.default$2.document,"mouseup",this._onMouseUp),this._start(t)));},ra.prototype.onTouchStart=function(t){"enabled"===this._state&&(t.touches.length>1||(d.addEventListener(e.default$2.document,"touchmove",this._onMove,{capture:!0,passive:!1}),d.addEventListener(e.default$2.document,"touchend",this._onTouchEnd),this._start(t)));},ra.prototype._start=function(t){e.default$2.addEventListener("blur",this._onBlur),this._state="pending",this._startPos=this._mouseDownPos=this._lastPos=d.mousePos(this._el,t),this._inertia=[[e.default.now(),this._startPos]],this._panoFrame&&this._map._cancelRenderFrame(this._panoFrame);},ra.prototype._onMove=function(t){t.preventDefault();var i=d.mousePos(this._el,t);this._lastPos.equals(i)||"pending"===this._state&&i.dist(this._mouseDownPos)<this._clickTolerance||(this._lastMoveEvent=t,this._lastPos=i,this._drainInertiaBuffer(),this._inertia.push([e.default.now(),this._lastPos]),"pending"===this._state&&(this._state="active",this._fireEvent("dragstart",t),this._fireEvent("movestart",t)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)));},ra.prototype._onDragFrame=function(){this._frameId=null;var e=this._lastMoveEvent;if(e){var t=this._map.transform;t.setLocationAtPoint(t.pointLocation(this._startPos),this._lastPos),this._fireEvent("drag",e),this._fireEvent("move",e),this._startPos=this._lastPos,delete this._lastMoveEvent;}},ra.prototype._onMouseUp=function(e){if(0===d.mouseButton(e))switch(this._state){case"active":this._state="enabled",d.suppressClick(),this._unbind(),this._deactivate(),this._inertialPan(e);break;case"pending":this._state="enabled",this._unbind();}},ra.prototype._onTouchEnd=function(e){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._inertialPan(e);break;case"pending":this._state="enabled",this._unbind();}},ra.prototype._onBlur=function(e){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("dragend",e),this._fireEvent("moveend",e);break;case"pending":this._state="enabled",this._unbind();}},ra.prototype._unbind=function(){d.removeEventListener(e.default$2.document,"touchmove",this._onMove,{capture:!0,passive:!1}),d.removeEventListener(e.default$2.document,"touchend",this._onTouchEnd),d.removeEventListener(e.default$2.document,"mousemove",this._onMove,{capture:!0}),d.removeEventListener(e.default$2.document,"mouseup",this._onMouseUp),d.removeEventListener(e.default$2,"blur",this._onBlur);},ra.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._map._cancelRenderFrame(this._panoFrame),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._mouseDownPos,delete this._lastPos;},ra.prototype._inertialPan=function(t){this._fireEvent("dragend",t),this._drainInertiaBuffer();var i=this._inertia;if(i.length<2)this._fireEvent("moveend",t);else{var a=i[i.length-1],o=i[0],r=a[1].sub(o[1]),n=(a[0]-o[0])/1e3;if(0===n||a[1].equals(o[1]))this._fireEvent("moveend",t);else{var s=r.mult(.3/n),l=s.mag();l>1400&&(l=1400,s._unit()._mult(l));var u=l/750,c=s.mult(-u/2);if(this._map.transform.sphereRender||this._map.transform.panoramaMode){this._panoFrame&&this._map._cancelRenderFrame(this._panoFrame);var _=this._map.transform,f=0,m=0,p=0;if(0!==c.x&&0!==c.y)Math.abs(c.x)>Math.abs(c.y)?(f=10,m=10*c.y/c.x,p=c.x/10):(f=10*c.x/c.y,m=10,p=c.y/10);else if(0!==c.x&&0===c.y)f=10,p=c.x/10;else{if(0!==c.x||0===c.y)return;m=10,p=c.y/10;}var h=_.pointLocation(new e.default$1(_.width/2+f,_.height/2+10+m)),d=_.pointLocation(new e.default$1(_.width/2,_.height/2+10));this._panoTimeElapseStart=Date.now(),this._panoActivDuration=u,this.difLng=-(d.lng-h.lng)*p,this.difLat=-(d.lat-h.lat)*p,this._panoStartMapCenter=this._map.getCenter(),this._lastZoomNumber=_.zoom,this._panoFrame=this._map._requestRenderFrame(this._panoPanRender);}else this._map.panBy(c,{duration:1e3*u,easing:oa,noMoveStart:!0},{originalEvent:t,dragPanEmmit:!0});}}},ra.prototype._panoPanRender=function(){if(this._map.transform.panoramaMode||this._map.transform.zoom===this._lastZoomNumber){var e=oa((Date.now()-this._panoTimeElapseStart)/this._panoActivDuration/1e3),t=this._panoStartMapCenter.lat+this.difLat*e,i=this._panoStartMapCenter.lng+this.difLng*e;t<-90?t=-90:t>90&&(t=90),i<-180?i+=360:i>180&&(i-=360),this._map.setCenter([i,t]),Date.now()-this._panoTimeElapseStart<1e3*this._panoActivDuration?(this._panoFrame=this._map._requestRenderFrame(this._panoPanRender),this._fireEvent("moving",{})):this._fireEvent("moveend",{});}},ra.prototype._fireEvent=function(t,i){return this._map.fire(new e.Event(t,i?{originalEvent:i}:{}))},ra.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,i=e.default.now();t.length>0&&i-t[0][0]>160;)t.shift();};var na=function(t){this._map=t,this._el=t.getCanvasContainer(),e.bindAll(["_onKeyDown"],this);};function sa(e){return e*(2-e)}na.prototype.isEnabled=function(){return!!this._enabled},na.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0);},na.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1);},na.prototype._onKeyDown=function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t=0,i=0,a=0,o=0,r=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),o=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),o=1);break;case 38:e.shiftKey?a=1:(e.preventDefault(),r=-1);break;case 40:e.shiftKey?a=-1:(r=1,e.preventDefault());break;default:return}var n=this._map,s=n.getZoom(),l={duration:300,delayEndEvents:500,easing:sa,zoom:t?Math.round(s)+t*(e.shiftKey?2:1):s,bearing:n.getBearing()+15*i,pitch:n.getPitch()+10*a,offset:[100*-o,100*-r],center:n.getCenter()};n.easeTo(l,{originalEvent:e});}};var la=function(t){this._map=t,e.bindAll(["_onDblClick","_onZoomEnd"],this);};la.prototype.isEnabled=function(){return!!this._enabled},la.prototype.isActive=function(){return!!this._active},la.prototype.enable=function(){this.isEnabled()||(this._enabled=!0);},la.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1);},la.prototype.onTouchStart=function(e){var t=this;this.isEnabled()&&(e.points.length>1||(this._tapped?(clearTimeout(this._tapped),this._tapped=null,this._zoom(e)):this._tapped=setTimeout(function(){t._tapped=null;},300)));},la.prototype.onDblClick=function(e){this.isEnabled()&&(e.originalEvent.preventDefault(),this._zoom(e));},la.prototype._zoom=function(e){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(e.originalEvent.shiftKey?-1:1),{around:e.lngLat},e);},la.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd);};var ua=e.bezier(0,0,.15,1),ca=function(t){this._map=t,this._el=t.getCanvasContainer(),e.bindAll(["_onMove","_onEnd","_onTouchFrame"],this);};ca.prototype.isEnabled=function(){return!!this._enabled},ca.prototype.enable=function(e){this.isEnabled()||(this._el.classList.add("minemap-touch-zoom-rotate"),this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around);},ca.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("minemap-touch-zoom-rotate"),this._enabled=!1);},ca.prototype.disableRotation=function(){this._rotationDisabled=!0;},ca.prototype.enableRotation=function(){this._rotationDisabled=!1;},ca.prototype.onStart=function(t){if(this.isEnabled()&&2===t.touches.length){var i=d.mousePos(this._el,t.touches[0]),a=d.mousePos(this._el,t.touches[1]);this._startVec=i.sub(a),this._gestureIntent=void 0,this._inertia=[],d.addEventListener(e.default$2.document,"touchmove",this._onMove,{passive:!1}),d.addEventListener(e.default$2.document,"touchend",this._onEnd);}},ca.prototype._getTouchEventData=function(e){var t=d.mousePos(this._el,e.touches[0]),i=d.mousePos(this._el,e.touches[1]),a=t.sub(i);return{vec:a,center:t.add(i).div(2),scale:a.mag()/this._startVec.mag(),bearing:this._rotationDisabled?0:180*a.angleWith(this._startVec)/Math.PI}},ca.prototype._onMove=function(t){if(2===t.touches.length){var i=this._getTouchEventData(t),a=i.vec,o=i.scale,r=i.bearing;if(!this._gestureIntent){var n=Math.abs(1-o)>.15;Math.abs(r)>10?this._gestureIntent="rotate":n&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._map.fire(new e.Event(this._gestureIntent+"start",{originalEvent:t})),this._map.fire(new e.Event("movestart",{originalEvent:t})),this._startVec=a);}this._lastTouchEvent=t,this._frameId||(this._frameId=this._map._requestRenderFrame(this._onTouchFrame)),t.preventDefault();}},ca.prototype._onTouchFrame=function(){this._frameId=null;var t=this._gestureIntent;if(t){var i=this._map.transform;this._startScale||(this._startScale=i.scale,this._startBearing=i.bearing);var a=this._getTouchEventData(this._lastTouchEvent),o=a.center,r=a.bearing,n=a.scale,s=i.pointLocation(o),l=i.locationPoint(s);"rotate"===t&&(i.bearing=this._startBearing+r),i.zoom=i.scaleZoom(this._startScale*n),i.setLocationAtPoint(s,l),this._map.fire(new e.Event(t,{originalEvent:this._lastTouchEvent})),this._map.fire(new e.Event("move",{originalEvent:this._lastTouchEvent})),this._drainInertiaBuffer(),this._inertia.push([e.default.now(),n,o]);}},ca.prototype._onEnd=function(t){d.removeEventListener(e.default$2.document,"touchmove",this._onMove,{passive:!1}),d.removeEventListener(e.default$2.document,"touchend",this._onEnd);var i=this._gestureIntent,a=this._startScale;if(this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._gestureIntent,delete this._startScale,delete this._startBearing,delete this._lastTouchEvent,i){this._map.fire(new e.Event(i+"end",{originalEvent:t})),this._drainInertiaBuffer();var o=this._inertia,r=this._map;if(o.length<2)r.snapToNorth({},{originalEvent:t});else{var n=o[o.length-1],s=o[0],l=r.transform.scaleZoom(a*n[1]),u=r.transform.scaleZoom(a*s[1]),c=l-u,_=(n[0]-s[0])/1e3,f=n[2];if(0!==_&&l!==u){var m=.15*c/_;Math.abs(m)>2.5&&(m=m>0?2.5:-2.5);var p=1e3*Math.abs(m/(12*.15)),h=l+m*p/2e3;h<0&&(h=0),r.easeTo({zoom:h,duration:p,easing:ua,around:this._aroundCenter?r.getCenter():r.unproject(f),noMoveStart:!0},{originalEvent:t});}else r.snapToNorth({},{originalEvent:t});}}},ca.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,i=e.default.now();t.length>2&&i-t[0][0]>160;)t.shift();};var _a={scrollZoom:ea,boxZoom:ta,dragRotate:aa,dragPan:ra,keyboard:na,doubleClickZoom:la,touchZoomRotate:ca};var fa=function(t){function i(i,a){t.call(this),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=a.bearingSnap,e.bindAll(["_renderFrameCallback"],this);}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.getCenter=function(){return this.transform.center},i.prototype.setCenter=function(e,t){return this.jumpTo({center:e},t)},i.prototype.panBy=function(t,i,a){return t=e.default$1.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},i),a)},i.prototype.panTo=function(t,i,a){return this.easeTo(e.extend({center:t},i),a)},i.prototype.getZoom=function(){return this.transform.zoom},i.prototype.setZoom=function(e,t){return this.jumpTo({zoom:e},t),this},i.prototype.zoomTo=function(t,i,a){return this.easeTo(e.extend({zoom:t},i),a)},i.prototype.zoomIn=function(e,t){return this.zoomTo(this.getZoom()+1,e,t),this},i.prototype.zoomOut=function(e,t){return this.zoomTo(this.getZoom()-1,e,t),this},i.prototype.getBearing=function(){return this.transform.bearing},i.prototype.setBearing=function(e,t){return this.jumpTo({bearing:e},t),this},i.prototype.rotateTo=function(t,i,a){return this.easeTo(e.extend({bearing:t},i),a)},i.prototype.resetNorth=function(t,i){return this.transform.panoramaMode?(this.easeTo({center:[0,0],duration:2e3,bearing:0,pitch:0,zoom:1}),this.fire(new e.Event("panorama-resetangle",{}))):this.rotateTo(0,e.extend({duration:1e3},t),i),this},i.prototype.snapToNorth=function(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this},i.prototype.getPitch=function(){return this.transform.pitch},i.prototype.setPitch=function(e,t){return this.jumpTo({pitch:e},t),this},i.prototype.cameraForBounds=function(t,i){if("number"==typeof(i=e.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){var a=i.padding;i.padding={top:a,bottom:a,right:a,left:a};}if(e.default$30(Object.keys(i.padding).sort(function(e,t){return e<t?-1:e>t?1:0}),["bottom","left","right","top"])){t=e.default$9.convert(t);var o=[(i.padding.left-i.padding.right)/2,(i.padding.top-i.padding.bottom)/2],r=Math.min(i.padding.right,i.padding.left),n=Math.min(i.padding.top,i.padding.bottom);i.offset=[i.offset[0]+o[0],i.offset[1]+o[1]];var s=e.default$1.convert(i.offset),l=this.transform,u=l.project(t.getNorthWest()),c=l.project(t.getSouthEast()),_=c.sub(u),f=(l.width-2*r-2*Math.abs(s.x))/_.x,m=(l.height-2*n-2*Math.abs(s.y))/_.y;if(!(m<0||f<0))return i.center=l.unproject(u.add(c).div(2)),i.zoom=Math.min(l.scaleZoom(l.scale*Math.min(f,m)),i.maxZoom),i.bearing=0,i;e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");}else e.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'");},i.prototype.fitBounds=function(t,i,a){var o=this.cameraForBounds(t,i);return o?(i=e.extend(o,i)).linear?this.easeTo(i,a):this.flyTo(i,a):this},i.prototype.jumpTo=function(t,i){this.stop();var a=this.transform,o=!1,r=!1,n=!1;return"zoom"in t&&a.zoom!==+t.zoom&&(o=!0,a.zoom=+t.zoom),void 0!==t.center&&(a.center=e.default$13.convert(t.center)),"bearing"in t&&a.bearing!==+t.bearing&&(r=!0,a.bearing=+t.bearing),"pitch"in t&&a.pitch!==+t.pitch&&(n=!0,a.pitch=+t.pitch),this.fire(new e.Event("movestart",i)).fire(new e.Event("move",i)),o&&this.fire(new e.Event("zoomstart",i)).fire(new e.Event("zoom",i)).fire(new e.Event("zoomend",i)),r&&this.fire(new e.Event("rotatestart",i)).fire(new e.Event("rotate",i)).fire(new e.Event("rotateend",i)),n&&this.fire(new e.Event("pitchstart",i)).fire(new e.Event("pitch",i)).fire(new e.Event("pitchend",i)),this.fire(new e.Event("moveend",i))},i.prototype.easeTo=function(t,i){var a=this;this.stop(),!1===(t=e.extend({offset:[0,0],duration:500,easing:e.ease},t)).animate&&(t.duration=0);var o=this.transform,r=this.getZoom(),n=this.getBearing(),s=this.getPitch(),l="zoom"in t?+t.zoom:r,u="bearing"in t?this._normalizeBearing(t.bearing,n):n,c="pitch"in t?+t.pitch:s,_=o.centerPoint.add(e.default$1.convert(t.offset)),f=o.pointLocation(_),m=e.default$13.convert(t.center||f);this._normalizeCenter(m);var p,h,d=o.project(f),g=o.project(m).sub(d),v=o.zoomScale(l-r);return t.around&&(p=e.default$13.convert(t.around),h=o.locationPoint(p)),this._zooming=l!==r,this._rotating=n!==u,this._pitching=c!==s,this._prepareEase(i,t.noMoveStart),clearTimeout(this._easeEndTimeoutID),this._ease(function(t){if(a._zooming&&(o.zoom=e.number(r,l,t)),a._rotating&&(o.bearing=e.number(n,u,t)),a._pitching&&(o.pitch=e.number(s,c,t)),p)o.setLocationAtPoint(p,h);else{var f=o.zoomScale(o.zoom-r),m=l>r?Math.min(2,v):Math.max(.5,v),y=Math.pow(m,1-t),x=o.unproject(d.add(g.mult(t*y)).mult(f));o.setLocationAtPoint(o.renderWorldCopies?x.wrap():x,_);}a._fireMoveEvents(i);},function(){t.delayEndEvents?a._easeEndTimeoutID=setTimeout(function(){return a._afterEase(i)},t.delayEndEvents):a._afterEase(i);},t),this},i.prototype._prepareEase=function(t,i){this._moving=!0,i||this.fire(new e.Event("movestart",t)),this._zooming&&this.fire(new e.Event("zoomstart",t)),this._rotating&&this.fire(new e.Event("rotatestart",t)),this._pitching&&this.fire(new e.Event("pitchstart",t));},i.prototype._fireMoveEvents=function(t){this.fire(new e.Event("move",t)),this._zooming&&this.fire(new e.Event("zoom",t)),this._rotating&&this.fire(new e.Event("rotate",t)),this._pitching&&this.fire(new e.Event("pitch",t));},i.prototype._afterEase=function(t){var i=this._zooming,a=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,i&&this.fire(new e.Event("zoomend",t)),a&&this.fire(new e.Event("rotateend",t)),o&&this.fire(new e.Event("pitchend",t)),this.fire(new e.Event("moveend",t));},i.prototype.flyTo=function(t,i){var a=this;this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.sphereFly?e.easeForSphere:e.ease},t);var o=this.transform,r=this.getZoom(),n=this.getBearing(),s=this.getPitch(),l="zoom"in t?e.clamp(+t.zoom,o.minZoom,o.maxZoom):r,u="bearing"in t?this._normalizeBearing(t.bearing,n):n,c="pitch"in t?+t.pitch:s,_=o.zoomScale(l-r),f=o.centerPoint.add(e.default$1.convert(t.offset)),m=o.pointLocation(f),p=e.default$13.convert(t.center||m);this._normalizeCenter(p);var h=o.project(m),d=o.project(p).sub(h),g=t.curve,v=Math.max(o.width,o.height),y=v/_,x=d.mag();if("minZoom"in t){var b=e.clamp(Math.min(t.minZoom,r,l),o.minZoom,o.maxZoom),w=v/o.zoomScale(b-r);g=Math.sqrt(w/x*2);}var A=g*g;function T(e){var t=(y*y-v*v+(e?-1:1)*A*A*x*x)/(2*(e?y:v)*A*x);return Math.log(Math.sqrt(t*t+1)-t)}function E(e){return(Math.exp(e)-Math.exp(-e))/2}function P(e){return(Math.exp(e)+Math.exp(-e))/2}var S=T(0),I=function(e){return P(S)/P(S+g*e)},M=function(e){return v*((P(S)*(E(t=S+g*e)/P(t))-E(S))/A)/x;var t;},R=(T(1)-S)/g;if(Math.abs(x)<1e-6||!isFinite(R)){if(Math.abs(v-y)<1e-6)return this.easeTo(t,i);var C=y<v?-1:1;R=Math.abs(Math.log(y/v))/g,M=function(){return 0},I=function(e){return Math.exp(C*g*e)};}if("duration"in t)t.duration=+t.duration;else{var O="screenSpeed"in t?+t.screenSpeed/g:+t.speed;t.duration=1e3*R/O;}return t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=n!==u,this._pitching=c!==s,this._prepareEase(i,!1),this._ease(function(_){var m=_*R,p=1/I(m);o.zoom=1===_?l:r+o.scaleZoom(p),a._rotating&&(o.bearing=e.number(n,u,_)),a._pitching&&(o.pitch=e.number(s,c,_));var g=o.unproject(h.add(d.mult(M(m))).mult(p));o.setLocationAtPoint(o.renderWorldCopies?g.wrap():g,f),a._fireMoveEvents(i),t.sphereFly&&(a.style.shouldUpdateSource=!1);},function(){return t.sphereFly&&(a.style.shouldUpdateSource=!0),a._afterEase(i)},t),this},i.prototype.isEasing=function(){return!!this._easeFrameId},i.prototype.stop=function(){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var e=this._onEaseEnd;delete this._onEaseEnd,e.call(this);}return this},i.prototype._ease=function(t,i,a){!1===a.animate||0===a.duration?(t(1),i()):(this._easeStart=e.default.now(),this._easeOptions=a,this._onEaseFrame=t,this._onEaseEnd=i,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback));},i.prototype._renderFrameCallback=function(){var t=Math.min((e.default.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop();},i.prototype._normalizeBearing=function(t,i){t=e.wrap(t,-180,180);var a=Math.abs(t-i);return Math.abs(t-360-i)<a&&(t-=360),Math.abs(t+360-i)<a&&(t+=360),t},i.prototype._normalizeCenter=function(e){var t=this.transform;if(t.renderWorldCopies&&!t.lngRange){var i=e.lng-t.center.lng;e.lng+=i>180?-360:i<-180?360:0;}},i}(e.Evented),ma=function(t){void 0===t&&(t={}),this.options=t,e.bindAll(["_updateEditLink","_updateData","_updateCompact"],this);};ma.prototype.getDefaultPosition=function(){return"bottom-right"},ma.prototype.onAdd=function(e){var t=this.options&&this.options.compact;return this._map=e,this._container=d.create("div","minemap-ctrl minemap-ctrl-attrib"),t&&this._container.classList.add("minemap-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},ma.prototype.onRemove=function(){d.remove(this._container),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0;},ma.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".minemap-improve-map"));var t=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:i.ACCESS_TOKEN}];if(e){var a=t.reduce(function(e,i,a){return i.value&&(e+=i.key+"="+i.value+(a<t.length-1?"&":"")),e},"?");e.href="https://www.minemap.com/feedback/"+a+(this._map._hash?this._map._hash.getHashString(!0):"");}},ma.prototype._updateData=function(e){e&&"metadata"===e.sourceDataType&&(this._updateAttributions(),this._updateEditLink());},ma.prototype._updateAttributions=function(){if(this._map.style){var e=[];if(this._map.style.stylesheet){var t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id;}var i=this._map.style.sourceCaches;for(var a in i){var o=i[a].getSource();o.attribution&&e.indexOf(o.attribution)<0&&e.push(o.attribution);}e.sort(function(e,t){return e.length-t.length}),(e=e.filter(function(t,i){for(var a=i+1;a<e.length;a++)if(e[a].indexOf(t)>=0)return!1;return!0})).length?(this._container.innerHTML=e.join(" | "),this._container.classList.remove("minemap-attrib-empty")):this._container.classList.add("minemap-attrib-empty"),this._editLink=null;}},ma.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("minemap-compact"):this._container.classList.remove("minemap-compact");};var pa=function(){e.bindAll(["_updateLogo"],this);};pa.prototype.onAdd=function(e){this._map=e,this._container=d.create("div","minemap-ctrl");var t=d.create("a","minemap-ctrl-logo");return t.target="_blank",t.href="https://www.minedata.cn/",t.setAttribute("aria-label","minedata logo"),t.setAttribute("rel","noopener"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._container},pa.prototype.onRemove=function(){d.remove(this._container),this._map.off("sourcedata",this._updateLogo);},pa.prototype.getDefaultPosition=function(){return"bottom-left"},pa.prototype._updateLogo=function(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none");},pa.prototype._logoRequired=function(){if(this._map.style)return!0};var ha=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1;};ha.prototype.add=function(e){var t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t},ha.prototype.remove=function(e){for(var t=this._currentlyRunning,i=0,a=t?this._queue.concat(t):this._queue;i<a.length;i+=1){var o=a[i];if(o.id===e)return void(o.cancelled=!0)}},ha.prototype.run=function(){var e=this._currentlyRunning=this._queue;this._queue=[];for(var t=0,i=e;t<i.length;t+=1){var a=i[t];if(!a.cancelled&&(a.callback(),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1;},ha.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[];};var da=function(t,i){this.map=i,this._sphereRender=t.sphereRender||!1,this._projection=t.projection||e.ProjectionType.MERCATOR,this.options=t;},ga={sphereRender:{configurable:!0},projection:{configurable:!0}};function va(t,i,a,o){void 0===o&&(o=!0);var r=1<<t,n={};function s(i,s,l){var u,c,_,f;if(l>=0&&l<=r)for(u=i;u<s;u++)c=Math.floor(u/r),_=(u%r+r)%r,0!==c&&!0!==o||(f=new e.OverscaledTileID(a,c,t,_,l),n[f.key]=f);}return ba(i[0],i[1],i[2],0,r,s),ba(i[2],i[3],i[0],0,r,s),Object.keys(n).map(function(e){return n[e]})}function ya(e,t){if(e.row>t.row){var i=e;e=t,t=i;}return{x0:e.column,y0:e.row,x1:t.column,y1:t.row,dx:t.column-e.column,dy:t.row-e.row}}function xa(e,t,i,a,o){var r=Math.max(i,Math.floor(t.y0)),n=Math.min(a,Math.ceil(t.y1));if(e.x0===t.x0&&e.y0===t.y0?e.x0+t.dy/e.dy*e.dx<t.x1:e.x1-t.dy/e.dy*e.dx<t.x0){var s=e;e=t,t=s;}for(var l=e.dx/e.dy,u=t.dx/t.dy,c=e.dx>0,_=t.dx<0,f=r;f<n;f++){var m=l*Math.max(0,Math.min(e.dy,f+c-e.y0))+e.x0,p=u*Math.max(0,Math.min(t.dy,f+_-t.y0))+t.x0;o(Math.floor(p),Math.ceil(m),f);}}function ba(e,t,i,a,o,r){var n,s=ya(e,t),l=ya(t,i),u=ya(i,e);s.dy>l.dy&&(n=s,s=l,l=n),s.dy>u.dy&&(n=s,s=u,u=n),l.dy>u.dy&&(n=l,l=u,u=n),s.dy&&xa(u,s,a,o,r),l.dy&&xa(u,l,a,o,r);}ga.sphereRender.set=function(e){this._sphereRender=e,this.map.transform.sphereRender=e;},ga.sphereRender.get=function(){return this._sphereRender},ga.projection.get=function(){return this._projection},ga.projection.set=function(t){this._projection=t||e.ProjectionType.MERCATOR,this.map.transform.projection=this._projection,this.map.style.changWorkerProjection(this._projection),this.map.painter.projection=this._projection;},Object.defineProperties(da.prototype,ga);var wa=function(t,i,a){this.tileSize=512,this._renderWorldCopies=void 0===a||a,this._minZoom=t||0,this._maxZoom=i||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this._center=new e.default$13(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._posMatrixCache={},this._alignedPosMatrixCache={};},Aa={minZoom:{configurable:!0},maxZoom:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerPoint:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},unmodified:{configurable:!0},x:{configurable:!0},y:{configurable:!0},point:{configurable:!0}};function Ta(t,i,a,o,r,n){var s,l,u,c,_=t.locationCoordinate(new e.default$13(i.west,i.north))._zoomTo(r),f=t.locationCoordinate(new e.default$13(i.east,i.south))._zoomTo(r);n?(s=_.column-4<0?0:Math.round(_.column-4),l=f.column+3<0?0:Math.round(f.column+3),u=_.row-4<0?0:Math.round(_.row-4),c=f.row+3<0?0:Math.round(f.row+3)):(s=_.column-1<0?0:Math.round(_.column-1),l=f.column<0?0:Math.round(f.column),u=_.row-1<0?0:Math.round(_.row-1),c=f.row<0?0:Math.round(f.row)),Math.abs(o.x-s)>20&&(s=o.x-20)<0&&(s=0),Math.abs(o.x-l)>20&&(l=o.x+20)>=Math.pow(2,r)&&(l=Math.pow(2,r)-1),Math.abs(o.y-u)>20&&(u=o.y-20)<0&&(u=0),Math.abs(o.y-c)>20&&(c=o.y+20,u>=Math.pow(2,r)&&(u=Math.pow(2,r)-1));for(var m=s;m<=l&&!(m>=Math.pow(2,r));m++)for(var p=u;p<=c&&!(p>=Math.pow(2,r));p++)a[r+"-"+m+"-"+p]=new e.OverscaledTileID(r,0,r,m,p);}wa.prototype.clone=function(){var e=new wa(this._minZoom,this._maxZoom,this._renderWorldCopies);return e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e._center=this._center,e.zoom=this.zoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._unmodified=this._unmodified,e._calcMatrices(),e},Aa.minZoom.get=function(){return this._minZoom},Aa.minZoom.set=function(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e));},Aa.maxZoom.get=function(){return this._maxZoom},Aa.maxZoom.set=function(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e));},Aa.renderWorldCopies.get=function(){return this._renderWorldCopies},Aa.renderWorldCopies.set=function(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e;},Aa.worldSize.get=function(){return this.tileSize*this.scale},Aa.centerPoint.get=function(){return this.size._div(2)},Aa.size.get=function(){return new e.default$1(this.width,this.height)},Aa.bearing.get=function(){return-this.angle/Math.PI*180},Aa.bearing.set=function(t){var i=-e.wrap(t,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=e.create$4(),e.rotate(this.rotationMatrix,this.rotationMatrix,this.angle));},Aa.pitch.get=function(){return this._pitch/Math.PI*180},Aa.pitch.set=function(t){var i=e.clamp(t,0,60)/180*Math.PI;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcMatrices());},Aa.fov.get=function(){return this._fov/Math.PI*180},Aa.fov.set=function(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices());},Aa.zoom.get=function(){return this._zoom},Aa.zoom.set=function(e){var t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom,this._constrain(),this._calcMatrices());},Aa.center.get=function(){return this._center},Aa.center.set=function(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices());},wa.prototype.coveringZoomLevel=function(e){return(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize))},wa.prototype.getVisibleUnwrappedCoordinates=function(t){var i=this.pointCoordinate(new e.default$1(0,0),0),a=this.pointCoordinate(new e.default$1(this.width,0),0),o=Math.floor(i.column),r=Math.floor(a.column),n=[new e.UnwrappedTileID(0,t)];if(this._renderWorldCopies)for(var s=o;s<=r;s++)0!==s&&n.push(new e.UnwrappedTileID(s,t));return n},wa.prototype.coveringTiles=function(t){var i=this.coveringZoomLevel(t),a=i;if(void 0!==t.minzoom&&i<t.minzoom)return[];void 0!==t.maxzoom&&i>t.maxzoom&&(i=t.maxzoom);var o=this.pointCoordinate(this.centerPoint,i),r=new e.default$1(o.column-.5,o.row-.5);return va(i,[this.pointCoordinate(new e.default$1(0,0),i),this.pointCoordinate(new e.default$1(this.width,0),i),this.pointCoordinate(new e.default$1(this.width,this.height),i),this.pointCoordinate(new e.default$1(0,this.height),i)],t.reparseOverscaled?a:i,this._renderWorldCopies).sort(function(e,t){return r.dist(e.canonical)-r.dist(t.canonical)})},wa.prototype.resize=function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices();},Aa.unmodified.get=function(){return this._unmodified},wa.prototype.zoomScale=function(e){return Math.pow(2,e)},wa.prototype.scaleZoom=function(e){return Math.log(e)/Math.LN2},wa.prototype.project=function(t){return new e.default$1(this.lngX(t.lng),this.latY(t.lat))},wa.prototype.unproject=function(t){return new e.default$13(this.xLng(t.x),this.yLat(t.y))},Aa.x.get=function(){return this.lngX(this.center.lng)},Aa.y.get=function(){return this.latY(this.center.lat)},Aa.point.get=function(){return new e.default$1(this.x,this.y)},wa.prototype.lngX=function(e){return(180+e)*this.worldSize/360},wa.prototype.latY=function(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))*this.worldSize/360},wa.prototype.xLng=function(e){return 360*e/this.worldSize-180},wa.prototype.yLat=function(e){var t=180-360*e/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90},wa.prototype.setLocationAtPoint=function(e,t){var i=this.pointCoordinate(t)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(e)._sub(i)),this._renderWorldCopies&&(this.center=this.center.wrap());},wa.prototype.locationPoint=function(e,t){return this.coordinatePoint(this.locationCoordinate(e))},wa.prototype.pointLocation=function(e,t){return this.coordinateLocation(this.pointCoordinate(e))},wa.prototype.locationCoordinate=function(t){var i=t.lat<this.latRange[0]?this.worldSize:t.lat>this.latRange[1]?0:this.latY(t.lat);return new e.default$27(this.lngX(t.lng)/this.tileSize,i/this.tileSize,this.zoom).zoomTo(this.tileZoom)},wa.prototype.coordinateLocation=function(t){var i=t.zoomTo(this.zoom);return new e.default$13(this.xLng(i.column*this.tileSize),this.yLat(i.row*this.tileSize))},wa.prototype.pointCoordinate=function(t,i){void 0===i&&(i=this.tileZoom);var a=[t.x,t.y,0,1],o=[t.x,t.y,1,1];e.transformMat4(a,a,this.pixelMatrixInverse),e.transformMat4(o,o,this.pixelMatrixInverse);var r=a[3],n=o[3],s=a[0]/r,l=o[0]/n,u=a[1]/r,c=o[1]/n,_=a[2]/r,f=o[2]/n,m=_===f?0:(0-_)/(f-_);return new e.default$27(e.number(s,l,m)/this.tileSize,e.number(u,c,m)/this.tileSize,this.zoom)._zoomTo(i)},wa.prototype.coordinatePoint=function(t){var i=t.zoomTo(this.zoom),a=[i.column*this.tileSize,i.row*this.tileSize,0,1];return e.transformMat4(a,a,this.pixelMatrix),new e.default$1(a[0]/a[3],a[1]/a[3])},wa.prototype.calculatePosMatrix=function(t,i){void 0===i&&(i=!1);var a=t.key,o=i?this._alignedPosMatrixCache:this._posMatrixCache;if(o[a])return o[a];var r=t.canonical,n=this.worldSize/this.zoomScale(r.z),s=r.x+Math.pow(2,r.z)*t.wrap,l=e.identity(new Float64Array(16));return e.translate(l,l,[s*n,r.y*n,0]),e.scale(l,l,[n/e.default$12,n/e.default$12,1]),e.multiply(l,i?this.alignedProjMatrix:this.projMatrix,l),o[a]=new Float32Array(l),o[a]},wa.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,i,a,o,r=-90,n=90,s=-180,l=180,u=this.size,c=this._unmodified;if(this.latRange){var _=this.latRange;r=this.latY(_[1]),t=(n=this.latY(_[0]))-r<u.y?u.y/(n-r):0;}if(this.lngRange){var f=this.lngRange;s=this.lngX(f[0]),i=(l=this.lngX(f[1]))-s<u.x?u.x/(l-s):0;}var m=Math.max(i||0,t||0);if(m)return this.center=this.unproject(new e.default$1(i?(l+s)/2:this.x,t?(n+r)/2:this.y)),this.zoom+=this.scaleZoom(m),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var p=this.y,h=u.y/2;p-h<r&&(o=r+h),p+h>n&&(o=n-h);}if(this.lngRange){var d=this.x,g=u.x/2;d-g<s&&(a=s+g),d+g>l&&(a=l-g);}void 0===a&&void 0===o||(this.center=this.unproject(new e.default$1(void 0!==a?a:this.x,void 0!==o?o:this.y))),this._unmodified=c,this._constraining=!1;}},wa.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var t=this._fov/2,i=Math.PI/2+this._pitch,a=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-i-t),o=this.x,r=this.y,n=1.01*(Math.cos(Math.PI/2-this._pitch)*a+this.cameraToCenterDistance),s=new Float64Array(16);e.perspective(s,this._fov,this.width/this.height,1,n),e.scale(s,s,[1,-1,1]),e.translate(s,s,[0,0,-this.cameraToCenterDistance]),e.rotateX(s,s,this._pitch),e.rotateZ(s,s,this.angle),e.translate(s,s,[-o,-r,0]),this.mercatorMatrix=e.scale([],s,[this.worldSize,this.worldSize,this.worldSize]);var l=this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180))));e.scale(s,s,[1,1,l,1]),this.projMatrix=s;var u=this.width%2/2,c=this.height%2/2,_=Math.cos(this.angle),f=Math.sin(this.angle),m=o-Math.round(o)+_*u+f*c,p=r-Math.round(r)+_*c+f*u,h=new Float64Array(s);if(e.translate(h,h,[m>.5?m-1:m,p>.5?p-1:p,0]),this.alignedProjMatrix=h,s=e.create(),e.scale(s,s,[this.width/2,-this.height/2,1]),e.translate(s,s,[1,-1,0]),this.pixelMatrix=e.multiply(new Float64Array(16),s,this.projMatrix),!(s=e.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=s,this._posMatrixCache={},this._alignedPosMatrixCache={};}},wa.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;if(this.pitch>60)return 10;var t=this.pointCoordinate(new e.default$1(0,0)).zoomTo(this.zoom),i=[t.column*this.tileSize,t.row*this.tileSize,0,1];return e.transformMat4(i,i,this.pixelMatrix)[3]/this.cameraToCenterDistance},wa.prototype.getCameraPoint=function(){var t=this._pitch,i=Math.tan(t)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.default$1(0,i))},wa.prototype.getCameraQueryGeometry=function(t){var i=this.getCameraPoint();if(1===t.length)return[t[0],i];for(var a=i.x,o=i.y,r=i.x,n=i.y,s=0,l=t;s<l.length;s+=1){var u=l[s];a=Math.min(a,u.x),o=Math.min(o,u.y),r=Math.max(r,u.x),n=Math.max(n,u.y);}return[new e.default$1(a,o),new e.default$1(r,o),new e.default$1(r,n),new e.default$1(a,n),new e.default$1(a,o)]},Object.defineProperties(wa.prototype,Aa);var Ea=function(t){function i(i,a,o,r,n){t.call(this,i,a,o),this.td_projectionInverseMatrix=e.create(),this.td_viewMatrix=e.createFloat64ArrayIdentityMatrix(),this.td_viewInverseMatrix=e.createFloat64ArrayIdentityMatrix(),this.td_sphereRender=r||!1,this.latRange=[e.default$11.TRANSFORM.MIN_LAT,e.default$11.TRANSFORM.MAX_LAT],this._projection=n,this.td_camPos=[0,0,0,1],this.td_pixelMatrix=e.create(),this.pixelMatrixInverse=e.create(),this.td_lastRect={},this.td_fPEnabled=!1,this.isFlying=!1,this.td_camHeightOffset=0,this.maxTiles=0,this.panoAnyWhereMoveAngle=0,this.td_projNeedChange=!0,this.td_projZoomChangeNumber=0,this._calcProjectionsMatrix();}t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i;var a={zoom:{configurable:!0},projection:{configurable:!0},sphereRender:{configurable:!0},pitch:{configurable:!0},center:{configurable:!0},bearing:{configurable:!0},fPMode:{configurable:!0},cameraHeightOffset:{configurable:!0},panoramaMode:{configurable:!0}};return i.prototype.setMap=function(e){this._map=e;},i.prototype.setPainter=function(e){this.painter=e;},i.prototype.clone=function(){var e=new i(this._minZoom,this._maxZoom,this._renderWorldCopies,this.sphereRender,this.projection);return e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e._center=this._center,e.zoom=this.zoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._unmodified=this._unmodified,e._calcMatrices(),e.setMap(this._map),e},i.prototype.resize=function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcProjectionsMatrix(),this._calcMatrices();},a.zoom.get=function(){return this._zoom},a.zoom.set=function(t){var i=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._fov&&this._zoom!==i&&(this._unmodified=!1,this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom,this.td_cameraDistance=e.getCameraDistanceFromZoom(this._fov,i,e.default$11.TRANSFORM.R),this.alt=this.td_cameraDistance-e.default$11.TRANSFORM.R,this.current_zoom_tangent_angle=Math.PI/2-Math.asin(e.default$11.TRANSFORM.R/this.td_cameraDistance),this._constrain(),this._calcMatrices(),this._calcProjectionsMatrix(),this._calcMatrices());},i.prototype._calcProjectionsMatrix=function(){0!==this.width&&0!==this.height&&(this.td_projectionMatrix=e.create(),this.panoramaMode?e.perspective(this.td_projectionMatrix,65*e.default$11.TRANSFORM.DEG_TO_RAD,this.width/this.height,.01,10):e.perspective(this.td_projectionMatrix,this._fov,this.width/this.height,this.alt/20,e.default$11.TRANSFORM.R+2*this.alt),e.invert(this.td_projectionInverseMatrix,this.td_projectionMatrix),this.td_pixelMatrix=e.create(),e.scale(this.td_pixelMatrix,this.td_pixelMatrix,[this.width/2,-this.height/2,1]),e.translate(this.td_pixelMatrix,this.td_pixelMatrix,[1,-1,0]),this.td_projNeedChange=!1);},a.projection.set=function(e){this._projection=e;},a.projection.get=function(){return this._projection},a.sphereRender.set=function(t){this.pitch>e.default$11.TRANSFORM.PLAIN_MAX_PITCH&&!t&&(this.pitch=e.default$11.TRANSFORM.PLAIN_MAX_PITCH),this.td_sphereRender=t;},a.sphereRender.get=function(){return this.td_sphereRender},i.prototype.locationPoint=function(e,t){return this.td_sphereRender?this.td_lngLatToScreenPoint(e,t).point:this.coordinatePoint(this.locationCoordinate(e))},i.prototype.locationPointOfScreen=function(e,t){return this.td_lngLatToScreenPoint(e,t)},i.prototype.td_lngLatToScreenPoint=function(t,i){var a=[0,0,0,1];return e.transformECEFToGeographic(a,t.toArray(),e.default$11.TRANSFORM.R+(i||0)*e.default$11.TRANSFORM.R_SCALE),e.transformMat4(a,a,this.td_viewMatrix),e.transformMat4(a,a,this.td_projectionMatrix),e.transformMat4(a,a,this.td_pixelMatrix),{point:new e.default$1(a[0]/a[3],a[1]/a[3]),w:a[3]}},i.prototype.checkPositionForeground=function(t){if(this.td_sphereRender){var i=[0,0,0,1];e.transformECEFToGeographic(i,t.toArray(),e.default$11.TRANSFORM.R);var a=this.getCameraPos(),o=e.dot(e.normalize$1([],i.slice(0,3)),e.normalize$1([],a));return Math.acos(o)<=this.current_zoom_tangent_angle}return!0},i.prototype.coordinatePoint=function(t){var i=t.zoomTo(this.zoom),a=[i.column*this.tileSize,i.row*this.tileSize,0,1];return e.transformMat4(a,a,this.pixelMatrix),new e.default$1(a[0]/a[3],a[1]/a[3])},i.prototype.lngX=function(t){return e.default$49(this._projection).lngX(t,this.worldSize)},i.prototype.lngXRoundZoom=function(t){return e.default$49(this._projection).lngX(t,Math.pow(2,Math.floor(this.zoom)))},i.prototype.latY=function(t){return e.default$49(this._projection).latY(t,this.worldSize)},i.prototype.latYRoundZoom=function(t){return e.default$49(this._projection).latY(t,Math.pow(2,Math.floor(this.zoom)))},i.prototype.xLng=function(t){return e.default$49(this._projection).xLng(t,this.worldSize)},i.prototype.yLat=function(t){return e.default$49(this._projection).yLat(t,this.worldSize)},a.pitch.get=function(){return this._pitch*e.default$11.TRANSFORM.RAD_TO_DEG},a.pitch.set=function(t){var i=e.clamp(t,0,this.sphereRender?e.default$11.TRANSFORM.SPHERE_MAX_PITCH:e.default$11.TRANSFORM.PLAIN_MAX_PITCH)*e.default$11.TRANSFORM.DEG_TO_RAD;this._pitch!==i&&(this._unmodified=!1,this._pitch=i,this._calcProjectionsMatrix(),this._calcMatrices());},a.center.get=function(){return this._center},a.center.set=function(e){if(e.lat!==this._center.lat||e.lng!==this._center.lng){if(this.fPMode){var t=this._map.style.getTerrainAltitude();t>0&&(this.td_camHeightOffset+=(t-this.td_camHeightOffset)/5);}this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices();}},i.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining&&!this.td_sphereRender){this._constraining=!0;var t,i,a,o,r=-90,n=90,s=-180,l=180,u=this.size,c=this._unmodified;if(this.latRange){var _=this.latRange;r=this.latY(_[1]),t=(n=this.latY(_[0]))-r<u.y?u.y/(n-r):0;}if(this.lngRange){var f=this.lngRange;s=this.lngX(f[0]),i=(l=this.lngX(f[1]))-s<u.x?u.x/(l-s):0;}var m=Math.max(i||0,t||0);if(m)return this.center=this.unproject(new e.default$1(i?(l+s)/2:this.x,t?(n+r)/2:this.y)),this.zoom+=this.scaleZoom(m),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var p=this.y,h=u.y/2;p-h<r&&(o=r+h),p+h>n&&(o=n-h);}if(this.lngRange){var d=this.x,g=u.x/2;d-g<s&&(a=s+g),d+g>l&&(a=l-g);}if(void 0!==a||void 0!==o)if(this.td_sphereRender){var v=this.center.lat,y=this.unproject(new e.default$1(void 0!==a?a:this.x,void 0!==o?o:this.y));this.center=new e.default$13(y.lng,this._checkLatRange(v));}else this.center=this.unproject(new e.default$1(void 0!==a?a:this.x,void 0!==o?o:this.y));this._unmodified=c,this._constraining=!1;}},i.prototype.pointLocation=function(e,t){return this.td_sphereRender?Gi({canvasX:e.x,canvasY:e.y,transform:this,alt:t||0,accurate:!0}).lngLat:this.coordinateLocation(this.pointCoordinate(e))},i.prototype.setLocationAtPoint=function(t,i){if(this.td_sphereRender){var a=Gi({canvasX:i.x,canvasY:i.y,transform:this,accurate:!1});if(a.lngLat&&t){var o=[a.lngLat.lng-t.lng,a.lngLat.lat-t.lat],r=this.center.lat-o[1],n=this.center.lng-o[0];r=this._checkLatRange(r),this.center=new e.default$13(n,r).wrap();}}else{var s=this.pointCoordinate(i)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(t)._sub(s)),this._renderWorldCopies&&(this.center=this.center.wrap());}},i.prototype._checkLatRange=function(e){return this.latRange?e>90?90:e<-90?-90:e:e},i.prototype.covering3DTiles=function(t){var i=this,a=this.td_lastRect;if(this.zoom<t.zoom)return{children:[],rect:a};var o=[],r=Math.floor(this.zoom)+t.data.zoomOffset||0;if(t.modelType===e.default$11.MODEL_TYPE.OSGB){for(var n in t.data.chd||console.error("倾斜摄影测量数据组织文件没有'chd'字段"),t.data.chd){var s=t.data.chd[n];if(s.rect||(s.rect=i._calcTdTileRect(t.matrix,s.bs)),i.intersectRect(a,s.rect))if(r===t.zoom)o.push({key:n,l:s.l,url:s.url,rect:s.rect,bs:s.bs});else{var l=[];i._checkOSGBChildrenCovered(s,r,t.matrix,l),o=o.concat(l);}}if(o.sort(function(t,a){return e.distance(i.td_camPos,t.rect.center)-e.distance(i.td_camPos,a.rect.center)}),o.length>e.default$11.SOURCE.MAX_GLTF_TILE_TO_FIND_PARENT){var u=o.slice(0,e.default$11.SOURCE.MAX_GLTF_TILE_TO_FIND_PARENT),c=o.slice(1*e.default$11.SOURCE.MAX_GLTF_TILE_TO_FIND_PARENT),_=this.getOsgbParentsByArr(c,t.data,1);o=u.concat(_);}}else{for(var f in t.data.chd){t.data.chd||console.error("倾斜摄影测量数据组织文件没有'chd'字段");var m=t.data.chd[f];m.rect||(m.rect=i._calcTdTileRect(t.matrix,m.bs)),i.intersectRect(a,m.rect)&&o.push({key:f,l:m.l,url:m.url,rect:m.rect,bs:m.bs});}o.sort(function(t,a){return e.distance(i.td_camPos,t.rect.center)-e.distance(i.td_camPos,a.rect.center)});}return{children:o.slice(0,e.default$11.SOURCE.MAX_GLTF_TILE_COUNT),rect:a}},i.prototype.getOSGBParentsKeys=function(e){for(var t={},i=0;i<e.length;i++)t[e[i].key]=e[i].key.split("~")[0];var a=[];for(var o in t)a.push(t[o]);return a},i.prototype.getOsgbParentsByArr=function(e,t,i,a){var o={},r=[];e:for(var n=0;n<e.length;n++){if(a)for(var s=0;s<a.length;s++)if(-1!==e[n].key.indexOf(a[s]))continue e;var l=this.findOsgbParentByChild(e[n],t,i);l&&(o[l.key]=l);}for(var u in o)r.push(o[u]);return r},i.prototype.findOsgbParentByChild=function(e,t,i){if(!e)return null;var a=e.key,o=a.split("~")[1].length-2,r=a.length,n=a.substr(0,r-o),s=t.chd[n];if(o<=i)return{l:s.l,url:s.url,bs:s.bs,rect:s.rect,key:n};for(o-=2;o>2*i;)n=a.substr(0,r-o),s=s.chd[n],o-=2;return{l:s.l,url:s.url,bs:s.bs,rect:s.rect,key:n}},i.prototype._calcTdTileRect=function(t,i){var a=[[],[]];e.transformMat4(a[0],i[0].concat([1]),t),e.transformMat4(a[1],i[1].concat([1]),t);var o=-1/0,r=1/0,n=1/0,s=-1/0;e.transformGeographicToECEF(a[0],a[0]),e.transformGeographicToECEF(a[1],a[1]),o<a[0][1]&&(o=a[0][1]),o<a[1][1]&&(o=a[1][1]),r>a[0][1]&&(r=a[0][1]),r>a[1][1]&&(r=a[1][1]),s<a[0][0]&&(s=a[0][0]),s<a[1][0]&&(s=a[1][0]),n>a[0][0]&&(n=a[0][0]),n>a[1][0]&&(n=a[1][0]);var l=.7*(s-n),u=.7*(o-r);return{north:o+u,south:r-u,west:n-l,east:s+l,center:e.transformECEFToGeographic([],[(s+n)/2,(o+r)/2],e.default$11.TRANSFORM.R)}},i.prototype._checkOSGBChildrenCovered=function(e,t,i,a){for(var o in e.chd){var r=e.chd[o];if(r.l<t){if(r.rect||(r.rect=this._calcTdTileRect(i,r.bs)),this.intersectRect(this.td_lastRect,r.rect)){if(0===Object.keys(r.chd).length)return void a.push({l:r.l,url:r.url,rect:r.rect,bs:r.bs,key:o});this._checkOSGBChildrenCovered(r,t,i,a);}}else{if(r.l!==t)return;r.rect||(r.rect=this._calcTdTileRect(i,r.bs)),this.intersectRect(this.td_lastRect,r.rect)&&a.push({l:r.l,url:r.url,rect:r.rect,bs:r.bs,key:o});}}},i.prototype._isEmpty=function(e){return e.east-e.west<=0||e.north-e.south<=0},i.prototype.intersectRect=function(e,t){var i={};return i.west=Math.max(e.west,t.west),i.north=Math.min(e.north,t.north),i.east=Math.min(e.east,t.east),i.south=Math.max(e.south,t.south),!this._isEmpty(i)},i.prototype.tangentPointInvisible=function(){return Gi({canvasX:this.width/2,canvasY:0,transform:this}).lngLat},i.prototype.coveringTiles=function(t){var a=this.coveringZoomLevel(t),o=a;if(void 0!==t.minzoom&&a<t.minzoom)return[];void 0!==t.maxzoom&&a>t.maxzoom&&(a=t.maxzoom);var r=this.pointCoordinate(this.centerPoint,a),n=new e.default$1(r.column-.5,r.row-.5);if(this.td_sphereRender){if(this.isFlying)return this._computeZoomTiles(3,n);var s=t.renderWithTerrain&&this.zoom>=e.default$11.TRANSFORM.TERRAIN_FIND_ZOOM_MIN,l=this.pointCoordinate(s?new e.default$1(this.width/2,this.height/4*(3-Math.cos(this._pitch))):this._getEarthViewCalculateCenterPixel(),a);l&&(n=new e.default$1(l.column,l.row));var u=[],c=function(t,i,a,o){var r=new e.default$1(Math.round(a.x),Math.round(a.y),0),n=i.td_lastRect,s={};return n.antimeridian?(Ta(i,{north:n.north,south:n.south,west:n.west,east:180},s,r,t,o),Ta(i,{north:n.north,south:n.south,west:-180,east:n.east},s,r,t,o)):n.isPole?Ta(i,{north:n.north,south:n.south,west:-180,east:180},s,r,t,o):Ta(i,n,s,r,t,o),Object.keys(s).map(function(e){return s[e]})}(t.reparseOverscaled?o:a,this,n,t.isBackground).sort(function(e,t){return n.dist(e.canonical)-n.dist(t.canonical)});if(t.noLowLevelCover)return c.slice(0,64);if(t.isVector)return t.noBox?c.reverse():c.slice(0,32).reverse();if(s){var _=this.maxTiles||64;return u=c.slice(0,_).reverse()}if(c.length>128){u=c.slice(0,40).reverse();var f=i._computeParent(c.slice(40,80),2);u=u.concat(f.reverse());var m=i._computeParent(c.slice(80,320),4);if(u=u.concat(m.reverse()),this.tangentPoint){var p=this.locationCoordinate(e.default$13.convert(this.tangentPoint))._zoomTo(a),h=i._computeParent([new e.OverscaledTileID(a,0,a,p.column,p.row)],8);return u=u.concat(h.reverse()).reverse()}return u.reverse()}return c}return va(a,[this.pointCoordinate(new e.default$1(0,0),a),this.pointCoordinate(new e.default$1(this.width,0),a),this.pointCoordinate(new e.default$1(this.width,this.height),a),this.pointCoordinate(new e.default$1(0,this.height),a)],t.reparseOverscaled?o:a,this._renderWorldCopies).sort(function(e,t){return n.dist(e.canonical)-n.dist(t.canonical)})},i._computeParent=function(t,i){if(0===t.length)return[];for(var a={},o=[],r=t[0].canonical.z-i>=1?i:t[0].canonical.z-1,n=1/Math.pow(2,r),s=0;s<t.length;s++){var l=t[s].canonical.x/Math.pow(2,r),u=t[s].canonical.y/Math.pow(2,r),c=l-Math.floor(l),_=u-Math.floor(u);l=c<=n?Math.floor(l)-2:Math.floor(l)-1,u=_<=n?Math.floor(u)-2:Math.floor(u)-1;for(var f=0;f<4;f++)for(var m=0;m<4;m++)if(!(l+f<0||u+m<0||l+f>=Math.pow(2,t[s].canonical.z-r)||u+m>=Math.pow(2,t[s].canonical.z-r))){var p=new e.OverscaledTileID(t[s].overscaledZ-r,0,t[s].canonical.z-r,l+f,u+m);a[p.key]||(o.push(p),a[p.key]=!0);}}return o},i.prototype._computeZoomTiles=function(t,i){for(var a={},o=[],r=0;r<Math.pow(2,t);r++)for(var n=0;n<Math.pow(2,t);n++){var s=new e.OverscaledTileID(t,0,t,r,n);a[s.key]||(o.push(s),a[s.key]=!0);}return o.sort(function(e,t){return i.dist(e.canonical)-i.dist(t.canonical)}).slice(0,40).reverse()},i.prototype._getEarthViewCalculateCenterPixel=function(){return this.fPMode?new e.default$1(this.width/2,this.height):new e.default$1(this.width/2,this.height*(.5+.5*(1-Math.cos(this._pitch))))},i.prototype._getMaxRectBounds=function(e){for(var t=1/0,i=-1/0,a=1/0,o=-1/0,r=0;r<e.length;r++){var n=e[r];n&&(n[0]>i&&(i=n[0]),n[0]<t&&(t=n[0]),n[1]>o&&(o=n[1]),n[1]<a&&(a=n[1]));}return{north:o,south:a,west:t,east:i,antimeridian:!1,isPole:!1}},i.prototype.computeViewRectangle=function(){var t=this.center.toArray();if(this.zoom<=3)return this._checkBounds({north:t[1]+90>90?90:t[1]+90,south:t[1]-90<-90?-90:t[1]-90,west:t[0]-90,east:t[0]+90,antimeridian:!1,isPole:!1});if(this.zoom<=4)return this._checkBounds({north:t[1]+70>90?90:t[1]+70,south:t[1]-70<-90?-90:t[1]-70,west:t[0]-70,east:t[0]+70,antimeridian:!1,isPole:!1});if(this.zoom<=5)return this._checkBounds({north:t[1]+45>90?90:t[1]+45,south:t[1]-45<-90?-90:t[1]-45,west:t[0]-45,east:t[0]+45,antimeridian:!1,isPole:!1});var i,a=this.tangentPointInvisible(),o=[],r=this.pointLocation(new e.default$1(0,this.height)),n=this.pointLocation(new e.default$1(this.width,this.height));if(r&&o.push(r.toArray()),n&&o.push(n.toArray()),this.pointLocation(new e.default$1(0,0))){var s=this.pointLocation(new e.default$1(0,0)),l=this.pointLocation(new e.default$1(this.width,0));s&&o.push(s.toArray()),l&&o.push(l.toArray());}else{var u=e.length(this.getCameraPos()),c=(Math.pow(this.alt,2)+Math.pow(u,2)-Math.pow(e.default$11.TRANSFORM.R,2))/(2*u*this.alt),_=Math.acos(c),f=e.default$11.TRANSFORM.R/u,m=Math.asin(f)-_,p=e.transformMat4([],[0,0,0,1],this.td_thirdPersonViewMatrix),h=Math.atan(this.width/this.height),d=this._getTangentLngLatByCameraRotateAngle({angle:m,cam:p,OC:u,tangentRotateAngle:h}),g=this._getTangentLngLatByCameraRotateAngle({angle:m,cam:p,OC:u,tangentRotateAngle:-h});o.push(g,d);}if(a)this.tangentPoint=a.toArray(),o.push(this.tangentPoint);else{var v=this.pointLocation(new e.default$1(0,this.height/2)),y=this.pointLocation(new e.default$1(this.width,this.height/2));v&&o.push(v.toArray()),y&&o.push(y.toArray());var x=e.length(this.getCameraPos()),b=(Math.pow(this.alt,2)+Math.pow(x,2)-Math.pow(e.default$11.TRANSFORM.R,2))/(2*x*this.alt),w=Math.acos(b),A=e.default$11.TRANSFORM.R/x,T=Math.asin(A)-w,E=e.transformMat4([],[0,0,0,1],this.td_thirdPersonViewMatrix),P=this._getTangentLngLatByCameraRotateAngle({angle:T,cam:E,OC:x,tangentRotateAngle:0});this.tangentPoint=P,o.push(P);}return i=this._getMaxRectBounds(o),this._checkBounds(i)},i.prototype._getTangentLngLatByCameraRotateAngle=function(t){var i=[0,Math.sin(t.angle),-Math.cos(t.angle),1];if(0!==t.tangentRotateAngle){var a=e.create();e.rotateY(a,a,t.tangentRotateAngle),e.transformMat4(i,i,a);}var o=e.transformMat4([],i,this.td_thirdPersonViewMatrix),r=e.normalize$1([],e.sub([],o,t.cam)),n=e.scale$1([],r,Math.sqrt(Math.pow(t.OC,2)-Math.pow(e.default$11.TRANSFORM.R,2))),s=e.add([],n,t.cam);return e.transformGeographicToECEF([],[-s[0],s[1],s[2]])},i.prototype._checkBounds=function(e){var t=e.north,i=e.south,a=e.west,o=e.east,r=e.antimeridian,n=e.isPole;for(t>=90&&(t=90,a=-180,o=180,n=!0),i<=-90&&(i=-90,a=-180,o=180,n=!0);a<-180;)a+=360,r=!0;for(;o>180;)o-=360,r=!0;return{north:t,south:i,west:a,east:o,antimeridian:r,isPole:n}},i.prototype.pointCoordinate=function(t,i){if(this.td_sphereRender){var a=Gi({canvasX:t.x,canvasY:t.y,transform:this,accurate:!0});return a.lngLat?new e.default$27(this.lngX(a.lngLat.lng)/this.tileSize,this.latY(a.lngLat.lat)/this.tileSize,this.zoom)._zoomTo(i||this.zoom):this._delegatePointCoordinate(t,i)}return this._delegatePointCoordinate(t,i)},i.prototype._delegatePointCoordinate=function(t,i){void 0===i&&(i=this.tileZoom);var a=[t.x,t.y,0,1],o=[t.x,t.y,1,1];e.transformMat4(a,a,this.pixelMatrixInverse),e.transformMat4(o,o,this.pixelMatrixInverse);var r=a[3],n=o[3],s=a[0]/r,l=o[0]/n,u=a[1]/r,c=o[1]/n,_=a[2]/r,f=o[2]/n,m=_===f?0:(0-_)/(f-_);return new e.default$27(e.number(s,l,m)/this.tileSize,e.number(u,c,m)/this.tileSize,this.zoom)._zoomTo(i)},a.bearing.get=function(){return-this.angle/Math.PI*180},a.bearing.set=function(t){var i=-e.wrap(t,-180,180)*Math.PI/180;this.angle!==i&&(this._unmodified=!1,this.angle=i,this._calcMatrices(),this.rotationMatrix=new Float64Array(4),this.rotationMatrix[1]=1,this.rotationMatrix[3]=1,e.rotate(this.rotationMatrix,this.rotationMatrix,this.angle));},i.prototype._getThirdPersonViewMatrix=function(t){t=t||{pitch:this._pitch,bearing:this.angle,altitude:this.alt,lng:this.center.lng,lat:this.center.lat};var i=e.translate([],e.create(),[0,0,t.altitude]),a=e.rotateX([],e.create(),t.pitch),o=e.translate([],e.create(),[0,0,e.default$11.TRANSFORM.R]),r=e.rotateZ([],e.create(),t.bearing),n=e.rotateX([],e.create(),-t.lat*e.default$11.TRANSFORM.DEG_TO_RAD),s=e.rotateY([],e.create(),(-90+t.lng)*e.default$11.TRANSFORM.DEG_TO_RAD);return e.multiply([],e.multiply([],e.multiply([],e.multiply([],e.multiply([],s,n),r),o),a),i)},i.prototype._getPanoViewMatrix=function(){var t=e.create(),i=.05*(this.zoom-1);i<0?i=0:i>.8&&(i=.8),this.pano_z=i,e.lookAt(t,[0,0,0],[0,0,-1],[0,-1,0]),e.rotateX(t,t,-this.center.lat*e.default$11.TRANSFORM.DEG_TO_RAD),e.rotateY(t,t,this.center.lng*e.default$11.TRANSFORM.DEG_TO_RAD);var a=e.create$6();return e.rotate$1(a,[0,i],[0,0],(-90+this.panoAnyWhereMoveAngle)*e.default$11.TRANSFORM.DEG_TO_RAD),e.translate(t,t,[a[0],0,a[1]])},i.prototype._getFirstPersonViewMatrix=function(t){t=t||{pitch:this._pitch,bearing:this.angle,altitude:(this.td_camHeightOffset||10)*e.default$11.TRANSFORM.R_SCALE,lng:this.center.lng,lat:this.center.lat};var i=e.rotateX([],e.create(),t.pitch),a=e.translate([],e.create(),[0,0,t.altitude]),o=e.translate([],e.create(),[0,0,e.default$11.TRANSFORM.R]),r=e.rotateZ([],e.create(),t.bearing),n=e.rotateX([],e.create(),-t.lat*e.default$11.TRANSFORM.DEG_TO_RAD),s=e.rotateY([],e.create(),(-90+t.lng)*e.default$11.TRANSFORM.DEG_TO_RAD);return e.multiply([],e.multiply([],e.multiply([],e.multiply([],e.multiply([],s,n),r),o),a),i)},i.prototype._calculateTDSceneMatrix=function(){var t=e.createFloat64ArrayIdentityMatrix(),i=[0,0,0,1],a=[0,0,-1,1],o=[0,1,0,1];this.td_fPEnabled&&this.zoom>=15?(this.td_firstPersonViewMatrix=this._getFirstPersonViewMatrix(),e.transformMat4(i,i,this.td_firstPersonViewMatrix),e.transformMat4(a,a,this.td_firstPersonViewMatrix),e.transformMat4(o,o,this.td_firstPersonViewMatrix),e.lookAt(t,[i[0]/i[3],i[1]/i[3],i[2]/i[3]],[a[0]/a[3],a[1]/a[3],a[2]/a[3]],[o[0]/o[3],o[1]/o[3],o[2]/o[3]]),e.scale(t,t,[-1,1,1])):this.panoramaMode?t=this._getPanoViewMatrix():(this.td_thirdPersonViewMatrix=this._getThirdPersonViewMatrix(),e.transformMat4(i,i,this.td_thirdPersonViewMatrix),e.transformMat4(a,a,this.td_thirdPersonViewMatrix),e.transformMat4(o,o,this.td_thirdPersonViewMatrix),e.lookAt(t,[i[0]/i[3],i[1]/i[3],i[2]/i[3]],[a[0]/a[3],a[1]/a[3],a[2]/a[3]],[o[0]/o[3],o[1]/o[3],o[2]/o[3]]),e.scale(t,t,[-1,1,1])),this.td_viewMatrix=t,this.td_camPos=[0,0,0,1],this.td_viewInverseMatrix=e.createFloat64ArrayIdentityMatrix(),e.invert(this.td_viewInverseMatrix,this.td_viewMatrix),e.transformMat4(this.td_camPos,this.td_camPos,this.td_viewInverseMatrix),this.td_camPosNormalized=[this.td_camPos[0]/this.td_camPos[3],this.td_camPos[1]/this.td_camPos[3],this.td_camPos[2]/this.td_camPos[3]],this.td_vpMatrix=e.createFloat64ArrayIdentityMatrix(),e.multiply(this.td_vpMatrix,this.td_projectionMatrix,this.td_viewMatrix),this.td_lastRect=this.computeViewRectangle();var r=e.create();e.perspective(r,this._fov,this.width/this.height,.001,10);var n=e.create();e.lookAt(n,[0,0,1/Math.tan(this._fov/2)],[0,0,0],[0,1,0]);var s=e.create();e.rotateX(s,s,this._pitch),this.td_symbolMVPMatrix=e.mul([],e.mul([],r,n),s);},i.prototype.customLayerMatrix=function(){return this.td_sphereRender?e.clone(this.calculateVPMatrix()):e.clone(this.mercatorMatrix)},i.prototype._calcMatrices=function(){if(this.height){this._calculateTDSceneMatrix(),this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var t=this._fov/2,i=Math.PI/2+this._pitch,a=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-i-t),o=this.x,r=this.y,n=1.01*(Math.cos(Math.PI/2-this._pitch)*a+this.cameraToCenterDistance),s=new Float64Array(16);e.perspective(s,this._fov,this.width/this.height,1,n),e.scale(s,s,[1,-1,1]),e.translate(s,s,[0,0,-this.cameraToCenterDistance]);var l=this.pitch;e.rotateX(s,s,l*e.default$11.TRANSFORM.DEG_TO_RAD),e.rotateZ(s,s,this.angle),e.translate(s,s,[-o,-r,0]),this.td_sphereRender||(this.mercatorMatrix=e.scale([],s,[this.worldSize,this.worldSize,this.worldSize]));var u=this.worldSize/(2*Math.PI*e.default$11.TRANSFORM.REAL_R*Math.abs(Math.cos(this.center.lat*e.default$11.TRANSFORM.DEG_TO_RAD)));e.scale(s,s,[1,1,u,1]),this.projMatrix=s;var c=this.width%2/2,_=this.height%2/2,f=Math.cos(this.angle),m=Math.sin(this.angle),p=o-Math.round(o)+f*c+m*_,h=r-Math.round(r)+f*_+m*c,d=new Float64Array(s);if(e.translate(d,d,[p>.5?p-1:p,h>.5?h-1:h,0]),this.alignedProjMatrix=d,s=e.clone(this.td_pixelMatrix),this.pixelMatrix=e.multiply(new Float64Array(16),s,this.projMatrix),!(s=e.invert(new Float64Array(16),this.pixelMatrix))&&!this.td_sphereRender)throw new Error("failed to invert matrix");this.pixelMatrixInverse=s,this._posMatrixCache={},this._alignedPosMatrixCache={};}},i.prototype.calculateAnyCameraMatrix=function(t){var i=[],a=e.createFloat64ArrayIdentityMatrix(),o=[0,0,0,1],r=[0,0,-1,1],n=[0,1,0,1];if(t.id===e.default$11.CAMERA.SKYBOX_CAMERA_ID)e.rotateY(a,a,(-this.center.lng-t.bearing+90)*e.default$11.TRANSFORM.DEG_TO_RAD);else if(t.id===e.default$11.CAMERA.ATMOSPHERE_BLEND_CAMERA_ID){var s=1+.035*Math.pow(2,-this.zoom);e.scale(a,this.td_viewMatrix,[-s,s,s]);}else if(t.id===e.default$11.CAMERA.SUNLIGHT_CAMERA_ID){var l=t.location||this.center.toArray(),u=this._getThirdPersonViewMatrix({lng:l[0],lat:l[1],pitch:t.pitch*e.default$11.TRANSFORM.DEG_TO_RAD,bearing:t.bearing*e.default$11.TRANSFORM.DEG_TO_RAD,altitude:t.altitude*e.default$11.TRANSFORM.R_SCALE});e.transformMat4(o,o,u),e.transformMat4(r,r,u),e.transformMat4(n,n,u),e.lookAt(a,[o[0]/o[3],o[1]/o[3],o[2]/o[3]],[r[0]/r[3],r[1]/r[3],r[2]/r[3]],[n[0]/n[3],n[1]/n[3],n[2]/n[3]]),e.scale(a,a,[-1,1,1]);}else{var c=this._getFirstPersonViewMatrix({lng:t.location[0],lat:t.location[1],pitch:t.pitch*e.default$11.TRANSFORM.DEG_TO_RAD,bearing:t.bearing*e.default$11.TRANSFORM.DEG_TO_RAD,altitude:t.altitude*e.default$11.TRANSFORM.R_SCALE});e.transformMat4(o,o,c),e.transformMat4(r,r,c),e.transformMat4(n,n,c),e.lookAt(a,[o[0]/o[3],o[1]/o[3],o[2]/o[3]],[r[0]/r[3],r[1]/r[3],r[2]/r[3]],[n[0]/n[3],n[1]/n[3],n[2]/n[3]]),e.scale(a,a,[-1,1,1]);}var _=e.createFloat64ArrayIdentityMatrix();e.invert(_,a),e.transformMat4(i,[0,0,0,1],_),this._lastSunLightStatus={lng:this.center.lng,lat:this.center.lat,pitch:t.pitch,bearing:t.bearing,geographic:i.slice(0,3),camTransformMatrix:a};},i.prototype.calculateVPMatrix=function(t){if(t){if(this.calculateAnyCameraMatrix(t),t.id===e.default$11.CAMERA.ATMOSPHERE_BLEND_CAMERA_ID)return e.multiply([],this.td_projectionMatrix,this._lastSunLightStatus.camTransformMatrix);if(t.id===e.default$11.CAMERA.SKYBOX_CAMERA_ID){var i=new Float64Array(16);return e.perspective(i,80*e.default$11.TRANSFORM.DEG_TO_RAD,this.width/this.height,.01,10),e.multiply([],i,this._lastSunLightStatus.camTransformMatrix)}var a=new Float64Array(16);return e.perspective(a,this._fov,this.width/this.height,.1*e.default$11.TRANSFORM.R_SCALE,10*t.farDistance),e.multiply([],a,this._lastSunLightStatus.camTransformMatrix)}return this.td_vpMatrix},i.prototype.getCameraPos=function(){return this.td_camPosNormalized},a.fPMode.get=function(){return this.td_fPEnabled},a.fPMode.set=function(e){this.td_fPEnabled=e;},a.cameraHeightOffset.set=function(e){this.td_camHeightOffset=e;},a.cameraHeightOffset.get=function(){return this.td_camHeightOffset},a.panoramaMode.set=function(e){this._panoramaMode=e,this._calcProjectionsMatrix(),e?this._saveSphereStatus():this._restoreSphereStatus(),this._calcMatrices();},a.panoramaMode.get=function(){return this._panoramaMode},i.prototype._saveSphereStatus=function(){this.sphere_save_transform_status={_zoom:0+this._zoom,_pitch:0+this._pitch,angle:0+this.angle,center:new e.default$13(this._center.lng,this._center.lat)},this._zoom=0,this._pitch=0,this.angle=0,this.center=new e.default$13(0,0),this.zoom=0;},i.prototype._restoreSphereStatus=function(){this._zoom=this.sphere_save_transform_status._zoom,this._pitch=this.sphere_save_transform_status._pitch,this.angle=this.sphere_save_transform_status.angle,this.center=this.sphere_save_transform_status.center;},Object.defineProperties(i.prototype,a),i}(wa),Pa=null,Sa=0,Ia=0,Ma={obj:null,init:function(e){Pa=e.cb,Sa=e.restrictX,Ia=e.restrictY,e.handler.onmousedown=this.start,e.handler.root=e.root||e.handler;var t=e.handler.root;t.onDragStart=e.dragStart||new Function,t.onDrag=e.onDrag||new Function,t.onDragEnd=e.onDragEnd||new Function;},start:function(t){var i=Ma.obj=this;i.style.cursor="move";var a=(t=t||Ma.fixEvent(e.default$2.event)).pageX,o=t.pageY;i.lastMouseX=a,i.lastMouseY=o;var r=i.root.offsetLeft,n=i.root.offsetTop;i.root.style.left=r+"px",i.root.style.top=n+"px",e.default$2.document.onmouseup=Ma.end,e.default$2.document.onmousemove=Ma.drag,i.root.onDragStart(r,n);},drag:function(t){var i=(t=t||Ma.fixEvent(e.default$2.event)).pageX,a=t.pageY,o=Ma.obj.root,r=o.style.left?parseInt(o.style.left):0,n=o.style.top?parseInt(o.style.top):0;r<=-1&&(r=-1),n<=-1&&(n=-1),r>=Sa&&(r=Sa),n>=Ia&&(n=Ia);var s=i-Ma.obj.lastMouseX+r,l=a-Ma.obj.lastMouseY+n;o.style.left=s+"px",o.style.top=l+"px",Ma.obj.root.onDrag(s,l),Ma.obj.lastMouseX=i,Ma.obj.lastMouseY=a;},end:function(){var t=Ma.obj.root.style.left?parseInt(Ma.obj.root.style.left):0,i=Ma.obj.root.style.top?parseInt(Ma.obj.root.style.top):0;Ma.obj.root.onDragEnd(t,i),e.default$2.setTimeout(function(){Pa(t,i);},100),e.default$2.document.onmousemove=null,e.default$2.document.onmouseup=null,Ma.obj=null;},fixEvent:function(t){return t.pageX=t.clientX+e.default$2.document.documentElement.scrollLeft,t.pageY=t.clientY+e.default$2.document.documentElement.scrollTop,t}};function Ra(t,i,a){if(t=new e.default$13(t.lng,t.lat),i){var o=new e.default$13(t.lng-360,t.lat),r=new e.default$13(t.lng+360,t.lat),n=a.locationPoint(t).distSqr(i);a.locationPoint(o).distSqr(i)<n?t=o:a.locationPoint(r).distSqr(i)<n&&(t=r);}for(;Math.abs(t.lng-a.center.lng)>180;){var s=a.locationPoint(t);if(s.x>=0&&s.y>=0&&s.x<=a.width&&s.y<=a.height)break;t.lng>a.center.lng?t.lng-=360:t.lng+=360;}return t}var Ca={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Oa(e,t,i){var a=e.classList;for(var o in Ca)a.remove("minemap-"+i+"-anchor-"+o);a.add("minemap-"+i+"-anchor-"+t);}var Fa=function(t){function i(i){if(t.call(this),(arguments[0]instanceof e.default$2.HTMLElement||2===arguments.length)&&(i=e.extend({element:i},arguments[1])),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick"],this),this._anchor=i&&i.anchor||"top-left",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._state="inactive",this._alt=0,this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&"auto"!==i.pitchAlignment?i.pitchAlignment:this._rotationAlignment,i&&i.element)this._element=i.element,this._offset=e.default$1.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=d.create("div");var a=d.createNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS(null,"height","41px"),a.setAttributeNS(null,"width","27px"),a.setAttributeNS(null,"viewBox","0 0 27 41");var o=d.createNS("http://www.w3.org/2000/svg","g");o.setAttributeNS(null,"stroke","none"),o.setAttributeNS(null,"stroke-width","1"),o.setAttributeNS(null,"fill","none"),o.setAttributeNS(null,"fill-rule","evenodd");var r=d.createNS("http://www.w3.org/2000/svg","g");r.setAttributeNS(null,"fill-rule","nonzero");var n=d.createNS("http://www.w3.org/2000/svg","g");n.setAttributeNS(null,"transform","translate(3.0, 29.0)"),n.setAttributeNS(null,"fill","#000000");for(var s=0,l=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];s<l.length;s+=1){var u=l[s],c=d.createNS("http://www.w3.org/2000/svg","ellipse");c.setAttributeNS(null,"opacity","0.04"),c.setAttributeNS(null,"cx","10.5"),c.setAttributeNS(null,"cy","5.80029008"),c.setAttributeNS(null,"rx",u.rx),c.setAttributeNS(null,"ry",u.ry),n.appendChild(c);}var _=d.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"fill",this._color);var f=d.createNS("http://www.w3.org/2000/svg","path");f.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),_.appendChild(f);var m=d.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"fill","#000000");var p=d.createNS("http://www.w3.org/2000/svg","path");p.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),m.appendChild(p);var h=d.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"transform","translate(6.0, 7.0)"),h.setAttributeNS(null,"fill","#FFFFFF");var g=d.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(8.0, 8.0)");var v=d.createNS("http://www.w3.org/2000/svg","circle");v.setAttributeNS(null,"fill","#000000"),v.setAttributeNS(null,"opacity","0.25"),v.setAttributeNS(null,"cx","5.5"),v.setAttributeNS(null,"cy","5.5"),v.setAttributeNS(null,"r","5.4999962");var y=d.createNS("http://www.w3.org/2000/svg","circle");y.setAttributeNS(null,"fill","#FFFFFF"),y.setAttributeNS(null,"cx","5.5"),y.setAttributeNS(null,"cy","5.5"),y.setAttributeNS(null,"r","5.4999962"),g.appendChild(v),g.appendChild(y),r.appendChild(n),r.appendChild(_),r.appendChild(m),r.appendChild(h),r.appendChild(g),a.appendChild(r),a.setAttributeNS(null,"height",41*this._scale+"px"),a.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(a),this._offset=e.default$1.convert(i&&i.offset||[-13.5*this._scale,-35*this._scale]);}this._element.classList.add("minemap-marker"),this._popup=null;}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.addTo=function(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},i.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),delete this._map),d.remove(this._element),this._popup&&this._popup.remove(),this},i.prototype.getLngLat=function(){return this._lngLat},i.prototype.setLngLat=function(t){return this._lngLat=e.default$13.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},i.prototype.getAltitude=function(){return this._alt},i.prototype.setAltitude=function(e){return this._alt=e,this._pos=null,this._popup&&this._popup.setAltitude(this._alt),this._update(),this},i.prototype.getElement=function(){return this._element},i.prototype.setPopup=function(e){if(this._popup&&(this._popup.remove(),this._popup=null),e){if(!("offset"in e.options)){var t=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[t,-1*(24.6+t)],"bottom-right":[-t,-1*(24.6+t)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset;}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat);}return this},i.prototype._onMapClick=function(e){var t=e.originalEvent.target,i=this._element;this._popup&&(t===i||i.contains(t))&&this.togglePopup();},i.prototype.getPopup=function(){return this._popup},i.prototype.togglePopup=function(){var e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this._map),this):this},i.prototype._update=function(e){if(this._map){if(this._map.transform.renderWorldCopies&&(this._lngLat=Ra(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat,this._alt)._add(this._offset),this._map.sphereRender){var t=this._map.transform.locationPointOfScreen(this._lngLat,this._alt);this._map.panoramaMode?t.w>0?this._element.style.visibility="hidden":this._element.style.visibility="visible":!this._map.transform.checkPositionForeground(this._lngLat)||t.w<0?this._element.style.visibility="hidden":this._element.style.visibility="visible";}e&&"moveend"!==e.type||(this._pos=this._pos.round());var i="",a={x:0,y:0};"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?(a=this._offset,i="rotateZ("+this._rotation+"deg)"):"map"===this._rotationAlignment&&(a=this._offset,i="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var o="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?o="rotateX(0deg)":"map"===this._pitchAlignment&&(a=this._offset,o="rotateX("+this._map.getPitch()+"deg)");var r=Math.abs(a.x)/parseFloat(d.getAllStyle(this._element).width)*100,n=Math.abs(a.y)/parseFloat(d.getAllStyle(this._element).height)*100;d.setTransformOrigin(this._element,r+"% "+n+"%"),d.setTransform(this._element,Ca[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+o+" "+i),Oa(this._element,this._anchor,"marker");}},i.prototype.getOffset=function(){return this._offset},i.prototype.setOffset=function(t){return this._offset=e.default$1.convert(t),this._update(),this},i.prototype._onMove=function(t){this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos,this._alt),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag"));},i.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive";},i.prototype._addDragHandler=function(e){this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._offset),this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp));},i.prototype.setDraggable=function(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},i.prototype.enableDragging=function(){return this.setDraggable(!0),this},i.prototype.disableDragging=function(){return this.setDraggable(!1),this},i.prototype.isDraggable=function(){return this._draggable},i.prototype.getDraggable=function(){return this.isDraggable()},i.prototype.getMap=function(){return this._map},i.prototype.setRotation=function(e){return this._rotation=e||0,this._update(),this},i.prototype.getRotation=function(){return this._rotation},i.prototype.setRotationAlignment=function(e){return this._rotationAlignment=e||"auto",this._update(),this},i.prototype.getRotationAlignment=function(){return this._rotationAlignment},i.prototype.setPitchAlignment=function(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this},i.prototype.getPitchAlignment=function(){return this._pitchAlignment},i}(e.Evented),La=function(){this.counter=0,this.timeSave=Date.now(),this._state=!1,this.needClearTime=!0;},Da={state:{configurable:!0}};La.prototype.update=function(){if(this._state){var e=Date.now();this.needClearTime?this.needClearTime=!1:this.counter+=(e-this.timeSave)/1e3,this.timeSave=e;}},Da.state.get=function(){return this._state},Da.state.set=function(e){this._state=e,e||(this.needClearTime=!0);},Object.defineProperties(La.prototype,Da);var za=function(){};za.prototype._sunLightPosition=function(t){1===t.month?t.month=0:2===t.month?t.month=31:3===t.month?t.month=59:4===t.month?t.month=90:5===t.month?t.month=120:6===t.month?t.month=151:7===t.month?t.month=181:8===t.month?t.month=212:9===t.month?t.month=243:10===t.month?t.month=273:11===t.month?t.month=304:12===t.month&&(t.month=334),this._meanSolarTime=t.hour+t.minute/60-8,this._sunLatLng=[180-15*this._meanSolarTime,23.45*Math.sin(360*(t.month+t.date-80)/370*Math.PI/180)];var i=e.transformECEFToGeographic([],this._sunLatLng,e.default$11.TRANSFORM.R);this._sunLightCenter=[i[0],i[1],i[2]];},za.prototype._shadowSunPosition=function(e){var t=Math.round(e.target[0]/15),i=(this._meanSolarTime+t+24)%24+(e.target[0]-15*t)/15,a=e.target[1]*Math.PI/180,o=this._sunLatLng[1]*Math.PI/180,r=15*(i-12)*Math.PI/180,n=parseFloat((Math.sin(o)*Math.sin(a)+Math.cos(o)*Math.cos(a)*Math.cos(r)).toPrecision(8)),s=180*Math.asin(n)/Math.PI,l=parseFloat(((n*Math.sin(a)-Math.sin(o))/(Math.cos(s*Math.PI/180)*Math.cos(a))).toPrecision(8)),u=180*Math.acos(l)/Math.PI;return s>=0?(i>=12&&(u=-u),this._shadow={active:!0,altitude:e.distance,bearing:u,color:[1,1,1],farDistance:.783927971443699,hFov:60,id:"SUNLIGHT_CAMERA_ID",pitch:90-s,shadowColor:[.2,.2,.2],wFov:0,location:e.target,type:"day"},this._shadow):(this._shadow={type:"night"},this._shadow)},za.prototype.getSunLightPos=function(){return this._sunLightCenter};var Na=e.default$2.HTMLImageElement,Ba=e.default$2.HTMLElement,ka={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:22,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,clickTolerance:3,hash:!1,logoControl:!0,attributionControl:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,transformRequest:null,fadeDuration:300,crossSourceCollisions:!0,sphereRender:!1,projection:e.ProjectionType.MERCATOR,localIdeographFontFamily:"PingFang SC,Microsoft YaHei,微软雅黑,Arial,sans-serif,黑体",defaultCursor:null},$a=function(i){function a(t){if(null!=(t=e.extend({},ka,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than minZoom");var a=new Ea(t.minZoom,t.maxZoom,t.renderWorldCopies,t.sphereRender||!1,t.projection);i.call(this,a,t),this.td_cameraManager=new Ai,this.sunLight=new za,this._shadowFlag=!1,this._viewShedFlag=!1,a.setMap(this),this.mapControl=new da(t,this),this._interactive=t.interactive,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._crossSourceCollisions=t.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=t.collectResourceTiming,this._renderTaskQueue=new ha,this._fxaaRender=t.fxaaRender||!1,this._bloomRender=t.bloomRender||!1,this._bloomOptions={step:9,extent:6};var o=t.transformRequest;if(this._transformRequest=o?function(e,t){return o(e,t)||{url:e}}:function(e){return{url:e}},"string"==typeof t.container){var r=e.default$2.document.getElementById(t.container);if(!r)throw new Error("Container '"+t.container+"' not found.");this._container=r;}else{if(!(t.container instanceof Ba))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container;}if(t.maxBounds&&this.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",this._update.bind(this,!1)),this.on("zoom",this._update.bind(this,!0)),void 0!==e.default$2&&(e.default$2.addEventListener("online",this._onWindowOnline,!1),e.default$2.addEventListener("resize",this._onWindowResize,!1)),function(e,t){var i=e.getCanvasContainer(),a=null,o=!1,r=null;for(var n in _a)e[n]=new _a[n](e,t),t.interactive&&t[n]&&e[n].enable(t[n]);d.addEventListener(i,"mouseout",function(t){e.fire(new Hi("mouseout",e,t));}),d.addEventListener(i,"mousedown",function(a){o=!0,r=d.mousePos(i,a);var n=new Hi("mousedown",e,a);e.fire(n),n.defaultPrevented||(t.interactive&&!e.doubleClickZoom.isActive()&&e.stop(),e.boxZoom.onMouseDown(a),e.boxZoom.isActive()||e.dragPan.isActive()||e.dragRotate.onMouseDown(a),e.boxZoom.isActive()||e.dragRotate.isActive()||e.dragPan.onMouseDown(a));}),d.addEventListener(i,"mouseup",function(t){var i=e.dragRotate.isActive();a&&!i&&e.fire(new Hi("contextmenu",e,a)),a=null,o=!1,e.fire(new Hi("mouseup",e,t));}),d.addEventListener(i,"mousemove",function(t){if(!e.dragPan.isActive()&&!e.dragRotate.isActive()){for(var a=t.target;a&&a!==i;)a=a.parentNode;a===i&&e.fire(new Hi("mousemove",e,t));}}),d.addEventListener(i,"mouseover",function(t){for(var a=t.target;a&&a!==i;)a=a.parentNode;a===i&&e.fire(new Hi("mouseover",e,t));}),d.addEventListener(i,"touchstart",function(i){var a=new Ki("touchstart",e,i);e.fire(a),a.defaultPrevented||(t.interactive&&e.stop(),e.boxZoom.isActive()||e.dragRotate.isActive()||e.dragPan.onTouchStart(i),e.touchZoomRotate.onStart(i),e.doubleClickZoom.onTouchStart(a));},{passive:!1}),d.addEventListener(i,"touchmove",function(t){e.fire(new Ki("touchmove",e,t));},{passive:!1}),d.addEventListener(i,"touchend",function(t){e.fire(new Ki("touchend",e,t));}),d.addEventListener(i,"touchcancel",function(t){e.fire(new Ki("touchcancel",e,t));}),d.addEventListener(i,"click",function(a){var o=d.mousePos(i,a);(o.equals(r)||o.dist(r)<t.clickTolerance)&&e.fire(new Hi("click",e,a));}),d.addEventListener(i,"dblclick",function(t){var i=new Hi("dblclick",e,t);e.fire(i),i.defaultPrevented||e.doubleClickZoom.onDblClick(i);}),d.addEventListener(i,"contextmenu",function(t){var i=e.dragRotate.isActive();o||i?o&&(a=t):e.fire(new Hi("contextmenu",e,t)),t.preventDefault();}),d.addEventListener(i,"wheel",function(i){t.interactive&&e.stop();var a=new Ji("wheel",e,i);e.fire(a),a.defaultPrevented||e.scrollZoom.onWheel(i);},{passive:!1});}(this,t),this._hash=t.hash&&(new Qi).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),this.resize(),t.style&&this.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily,projection:t.projection}),t.attributionControl&&this.addControl(new ma),t.logoControl&&this.addControl(new pa,t.logoPosition),this.on("style.load",function(){this.transform.unmodified&&this.jumpTo(this.style.stylesheet);}),this.on("data",this._onData),this.on("dataloading",this._onDataLoading),this._overviewMapOptions=t,t.overviewMap?(this._overviewMap=!0,this.addOverviewMap()):this._overviewMap=!1,this.setDefaultCursor(t.defaultCursor),this.timer=new La;var n=new Date,s=n.getMonth()+1,l=n.getDate(),u=n.getMinutes();this.setSunLight({month:s,date:l,hour:12,minute:u});}i&&(a.__proto__=i),a.prototype=Object.create(i&&i.prototype),a.prototype.constructor=a;var o={showTileBoundaries:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},sphereRender:{configurable:!0},fxaaRender:{configurable:!0},bloomRender:{configurable:!0},projection:{configurable:!0},vertices:{configurable:!0},panoramaMode:{configurable:!0},fPMode:{configurable:!0},cameraHeightOffset:{configurable:!0}};return a.prototype.__onMove=function(){this.overviewMapInstance.setCenter(this.getCenter()),this.overviewMapInstance.setBearing(this.getBearing()),this.overviewMapInstance.setZoom(this.getZoom()<6?3:this.getZoom()-4);},a.prototype.disableDrag=function(){this.dragPan.disable();},a.prototype.enableDrag=function(){this.dragPan.enable();},a.prototype.setDefaultCursor=function(e){this._canvas.style.cursor=e||"";},a.prototype.setCursor=function(e){this.setDefaultCursor(e);},a.prototype.setZoomAndCenter=function(e,t){this.jumpTo({center:t,zoom:e});},a.prototype.getAllMarkers=function(){return this.__markerList},a.prototype.addMarker=function(e){!function(e,t){var i=e.length;for(;i--;)if(e[i]===t)return!0;return!1}(this.__markerList,e)&&e instanceof Fa&&(this.__markerList.push(e),e.addTo(this));},a.prototype.addMarkers=function(e){for(var t=0;t<e.length;t++)this.addMarker(e[t]);},a.prototype.removeMarker=function(e){e instanceof Fa&&e.remove();},a.prototype.removeMarkers=function(e){if(e)for(var t=0;t<e.length;t++){this.removeMarker(e[t]);for(var i=0;i<this.__markerList.length;i++)e[t]===this.__markerList[i]&&this.__markerList.splice(i,1);}else{for(var a=0;a<this.__markerList.length;a++)this.removeMarker(this.__markerList[a]);this.__markerList=[];}},a.prototype.addOverviewMap=function(){var t=this;this._overviewMapElement=e.default$2.document.createElement("div"),this._overviewMapElement.id="overviewMap_"+Math.random(),this._overviewMapElement.style.position="absolute",this._overviewMapElement.style.width="160px",this._overviewMapElement.style.height="160px",this._overviewMapElement.style.bottom="0px",this._overviewMapElement.style.right="0px",this._overviewMapElement.style.zIndex=200,this._overviewMapElement.style.boxSizing="border-box",this._overviewMapElement.style.border="2px solid rgba(187,187,187,0.5)",this._overviewMapElement.style.borderRadius="2px",this.getContainer().parentNode.parentNode.appendChild(this._overviewMapElement),this.overviewMapInstance=new a({container:this._overviewMapElement,style:this._overviewMapOptions.style,center:this.getCenter(),zoom:this.getZoom()<7?3:this.getZoom()-4,pitch:0,dragPan:!1,doubleClickZoom:!1,scrollZoom:!1,dragRotate:!1,maxZoom:17,minZoom:3,logoControl:!1,preserveDrawingBuffer:!0}),this.on("moveend",this.__onMove),setTimeout(function(){var i=e.default$2.document.createElement("div");t.overviewMapInstance.getCanvas().style.cursor="";var a=t.getBounds(),o=t.overviewMapInstance.project(a.getSouthWest()),r=t.overviewMapInstance.project(a.getNorthEast());r.y<=45&&(r=new e.default$1(r.x,45)),o.x<=45&&(o=new e.default$1(45,o.y)),i.style.top=Math.round(r.y)+"px",i.style.left=Math.round(o.x)+"px",i.style.width=Math.round(160-2*o.x)+"px",i.style.height=Math.round(160-2*r.y)+"px",i.style.border="2px solid red",i.style.position="absolute",t._overviewMapElement.appendChild(i),Ma.init({handler:t._overviewMapElement,root:i,restrictX:2*Math.round(o.x),restrictY:2*Math.round(r.y),cb:function(e,a){if(e-Math.round(o.x)!=0||a-Math.round(r.y)!=0){var n=t.overviewMapInstance.unproject([e-Math.round(o.x)+80,a-Math.round(r.y)+80]);t.flyTo({center:n,bearing:t.overviewMapInstance.getBearing()}),i.style.top=Math.round(r.y)+"px",i.style.left=Math.round(o.x)+"px";}}});},1e3);},a.prototype.openOverviewMap=function(e){this._overviewMap=e,this.overviewMapInstance?this._overviewMapElement.style.display="block":this.addOverviewMap();},a.prototype.closeOverviewMap=function(){this.overviewMapInstance&&(this._overviewMapElement.style.display="none");},a.prototype.getOverviewMap=function(){return this._overviewMap},a.prototype.addControl=function(e,t){void 0===t&&e.getDefaultPosition&&(t=e.getDefaultPosition()),void 0===t&&(t="top-right");var i=e.onAdd(this),a=this._controlPositions[t];return-1!==t.indexOf("bottom")?a.insertBefore(i,a.firstChild):a.appendChild(i),this},a.prototype.removeControl=function(e){return e.onRemove(this),this},a.prototype.resize=function(t){var i=this._containerDimensions(),a=i[0],o=i[1];return this._resizeCanvas(a,o),this.transform.resize(a,o),this.painter.resize(a,o),this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t)).fire(new e.Event("resize",t)).fire(new e.Event("moveend",t)),this},a.prototype.getBounds=function(){return(new e.default$9).extend(this.transform.pointLocation(new e.default$1(0,0))).extend(this.transform.pointLocation(new e.default$1(this.transform.width,0))).extend(this.transform.pointLocation(new e.default$1(this.transform.width,this.transform.height))).extend(this.transform.pointLocation(new e.default$1(0,this.transform.height)))},a.prototype.getMaxBounds=function(){return this.transform.latRange&&2===this.transform.latRange.length&&this.transform.lngRange&&2===this.transform.lngRange.length?new e.default$9([this.transform.lngRange[0],this.transform.latRange[0]],[this.transform.lngRange[1],this.transform.latRange[1]]):null},a.prototype.setMaxBounds=function(t){if(t){var i=e.default$9.convert(t);this.transform.lngRange=[i.getWest(),i.getEast()],this.transform.latRange=[i.getSouth(),i.getNorth()],this.transform._constrain(),this._update();}else null!==t&&void 0!==t||(this.transform.lngRange=null,this.transform.latRange=null,this._update());return this},a.prototype.setMinZoom=function(e){if((e=null===e||void 0===e?0:e)>=0&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")},a.prototype.getMinZoom=function(){return this.transform.minZoom},a.prototype.setMaxZoom=function(e){if((e=null===e||void 0===e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")},a.prototype.getMaxZoom=function(){return this.transform.maxZoom},a.prototype.project=function(t,i){return this.transform.locationPoint(e.default$13.convert(t),i)},a.prototype.unproject=function(t,i){return this.transform.pointLocation(e.default$1.convert(t),i)},a.prototype.isMoving=function(){return this._moving||this.dragPan.isActive()||this.dragRotate.isActive()||this.scrollZoom.isActive()},a.prototype.isZooming=function(){return this._zooming||this.scrollZoom.isActive()},a.prototype.isRotating=function(){return this._rotating||this.dragRotate.isActive()},a.prototype.on=function(e,t){return i.prototype.on.call(this,e,t)},a.prototype.off=function(e,t){return i.prototype.off.call(this,e,t)},a.prototype.queryRenderedFeatures=function(t,i){if(!this.style)return[];var a;if(void 0!==i||void 0===t||t instanceof e.default$1||Array.isArray(t)||(i=t,t=void 0),i=i||{},(t=t||[[0,0],[this.transform.width,this.transform.height]])instanceof e.default$1||"number"==typeof t[0])a=[e.default$1.convert(t)];else{var o=e.default$1.convert(t[0]),r=e.default$1.convert(t[1]);a=[o,new e.default$1(r.x,o.y),r,new e.default$1(o.x,r.y),o];}return this.style.queryRenderedFeatures(a,i,this.transform)},a.prototype.querySpherePosition=function(t,i){var a;a=t.point instanceof e.default$1?t.point:e.default$1.convert(t.point);var o=this.style.querySpherePosition({point:a},i);return this.triggerRepaint(),o},a.prototype.querySourceFeatures=function(e,t){return this.style.querySourceFeatures(e,t)},a.prototype.setStyle=function(t,i){return((i=e.extend({},{localIdeographFontFamily:ka.localIdeographFontFamily},i)).keepUserInfo||i.diff)&&this.style&&t?(this._diffStyle(t,i),this):this._updateStyle(t,i)},a.prototype._updateStyle=function(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),e?(this.style=new vt(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e),this):(delete this.style,this)},a.prototype._diffStyle=function(t,i){var a=this;if("string"==typeof t){var o=s(t),r=this._transformRequest(o,e.ResourceType.Style);e.getJSON(r,function(t,o){t?a.fire(new e.ErrorEvent(t)):o&&a._updateDiff(o,i);});}else"object"==typeof t&&this._updateDiff(t,i);},a.prototype._updateDiff=function(t,i){try{this.style.setState(t,i.keepUserInfo)&&this._update(!0);}catch(a){e.warnOnce("Unable to perform style diff: "+(a.message||a.error||a)+".  Rebuilding the style from scratch."),this._updateStyle(t,i);}},a.prototype.getStyle=function(){if(this.style)return this.style.serialize()},a.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():e.warnOnce("There is no style added to the map.")},a.prototype.addSource=function(e,t){return this.style.addSource(e,t),this._update(!0),this},a.prototype.isSourceLoaded=function(t){var i=this.style&&this.style.sourceCaches[t];if(void 0!==i)return i.loaded();this.fire(new e.ErrorEvent(new Error("There is no source with ID '"+t+"'")));},a.prototype.clipGround=function(e){this.clipGroundState=!0,e.addTo(this,!0);},a.prototype.removeClipGround=function(e){this.clipGroundState=!1,e.removeFrom(this);},a.prototype.areTilesLoaded=function(){var e=this.style&&this.style.sourceCaches;for(var t in e){var i=e[t]._tiles;for(var a in i){var o=i[a];if("loaded"!==o.state&&"errored"!==o.state)return!1}}return!0},a.prototype.addSourceType=function(e,t,i){return this.style.addSourceType(e,t,i)},a.prototype.removeSource=function(e){return this.style.removeSource(e),this._update(!0),this},a.prototype.getSource=function(e){return this.style.getSource(e)},a.prototype.addImage=function(t,i,a){void 0===a&&(a={});var o=a.pixelRatio;void 0===o&&(o=1);var r=a.sdf;if(void 0===r&&(r=!1),i instanceof Na){var n=e.default.getImageData(i),s=n.width,l=n.height,u=n.data;this.style.addImage(t,{data:new e.RGBAImage({width:s,height:l},u),pixelRatio:o,sdf:r});}else{if(void 0===i.width||void 0===i.height)return this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var c=i.width,_=i.height,f=i.data;this.style.addImage(t,{data:new e.RGBAImage({width:c,height:_},new Uint8Array(f)),pixelRatio:o,sdf:r});}},a.prototype.hasImage=function(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)},a.prototype.removeImage=function(e){this.style.removeImage(e);},a.prototype.loadImage=function(t,i){e.getImage(this._transformRequest(t,e.ResourceType.Image),i);},a.prototype.listImages=function(){return this.style.listImages()},a.prototype.addLayer=function(e,t){return this.style.addLayer(e,t),this._update(!0),this},a.prototype.moveLayer=function(e,t){return this.style.moveLayer(e,t),this._update(!0),this},a.prototype.removeLayer=function(e){return this.style.removeLayer(e),this._update(!0),this},a.prototype.getLayer=function(e){return this.style.getLayer(e)},a.prototype.setFilter=function(e,t){return this.style.setFilter(e,t),this._update(!0),this},a.prototype.setSourceFilter=function(e,t){return this.style.setSourceFilter(e,t),this._update(!0),this},a.prototype.setLayerZoomRange=function(e,t,i){return this.style.setLayerZoomRange(e,t,i),this._update(!0),this},a.prototype.getFilter=function(e){return this.style.getFilter(e)},a.prototype.setPaintProperty=function(e,t,i){return this.style.setPaintProperty(e,t,i),this._update(!0),this},a.prototype.getPaintProperty=function(e,t){return this.style.getPaintProperty(e,t)},a.prototype.setLayoutProperty=function(e,t,i){return this.style.setLayoutProperty(e,t,i),this._update(!0),this},a.prototype.getLayoutProperty=function(e,t){return this.style.getLayoutProperty(e,t)},a.prototype.setLight=function(e){return this.style.setLight(e),this._update(!0),this},a.prototype.getLight=function(){return this.style.getLight()},a.prototype.setSunLight=function(e){this.sunLight._sunLightPosition(e),this._update(!0);},a.prototype.enableSunLight=function(){this.style.enableSunLight(),this._update(!0);},a.prototype.disableSunLight=function(){this.style.disableSunLight(),this._update(!0);},a.prototype.enableShadow=function(){this.openCameraView(e.default$11.CAMERA.SUNLIGHT_CAMERA_ID),this._shadowFlag=!0,this._update(!0);},a.prototype.disableShadow=function(){this.closeCameraView(e.default$11.CAMERA.SUNLIGHT_CAMERA_ID),this._shadowFlag=!1,this._update(!0);},a.prototype.setFeatureState=function(e,t){this.style.setFeatureState(e,t),this._update();},a.prototype.getFeatureState=function(e){return this.style.getFeatureState(e)},a.prototype.getContainer=function(){return this._container},a.prototype.getCanvasContainer=function(){return this._canvasContainer},a.prototype.getCanvas=function(){return this._canvas},a.prototype._containerDimensions=function(){var e=0,t=0;return this._container&&(e=this._container.offsetWidth||400,t=this._container.offsetHeight||300),[e,t]},a.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==e.default$2.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("minemap.css加载失败或者版本不正确");},a.prototype._setupContainer=function(){var e=this._container;e.classList.add("minemap-map"),(this._missingCSSCanary=d.create("div","minemap-canary",e)).style.visibility="hidden",this._detectMissingCSS();var t=this._canvasContainer=d.create("div","minemap-canvas-container",e);this._interactive&&t.classList.add("minemap-interactive"),this._canvas=d.create("canvas","minemap-canvas",t),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var i=this._containerDimensions();this._resizeCanvas(i[0],i[1]);var a=this._controlContainer=d.create("div","minemap-control-container",e),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(e){o[e]=d.create("div","minemap-ctrl-"+e,a);});},a.prototype._resizeCanvas=function(t,i){var a=e.default$2.devicePixelRatio||1;this._canvas.width=a*t,this._canvas.height=a*i,this._canvas.style.width=t+"px",this._canvas.style.height=i+"px";},a.prototype._setupPainter=function(){var i=e.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},t.webGLContextAttributes),a=this._canvas.getContext("webgl",i)||this._canvas.getContext("experimental-webgl",i);a?this.painter=new Zi(a,this.transform,this):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")));},a.prototype._contextLost=function(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}));},a.prototype._contextRestored=function(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}));},a.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!(!this.style||!this.style.loaded())},a.prototype._update=function(e){this.style&&(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint());},a.prototype._requestRenderFrame=function(e){return this._update(),this._renderTaskQueue.add(e)},a.prototype._cancelRenderFrame=function(e){this._renderTaskQueue.remove(e);},a.prototype._render=function(){this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run();var t=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var i=this.transform.zoom,a=e.default.now();this.style.zoomHistory.update(i,a);var o=new e.default$20(i,{now:a,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),r=o.crossFadingFactor();1===r&&r===this._crossFadingFactor||(t=!0,this._crossFadingFactor=r),this.style.update(o);}return this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),fadeDuration:this._fadeDuration}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&(this.style.hasTransitions()||t)&&(this._styleDirty=!0),(this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty)&&this.triggerRepaint(),this},a.prototype.remove=function(){this._hash&&this._hash.remove(),this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.setStyle(null),void 0!==e.default$2&&(e.default$2.removeEventListener("resize",this._onWindowResize,!1),e.default$2.removeEventListener("online",this._onWindowOnline,!1));var t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),Ua(this._canvasContainer),Ua(this._controlContainer),Ua(this._missingCSSCanary),this._container.classList.remove("minemap-map"),this.fire(new e.Event("remove"));},a.prototype.triggerRepaint=function(){var t=this;this.style&&!this._frame&&(this._frame=e.default.frame(function(){t._frame=null,t._render(),t.timer.update();}));},a.prototype._rerender=function(){var t=this;this.style&&!this._frame&&(this._frame=e.default.frame(function(){t._frame=null,t._render(),t.timer.update();}));},a.prototype._onWindowOnline=function(){this._update();},a.prototype._onWindowResize=function(){this._trackResize&&this.resize()._update();},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update());},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update());},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update());},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(e){this._repaint=e,this.timer.state=!!e,this._update();},o.sphereRender.get=function(){return!!this.mapControl.sphereRender},o.sphereRender.set=function(e){this.mapControl.sphereRender=e,this.setCenter([this.getCenter().lng+1e-7,this.getCenter().lat]),this._update(!0);},o.fxaaRender.set=function(e){this._fxaaRender=e;},o.fxaaRender.get=function(){return this._fxaaRender},o.bloomRender.set=function(e){this._bloomRender=e;},o.bloomRender.get=function(){return this._bloomRender},a.prototype.setBloomOptions=function(e){e&&(this._bloomOptions=e);},o.projection.get=function(){return this.mapControl._projection},o.projection.set=function(t){t!==e.ProjectionType.MERCATOR&&t!==e.ProjectionType.LATLON||(this.mapControl._projection=t);},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(e){this._vertices=e,this._update();},a.prototype._onData=function(t){this._update("style"===t.dataType),this.fire(new e.Event(t.dataType+"data",t));},a.prototype._onDataLoading=function(t){this.fire(new e.Event(t.dataType+"dataloading",t));},o.panoramaMode.get=function(){return this._panoramaMode},o.panoramaMode.set=function(e){this._panoramaMode=e,this.transform.panoramaMode=e,this.triggerRepaint();},o.fPMode.get=function(){return this.transform.fPMode},o.fPMode.set=function(e){this.transform.fPMode=e;},o.cameraHeightOffset.set=function(e){this.transform.cameraHeightOffset=e;},o.cameraHeightOffset.get=function(){return this.transform.cameraHeightOffset},a.prototype.setDemMaxTiles=function(e){e&&(this.transform.maxTiles=e);},a.prototype.addCameraView=function(e,t){return this.td_cameraManager.addCameraView(e,t)},a.prototype.deleteCameraView=function(e){return this.td_cameraManager.deleteCameraView(e)},a.prototype.openCameraView=function(e){return this.td_cameraManager.openCameraView(e)},a.prototype.closeCameraView=function(e){return this.td_cameraManager.closeCameraView(e)},a.prototype.getCameraView=function(e){return this.td_cameraManager.getCameraView(e)},a.prototype.getAllActiveCameraViews=function(){return this.td_cameraManager.getAllActiveCameraViews()},a.prototype.modifyCameraViewGroup=function(e){this.td_cameraManager.modifyCameraViewGroup(e);},a.prototype.modifyCameraViewById=function(e,t){this.td_cameraManager.modifyCameraViewById(e,t);},a.prototype.getTranslatedLngLatPoint=function(t,i){return e.getTranslatedLngLatPoint(t,i)},a.prototype.getCameraViewOptionFromStartEnd=function(t,i){var a=e.calcLocalCoords(i,t),o=a[0],r=a[1],n=a[2],s=Math.atan2(n,o)*(180/Math.PI),l=e.length(a),u=Math.atan(r/Math.sqrt(o*o+n*n));return{distance:l,bearing:s,pitch:u=180*u/Math.PI}},a.prototype.getTDSpaceCoord=function(t){if(t.disableLayer){var i=this.unproject(t.point,0);return{lngLat:i,geographic:i?e.transformECEFToGeographic([],i.toArray(),e.default$11.TRANSFORM.REAL_R):null,altitude:0}}var a=this.queryRenderedFeatures(t.point,{disableLayer:!1,modelHighlight:t.modelHighlight});if(0!==a.length&&a[0].intersectionPoint){var o=a[0].intersectionPoint,r=e.transformGeographicToECEF([],o);return{geographic:o,lngLat:new e.default$13(r[0],r[1]),altitude:(r[2]-e.default$11.TRANSFORM.R)*e.default$11.TRANSFORM.R_ZOOM}}var n=this.unproject(t.point,0);return{lngLat:n,geographic:n?e.transformECEFToGeographic([],n.toArray(),e.default$11.TRANSFORM.REAL_R):null,altitude:0}},a.prototype.getCameraHeight=function(){return(this.transform.alt*e.default$11.TRANSFORM.R_ZOOM).toFixed(2)},Object.defineProperties(a.prototype,o),a}(fa);function Ua(e){e.parentNode&&e.parentNode.removeChild(e);}var Va={showCompass:!0,showZoom:!0},Ga=function(t){var i=this;this.options=e.extend({},Va,t),this._container=d.create("div","minemap-ctrl minemap-ctrl-group"),this._container.addEventListener("contextmenu",function(e){return e.preventDefault()}),this.options.showZoom&&(this._zoomInButton=this._createButton("minemap-ctrl-icon minemap-ctrl-zoom-in","Zoom In",function(){return i._map.zoomIn()}),this._zoomOutButton=this._createButton("minemap-ctrl-icon minemap-ctrl-zoom-out","Zoom Out",function(){return i._map.zoomOut()})),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("minemap-ctrl-icon minemap-ctrl-compass","Reset North",function(){return i._map.resetNorth()}),this._compassArrow=d.create("span","minemap-ctrl-compass-arrow",this._compass));};Ga.prototype._rotateCompassArrow=function(e){var t=this._map.panoramaMode?"rotate("+e.angle+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t;},Ga.prototype.onAdd=function(e){return this._map=e,this.options.showCompass&&(this._map.on("rotate",this._rotateCompassArrow),this._map.on("panorama-change-bearing",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new aa(e,{button:"left",element:this._compass}),d.addEventListener(this._compass,"mousedown",this._handler.onMouseDown),this._handler.enable()),this._container},Ga.prototype.onRemove=function(){d.remove(this._container),this.options.showCompass&&(this._map.off("rotate",this._rotateCompassArrow),this._map.off("panorama-change-bearing",this._rotateCompassArrow),d.removeEventListener(this._compass,"mousedown",this._handler.onMouseDown),this._handler.disable(),delete this._handler),delete this._map;},Ga.prototype._createButton=function(e,t,i){var a=d.create("button",e,this._container);return a.type="button",a.setAttribute("aria-label",t),a.addEventListener("click",i),a};var Xa,Wa={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0};var ja=function(t){function i(i){t.call(this),this.options=e.extend({},Wa,i),e.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker"],this);}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.onAdd=function(t){var i;return this._map=t,this._container=d.create("div","minemap-ctrl minemap-ctrl-group"),i=this._setupUI,void 0!==Xa?i(Xa):void 0!==e.default$2.navigator.permissions?e.default$2.navigator.permissions.query({name:"geolocation"}).then(function(e){Xa="denied"!==e.state,i(Xa);}):(Xa=!!e.default$2.navigator.geolocation,i(Xa)),this._container},i.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(e.default$2.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker.remove(),d.remove(this._container),this._map=void 0;},i.prototype._onSuccess=function(t){if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background");}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("minemap-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish();},i.prototype._updateCamera=function(t){var i=new e.default$13(t.coords.longitude,t.coords.latitude),a=t.coords.accuracy;this._map.fitBounds(i.toBounds(a),this.options.fitBoundsOptions,{geolocateSource:!0});},i.prototype._updateMarker=function(e){e?this._userLocationDotMarker.setLngLat([e.coords.longitude,e.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove();},i.prototype._onError=function(t){if(this.options.trackUserLocation)if(1===t.code)this._watchState="OFF",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting");}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("minemap-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish();},i.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0;},i.prototype._setupUI=function(t){var i=this;!1!==t?(this._container.addEventListener("contextmenu",function(e){return e.preventDefault()}),this._geolocateButton=d.create("button","minemap-ctrl-icon minemap-ctrl-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=d.create("div","minemap-user-location-dot"),this._userLocationDotMarker=new Fa(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(t){t.geolocateSource||"ACTIVE_LOCK"!==i._watchState||(i._watchState="BACKGROUND",i._geolocateButton.classList.add("minemap-ctrl-geolocate-background"),i._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),i.fire(new e.Event("trackuserlocationend")));})):e.warnOnce("Geolocation support is not available, the GeolocateControl will not be visible.");},i.prototype.trigger=function(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("minemap-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"));}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("minemap-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("minemap-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("minemap-ctrl-geolocate-background-error");}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("minemap-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=e.default$2.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions));}else e.default$2.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},i.prototype._clearWatch=function(){e.default$2.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("minemap-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null);},i}(e.Evented),Ya={maxWidth:100,unit:"metric"},Za=function(t){this.options=e.extend({},Ya,t),e.bindAll(["_onMove","setUnit"],this);};function qa(e,t,i,a){var o,r,n,s,l,u,c=a&&a.maxWidth||100,_=e._container.clientHeight/2,f=e._container.clientWidth/2,m=(o=e.unproject([f,_]),r=e.unproject([f+1,_]),n=Math.PI/180,s=o.lat*n,l=r.lat*n,u=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((r.lng-o.lng)*n),6371e3*Math.acos(Math.min(u,1))*c);if(a&&"imperial"===a.unit){var p=3.2808*m;if(p>5280)Qa(t,i,c,p/5280,"mi");else Qa(t,i,c,p,"ft");}else if(a&&"nautical"===a.unit){Qa(t,i,c,m/1852,"nm");}else Qa(t,i,c,m,"m");}function Qa(e,t,i,a,o){var r,n,s,l=(r=a,(n=Math.pow(10,(""+Math.floor(r)).length-1))*(s=(s=r/n)>=10?10:s>=5?5:s>=3?3:s>=2?2:1)),u=l/a;"m"===o&&l>=1e3&&(l/=1e3,o="km"),e.style.width=i*u+"px",t.innerHTML=l+o;}Za.prototype.getDefaultPosition=function(){return"bottom-left"},Za.prototype._onMove=function(){qa(this._map,this._container,this._content,this.options);},Za.prototype.onAdd=function(e){this._map=e,this._container=d.create("div","minemap-ctrl minemap-ctrl-scale",e.getContainer()),this._content=d.create("div","minemap-ctrl-scale-text",this._container),this._container.appendChild(this._content);var t=d.create("div","minemap-ctrl-scale-left-bar",this._container),i=d.create("div","minemap-ctrl-scale-right-bar",this._container),a=d.create("div","minemap-ctrl-scale-bottom-bar",this._container);return this._container.appendChild(t),this._container.appendChild(i),this._container.appendChild(a),this._map.on("move",this._onMove),this._onMove(),this._container},Za.prototype.onRemove=function(){d.remove(this._container),this._map.off("move",this._onMove),this._map=void 0;},Za.prototype.setUnit=function(e){this.options.unit=e,qa(this._map,this._container,this._content,this.options);};var Ha=function(){this._fullscreen=!1,e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.default$2.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in e.default$2.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in e.default$2.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in e.default$2.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="minemap-ctrl";};Ha.prototype.onAdd=function(t){return this._map=t,this._mapContainer=this._map.getContainer(),this._container=d.create("div",this._className+" minemap-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._container.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._container},Ha.prototype.onRemove=function(){d.remove(this._container),this._map=null,e.default$2.document.removeEventListener(this._fullscreenchange,this._changeIcon);},Ha.prototype._checkFullscreenSupport=function(){return!!(e.default$2.document.fullscreenEnabled||e.default$2.document.mozFullScreenEnabled||e.default$2.document.msFullscreenEnabled||e.default$2.document.webkitFullscreenEnabled)},Ha.prototype._setupUI=function(){var t=this._fullscreenButton=d.create("button",this._className+"-icon "+this._className+"-fullscreen",this._container);t.setAttribute("aria-label","Toggle fullscreen"),t.type="button",this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.default$2.document.addEventListener(this._fullscreenchange,this._changeIcon);},Ha.prototype._isFullscreen=function(){return this._fullscreen},Ha.prototype._changeIcon=function(){(e.default$2.document.fullscreenElement||e.default$2.document.mozFullScreenElement||e.default$2.document.webkitFullscreenElement||e.default$2.document.msFullscreenElement)===this._mapContainer!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(this._className+"-shrink"),this._fullscreenButton.classList.toggle(this._className+"-fullscreen"));},Ha.prototype._onClickFullscreen=function(){this._isFullscreen()?e.default$2.document.exitFullscreen?e.default$2.document.exitFullscreen():e.default$2.document.mozCancelFullScreen?e.default$2.document.mozCancelFullScreen():e.default$2.document.msExitFullscreen?e.default$2.document.msExitFullscreen():e.default$2.document.webkitCancelFullScreen&&e.default$2.document.webkitCancelFullScreen():this._mapContainer.requestFullscreen?this._mapContainer.requestFullscreen():this._mapContainer.mozRequestFullScreen?this._mapContainer.mozRequestFullScreen():this._mapContainer.msRequestFullscreen?this._mapContainer.msRequestFullscreen():this._mapContainer.webkitRequestFullscreen&&this._mapContainer.webkitRequestFullscreen();};var Ka={closeButton:!0,closeOnClick:!0,className:"",maxWidth:"240px"},Ja=function(t){function i(i){t.call(this),this.options=e.extend(Object.create(Ka),i),this._alt=0,e.bindAll(["_update","remove","_onMouseMove","_onMouseUp","_onDrag","_onClickClose"],this);}return t&&(i.__proto__=t),i.prototype=Object.create(t&&t.prototype),i.prototype.constructor=i,i.prototype.addTo=function(t){return this._map=t,this.options.closeOnClick&&this._map.on("click",this._onClickClose),this.options.closeOnMove&&this._map.on("move",this._onClickClose),this._map.on("remove",this.remove),this._update(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("minemap-popup-track-pointer"),this._map._canvasContainer.classList.add("minemap-track-pointer")):this._map.on("move",this._update),this.fire(new e.Event("open")),this},i.prototype.isOpen=function(){return!!this._map},i.prototype.remove=function(){return this._content&&d.remove(this._content),this._container&&(d.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),this._map.off("move",this._onClickClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new e.Event("close")),this},i.prototype.getLngLat=function(){return this._lngLat},i.prototype.setLngLat=function(t){return this._lngLat=e.default$13.convert(t),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("minemap-popup-track-pointer"),this._map._canvasContainer.classList.remove("minemap-track-pointer")),this},i.prototype.getAltitude=function(){return this._alt},i.prototype.setAltitude=function(e){return this._alt=e,this._pos=null,this._update(),this._trackPointer=!1,this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("minemap-popup-track-pointer"),this._map._canvasContainer.classList.remove("minemap-track-pointer")),this},i.prototype.setText=function(t){return this.setDOMContent(e.default$2.document.createTextNode(t))},i.prototype.setHTML=function(t){var i,a=e.default$2.document.createDocumentFragment(),o=e.default$2.document.createElement("body");for(o.innerHTML=t;i=o.firstChild;)a.appendChild(i);return this.setDOMContent(a)},i.prototype.setDOMContent=function(e){return this._createContent(),this._content.appendChild(e),this._update(),this},i.prototype._createContent=function(){this._content&&d.remove(this._content),this._content=d.create("div","minemap-popup-content",this._container),this.options.closeButton&&(this._closeButton=d.create("button","minemap-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose));},i.prototype._update=function(t){var i=this,a=this._lngLat||this._trackPointer;if(this._map&&a&&this._content&&(this._container||(this._container=d.create("div","minemap-popup",this._map.getContainer()),this._tip=d.create("div","minemap-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(e){return i._container.classList.add(e)}),this._trackPointer&&this._container.classList.add("minemap-popup-track-pointer")),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ra(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||t)){var o=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat,this._alt),r=this.options.anchor,n=function t(i){if(i){if("number"==typeof i){var a=Math.round(Math.sqrt(.5*Math.pow(i,2)));return{center:new e.default$1(0,0),top:new e.default$1(0,i),"top-left":new e.default$1(a,a),"top-right":new e.default$1(-a,a),bottom:new e.default$1(0,-i),"bottom-left":new e.default$1(a,-a),"bottom-right":new e.default$1(-a,-a),left:new e.default$1(i,0),right:new e.default$1(-i,0)}}if(i instanceof e.default$1||Array.isArray(i)){var o=e.default$1.convert(i);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:e.default$1.convert(i.center||[0,0]),top:e.default$1.convert(i.top||[0,0]),"top-left":e.default$1.convert(i["top-left"]||[0,0]),"top-right":e.default$1.convert(i["top-right"]||[0,0]),bottom:e.default$1.convert(i.bottom||[0,0]),"bottom-left":e.default$1.convert(i["bottom-left"]||[0,0]),"bottom-right":e.default$1.convert(i["bottom-right"]||[0,0]),left:e.default$1.convert(i.left||[0,0]),right:e.default$1.convert(i.right||[0,0])}}return t(new e.default$1(0,0))}(this.options.offset);if(!r){var s,l=this._container.offsetWidth,u=this._container.offsetHeight;s=o.y+n.bottom.y<u?["top"]:o.y>this._map.transform.height-u?["bottom"]:[],o.x<l/2?s.push("left"):o.x>this._map.transform.width-l/2&&s.push("right"),r=0===s.length?"bottom":s.join("-");}var c=o.add(n[r]).round();if(d.setTransform(this._container,Ca[r]+" translate("+c.x+"px,"+c.y+"px)"),Oa(this._container,r,"popup"),this._map.sphereRender&&!this._trackPointer){var _=this._map.transform.locationPointOfScreen(this._lngLat,this._alt);this._map.panoramaMode?_.w>0?this._container.style.visibility="hidden":this._container.style.visibility="visible":!this._map.transform.checkPositionForeground(this._lngLat)||_.w<0?this._container.style.visibility="hidden":this._container.style.visibility="visible";}}},i.prototype._onClickClose=function(){this.remove();},i.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("minemap-popup-track-pointer"),this._map._canvasContainer.classList.add("minemap-track-pointer")),this},i.prototype.getElement=function(){return this._container},i.prototype.getMap=function(){return this._map},i.prototype._onDrag=function(e){this._update(e.point);},i.prototype._onMouseUp=function(e){this._update(e.point);},i.prototype._onMouseMove=function(e){this._update(e.point);},i}(e.Evented);var eo={getJSON:e.getJSON,getArrayBuffer:e.getArrayBuffer},to={version:"3.1.6",supported:t,workerCount:Math.max(Math.floor(e.default.hardwareConcurrency/2),1),setRTLTextPlugin:e.setRTLTextPlugin,Map:$a,Navigation:Ga,Geolocate:ja,Attribution:ma,Scale:Za,Fullscreen:Ha,Popup:Ja,Marker:Fa,Style:vt,LngLat:e.default$13,LngLatBounds:e.default$9,Point:e.default$1,Evented:e.Evented,config:i,ProjectionType:e.ProjectionType,util:eo,R:e.default$11.TRANSFORM.R,get accessToken(){return i.ACCESS_TOKEN},set accessToken(e){i.ACCESS_TOKEN=e;},get appKey(){return i.APP_KEY},set appKey(e){i.APP_KEY=e;},get solution(){return i.SOLU},set solution(e){i.SOLU=e;},get dataVersion(){return i.DATA_VERSION},set dataVersion(e){i.DATA_VERSION=e;},get TRW(){return i.TRW},set TRW(e){i.TRW=e;},get spriteUrl(){return i.spriteUrl},set spriteUrl(e){i.spriteUrl=e;},get fontsUrl(){return i.fontsUrl},set fontsUrl(e){i.fontsUrl=e;},get serviceUrl(){return i.SERVICE_URL},set serviceUrl(e){i.SERVICE_URL=e;},get domainUrl(){return i.DOMAIN},set domainUrl(e){i.DOMAIN=e,i.SRC_URL=i.DOMAIN+i.SRC_BASE,i.SERVICE_URL=i.DOMAIN+i.SERVICE_BASE;},get dataDomainUrl(){return i.DATA_DOMAIN},set dataDomainUrl(e){i.DATA_DOMAIN=e,Array.isArray(e)?(i.API_URL=i.DATA_DOMAIN.map(function(e){return e+i.API_BASE}),i.DYN_URL=i.DATA_DOMAIN.map(function(e){return e+i.DYN_BASE}),i.MERGE_URL=i.DATA_DOMAIN.map(function(e){return e+i.MERGE_BASE}),i.OTHER_URL=i.DATA_DOMAIN.map(function(e){return e+i.OTHER_BASE})):(i.API_URL=i.DATA_DOMAIN+i.API_BASE,i.DYN_URL=i.DATA_DOMAIN+i.DYN_BASE,i.MERGE_URL=i.DATA_DOMAIN+i.MERGE_BASE,i.OTHER_URL=i.DATA_DOMAIN+i.OTHER_BASE);},workerUrl:""};return to});

return minemap;

})));
